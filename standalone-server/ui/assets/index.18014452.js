import{u as D,b5 as B,a as c,bq as O,t as d,d as M,at as $,w as q,e as F,ba as A,c as a,bJ as G,ak as H}from"./index.536c7d72.js";import{_ as V}from"./lodash.bce5b897.js";import{u as J}from"./index.990798b2.js";import{u as X}from"./use-text-copy.f14b4440.js";import{j as Q,k as Y,l as E,r as Z,f as ee,m as oe}from"./index.22428b53.js";import te from"./table-action.7d8f0922.js";import{s as re,S as ae}from"./start-modal.5f428608.js";import{B as se}from"./index.eb38a2cf.js";import{D as ie,C as l,c as le}from"./column-width-config.7df9c412.js";import{C as ne}from"./CopyOutlined.6f3bd1e0.js";import{N as pe}from"./Ellipsis.b0d6a040.js";import{N as w}from"./Space.8c5cfc39.js";import{N as P}from"./Icon.36d6d904.js";import{N as f}from"./Button.9dd5ee3c.js";import{d as K}from"./Selection.2ed26059.js";import{C as I}from"./index.67b00418.js";import ce from"./import-modal.21c762bf.js";import de from"./timing-modal.34fda901.js";import me from"./version-modal.80356484.js";import we from"./copy-modal.ed38be1c.js";import{S as fe}from"./SearchOutlined.b0711796.js";import{N as he}from"./Input.4b8b409e.js";import{N as ue,a as ke}from"./DataTable.4d10e01f.js";import{N as v}from"./Tooltip.2dc588a0.js";import{N as ge}from"./Popconfirm.f3bbced5.js";import"./use-message.243250a9.js";import"./service.4ca56d82.js";import"./FormOutlined.36940f0d.js";import"./PlayCircleOutlined.a491bf9f.js";import"./DownloadOutlined.e576ca2a.js";import"./InfoCircleFilled.9f54e30c.js";import"./DeleteOutlined.0c0bc8fc.js";import"./ApartmentOutlined.393548b4.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.12a336d2.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./use-locale.31127f4e.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./index.7a579f81.js";import"./index.4d9d5980.js";import"./Card.1fac8dc8.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./use-modal.50ac9826.js";import"./index.5b6233e7.js";import"./index.5342f370.js";import"./index.393f36dd.js";import"./index.67996f97.js";import"./common.cc1e0c6c.js";import"./SettingOutlined.06d5d07d.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./CloseCircleOutlined.14b6a996.js";import"./CheckCircleOutlined.4f0aee70.js";import"./EditOutlined.57b65af3.js";import"./index.9c0cbe29.js";import"./ArrowUpOutlined.6047a6cd.js";import"./PlusCircleOutlined.da9dc67f.js";import"./Form.b918a62f.js";import"./FormItem.67716b88.js";import"./RadioGroup.5a44255f.js";import"./Radio.8f1c774c.js";import"./Select.eddb521d.js";import"./Checkbox.9b98fe51.js";import"./RadioButton.c57a94c4.js";import"./DatePicker.9d2907ba.js";import"./use-keyboard.3c40c702.js";import"./Forward.5223a2c3.js";import"./Switch.57a995f1.js";import"./Suffix.4fa63b0d.js";import"./Upload.ebcdcc1c.js";import"./Add.4fb6bf29.js";import"./Image.54674f30.js";import"./CloudUploadOutlined.753210e3.js";import"./timezone.01550da9.js";import"./InputNumber.1f688029.js";import"./Tabs.5c3bb5ac.js";import"./throttle.25c0ae05.js";import"./debounce.8aa2d6ba.js";import"./toNumber.c47a71ca.js";import"./InputGroup.4428ca06.js";import"./ExclamationCircleOutlined.61140060.js";import"./ArrowDown.e4a7e0d5.js";import"./Dropdown.8c20a4f5.js";import"./ChevronRight.ffdb37b1.js";import"./index.40581ef3.js";function ye(){const{t:s}=D(),n=O(),{copy:i}=X(),e=B({columns:[],tableWidth:ie,checkedRowKeys:[],row:{},tableData:[],projectCode:c(Number(n.currentRoute.value.params.projectCode)),page:c(1),pageSize:c(10),searchVal:c(),totalPage:c(1),showRef:c(!1),startShowRef:c(!1),timingShowRef:c(!1),versionShowRef:c(!1),copyShowRef:c(!1),loadingRef:c(!1)}),o=t=>{t.columns=[{type:"selection",className:"btn-selected",...l.selection},{title:"#",key:"id",...l.index,render:(r,p)=>p+1},{title:s("project.workflow.workflow_name"),key:"name",className:"workflow-name",...l.name,titleColSpan:2,render:r=>d(w,{justify:"space-between",wrap:!1,class:re["workflow-name"]},{default:()=>d(se,{onClick:()=>void n.push({name:"workflow-definition-detail",params:{code:r.code}})},{default:()=>d(pe,l.linkEllipsis,()=>r.name)})})},{title:"Copy",key:"copy",...l.copy,render:r=>d(f,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>void i(r.name)},{icon:()=>d(P,{size:16},()=>d(ne))})},{title:s("project.workflow.status"),key:"releaseState",...l.state,render:r=>r.releaseState==="ONLINE"?s("project.workflow.up_line"):s("project.workflow.down_line")},{title:s("project.workflow.create_time"),key:"createTime",...l.time},{title:s("project.workflow.update_time"),key:"updateTime",...l.time},{title:s("project.workflow.description"),key:"description",...l.note},{title:s("project.workflow.create_user"),key:"userName",...l.userName},{title:s("project.workflow.modify_user"),key:"modifyBy",...l.userName},{title:s("project.workflow.schedule_publish_status"),key:"scheduleReleaseState",...l.state,render:r=>r.scheduleReleaseState==="ONLINE"?d(K,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):r.scheduleReleaseState==="OFFLINE"?d(K,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")}):"-"},{title:s("project.workflow.operation"),key:"operation",...l.operation(10),render:r=>d(te,{row:r,onEditWorkflow:()=>y(r),onStartWorkflow:()=>C(r),onTimingWorkflow:()=>S(r),onVersionWorkflow:()=>R(r),onDeleteWorkflow:()=>m(r),onReleaseWorkflow:()=>U(r),onCopyWorkflow:()=>_(r),onExportWorkflow:()=>L(r),onGotoTimingManage:()=>j(r),onGotoWorkflowTree:()=>x(r)})}],t.tableWidth&&(t.tableWidth=le(t.columns))},y=t=>{e.row=t,n.push({name:"workflow-definition-detail",params:{code:t.code}})},C=t=>{e.startShowRef=!0,e.row=t},S=t=>{e.timingShowRef=!0,e.row=t},R=t=>{e.versionShowRef=!0,e.row=t},m=t=>{Q(e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},N=()=>{const t={codes:V.join(e.checkedRowKeys,",")};Y(t,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},W=()=>{const t="workflow_"+new Date().getTime(),r={codes:V.join(e.checkedRowKeys,",")};E(r,e.projectCode).then(p=>{b(p,t),window.$message.success(s("project.workflow.success")),e.checkedRowKeys=[]})},z=()=>{},U=t=>{const r={name:t.name,releaseState:t.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};Z(r,e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},_=t=>{const r={codes:String(t.code),targetProjectCode:e.projectCode};ee(r,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},b=(t,r="json")=>{if(!t)return;const p=new Blob([t]),h=`${r}.json`;if("download"in document.createElement("a")){const T=window.URL.createObjectURL(p),u=document.createElement("a");u.style.display="none",u.href=T,u.setAttribute("download",h),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(T)}else window.navigator.msSaveBlob&&window.navigator.msSaveBlob(p,h)},L=t=>{const r="workflow_"+new Date().getTime(),p={codes:String(t.code)};E(p,e.projectCode).then(h=>{b(h,r)})},j=t=>{n.push({name:"workflow-definition-timing",params:{projectCode:e.projectCode,definitionCode:t.code}})},x=t=>{n.push({name:"workflow-definition-tree",params:{projectCode:e.projectCode,definitionCode:t.code}})},k=t=>{if(e.loadingRef)return;e.loadingRef=!0;const{state:r}=J(oe({...t},e.projectCode).then(p=>{e.totalPage=p.totalPage,e.tableData=p.totalList.map(h=>({...h})),e.loadingRef=!1}),{total:0,table:[]});return r};return{variables:e,createColumns:o,getTableData:k,batchDeleteWorkflow:N,batchExportWorkflow:W,batchCopyWorkflow:z}}function g(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!H(s)}const nt=M({name:"WorkflowDefinitionList",setup(){var j;const s=O(),n=G(),i=Number(n.params.projectCode),{variables:e,createColumns:o,getTableData:y,batchDeleteWorkflow:C,batchExportWorkflow:S,batchCopyWorkflow:R}=ye(),m=()=>{y({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})},N=()=>{m()},W=()=>{e.checkedRowKeys=[],m()},z=()=>{e.page=1,m()},U=()=>{e.page=1,y({pageSize:e.pageSize,pageNo:e.page,searchVal:""})},_=()=>{e.page=1,m()},b=()=>{s.push({path:`/projects/${i}/workflow/definitions/create`})},L=(j=$())==null?void 0:j.appContext.config.globalProperties.trim;return q(D().locale,()=>{o(e)}),F(()=>{o(e),m()}),{requestData:m,handleSearch:z,onClearSearch:U,handleUpdateList:N,createDefinition:b,handleChangePageSize:_,batchDeleteWorkflow:C,batchExportWorkflow:S,batchCopyWorkflow:R,handleCopyUpdateList:W,...A(e),trim:L}},render(){let s,n;const{t:i}=D(),{loadingRef:e}=this;return a(w,{vertical:!0},{default:()=>[a(I,null,{default:()=>[a(w,{justify:"space-between"},{default:()=>[a(w,null,{default:()=>[a(f,{type:"primary",size:"small",onClick:this.createDefinition,class:"btn-create-process"},g(s=i("project.workflow.create_workflow"))?s:{default:()=>[s]}),a(f,{strong:!0,secondary:!0,size:"small",onClick:()=>this.showRef=!0},g(n=i("project.workflow.import_workflow"))?n:{default:()=>[n]})]}),a(w,null,{default:()=>[a(he,{allowInput:this.trim,size:"small",placeholder:i("resource.function.enter_keyword_tips"),value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,clearable:!0,onClear:this.onClearSearch},null),a(f,{type:"primary",size:"small",onClick:this.handleSearch},{default:()=>[a(P,null,{default:()=>[a(fe,null,null)]})]})]})]})]}),a(I,{title:i("project.workflow.workflow_definition")},{default:()=>[a(w,{vertical:!0},{default:()=>[a(ue,{loading:e,rowKey:o=>o.code,columns:this.columns,data:this.tableData,striped:!0,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":o=>this.checkedRowKeys=o,"row-class-name":"items",scrollX:this.tableWidth},null),a(w,{justify:"space-between"},{default:()=>[a(w,null,{default:()=>[a(v,null,{default:()=>i("project.workflow.delete"),trigger:()=>a(ge,{onPositiveClick:this.batchDeleteWorkflow},{default:()=>i("project.workflow.delete_confirm"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,class:"btn-delete-all"},g(o=i("project.workflow.delete"))?o:{default:()=>[o]})}})}),a(v,null,{default:()=>i("project.workflow.export"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:this.batchExportWorkflow,class:"btn-delete-all"},g(o=i("project.workflow.export"))?o:{default:()=>[o]})}}),a(v,null,{default:()=>i("project.workflow.batch_copy"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:()=>this.copyShowRef=!0,class:"btn-delete-all"},g(o=i("project.workflow.batch_copy"))?o:{default:()=>[o]})}})]}),a(ke,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]})]}),a(ce,{show:this.showRef,"onUpdate:show":o=>this.showRef=o,onUpdateList:this.handleUpdateList},null),a(ae,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.startShowRef,"onUpdate:show":o=>this.startShowRef=o,onUpdateList:this.handleUpdateList},null),a(de,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.timingShowRef,"onUpdate:show":o=>this.timingShowRef=o,onUpdateList:this.handleUpdateList},null),a(me,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.versionShowRef,"onUpdate:show":o=>this.versionShowRef=o,onUpdateList:this.handleUpdateList},null),a(we,{codes:this.checkedRowKeys,"onUpdate:codes":o=>this.checkedRowKeys=o,show:this.copyShowRef,"onUpdate:show":o=>this.copyShowRef=o,onUpdateList:this.handleCopyUpdateList},null)]})}});export{nt as default};

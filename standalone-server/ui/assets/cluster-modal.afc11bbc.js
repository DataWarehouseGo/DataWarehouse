import{M as _}from"./index.4d9d5980.js";import{u as h,b5 as b,a as r,d as v,at as k,w as g,ba as M,c as n}from"./index.536c7d72.js";import{v as C,c as w,u as R}from"./index.54f6c7a0.js";import{N}from"./Form.b918a62f.js";import{N as l}from"./FormItem.67716b88.js";import{N as c}from"./Input.4b8b409e.js";import"./index.eb38a2cf.js";import"./Button.9dd5ee3c.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./keysOf.10525521.js";import"./Card.1fac8dc8.js";import"./index.7a579f81.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./utils.ba7f47bf.js";import"./Space.8c5cfc39.js";import"./get-slot.7f666ba0.js";import"./service.4ca56d82.js";import"./lodash.bce5b897.js";import"./format-length.a0cbed4d.js";import"./use-locale.31127f4e.js";import"./Suffix.4fa63b0d.js";function S(t,i){const{t:o}=h(),e=b({clusterFormRef:r(),model:{code:r(-1),name:r(""),k8s_config:r(""),yarn_config:r(""),description:r("")},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(e.model.name==="")return new Error(o("security.cluster.cluster_name_tips"))}},description:{required:!0,trigger:["input","blur"],validator(){if(e.model.description==="")return new Error(o("security.cluster.cluster_description_tips"))}}}}),d=async s=>{if(await e.clusterFormRef.validate(),!e.saving){e.saving=!0;try{s===0?await m():await u()}finally{e.saving=!1}}},m=()=>{C({clusterName:e.model.name}).then(()=>{const s={name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};w(s).then(()=>{e.model.name="",e.model.k8s_config="",e.model.yarn_config="",e.model.description="",i.emit("confirmModal",t.showModalRef)})})},u=()=>{const s={code:e.model.code,name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};R(s).then(()=>{i.emit("confirmModal",t.showModalRef)})};return{variables:e,handleValidate:d}}const I=`apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CZJQ0FURS0tLS0tCg==
    server: https://127.0.0.1:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CZJQ0FURS0tLS0tCg= 
`,F="In development...",ne=v({name:"ClusterModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(t,i){var f;const{variables:o,handleValidate:e}=S(t,i),{t:d}=h(),m=()=>{t.statusRef===0&&(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""),i.emit("cancelModal",t.showModalRef)},u=()=>{e(t.statusRef)},s=a=>{if(o.model.code=a.code,o.model.name=a.name,a.config){const p=JSON.parse(a.config);o.model.k8s_config=p.k8s||"",o.model.yarn_config=p.yarn||""}else o.model.k8s_config="",o.model.yarn_config="";o.model.description=a.description},y=(f=k())==null?void 0:f.appContext.config.globalProperties.trim;return g(()=>t.statusRef,()=>{t.statusRef===0?(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""):s(t.row)}),g(()=>t.row,()=>{s(t.row)}),{t:d,...M(o),cancelModal:m,confirmModal:u,trim:y}},render(){const{t}=this;return n("div",null,[n(_,{title:this.statusRef===0?t("security.cluster.create_cluster"):t("security.cluster.edit_cluster"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.name||!this.model.description,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>n(N,{model:this.model,rules:this.rules,ref:"clusterFormRef"},{default:()=>[n(l,{label:t("security.cluster.cluster_name"),path:"name"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-name",placeholder:t("security.cluster.cluster_name_tips"),value:this.model.name,"onUpdate:value":i=>this.model.name=i},null)]}),n(l,{label:t("security.cluster.kubernetes_config"),path:"k8s_config"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-config",placeholder:I,type:"textarea",autosize:{minRows:16},value:this.model.k8s_config,"onUpdate:value":i=>this.model.k8s_config=i},null)]}),n(l,{label:t("security.cluster.yarn_config"),path:"yarn_config"},{default:()=>[n(c,{allowInput:this.trim,class:"input-yarn-config",placeholder:F,disabled:!0,value:this.model.yarn_config,"onUpdate:value":i=>this.model.yarn_config=i},null)]}),n(l,{label:t("security.cluster.cluster_desc"),path:"description"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-desc",placeholder:t("security.cluster.cluster_description_tips"),value:this.model.description,"onUpdate:value":i=>this.model.description=i},null)]})]})})])}});export{ne as default};

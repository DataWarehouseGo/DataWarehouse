import{d as v,b7 as I,b8 as L,b9 as D,u as P,bJ as O,b5 as W,t as o,at as B,e as E,_ as q,w as T,ba as $,c as l}from"./index.536c7d72.js";import{A,d as F,q as G,s as J,a as X}from"./index.bf50bc28.js";import{r as j,S as Y,p as z,t as K,a as Q}from"./common.cc1e0c6c.js";import{D as Z,C as c,c as ee}from"./column-width-config.7df9c412.js";import{D as te}from"./DownloadOutlined.e576ca2a.js";import{f as b}from"./index.9c0cbe29.js";import{N as d}from"./Tooltip.2dc588a0.js";import{N as h}from"./Button.9dd5ee3c.js";import{N as u}from"./Icon.36d6d904.js";import{N as k}from"./Space.8c5cfc39.js";import{N as ae}from"./Spin.5bd91cff.js";import{u as oe}from"./index.990798b2.js";import{L as se,q as re}from"./index.940c2a82.js";import{C as x}from"./index.67b00418.js";import{S as le}from"./SearchOutlined.b0711796.js";import{N}from"./Input.4b8b409e.js";import{a as ie}from"./Select.eddb521d.js";import{N as ne}from"./DatePicker.9d2907ba.js";import{N as ce,a as pe}from"./DataTable.4d10e01f.js";import"./service.4ca56d82.js";import"./lodash.bce5b897.js";import"./SettingOutlined.06d5d07d.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./CloseCircleOutlined.14b6a996.js";import"./CheckCircleOutlined.4f0aee70.js";import"./EditOutlined.57b65af3.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.12a336d2.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./get-slot.7f666ba0.js";import"./index.7a579f81.js";import"./index.4d9d5980.js";import"./index.eb38a2cf.js";import"./keysOf.10525521.js";import"./Card.1fac8dc8.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./SyncOutlined.60307d76.js";import"./FullscreenOutlined.764420ff.js";import"./use-locale.31127f4e.js";import"./throttle.25c0ae05.js";import"./debounce.8aa2d6ba.js";import"./toNumber.c47a71ca.js";import"./Suffix.4fa63b0d.js";import"./Selection.2ed26059.js";import"./use-keyboard.3c40c702.js";import"./Forward.5223a2c3.js";import"./ArrowDown.e4a7e0d5.js";import"./Checkbox.9b98fe51.js";import"./RadioGroup.5a44255f.js";import"./Radio.8f1c774c.js";import"./Dropdown.8c20a4f5.js";import"./ChevronRight.ffdb37b1.js";import"./Ellipsis.b0d6a040.js";const me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ue=D("path",{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0 0 11.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 0 0-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 0 0-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8c4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z",fill:"currentColor"},null,-1),de=[ue],he=v({name:"RetweetOutlined",render:function(m,e){return I(),L("svg",me,de)}}),fe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ge=D("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144s144-64.5 144-144s-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80s80 35.8 80 80s-35.8 80-80 80z",fill:"currentColor"},null,-1),ke=[ge],ye=v({name:"SaveOutlined",render:function(m,e){return I(),L("svg",fe,ke)}});function Ne(){const{t}=P(),m=O(),e=Number(m.params.projectCode),n=Number(m.params.processInstanceId),s=W({columns:[],tableWidth:Z,tableData:[],page:1,pageSize:10,searchVal:null,processInstanceId:n||null,host:null,stateType:null,datePickerRange:null,executorName:null,processDefinitionName:null,totalPage:1,showModalRef:!1,row:{},loadingRef:!1,logRef:"",logLoadingRef:!0,skipLineNum:0,limit:1e3}),f=i=>{i.columns=[{title:"#",key:"index",render:(a,C)=>C+1,...c.index},{title:t("project.task.task_name"),key:"name",...c.name},{title:t("project.task.workflow_name"),key:"processDefinitionName",...c.name},{title:t("project.task.node_type"),key:"taskType",...c.type},{title:t("project.task.state"),key:"state",...c.state,render:a=>we(a.state,t)},{title:t("project.task.executor"),key:"executorName",...c.name},{title:t("project.task.host"),key:"host",...c.name,render:a=>a.host||"-"},{title:t("project.task.app_id"),key:"applicationID",...c.name,render:a=>a.applicationID||"-"},{title:t("project.task.dry_run_flag"),key:"dryRun",...c.dryRun,render:a=>a.dryRun===1?"YES":"NO"},{title:t("project.task.start_time"),...c.time,key:"startTime",render:a=>j(a.startTime)},{title:t("project.task.end_time"),...c.time,key:"endTime",render:a=>j(a.endTime)},{title:t("project.task.duration"),key:"duration",...c.duration,render:a=>o("span",null,a.duration?a.duration:"-")},{title:t("project.task.operation"),key:"operation",...c.operation(5),render(a){return o(k,null,{default:()=>[o(d,{},{trigger:()=>o(h,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>S(a.id)},{icon:()=>o(u,null,{default:()=>o(ye)})}),default:()=>t("project.task.savepoint")}),o(d,{},{trigger:()=>o(h,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>w(a.id)},{icon:()=>o(u,null,{default:()=>o(Y)})}),default:()=>t("project.task.stop")}),o(d,{},{trigger:()=>o(h,{circle:!0,type:"info",size:"small",disabled:!a.host,onClick:()=>p(a)},{icon:()=>o(u,null,{default:()=>o(A)})}),default:()=>t("project.task.view_log")}),o(d,{},{trigger:()=>o(h,{circle:!0,type:"info",size:"small",onClick:()=>F(a.id)},{icon:()=>o(u,null,{default:()=>o(te)})}),default:()=>t("project.task.download_log")}),o(d,{},{trigger:()=>o(h,{circle:!0,type:"warning",size:"small",disabled:!0,tag:"div"},{icon:()=>o(u,null,{default:()=>o(he)})}),default:()=>t("project.task.jump_tip")})]})}}],i.tableWidth&&(i.tableWidth=ee(i.columns))},p=i=>{s.showModalRef=!0,s.row=i},r=()=>{if(s.loadingRef)return;s.loadingRef=!0;const i={pageSize:s.pageSize,pageNo:s.page,searchVal:s.searchVal,processInstanceId:s.processInstanceId,host:s.host,stateType:s.stateType,startDate:s.datePickerRange?b(z(s.datePickerRange[0]),"yyyy-MM-dd HH:mm:ss"):"",endDate:s.datePickerRange?b(z(s.datePickerRange[1]),"yyyy-MM-dd HH:mm:ss"):"",executorName:s.executorName,processDefinitionName:s.processDefinitionName,taskExecuteType:"STREAM"};G(i,{projectCode:e}).then(a=>{s.tableData=[...a.totalList],s.totalPage=a.totalPage}).finally(()=>s.loadingRef=!1)},w=i=>{J(e,i).then(()=>{window.$message.success(t("project.task.success")),r()})},S=i=>{X(e,i).then(()=>{window.$message.success(t("project.task.success")),r()})};return{t,variables:s,getTableData:r,createColumns:f}}function we(t,m){if(!t)return"";const e=K(m)[t],n=o(u,{color:e.color,class:e.classNames,style:{display:"flex"},size:20},()=>o(e.icon));return o(d,null,{trigger:()=>e.isSpin?o(ae,{size:20},{icon:()=>n}):n,default:()=>e.desc})}const xt=v({name:"task-instance",setup(){var _;let t;const{t:m,variables:e,getTableData:n,createColumns:s}=Ne(),f=()=>{e.page=1,n()},p=()=>{e.page=1,n()},r=()=>{e.searchVal=null,p()},w=()=>{e.processDefinitionName=null,p()},S=()=>{e.executorName=null,p()},i=()=>{e.host=null,p()},a=()=>{e.stateType=null,p()},C=()=>{e.datePickerRange=null,p()},M=()=>{e.showModalRef=!1},R=y=>{const{state:H}=oe(re({taskInstanceId:Number(y.id),limit:e.limit,skipLineNum:e.skipLineNum}).then(g=>{g!=null&&g.message?(e.logRef+=g.message,e.limit+=1e3,e.skipLineNum+=g.lineNum,R(y)):e.logLoadingRef=!1}),{});return H},V=y=>{e.logRef="",e.limit=1e3,e.skipLineNum=0,R(y)},U=(_=B())==null?void 0:_.appContext.config.globalProperties.trim;return E(()=>{s(e),n(),t=setInterval(()=>{n()},3e3)}),q(()=>{clearInterval(t)}),T(P().locale,()=>{s(e)}),T(()=>e.showModalRef,()=>{e.showModalRef?R(e.row):(e.row={},e.logRef="",e.logLoadingRef=!0,e.skipLineNum=0,e.limit=1e3)}),{t:m,...$(e),getTableData:n,onUpdatePageSize:f,onSearch:p,onClearSearchTaskName:r,onClearSearchWorkFlowName:w,onClearSearchExecutorName:S,onClearSearchHost:i,onClearSearchStateType:a,onClearSearchTime:C,onConfirmModal:M,refreshLogs:V,trim:U}},render(){const{t,getTableData:m,onUpdatePageSize:e,onSearch:n,onConfirmModal:s,loadingRef:f,refreshLogs:p}=this;return l(k,{vertical:!0},{default:()=>[l(x,null,{default:()=>[l(k,{justify:"end",wrap:!1},{default:()=>[l(N,{allowInput:this.trim,value:this.searchVal,"onUpdate:value":r=>this.searchVal=r,size:"small",placeholder:t("project.task.task_name"),clearable:!0,onClear:this.onClearSearchTaskName},null),l(N,{allowInput:this.trim,value:this.processDefinitionName,"onUpdate:value":r=>this.processDefinitionName=r,size:"small",placeholder:t("project.task.workflow_name"),clearable:!0,onClear:this.onClearSearchWorkFlowName},null),l(N,{allowInput:this.trim,value:this.executorName,"onUpdate:value":r=>this.executorName=r,size:"small",placeholder:t("project.task.executor"),clearable:!0,onClear:this.onClearSearchExecutorName},null),l(N,{allowInput:this.trim,value:this.host,"onUpdate:value":r=>this.host=r,size:"small",placeholder:t("project.task.host"),clearable:!0,onClear:this.onClearSearchHost},null),l(ie,{value:this.stateType,"onUpdate:value":r=>this.stateType=r,size:"small",options:Q(t).slice(1),placeholder:t("project.task.state"),style:{width:"180px"},clearable:!0,onClear:this.onClearSearchStateType},null),l(ne,{value:this.datePickerRange,"onUpdate:value":r=>this.datePickerRange=r,type:"datetimerange",size:"small","start-placeholder":t("project.task.start_time"),"end-placeholder":t("project.task.end_time"),clearable:!0,onClear:this.onClearSearchTime},null),l(h,{size:"small",type:"primary",onClick:n},{default:()=>[l(u,null,{default:()=>[l(le,null,null)]})]})]})]}),l(x,{title:t("project.task.stream_task")},{default:()=>[l(k,{vertical:!0},{default:()=>[l(ce,{loading:f,columns:this.columns,data:this.tableData,scrollX:this.tableWidth},null),l(k,{justify:"center"},{default:()=>[l(pe,{page:this.page,"onUpdate:page":r=>this.page=r,"page-size":this.pageSize,"onUpdate:page-size":r=>this.pageSize=r,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:m,onUpdatePageSize:e},null)]})]})]}),l(se,{showModalRef:this.showModalRef,logRef:this.logRef,row:this.row,logLoadingRef:this.logLoadingRef,onConfirmModal:s,onRefreshLogs:p},null)]})}});export{xt as default};

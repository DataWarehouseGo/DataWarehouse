import{u as g,a as M,e as S,w as b,t as i,b5 as T,d as _,at as U,ba as R,c as a,ak as v}from"./index.536c7d72.js";import{D as I,C as u,c as L}from"./column-width-config.7df9c412.js";import{N as O}from"./Dropdown.8c20a4f5.js";import{U as P}from"./UserOutlined.0b3ad7d5.js";import{E as j}from"./EditOutlined.57b65af3.js";import{D}from"./DeleteOutlined.0c0bc8fc.js";import{d as V}from"./Selection.2ed26059.js";import{N as y}from"./Tooltip.2dc588a0.js";import{N as h}from"./Button.9dd5ee3c.js";import{N as f}from"./Icon.36d6d904.js";import{N as A}from"./Popconfirm.f3bbced5.js";import{N as d}from"./Space.8c5cfc39.js";import{q as E,h as W}from"./index.fe30cd62.js";import{p as N}from"./common.cc1e0c6c.js";import{f as k}from"./index.9c0cbe29.js";import{UserModal as q}from"./user-detail-modal.13da1dbf.js";import{AuthorizeModal as H}from"./authorize-modal.fa70d7bb.js";import{C as w}from"./index.67b00418.js";import{S as x}from"./SearchOutlined.b0711796.js";import{N as B}from"./Input.4b8b409e.js";import{N as G,a as F}from"./DataTable.4d10e01f.js";import"./lodash.bce5b897.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.12a336d2.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./ChevronRight.ffdb37b1.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./use-keyboard.3c40c702.js";import"./index.7a579f81.js";import"./use-locale.31127f4e.js";import"./use-rtl.b3456902.js";import"./Suffix.4fa63b0d.js";import"./is-browser.f4bc45cf.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./service.4ca56d82.js";import"./SettingOutlined.06d5d07d.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./CloseCircleOutlined.14b6a996.js";import"./CheckCircleOutlined.4f0aee70.js";import"./index.89780321.js";import"./index.d84b4881.js";import"./index.4d9d5980.js";import"./index.eb38a2cf.js";import"./Card.1fac8dc8.js";import"./Form.b918a62f.js";import"./FormItem.67716b88.js";import"./Select.eddb521d.js";import"./RadioGroup.5a44255f.js";import"./Radio.8f1c774c.js";import"./index.40581ef3.js";import"./index.ef1910ce.js";import"./index.ea5b005f.js";import"./index.5b11598a.js";import"./Checkbox.9b98fe51.js";import"./RadioButton.c57a94c4.js";import"./TreeSelect.c15d3653.js";import"./ArrowDown.e4a7e0d5.js";import"./Ellipsis.b0d6a040.js";import"./Forward.5223a2c3.js";function X(t){const{t:e}=g(),o=M({columns:[],tableWidth:I}),n=()=>{const c=[{title:"#",key:"index",render:(s,m)=>m+1,...u.index},{title:e("security.user.username"),key:"userName",className:"name",...u.userName},{title:e("security.user.user_type"),key:"userType",render:s=>s.userType==="GENERAL_USER"?e("security.user.ordinary_user"):e("security.user.administrator"),...u.type},{title:e("security.user.tenant_code"),key:"tenantCode",...u.name},{title:e("security.user.queue"),key:"queue",width:120},{title:e("security.user.email"),key:"email",...u.name},{title:e("security.user.phone"),key:"phone",width:140},{title:e("security.user.state"),key:"state",...u.state,render:(s,m)=>i(V,{type:s.state===1?"success":"error"},{default:()=>e(`security.user.state_${s.state===1?"enabled":"disabled"}`)})},{title:e("security.user.create_time"),key:"createTime",...u.time},{title:e("security.user.update_time"),key:"updateTime",...u.time},{title:e("security.user.operation"),key:"operation",...u.operation(3),render:(s,m)=>i(d,null,{default:()=>[i(O,{trigger:"click",options:[{label:e("security.user.project"),key:"authorize_project"},{label:e("security.user.resource"),key:"authorize_resource"},{label:e("security.user.datasource"),key:"authorize_datasource"},{label:e("security.user.udf"),key:"authorize_udf"},{label:e("security.user.namespace"),key:"authorize_namespace"}],onSelect:r=>void t({rowData:s,key:r},"authorize")},()=>i(y,{trigger:"hover"},{trigger:()=>i(h,{circle:!0,type:"warning",size:"small",class:"authorize"},{icon:()=>i(f,null,()=>i(P))}),default:()=>e("security.user.authorize")})),i(y,{trigger:"hover"},{trigger:()=>i(h,{circle:!0,type:"info",size:"small",class:"edit",onClick:()=>void t({rowData:s},"edit")},()=>i(f,null,()=>i(j))),default:()=>e("security.user.edit")}),i(A,{onPositiveClick:()=>void t({rowData:s},"delete")},{trigger:()=>i(y,{},{trigger:()=>i(h,{circle:!0,type:"error",size:"small",class:"delete"},{icon:()=>i(f,null,{default:()=>i(D)})}),default:()=>e("security.user.delete")}),default:()=>e("security.user.delete_confirm")})]})}];o.value={columns:c,tableWidth:L(c)}};return S(()=>{n()}),b(g().locale,()=>{n()}),{columnsRef:o,createColumns:n}}function $(){const t=T({page:1,pageSize:10,itemCount:0,searchVal:"",list:[],loading:!1,currentRecord:{},authorizeType:"authorize_project",detailModalShow:!1,authorizeModalShow:!1}),e=async()=>{if(t.loading)return;t.loading=!0;const{totalList:r,total:p}=await E({pageNo:t.page,pageSize:t.pageSize,searchVal:t.searchVal});if(t.loading=!1,!r)throw Error();t.list=r.map(l=>(l.createTime=l.createTime?k(N(l.createTime),"yyyy-MM-dd HH:mm:ss"):"",l.updateTime=l.updateTime?k(N(l.updateTime),"yyyy-MM-dd HH:mm:ss"):"",l.tenantId=l.tenantId===0?null:l.tenantId,l)),t.itemCount=p},o=()=>{t.list.length===1&&t.page>1&&--t.page,e()},n=async r=>{await W({id:r}),o()},c=(r,p)=>{t.currentRecord=r.rowData,p==="edit"&&(t.detailModalShow=!0),p==="authorize"&&r.key&&(t.authorizeModalShow=!0,t.authorizeType=r.key),p==="delete"&&n(r.rowData.id)},s=r=>{t.page=r,e()},m=r=>{t.page=1,t.pageSize=r,e()};return S(()=>{e()}),{state:t,changePage:s,changePageSize:m,updateList:o,onOperationClick:c}}function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!v(t)}const mt=_({name:"user-manage",setup(){var z;const{t}=g(),{state:e,changePage:o,changePageSize:n,updateList:c,onOperationClick:s}=$(),{columnsRef:m}=X(s),r=()=>{e.detailModalShow=!0,e.currentRecord=null},p=()=>{e.detailModalShow=!1},l=()=>{e.authorizeModalShow=!1},C=(z=U())==null?void 0:z.appContext.config.globalProperties.trim;return{t,columnsRef:m,...R(e),changePage:o,changePageSize:n,onAddUser:r,onUpdatedList:c,onDetailModalCancel:p,onAuthorizeModalCancel:l,trim:C}},render(){let t;return a(d,{vertical:!0},{default:()=>{var e;return[a(w,null,{default:()=>[a(d,{justify:"space-between"},{default:()=>[a(h,{onClick:this.onAddUser,type:"primary",class:"btn-create-user",size:"small"},J(t=this.t("security.user.create_user"))?t:{default:()=>[t]}),a(d,null,{default:()=>[a(B,{allowInput:this.trim,value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,size:"small",clearable:!0},null),a(h,{type:"primary",size:"small",onClick:this.onUpdatedList},{default:()=>[a(f,null,{default:()=>[a(x,null,null)]})]})]})]})]}),a(w,{title:this.t("menu.user_manage")},{default:()=>[a(d,{vertical:!0},{default:()=>[a(G,{"row-class-name":"items",columns:this.columnsRef.columns,data:this.list,loading:this.loading,scrollX:this.columnsRef.tableWidth},null),a(d,{justify:"center"},{default:()=>[a(F,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"item-count":this.itemCount,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,"on-update:page":this.changePage,"on-update:page-size":this.changePageSize},null)]})]})]}),a(q,{show:this.detailModalShow,currentRecord:this.currentRecord,onCancel:this.onDetailModalCancel,onUpdate:this.onUpdatedList},null),a(H,{show:this.authorizeModalShow,type:this.authorizeType,userId:(e=this.currentRecord)==null?void 0:e.id,onCancel:this.onAuthorizeModalCancel},null)]}})}});export{mt as default};

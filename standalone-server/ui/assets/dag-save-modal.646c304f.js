import{M as le}from"./index.4d9d5980.js";import{d as O,t as i,bx as oe,ap as re,au as ie,ac as ue,cc as se,y as ce,A as M,g as C,f as W,h as de,i as pe,m as me,a as F,z as _,l as Z,n as U,B as fe,s as ve,N,cd as T,ce as $,a4 as he,u as ge,e as G,cf as ye,at as be,w as Pe,c as p,bJ as Ie,ak as we}from"./index.536c7d72.js";import{q as Re}from"./index.89780321.js";import{v as Ve}from"./index.22428b53.js";/* empty css                 */import{N as D,f as ke}from"./Button.9dd5ee3c.js";import{N as L}from"./Input.4b8b409e.js";import{u as Ce}from"./use-rtl.b3456902.js";import{u as je}from"./Scrollbar.7c2bcabe.js";import{u as Se}from"./use-locale.31127f4e.js";import{a as H,b as Ae,c as E}from"./resolve-slot.12a336d2.js";import{A as J}from"./Add.4fb6bf29.js";import{N as Ne}from"./ButtonGroup.a882bf80.js";import{R as De,N as Ue}from"./InputNumber.1f688029.js";import{A as Le}from"./ArrowDown.e4a7e0d5.js";import{N as Oe}from"./Form.b918a62f.js";import{N as P}from"./FormItem.67716b88.js";import{a as Y}from"./Select.eddb521d.js";import{N as _e}from"./Switch.57a995f1.js";import{a as Q}from"./Checkbox.9b98fe51.js";import"./index.eb38a2cf.js";import"./keysOf.10525521.js";import"./Card.1fac8dc8.js";import"./index.7a579f81.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./fade-in.cssr.ef9eaee7.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./utils.ba7f47bf.js";import"./is-browser.f4bc45cf.js";import"./Space.8c5cfc39.js";import"./get-slot.7f666ba0.js";import"./service.4ca56d82.js";import"./lodash.bce5b897.js";import"./VResizeObserver.0aad584a.js";import"./Suffix.4fa63b0d.js";import"./format-length.a0cbed4d.js";import"./use-compitable.7f10f89e.js";import"./Selection.2ed26059.js";import"./Popover.374e8a7f.js";import"./next-frame-once.e5ee25e8.js";const Be=O({name:"ArrowUp",render(){return i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},i("g",{fill:"none"},i("path",{d:"M3.13 9.163a.5.5 0 1 0 .74.674L9.5 3.67V17.5a.5.5 0 0 0 1 0V3.672l5.63 6.165a.5.5 0 0 0 .738-.674l-6.315-6.916a.746.746 0 0 0-.632-.24a.746.746 0 0 0-.476.24L3.131 9.163z",fill:"currentColor"})))}}),Fe=()=>se,Te=oe({name:"DynamicInput",common:re,peers:{Input:ie,Button:ue},self:Fe}),$e=Te,x=ce("n-dynamic-input"),Ee=O({name:"DynamicInputInputPreset",props:{clsPrefix:{type:String,required:!0},value:{type:String,default:""},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(){const{mergedThemeRef:e,placeholderRef:h}=M(x);return{mergedTheme:e,placeholder:h}},render(){const{mergedTheme:e,placeholder:h,value:c,clsPrefix:l,onUpdateValue:g}=this;return i("div",{class:`${l}-dynamic-input-preset-input`},i(L,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:c,placeholder:h,onUpdateValue:g}))}}),Me=O({name:"DynamicInputPairPreset",props:{clsPrefix:{type:String,required:!0},value:{type:Object,default:()=>({key:"",value:""})},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(e){const{mergedThemeRef:h,keyPlaceholderRef:c,valuePlaceholderRef:l}=M(x);return{mergedTheme:h,keyPlaceholder:c,valuePlaceholder:l,handleKeyInput(g){e.onUpdateValue({key:g,value:e.value.value})},handleValueInput(g){e.onUpdateValue({key:e.value.key,value:g})}}},render(){const{mergedTheme:e,keyPlaceholder:h,valuePlaceholder:c,value:l,clsPrefix:g}=this;return i("div",{class:`${g}-dynamic-input-preset-pair`},i(L,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.key,class:`${g}-dynamic-input-pair-input`,placeholder:h,onUpdateValue:this.handleKeyInput}),i(L,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.value,class:`${g}-dynamic-input-pair-input`,placeholder:c,onUpdateValue:this.handleValueInput}))}}),xe=C("dynamic-input",{width:"100%"},[C("dynamic-input-item",`
 margin-bottom: 10px;
 display: flex;
 flex-wrap: nowrap;
 `,[C("dynamic-input-preset-input",{flex:1,alignItems:"center"}),C("dynamic-input-preset-pair",`
 flex: 1;
 display: flex;
 align-items: center;
 `,[C("dynamic-input-pair-input",[W("&:first-child",{"margin-right":"12px"})])]),de("action",`
 align-self: flex-start;
 display: flex;
 justify-content: flex-end;
 flex-shrink: 0;
 flex-grow: 0;
 margin: var(--action-margin);
 `,[pe("icon",{cursor:"pointer"})]),W("&:last-child",{marginBottom:0})]),C("form-item",`
 padding-top: 0 !important;
 margin-right: 0 !important;
 `,[C("form-item-blank",{paddingTop:"0 !important"})])]),B=new WeakMap,ze=Object.assign(Object.assign({},Z.props),{max:Number,min:{type:Number,default:0},value:Array,defaultValue:{type:Array,default:()=>[]},preset:{type:String,default:"input"},keyField:String,itemStyle:[String,Object],keyPlaceholder:{type:String,default:""},valuePlaceholder:{type:String,default:""},placeholder:{type:String,default:""},showSortButton:Boolean,createButtonProps:Object,onCreate:Function,onRemove:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onClear:Function,onInput:[Function,Array]}),Ke=O({name:"DynamicInput",props:ze,setup(e,{slots:h}){const{mergedComponentPropsRef:c,mergedClsPrefixRef:l,mergedRtlRef:g,inlineThemeDisabled:v}=me(),I=M(ke,null),a=F(e.defaultValue),V=_(e,"value"),y=je(V,a),m=Z("DynamicInput","-dynamic-input",xe,$e,e,l),j=U(()=>{const{value:t}=y;if(Array.isArray(t)){const{max:n}=e;return n!==void 0&&t.length>=n}return!1}),k=U(()=>{const{value:t}=y;return Array.isArray(t)?t.length<=e.min:!0}),S=U(()=>{var t,n;return(n=(t=c==null?void 0:c.value)===null||t===void 0?void 0:t.DynamicInput)===null||n===void 0?void 0:n.buttonSize});function b(t){const{onInput:n,"onUpdate:value":d,onUpdateValue:u}=e;n&&E(n,t),d&&E(d,t),u&&E(u,t),a.value=t}function r(t,n){if(t==null||typeof t!="object")return n;const d=T(t)?$(t):t;let u=B.get(d);return u===void 0&&B.set(d,u=he()),u}function f(t,n){const{value:d}=y,u=Array.from(d!=null?d:[]),R=u[t];if(u[t]=n,R&&n&&typeof R=="object"&&typeof n=="object"){const ae=T(R)?$(R):R,ne=T(n)?$(n):n,q=B.get(ae);q!==void 0&&B.set(ne,q)}b(u)}function o(){s(0)}function s(t){const{value:n}=y,{onCreate:d}=e,u=Array.from(n!=null?n:[]);if(d)u.splice(t+1,0,d(t+1)),b(u);else if(h.default)u.splice(t+1,0,null),b(u);else switch(e.preset){case"input":u.splice(t+1,0,""),b(u);break;case"pair":u.splice(t+1,0,{key:"",value:""}),b(u);break}}function w(t){const{value:n}=y;if(!Array.isArray(n))return;const{min:d}=e;if(n.length<=d)return;const u=Array.from(n);u.splice(t,1),b(u);const{onRemove:R}=e;R&&R(t)}function z(t,n,d){if(n<0||d<0||n>=t.length||d>=t.length||n===d)return;const u=t[n];t[n]=t[d],t[d]=u}function ee(t,n){const{value:d}=y;if(!Array.isArray(d))return;const u=Array.from(d);t==="up"&&z(u,n,n-1),t==="down"&&z(u,n,n+1),b(u)}fe(x,{mergedThemeRef:m,keyPlaceholderRef:_(e,"keyPlaceholder"),valuePlaceholderRef:_(e,"valuePlaceholder"),placeholderRef:_(e,"placeholder")});const te=Ce("DynamicInput",g,l),K=U(()=>{const{self:{actionMargin:t,actionMarginRtl:n}}=m.value;return{"--action-margin":t,"--action-margin-rtl":n}}),A=v?ve("dynamic-input",void 0,K,e):void 0;return{locale:Se("DynamicInput").localeRef,rtlEnabled:te,buttonSize:S,mergedClsPrefix:l,NFormItem:I,uncontrolledValue:a,mergedValue:y,insertionDisabled:j,removeDisabled:k,handleCreateClick:o,ensureKey:r,handleValueChange:f,remove:w,move:ee,createItem:s,mergedTheme:m,cssVars:v?void 0:K,themeClass:A==null?void 0:A.themeClass,onRender:A==null?void 0:A.onRender}},render(){const{$slots:e,buttonSize:h,mergedClsPrefix:c,mergedValue:l,locale:g,mergedTheme:v,keyField:I,itemStyle:a,preset:V,showSortButton:y,NFormItem:m,ensureKey:j,handleValueChange:k,remove:S,createItem:b,move:r,onRender:f}=this;return f==null||f(),i("div",{class:[`${c}-dynamic-input`,this.rtlEnabled&&`${c}-dynamic-input--rtl`,this.themeClass],style:this.cssVars},!Array.isArray(l)||l.length===0?i(D,Object.assign({block:!0,ghost:!0,dashed:!0,size:h},this.createButtonProps,{disabled:this.insertionDisabled,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:this.handleCreateClick}),{default:()=>H(e["create-button-default"],()=>[g.create]),icon:()=>H(e["create-button-icon"],()=>[i(N,{clsPrefix:c},{default:()=>i(J,null)})])}):l.map((o,s)=>i("div",{key:I?o[I]:j(o,s),"data-key":I?o[I]:j(o,s),class:`${c}-dynamic-input-item`,style:a},Ae(e.default,{value:l[s],index:s},()=>[V==="input"?i(Ee,{clsPrefix:c,value:l[s],parentPath:m?m.path.value:void 0,path:m!=null&&m.path.value?`${m.path.value}[${s}]`:void 0,onUpdateValue:w=>k(s,w)}):V==="pair"?i(Me,{clsPrefix:c,value:l[s],parentPath:m?m.path.value:void 0,path:m!=null&&m.path.value?`${m.path.value}[${s}]`:void 0,onUpdateValue:w=>k(s,w)}):null]),i("div",{class:`${c}-dynamic-input-item__action`},i(Ne,{size:h},{default:()=>[i(D,{disabled:this.removeDisabled,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,circle:!0,onClick:()=>S(s)},{icon:()=>i(N,{clsPrefix:c},{default:()=>i(De,null)})}),i(D,{disabled:this.insertionDisabled,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>b(s)},{icon:()=>i(N,{clsPrefix:c},{default:()=>i(J,null)})}),y?i(D,{disabled:s===0,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>r("up",s)},{icon:()=>i(N,{clsPrefix:c},{default:()=>i(Be,null)})}):null,y?i(D,{disabled:s===l.length-1,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>r("down",s)},{icon:()=>i(N,{clsPrefix:c},{default:()=>i(Le,null)})}):null]})))))}});function X(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!we(e)}const qe={visible:{type:Boolean,default:!1},definition:{type:Object,default:void 0},instance:{type:Object,default:void 0}},Lt=O({name:"dag-save-modal",props:qe,emits:["update:show","save"],setup(e,h){var b;const c=Ie(),{t:l}=ge(),g=Number(c.params.projectCode),v=F([]),I=U(()=>v.value?v.value.map(r=>({label:r.tenantCode,value:r.tenantCode})).concat({label:"default",value:"default"}):[]);G(()=>{Re().then(r=>{v.value=r})});const a=F({name:"",description:"",tenantCode:"default",executionType:"PARALLEL",timeoutFlag:!1,timeout:0,globalParams:[],release:!1,sync:!1}),V=F(),y={name:{required:!0,message:l("project.dag.dag_name_empty")},timeout:{validator(){if(a.value.timeoutFlag&&!ye.test(String(a.value.timeout)))return new Error(l("project.dag.positive_integer"))}},globalParams:{validator(){const r=new Set,f=a.value.globalParams.map(s=>s.key);if(new Set(f).size!==f.length)return new Error(l("project.dag.prop_repeat"));for(const s of a.value.globalParams){const w=s.value;if(!w)return new Error(l("project.dag.prop_empty"));r.add(w)}}}},m=()=>{V.value.validate(async r=>{var f,o;if(!r){const s={name:a.value.name,code:(f=e.definition)==null?void 0:f.processDefinition.code};((o=e.definition)==null?void 0:o.processDefinition.name)!==a.value.name?Ve(s,g).then(()=>h.emit("save",a.value)):h.emit("save",a.value)}})},j=()=>{h.emit("update:show",!1)},k=()=>{var f;const r=(f=e.definition)==null?void 0:f.processDefinition;r&&(a.value.name=r.name,a.value.description=r.description,a.value.tenantCode=r.tenantCode||"default",a.value.executionType=r.executionType||"PARALLEL",r.timeout&&r.timeout>0&&(a.value.timeoutFlag=!0,a.value.timeout=r.timeout),a.value.globalParams=r.globalParamList.map(o=>({key:o.prop,value:o.value})))},S=(b=be())==null?void 0:b.appContext.config.globalProperties.trim;return G(()=>k()),Pe(()=>{var r;return(r=e.definition)==null?void 0:r.processDefinition},()=>k()),()=>{let r,f;return p(le,{show:e.visible,title:l("project.dag.basic_info"),onConfirm:m,onCancel:j,autoFocus:!1},{default:()=>[p(Oe,{model:a.value,rules:y,ref:V},{default:()=>[p(P,{label:l("project.dag.workflow_name"),path:"name"},{default:()=>[p(L,{allowInput:S,value:a.value.name,"onUpdate:value":o=>a.value.name=o,class:"input-name"},null)]}),p(P,{label:l("project.dag.description"),path:"description"},{default:()=>[p(L,{allowInput:S,type:"textarea",value:a.value.description,"onUpdate:value":o=>a.value.description=o,class:"input-description"},null)]}),p(P,{label:l("project.dag.tenant"),path:"tenantCode"},{default:()=>[p(Y,{options:I.value,value:a.value.tenantCode,"onUpdate:value":o=>a.value.tenantCode=o,class:"btn-select-tenant-code"},null)]}),p(P,{label:l("project.dag.timeout_alert"),path:"timeoutFlag"},{default:()=>[p(_e,{value:a.value.timeoutFlag,"onUpdate:value":o=>a.value.timeoutFlag=o},null)]}),a.value.timeoutFlag&&p(P,{showLabel:!1,path:"timeout"},{default:()=>[p(Ue,{value:a.value.timeout,"onUpdate:value":o=>a.value.timeout=o,"show-button":!1,min:0},{suffix:()=>l("project.dag.minute")})]}),!e.instance&&p(P,{label:l("project.dag.process_execute_type"),path:"executionType"},{default:()=>[p(Y,{options:[{value:"PARALLEL",label:l("project.dag.parallel")},{value:"SERIAL_WAIT",label:l("project.dag.serial_wait")},{value:"SERIAL_DISCARD",label:l("project.dag.serial_discard")},{value:"SERIAL_PRIORITY",label:l("project.dag.serial_priority")}],value:a.value.executionType,"onUpdate:value":o=>a.value.executionType=o},null)]}),p(P,{label:l("project.dag.global_variables"),path:"globalParams"},{default:()=>[p(Ke,{value:a.value.globalParams,"onUpdate:value":o=>a.value.globalParams=o,preset:"pair","key-placeholder":l("project.dag.key"),"value-placeholder":l("project.dag.value"),class:"input-global-params"},null)]}),e.definition&&!e.instance&&p(P,{path:"timeoutFlag",showLabel:!1},{default:()=>[p(Q,{checked:a.value.release,"onUpdate:checked":o=>a.value.release=o},X(r=l("project.dag.online_directly"))?r:{default:()=>[r]})]}),e.instance&&p(P,{path:"sync",showLabel:!1},{default:()=>[p(Q,{checked:a.value.sync,"onUpdate:checked":o=>a.value.sync=o},X(f=l("project.dag.update_directly"))?f:{default:()=>[f]})]})]})]})}}});export{Lt as default};

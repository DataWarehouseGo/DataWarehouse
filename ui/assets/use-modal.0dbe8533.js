import{u as l,b5 as d,a as c,bq as F}from"./index.536c7d72.js";import{u as g}from"./file.1c109dec.js";import{g as v,c as w,h as R}from"./index.ea5b005f.js";const b=()=>{const{t:e}=l(),a=d({folderFormRef:c(),folderForm:{pid:-1,type:"UDF",name:"",description:"",currentDir:"/"},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(a.folderForm.name==="")return new Error(e("resource.udf.enter_name_tips"))}}}}),n=d({uploadFormRef:c(),uploadForm:{name:"",file:"",description:"",pid:-1,currentDir:"/"},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(n.uploadForm.name==="")return new Error(e("resource.udf.enter_name_tips"))}},file:{required:!0,trigger:["input","blur"],validator(){if(n.uploadForm.file==="")return new Error(e("resource.file.enter_content_tips"))}}}});return{folderState:a,uploadState:n}};function q(e,a){const{t:n}=l(),u=F(),s=g(),p=async()=>{const r=u.currentRoute.value.params.id||-1,i=r===-1?"/":s.getCurrentDir||"/";t(async()=>await w({...e.folderForm,pid:r,currentDir:i}))},m=async r=>{t(async()=>{await R({...e.folderForm,id:r},r)})},t=async r=>{if(await e.folderFormRef.validate(),!e.saving){e.saving=!0;try{await r(),window.$message.success(n("resource.udf.success")),e.saving=!1,a.emit("updateList"),a.emit("update:show")}catch{e.saving=!1}}},f=()=>{e.uploadForm.name="",e.uploadForm.file="",e.uploadForm.description=""};return{handleCreateResource:p,handleRenameResource:m,handleUploadFile:async()=>{if(await e.uploadFormRef.validate(),!e.saving){e.saving=!0;try{const r=u.currentRoute.value.params.id||-1,i=r===-1?"/":s.getCurrentDir||"/",o=new FormData;o.append("file",e.uploadForm.file),o.append("type","UDF"),o.append("name",e.uploadForm.name),o.append("pid",String(r)),o.append("currentDir",i),o.append("description",e.uploadForm.description),await v(o),window.$message.success(n("resource.udf.success")),a.emit("updateList"),a.emit("update:show"),f()}finally{e.saving=!1}}}}}export{q as a,b as u};

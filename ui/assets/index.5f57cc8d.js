import{u as N,b5 as R,a as c,bq as j,t as m,d as C,e as P,w as E,_,ba as x,c as l}from"./index.536c7d72.js";import{_ as D}from"./lodash.bce5b897.js";import{B as U}from"./index.eb38a2cf.js";import{d as z,e as O,f as v}from"./index.c7ac6f91.js";import{e as I}from"./index.67996f97.js";import K from"./table-action.d9bac75a.js";import{b as W,r as y,d as V}from"./common.cc1e0c6c.js";import{D as A,C as s,c as B}from"./column-width-config.7df9c412.js";import{N as q}from"./Ellipsis.b0d6a040.js";import{N as L}from"./Icon.36d6d904.js";import{N as M}from"./Spin.5bd91cff.js";import{N as S}from"./Tooltip.2dc588a0.js";import{C as b}from"./index.67b00418.js";import $ from"./process-instance-condition.9ef31b3d.js";import{N as T}from"./Space.8c5cfc39.js";import{N as F,a as G}from"./DataTable.4d10e01f.js";import{N as H}from"./Button.9dd5ee3c.js";import{N as X}from"./Popconfirm.f3bbced5.js";import"./service.4ca56d82.js";import"./FormOutlined.36940f0d.js";import"./SyncOutlined.60307d76.js";import"./CloseCircleOutlined.14b6a996.js";import"./PlayCircleOutlined.a491bf9f.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./InfoCircleFilled.9f54e30c.js";import"./DeleteOutlined.0c0bc8fc.js";import"./ControlOutlined.11506a23.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.12a336d2.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./use-locale.31127f4e.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./index.7a579f81.js";import"./SettingOutlined.06d5d07d.js";import"./CheckCircleOutlined.4f0aee70.js";import"./EditOutlined.57b65af3.js";import"./index.9c0cbe29.js";import"./Card.1fac8dc8.js";import"./SearchOutlined.b0711796.js";import"./Input.4b8b409e.js";import"./Suffix.4fa63b0d.js";import"./Select.eddb521d.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./Selection.2ed26059.js";import"./DatePicker.9d2907ba.js";import"./use-keyboard.3c40c702.js";import"./Forward.5223a2c3.js";import"./ArrowDown.e4a7e0d5.js";import"./Checkbox.9b98fe51.js";import"./RadioGroup.5a44255f.js";import"./Radio.8f1c774c.js";import"./Dropdown.8c20a4f5.js";import"./ChevronRight.ffdb37b1.js";function Y(){const{t:o}=N(),a=j(),e=R({columns:[],tableWidth:A,checkedRowKeys:[],tableData:[],page:c(1),pageSize:c(10),totalPage:c(1),searchVal:c(),executorName:c(),host:c(),stateType:c(),startDate:c(),endDate:c(),projectCode:c(Number(a.currentRoute.value.params.projectCode)),loadingRef:c(!1)}),u=r=>{r.columns=[{type:"selection",className:"btn-selected",...s.selection},{title:"#",key:"id",...s.index,render:(t,i)=>i+1},{title:o("project.workflow.workflow_instance_name"),key:"name",...s.linkName,className:"workflow-name",render:t=>m(U,{onClick:()=>void a.push({name:"workflow-instance-detail",params:{id:t.id},query:{code:t.processDefinitionCode}})},{default:()=>m(q,s.linkEllipsis,()=>t.name)})},{title:o("project.workflow.status"),key:"state",...s.state,className:"workflow-status",render:t=>J(t.state,o)},{title:o("project.workflow.run_type"),key:"commandType",width:160,className:"workflow-run-type",render:t=>(D.filter(W(o),i=>i.code===t.commandType)[0]||{}).desc},{title:o("project.workflow.scheduling_time"),key:"scheduleTime",...s.time,render:t=>y(t.scheduleTime)},{title:o("project.workflow.start_time"),key:"startTime",...s.time,render:t=>y(t.startTime)},{title:o("project.workflow.end_time"),key:"endTime",...s.time,render:t=>y(t.endTime)},{title:o("project.workflow.duration"),key:"duration",...s.duration,render:t=>t.duration||"-"},{title:o("project.workflow.run_times"),key:"runTimes",...s.times,className:"workflow-run-times"},{title:o("project.workflow.fault_tolerant_sign"),key:"recovery",width:100},{title:o("project.workflow.dry_run_flag"),key:"dryRun",...s.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:o("project.workflow.executor"),key:"executorName",...s.name},{title:o("project.workflow.host"),key:"host",...s.name},{title:o("project.workflow.operation"),key:"operation",...s.operation(7),render:(t,i)=>m(K,{row:t,onReRun:()=>n({index:i,processInstanceId:t.id,executeType:"REPEAT_RUNNING",buttonType:"run"}),onReStore:()=>n({index:i,processInstanceId:t.id,executeType:"START_FAILURE_TASK_PROCESS",buttonType:"store"}),onStop:()=>{t.state==="STOP"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({processInstanceId:t.id,executeType:"STOP"})},onSuspend:()=>{t.state==="PAUSE"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({processInstanceId:t.id,executeType:"PAUSE"})},onDeleteInstance:()=>d(t.id)})}],r.tableWidth&&(r.tableWidth=B(r.columns))},p=()=>{if(e.loadingRef)return;e.loadingRef=!0;const r={pageNo:e.page,pageSize:e.pageSize,searchVal:e.searchVal,executorName:e.executorName,host:e.host,stateType:e.stateType,startDate:e.startDate,endDate:e.endDate};z({...r},e.projectCode).then(t=>{e.totalPage=t.totalPage,e.tableData=t.totalList.map(i=>({...i})),e.loadingRef=!1})},d=r=>{O(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===1&&e.page>1&&(e.page-=1),p()})},k=()=>{const r={processInstanceIds:D.join(e.checkedRowKeys,",")};v(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],p()})},w=r=>{I(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),p()})},g=(r,t)=>{let h,f;h||(f=10,h=setInterval(()=>{f>0&&f<=10?(f--,e.tableData[t].count=f):(r(),clearInterval(h),h=void 0)},1e3))},n=r=>{const{index:t}=r;e.tableData[t].buttonType=r.buttonType,I(r,e.projectCode).then(()=>{e.tableData[t].disabled=!0,window.$message.success(o("project.workflow.success")),g(()=>{p()},t)})};return{variables:e,createColumns:u,getTableData:p,batchDeleteInstance:k}}function J(o,a){if(!o)return"";const e=V(a)[o],u=m(L,{color:e.color,class:e.classNames,style:{display:"flex"},size:20},()=>m(e.icon));return m(S,null,{trigger:()=>e.isSpin?m(M,{size:20},{icon:()=>u}):u,default:()=>e.desc})}const ct=C({name:"WorkflowInstanceList",setup(){let o;const{variables:a,createColumns:e,getTableData:u,batchDeleteInstance:p}=Y(),d=()=>{u()},k=n=>{a.searchVal=n.searchVal,a.executorName=n.executorName,a.host=n.host,a.stateType=n.stateType,a.startDate=n.startDate,a.endDate=n.endDate,a.page=1,d()},w=()=>{a.page=1,d()},g=()=>{p()};return P(()=>{e(a),d(),o=setInterval(()=>{d()},9e3)}),E(N().locale,()=>{e(a)}),_(()=>{clearInterval(o)}),{requestData:d,handleSearch:k,handleChangePageSize:w,handleBatchDelete:g,...x(a)}},render(){const{t:o}=N(),{loadingRef:a}=this;return l(T,{vertical:!0},{default:()=>[l(b,null,{default:()=>[l($,{onHandleSearch:this.handleSearch},null)]}),l(b,{title:o("project.workflow.workflow_instance")},{default:()=>[l(T,{vertical:!0},{default:()=>[l(F,{loading:a,rowKey:e=>e.id,columns:this.columns,data:this.tableData,striped:!0,size:"small",scrollX:this.tableWidth,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":e=>this.checkedRowKeys=e,"row-class-name":"items-workflow-instances"},null),l(T,{justify:"center"},{default:()=>[l(G,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]}),l(S,null,{default:()=>o("project.workflow.delete"),trigger:()=>l(H,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,style:"position: absolute; bottom: 10px; left: 10px;",class:"btn-delete-all"},{default:()=>[l(X,{onPositiveClick:this.handleBatchDelete},{default:()=>o("project.workflow.delete_confirm"),trigger:()=>o("project.workflow.delete")})]})})]})]})}});export{ct as default};

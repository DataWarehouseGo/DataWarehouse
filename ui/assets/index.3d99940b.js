import{u as T,t as v,bq as j,d as K,a as h,b5 as L,e as w,at as Q,c as o,ak as Y}from"./index.536c7d72.js";import{e as Z}from"./common.cc1e0c6c.js";import{u as x}from"./file.1c109dec.js";import ee from"./table-action.6a426664.js";import{B as te}from"./index.eb38a2cf.js";import{C as f,c as ae,D as oe}from"./column-width-config.7df9c412.js";import{N as ie}from"./Ellipsis.b0d6a040.js";import{u as U}from"./index.990798b2.js";import{d as re,v as se,e as F,f as le}from"./index.ea5b005f.js";import{C as P}from"./index.67b00418.js";import ne from"./index.23332c1d.js";import ue from"./index.1ce3420d.js";import pe from"./index.5288c30b.js";import{s as B}from"./index.module.b13963ba.js";import{N as me}from"./ButtonGroup.a882bf80.js";import{S as ce}from"./SearchOutlined.b0711796.js";import{N as de,a as D}from"./BreadcrumbItem.99b6cdcb.js";import{N as R}from"./Space.8c5cfc39.js";import{N as b}from"./Button.9dd5ee3c.js";import{N as fe}from"./Input.4b8b409e.js";import{N as he}from"./Icon.36d6d904.js";import{N as ge,a as Ne}from"./DataTable.4d10e01f.js";import"./lodash.bce5b897.js";import"./SettingOutlined.06d5d07d.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./CloseCircleOutlined.14b6a996.js";import"./CheckCircleOutlined.4f0aee70.js";import"./EditOutlined.57b65af3.js";import"./index.9c0cbe29.js";import"./FormOutlined.36940f0d.js";import"./DownloadOutlined.e576ca2a.js";import"./InfoCircleFilled.9f54e30c.js";import"./DeleteOutlined.0c0bc8fc.js";import"./Tooltip.2dc588a0.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.12a336d2.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./Popconfirm.f3bbced5.js";import"./use-locale.31127f4e.js";import"./keysOf.10525521.js";import"./service.4ca56d82.js";import"./Card.1fac8dc8.js";import"./use-rtl.b3456902.js";import"./index.7a579f81.js";import"./index.4d9d5980.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./is-browser.f4bc45cf.js";import"./Form.b918a62f.js";import"./FormItem.67716b88.js";import"./get-slot.7f666ba0.js";import"./Suffix.4fa63b0d.js";import"./Upload.ebcdcc1c.js";import"./Add.4fb6bf29.js";import"./Image.54674f30.js";import"./ArrowDown.e4a7e0d5.js";import"./Checkbox.9b98fe51.js";import"./RadioGroup.5a44255f.js";import"./Radio.8f1c774c.js";import"./Dropdown.8c20a4f5.js";import"./ChevronRight.ffdb37b1.js";import"./Selection.2ed26059.js";import"./use-keyboard.3c40c702.js";import"./Select.eddb521d.js";import"./Forward.5223a2c3.js";const Re=(r,a)=>{const e=x();e.setFileInfo(`${a.alias}|${a.size}`),a.directory?(e.setCurrentDir(`${a.fullName}`),r.push({name:"resource-file-subdirectory",params:{id:a.id}})):r.push({name:"resource-file-list",params:{id:a.id}})};function Se(r,a){const{t:e}=T(),u=j(),c=[{title:"#",key:"id",...f.index,render:(s,p)=>p+1},{title:e("resource.file.name"),key:"name",...f.linkName,render:s=>v(te,{onClick:()=>void Re(u,s)},{default:()=>v(ie,f.linkEllipsis,()=>s.name)})},{title:e("resource.file.user_name"),...f.userName,key:"user_name"},{title:e("resource.file.whether_directory"),key:"whether_directory",...f.yesOrNo,render:s=>s.directory?e("resource.file.yes"):e("resource.file.no")},{title:e("resource.file.file_name"),...f.name,key:"file_name"},{title:e("resource.file.description"),...f.note,key:"description"},{title:e("resource.file.size"),key:"size",...f.size,render:s=>Z(s.size)},{title:e("resource.file.update_time"),...f.time,key:"update_time"},{title:e("resource.file.operation"),key:"operation",render:s=>v(ee,{row:s,onRenameResource:(p,d,n)=>r(p,d,n),onUpdateList:()=>a()}),...f.operation(4)}];return{columnsRef:c,tableWidth:ae(c)||oe}}function ye(r={}){return{getResourceListState:(u=-1,c="",s=1,p=10)=>{const{state:d}=U(re({id:u,type:"FILE",searchVal:c,pageNo:s,pageSize:p}).then(n=>{const{total:g}=n;r(g);const l=n.totalList.map(t=>({id:t.id,name:t.alias,alias:t.alias,fullName:t.fullName,type:t.type,user_name:t.userName,directory:t.directory,file_name:t.fileName,description:t.description,size:t.size,update_time:t.updateTime}));return{total:g,table:l}}),{total:0,table:[]});return d},getResourceView:u=>{const c={skipLineNum:0,limit:3e3},{state:s}=U(se(c,u),{});return s}}}function z(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Y(r)}const qt=K({name:"File",setup(){var _;const r=j(),a=h(Number(r.currentRoute.value.params.id)||-1),e=h(),u=h(!1),c=h(!1),s=h(!1),p=h(),d=L({id:-1,name:"",description:""}),n=L({page:1,pageSize:10,itemCount:0,pageSizes:[10,30,50]}),g=i=>{n.page=i,e.value=N(a.value,p.value,n.page,n.pageSize)},l=i=>{n.page=1,n.pageSize=i,e.value=N(a.value,p.value,n.page,n.pageSize)},t=i=>{i.value=!0},M=i=>{n.itemCount=i},{getResourceListState:N}=ye(M),O=()=>{e.value=N(a.value,p.value)},q=()=>{t(u)},W=()=>{const i=a.value?"resource-subfile-create":"resource-file-create";r.push({name:i,params:{id:a.value}})},E=()=>{t(c)},G=(i,m,y)=>{d.id=i,d.name=m,d.description=y,t(s)},V=()=>{r.push({name:"file-manage"})},$=()=>{e.value=N(a.value,p.value)},C=x();w(()=>{e.value=N(a.value)});const S=h([{id:1,fullName:"l1"},{id:2,fullName:"l2"},{id:4,fullName:"l3"}]),A=(_=Q())==null?void 0:_.appContext.config.globalProperties.trim;w(()=>{const i=Number(r.currentRoute.value.params.id)||-1;i===-1?C.setCurrentDir("/"):F(i).then(m=>{m.fullName&&C.setCurrentDir(m.fullName)})});const H=async i=>{var y,k;let m=0;for(const X of i){const I=i.slice(0,m+1).join("/");if(I){const J=await le({id:0,type:"FILE",fullName:I},0);(y=S.value)==null||y.push({id:J.id,fullName:X})}else(k=S.value)==null||k.push({id:0,fullName:"Root"});m=m+1}};return w(()=>{S.value=[],a.value!=-1&&F(a.value).then(i=>{if(i.fullName){const m=i.fullName.split("/");m&&m.length>1&&H(m)}})}),{fileId:a,searchRef:p,folderShowRef:u,uploadShowRef:c,renameShowRef:s,handleShowModal:t,resourceListRef:e,updateList:$,handleConditions:O,handleCreateFolder:q,handleCreateFile:W,handleUploadFile:E,handleRenameFile:G,handleUpdatePage:g,handleUpdatePageSize:l,handleGoRoot:V,pagination:n,renameInfo:d,breadcrumbItemsRef:S,trim:A}},render(){let r,a,e;const{t:u}=T(),{columnsRef:c,tableWidth:s}=Se(this.handleRenameFile,this.updateList),{handleConditions:p,handleCreateFolder:d,handleCreateFile:n,handleUploadFile:g}=this;return o(R,{vertical:!0},{default:()=>[o(P,null,{default:()=>[o(R,{justify:"space-between"},{default:()=>[o(me,{size:"small"},{default:()=>[o(b,{onClick:d,class:"btn-create-directory"},z(r=u("resource.file.create_folder"))?r:{default:()=>[r]}),o(b,{onClick:n,class:"btn-create-file"},z(a=u("resource.file.create_file"))?a:{default:()=>[a]}),o(b,{onClick:g,class:"btn-upload-file"},z(e=u("resource.file.upload_files"))?e:{default:()=>[e]})]}),o(R,null,{default:()=>[o(fe,{size:"small",allowInput:this.trim,placeholder:u("resource.file.enter_keyword_tips"),value:this.searchRef,"onUpdate:value":l=>this.searchRef=l},null),o(b,{size:"small",type:"primary",onClick:p},{default:()=>[o(he,null,{default:()=>[o(ce,null,null)]})]})]})]})]}),o(P,{title:u("resource.file.file_manage")},{"header-extra":()=>o(de,{separator:">",class:B.breadcrumb},{default:()=>{var l;return[(l=this.breadcrumbItemsRef)==null?void 0:l.map(t=>t.id===0?o(D,null,{default:()=>[o("span",{onClick:this.handleGoRoot},[t.fullName])]}):o(D,{href:t.id.toString()},{default:()=>[t.fullName]}))]}}),default:()=>o(R,{vertical:!0},{default:()=>{var l;return[o(ge,{remote:!0,columns:c,data:(l=this.resourceListRef)==null?void 0:l.value.table,striped:!0,size:"small",class:B["table-box"],"row-class-name":"items",scrollX:s},null),o(R,{justify:"center"},{default:()=>[o(Ne,{page:this.pagination.page,"onUpdate:page":t=>this.pagination.page=t,pageSize:this.pagination.pageSize,"onUpdate:pageSize":t=>this.pagination.pageSize=t,pageSizes:this.pagination.pageSizes,"item-count":this.pagination.itemCount,onUpdatePage:this.handleUpdatePage,onUpdatePageSize:this.handleUpdatePageSize,"show-quick-jumper":!0,"show-size-picker":!0},null)]})]}})}),o(ne,{show:this.folderShowRef,"onUpdate:show":l=>this.folderShowRef=l,onUpdateList:this.updateList},null),o(ue,{show:this.uploadShowRef,"onUpdate:show":l=>this.uploadShowRef=l,onUpdateList:this.updateList},null),o(pe,{show:this.renameShowRef,"onUpdate:show":l=>this.renameShowRef=l,id:this.renameInfo.id,name:this.renameInfo.name,description:this.renameInfo.description,onUpdateList:this.updateList},null)]})}});export{qt as default};

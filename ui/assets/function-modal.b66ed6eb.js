import{u as R,b5 as g,a as N,d as E,at as q,e as V,w as j,ba as v,c as r,ah as $,ak as M}from"./index.536c7d72.js";import{M as x}from"./index.4d9d5980.js";import{_ as B}from"./lodash.bce5b897.js";import{a as O,g as H,k as T,l as S}from"./index.ea5b005f.js";import{u as G}from"./index.990798b2.js";import{C as P}from"./CloudUploadOutlined.753210e3.js";import{N as C}from"./Form.b918a62f.js";import{N as l}from"./FormItem.67716b88.js";import{N as A}from"./RadioGroup.5a44255f.js";import{N as J}from"./Radio.8f1c774c.js";import{N as m}from"./Input.4b8b409e.js";import{N as D}from"./InputGroup.4428ca06.js";import{N as L}from"./TreeSelect.c15d3653.js";import{N as b}from"./Button.9dd5ee3c.js";import{N as z}from"./Upload.ebcdcc1c.js";import{N as K}from"./Icon.36d6d904.js";import"./index.eb38a2cf.js";import"./keysOf.10525521.js";import"./Card.1fac8dc8.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./index.7a579f81.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./utils.ba7f47bf.js";import"./is-browser.f4bc45cf.js";import"./Space.8c5cfc39.js";import"./get-slot.7f666ba0.js";import"./service.4ca56d82.js";import"./format-length.a0cbed4d.js";import"./use-locale.31127f4e.js";import"./Suffix.4fa63b0d.js";import"./Checkbox.9b98fe51.js";import"./Selection.2ed26059.js";import"./Popover.374e8a7f.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./Add.4fb6bf29.js";import"./Image.54674f30.js";import"./Tooltip.2dc588a0.js";const Q=()=>{const{t}=R(),i=g({functionFormRef:N(),functionForm:{type:"HIVE",funcName:"",className:"",argTypes:"",database:"",description:"",resourceId:-1},saving:!1,rules:{type:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.type)return new Error(t("resource.function.enter_name_tips"))}},funcName:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.funcName)return new Error(t("resource.function.enter_name_tips"))}},className:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.className)return new Error(t("resource.function.enter_name_tips"))}},resourceId:{required:!0,trigger:["input","blur"],validator(){if(i.functionForm.resourceId===-1)return new Error(t("resource.function.enter_name_tips"))}}}}),n=g({uploadFormRef:N(),uploadForm:{name:"",file:"",description:"",pid:-1,currentDir:"/"},uploadRules:{pid:{required:!0,trigger:["input","blur"],validator(){if(n.uploadForm.pid===-1)return new Error(t("resource.function.enter_name_tips"))}}}});return{state:i,uploadState:n}};function W(t,i,n){const{t:o}=R(),c=async()=>{F(async()=>await T({...t.functionForm},t.functionForm.resourceId))},h=async a=>{F(async()=>{await S({...t.functionForm,id:a},t.functionForm.resourceId,a)})},F=async a=>{if(await t.functionFormRef.validate(),!t.saving){t.saving=!0;try{await a(),window.$message.success(o("resource.udf.success")),t.saving=!1,n.emit("updateList"),n.emit("update:show")}catch{t.saving=!1}}},d=g({uploadShow:N(!1),udfResourceList:[],udfResourceDirList:[]}),p=a=>{for(const e of a)e.children&&(/\.jar$/.test(e.name)||(e.disabled=!0),p(e.children));return a.filter(e=>/\.jar$/.test(e.name)&&e.children.length===0||!/\.jar$/.test(e.name)&&e.children.length>0)},w=a=>{for(const e of a)e.children&&(e.children=w(e.children));return a.filter(e=>!/\.jar$/.test(e.name))},f=a=>{a.forEach(e=>{e.children===""||e.children===void 0||e.children===null||e.children.length===0?delete e.children:f(e.children)})},_=()=>{const{state:a}=G(O({type:"UDF"}).then(e=>{let u=e,s=B.cloneDeep(e);p(u),u=p(u),f(u),f(w(s)),s=s.filter(U=>{if(U.dirctory)return U}),d.udfResourceList=u,d.udfResourceDirList=s}),{});return a},y=()=>{i.uploadForm.name="",i.uploadForm.file="",i.uploadForm.pid=-1,i.uploadForm.currentDir="/",i.uploadForm.description=""};return{variables:d,getUdfList:_,handleCreateFunc:c,handleRenameFunc:h,handleUploadFile:()=>{i.uploadFormRef.validate(async a=>{if(!a){const e=new FormData;e.append("file",i.uploadForm.file),e.append("type","UDF"),e.append("name",i.uploadForm.name),e.append("pid",i.uploadForm.pid),e.append("currentDir",i.uploadForm.currentDir),e.append("description",i.uploadForm.description);const u=await H(e);window.$message.success(o("resource.function.success")),d.uploadShow=!1,y(),_(),t.functionForm.resourceId=u.id}})}}}function k(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!M(t)}const X={row:{type:Object,default:{}},show:{type:Boolean,default:!1}},Se=E({name:"ResourceFileFolder",props:X,emits:["update:show","updateList"],setup(t,i){var u;const n=N(),{state:o,uploadState:c}=Q(),{variables:h,handleCreateFunc:F,handleRenameFunc:d,getUdfList:p,handleUploadFile:w}=W(o,c,i),f=()=>{i.emit("update:show")},_=()=>{F()},y=()=>{d(t.row.id)},I=()=>{var s;c.uploadForm.currentDir=`/${(s=n.value.selectedOption)==null?void 0:s.fullName}`,w()},a=({file:s})=>{c.uploadForm.name=s.name,c.uploadForm.file=s.file},e=(u=q())==null?void 0:u.appContext.config.globalProperties.trim;return V(()=>{p()}),j(()=>t.row,()=>{h.uploadShow=!1,o.functionForm.type=t.row.type||"HIVE",o.functionForm.funcName=t.row.funcName,o.functionForm.className=t.row.className,o.functionForm.resourceId=t.row.resourceId||-1,o.functionForm.description=t.row.description}),{treeRef:n,hideModal:f,handleCreate:_,handleRename:y,customRequest:a,handleUpload:I,...v(o),...v(c),...v(h),trim:e}},render(){let t,i;const{t:n}=R();return r(x,{show:this.$props.show,title:this.row.id?n("resource.function.edit_udf_function"):n("resource.function.create_udf_function"),onCancel:this.hideModal,onConfirm:this.row.id?this.handleRename:this.handleCreate,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>[r(C,{rules:this.rules,ref:"functionFormRef"},{default:()=>[r(l,{label:n("resource.function.type"),path:"type"},{default:()=>[r(A,{value:this.functionForm.type,"onUpdate:value":o=>this.functionForm.type=o,name:"type",class:"radio-function-type"},{default:()=>[r(J,{value:"HIVE"},{default:()=>[$("HIVE UDF")]})]})]}),r(l,{label:n("resource.function.udf_function_name"),path:"funcName"},{default:()=>[r(m,{allowInput:this.trim,value:this.functionForm.funcName,"onUpdate:value":o=>this.functionForm.funcName=o,placeholder:n("resource.function.enter_udf_unction_name_tips"),class:"input-function-name"},null)]}),r(l,{label:n("resource.function.package_name"),path:"className"},{default:()=>[r(m,{allowInput:this.trim,value:this.functionForm.className,"onUpdate:value":o=>this.functionForm.className=o,placeholder:n("resource.function.enter_package_name_tips"),class:"input-class-name"},null)]}),r(l,{label:n("resource.function.udf_resources"),path:"resourceId"},{default:()=>[r(D,null,{default:()=>[r(L,{options:this.udfResourceList,"label-field":"fullName","key-field":"id",value:this.functionForm.resourceId,"onUpdate:value":o=>this.functionForm.resourceId=o,placeholder:n("resource.function.enter_select_udf_resources_tips"),defaultValue:this.functionForm.resourceId,disabled:this.uploadShow,showPath:!1,class:"btn-udf-resource-dropdown"},null),r(b,{type:"primary",ghost:!0,onClick:()=>this.uploadShow=!this.uploadShow},k(t=n("resource.function.upload_resources"))?t:{default:()=>[t]})]})]}),this.uploadShow&&r(C,{rules:this.uploadRules,ref:"uploadFormRef"},{default:()=>[r(l,{label:n("resource.function.udf_resources_directory"),path:"pid","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[r(L,{ref:"treeRef",options:this.udfResourceDirList,"label-field":"fullName","key-field":"id",value:this.uploadForm.pid,"onUpdate:value":o=>this.uploadForm.pid=o,placeholder:n("resource.function.enter_select_udf_resources_directory_tips"),defaultValue:this.uploadForm.pid},null)]}),r(l,{label:" ","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[r(D,null,{default:()=>[r(m,{allowInput:this.trim,value:this.uploadForm.name,"onUpdate:value":o=>this.uploadForm.name=o,placeholder:n("resource.function.enter_name_tips")},null),r(z,{value:this.uploadForm.file,"onUpdate:value":o=>this.uploadForm.file=o,customRequest:this.customRequest,showFileList:!1,style:{width:"auto"}},{default:()=>[r(b,null,{default:()=>[n("resource.function.upload"),r(K,null,{default:()=>[r(P,null,null)]})]})]})]})]}),r(l,{label:" ",path:"description","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[r(m,{allowInput:this.trim,type:"textarea",value:this.uploadForm.description,"onUpdate:value":o=>this.uploadForm.description=o,placeholder:n("resource.function.enter_description_tips"),class:"input-description"},null)]}),r(l,{label:" "},{default:()=>[r(b,{onClick:this.handleUpload},k(i=n("resource.function.upload_udf_resources"))?i:{default:()=>[i]})]})]}),r(l,{label:n("resource.function.instructions"),path:"description"},{default:()=>[r(m,{allowInput:this.trim,type:"textarea",value:this.functionForm.description,"onUpdate:value":o=>this.functionForm.description=o,placeholder:n("resource.function.enter_instructions_tips"),class:"input-description"},null)]})]})]})}});export{Se as default};

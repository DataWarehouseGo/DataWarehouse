import{d as j,b8 as V,b9 as d,b7 as x,a as N,u as Y,bB as Z,A as ee,c as e,V as te,ak as oe,bJ as le,bq as re}from"./index.536c7d72.js";import{S as l}from"./dag.module.c7fce5f9.js";import{D as ne}from"./track.f1da8f9b.js";import"./lodash.bce5b897.js";import{b as ie}from"./index.990798b2.js";import"./dag-context-menu.eb822e2c.js";import"./gForce.6c6bb633.js";import{u as ae}from"./use-text-copy.f14b4440.js";import"./service.4ca56d82.js";import"./dag-node-status.53d6d801.js";import"./task-node.c5365e5f.js";import se from"./dag-startup-param.aaefe1fe.js";import ce from"./variables-view.1a3f3d07.js";import{C as ue}from"./CopyOutlined.6f3bd1e0.js";import{S as de}from"./SearchOutlined.b0711796.js";import{D as me}from"./DownloadOutlined.e576ca2a.js";import{S as pe}from"./SyncOutlined.60307d76.js";import{D as fe}from"./DeleteOutlined.0c0bc8fc.js";import{F as ge,a as he}from"./FullscreenOutlined.764420ff.js";import{I as ve}from"./InfoCircleOutlined.83e0afb2.js";import{N as a}from"./Tooltip.2dc588a0.js";import{N as n}from"./Button.9dd5ee3c.js";import{N as s}from"./Icon.36d6d904.js";import{N as R}from"./Popover.374e8a7f.js";import{N as U}from"./text.9c0a1613.js";import{d as we}from"./Selection.2ed26059.js";import{a as _e}from"./Select.eddb521d.js";import"./toNumber.c47a71ca.js";import"./fade-in.cssr.ef9eaee7.js";import"./debounce.8aa2d6ba.js";import"./index.d67d1729.js";import"./common.cc1e0c6c.js";import"./SettingOutlined.06d5d07d.js";import"./PauseCircleOutlined.a11f5c7d.js";import"./CloseCircleOutlined.14b6a996.js";import"./CheckCircleOutlined.4f0aee70.js";import"./EditOutlined.57b65af3.js";import"./index.9c0cbe29.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./use-message.243250a9.js";import"./Spin.5bd91cff.js";import"./use-compitable.7f10f89e.js";import"./index.7a579f81.js";import"./format-length.a0cbed4d.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./VResizeObserver.0aad584a.js";import"./utils.ba7f47bf.js";import"./next-frame-once.e5ee25e8.js";import"./index.393f36dd.js";import"./index.5b6233e7.js";import"./index.c7ac6f91.js";import"./index.22428b53.js";import"./use-locale.31127f4e.js";import"./Suffix.4fa63b0d.js";import"./fade-in-scale-up.cssr.1167eea7.js";const be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ye=d("defs",null,null,-1),ke=d("path",{d:"M840 192h-56v-72c0-13.3-10.7-24-24-24H168c-13.3 0-24 10.7-24 24v272c0 13.3 10.7 24 24 24h592c13.3 0 24-10.7 24-24V256h32v200H465c-22.1 0-40 17.9-40 40v136h-44c-4.4 0-8 3.6-8 8v228c0 .6.1 1.3.2 1.9c-.1 2-.2 4.1-.2 6.1c0 46.4 37.6 84 84 84s84-37.6 84-84c0-2.1-.1-4.1-.2-6.1c.1-.6.2-1.2.2-1.9V640c0-4.4-3.6-8-8-8h-44V520h351c22.1 0 40-17.9 40-40V232c0-22.1-17.9-40-40-40zM720 352H208V160h512v192zM477 876c0 11-9 20-20 20s-20-9-20-20V696h40v180z",fill:"currentColor"},null,-1),Ce=[ye,ke],Ne=j({name:"FormatPainterOutlined",render:function(r,t){return x(),V("svg",be,Ce)}}),je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Se=d("defs",null,null,-1),Ve=d("path",{d:"M956 686.5l-.1-.1l-.1-.1C911.7 593 843.4 545 752.5 545s-159.2 48.1-203.4 141.3v.1c-5.4 11.5-5.4 24.9 0 36.4C593.3 816 661.6 864 752.5 864s159.2-48.1 203.4-141.3c5.4-11.5 5.4-24.8.1-36.2zM752.5 800c-62.1 0-107.4-30-141.1-95.5C645 639 690.4 609 752.5 609c62.1 0 107.4 30 141.1 95.5C860 770 814.6 800 752.5 800z",fill:"currentColor"},null,-1),xe=d("path",{d:"M697 705a56 56 0 1 0 112 0a56 56 0 1 0-112 0z",fill:"currentColor"},null,-1),Oe=d("path",{d:"M136 232h704v253h72V192c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h352v-72H136V232z",fill:"currentColor"},null,-1),Te=d("path",{d:"M724.9 338.1l-36.8-36.8c-3.1-3.1-8.2-3.1-11.3 0L493 485.3l-86.1-86.2c-3.1-3.1-8.2-3.1-11.3 0L251.3 543.4c-3.1 3.1-3.1 8.2 0 11.3l36.8 36.8c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8l86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.2-3.1 3.2-8.2 0-11.3z",fill:"currentColor"},null,-1),De=[Se,Ve,xe,Oe,Te],$e=j({name:"FundViewOutlined",render:function(r,t){return x(),V("svg",je,De)}}),ze={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Fe=d("path",{d:"M666.7 505.5l-246-178A8 8 0 0 0 408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512L421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z",fill:"currentColor"},null,-1),Me=d("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),Ie=[Fe,Me],Be=j({name:"RightCircleOutlined",render:function(r,t){return x(),V("svg",ze,Ie)}});function Pe(o){const r=N(""),{graph:t}=o,_=N(!1),f=()=>{_.value=!_.value},g=N([]),m=()=>{var k;const v=((k=t.value)==null?void 0:k.getNodes())||[];g.value=v.map(w=>({label:w.getData().taskName,value:w.id})),g.value.findIndex(w=>w.value===r.value)===-1&&(r.value="")};function S(v){if(r.value=v,!t.value)return;const b=t.value.getCellById(v);t.value.scrollToCell(b,{animation:{duration:600}}),t.value.cleanSelection(),t.value.select(b)}return{searchSelectValue:r,navigateTo:S,toggleSearchInput:f,searchInputVisible:_,reQueryNodes:m,nodesDropdown:g}}function y(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!oe(o)}const He={layoutToggle:{type:Function,default:()=>{}},instance:{type:Object,default:null},definition:{type:Object,default:null}},At=j({name:"workflow-dag-toolbar",props:He,emits:["versionToggle","saveModelToggle","removeTasks","refresh"],setup(o,r){const{t}=Y(),_=Z(),f=ee("graph",N()),g=re(),m=le(),{searchSelectValue:S,navigateTo:v,toggleSearchInput:b,searchInputVisible:k,reQueryNodes:w,nodesDropdown:A}=Pe({graph:f}),G=(p={fileName:"dag",bgColor:"#f2f3f7"})=>{var c;const{fileName:i,bgColor:h}=p;(c=f.value)==null||c.toPNG(C=>{ne.downloadDataUri(C,`${i}.png`)},{padding:{top:50,right:50,bottom:50,left:50},backgroundColor:h})},{isFullscreen:O,toggle:Q}=ie(),J=()=>{r.emit("versionToggle",!0)},W=()=>{o.layoutToggle(!0)},K=()=>{if(history.state.back!=="/login"){g.go(-1);return}if(history.state.current.includes("workflow/definitions")){g.push({path:`/projects/${m.params.projectCode}/workflow-definition`});return}if(history.state.current.includes("workflow/instances")){g.push({path:`/projects/${m.params.projectCode}/workflow/instances`});return}},{copy:T}=ae(),X=()=>{var p;if(f.value){const i=f.value.getSelectedCells();if(i){const h=i.filter(c=>c.isNode()).map(c=>+c.id);r.emit("removeTasks",h,i),(p=f.value)==null||p.removeCells(i)}}};return()=>{var c,C,D,$,z,F,M,I,B,P,H;let p,i,h;return e("div",{class:[l.toolbar,l[_.darkTheme?"toolbar-dark":"toolbar-light"]]},[e("span",{class:l["workflow-name"]},[m.name==="workflow-instance-detail"?(c=o.instance)==null?void 0:c.name:((D=(C=o.definition)==null?void 0:C.processDefinition)==null?void 0:D.name)||t("project.dag.create")]),((z=($=o.definition)==null?void 0:$.processDefinition)==null?void 0:z.name)&&e(a,null,{trigger:()=>e(n,{quaternary:!0,circle:!0,onClick:()=>{var L,q,E;const u=m.name==="workflow-instance-detail"?(L=o.instance)==null?void 0:L.name:(E=(q=o.definition)==null?void 0:q.processDefinition)==null?void 0:E.name;T(u)},class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(ue,null,null)]})]}),default:()=>t("project.dag.copy_name")}),((M=(F=o.definition)==null?void 0:F.processDefinition)==null?void 0:M.name)&&e(a,null,{trigger:()=>e(R,{placement:"bottom",trigger:"click",scrollable:!0,style:{maxWidth:"50vw",maxHeight:"70vh"}},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e($e,null,null)]})]}),header:()=>{let u;return e(U,{strong:!0,depth:1},y(u=t("project.workflow.parameters_variables"))?u:{default:()=>[u]})},default:()=>e(ce,{onCopy:T},null)}),default:()=>t("project.dag.view_variables")}),e("div",{class:l["toolbar-left-part"]},[m.name!=="workflow-instance-detail"&&((B=(I=o.definition)==null?void 0:I.processDefinition)==null?void 0:B.releaseState)==="ONLINE"&&e(we,{round:!0,size:"small",type:"info"},y(p=t("project.dag.online"))?p:{default:()=>[p]}),m.name==="workflow-instance-detail"&&e(te,null,[e(a,null,{trigger:()=>e(R,{placement:"bottom",trigger:"click"},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(Be,null,null)]})]}),header:()=>{let u;return e(U,{strong:!0,depth:1},y(u=t("project.workflow.startup_parameter"))?u:{default:()=>[u]})},default:()=>e(se,{startupParam:o.instance},null)}),default:()=>t("project.dag.startup_parameter")})])]),e("div",{class:l["toolbar-right-part"]},[e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:b},{icon:()=>e(s,null,{default:()=>[e(de,null,null)]})}),default:()=>t("project.dag.search")}),e("div",{class:`${l["toolbar-right-item"]} ${l["node-selector"]} ${k.value?l.visible:""}`},[e(_e,{size:"small",value:S.value,options:A.value,onFocus:w,onUpdateValue:v,filterable:!0},null)]),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>G()},{icon:()=>e(s,null,{default:()=>[e(me,null,null)]})}),default:()=>t("project.dag.download_png")}),o.instance&&e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>{r.emit("refresh")}},{icon:()=>e(s,null,{default:()=>[e(pe,null,null)]})}),default:()=>t("project.dag.refresh_dag_status")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>X()},{icon:()=>e(s,null,{default:()=>[e(fe,null,null)]})}),default:()=>t("project.dag.delete_cell")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Q},{icon:()=>e(s,null,{default:()=>[O.value?e(ge,null,null):e(he,null,null)]})}),default:()=>O.value?t("project.dag.fullscreen_close"):t("project.dag.fullscreen_open")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:W},{icon:()=>e(s,null,{default:()=>[e(Ne,null,null)]})}),default:()=>t("project.dag.format")}),!!o.definition&&e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:J},{icon:()=>e(s,null,{default:()=>[e(ve,null,null)]})}),default:()=>t("project.workflow.version_info")}),e(n,{class:[l["toolbar-right-item"],"btn-save"],type:"info",secondary:!0,round:!0,disabled:((H=(P=o.definition)==null?void 0:P.processDefinition)==null?void 0:H.releaseState)==="ONLINE"&&!o.instance,onClick:()=>{r.emit("saveModelToggle",!0)}},y(i=t("project.dag.save"))?i:{default:()=>[i]}),e(n,{secondary:!0,round:!0,onClick:K,class:"btn-close"},y(h=t("project.dag.close"))?h:{default:()=>[h]})])])}}});export{At as default};

import{u as b,bo as D,b5 as g,a as I,e as q,d as R,at as S,w as U,ba as A,c as r,ak as C}from"./index.536c7d72.js";import{l as M}from"./lodash.bce5b897.js";import{q as $}from"./index.89780321.js";import{q as E}from"./index.d84b4881.js";import{v as P,u as z,f as Z}from"./index.fe30cd62.js";import{M as V}from"./index.4d9d5980.js";import{N as j}from"./Form.b918a62f.js";import{N as l}from"./FormItem.67716b88.js";import{N as f}from"./Input.4b8b409e.js";import{a as _}from"./Select.eddb521d.js";import{N as x}from"./RadioGroup.5a44255f.js";import{N as L}from"./Space.8c5cfc39.js";import{N}from"./Radio.8f1c774c.js";import"./service.4ca56d82.js";import"./index.eb38a2cf.js";import"./Button.9dd5ee3c.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./keysOf.10525521.js";import"./Card.1fac8dc8.js";import"./index.7a579f81.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./utils.ba7f47bf.js";import"./format-length.a0cbed4d.js";import"./use-locale.31127f4e.js";import"./Suffix.4fa63b0d.js";import"./use-compitable.7f10f89e.js";import"./Selection.2ed26059.js";import"./Popover.374e8a7f.js";import"./next-frame-once.e5ee25e8.js";import"./get-slot.7f666ba0.js";function O(){const{t:s}=b(),a=D().getUserInfo.userType==="ADMIN_USER",u={userName:"",userPassword:"",tenantId:null,email:"",queue:"",phone:"",state:1};let n;const e=g({formRef:I(),formData:{...u},saving:!1,loading:!1,queues:[],tenants:[]}),d={userName:{trigger:["input","blur"],required:!0,validator(o,t){if(!t.trim())return new Error(s("security.user.username_tips"))}},userPassword:{trigger:["input","blur"],required:!0,validator(o,t){if(!t||!/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?![`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、]+$)[`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、0-9A-Za-z]{6,22}$/.test(t))return new Error(s("security.user.user_password_tips"))}},tenantId:{trigger:["input","blur"],required:!0,validator(o,t){if(a&&!t)return new Error(s("security.user.tenant_id_tips"))}},email:{trigger:["input","blur"],required:!0,validator(o,t){if(!t)return new Error(s("security.user.email_empty_tips"));if(!/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,}$/.test(t))return new Error(s("security.user.emial_correct_tips"))}},phone:{trigger:["input","blur"],validator(o,t){if(t&&!/^1(3|4|5|6|7|8)\d{9}$/.test(t))return new Error(s("security.user.phone_correct_tips"))}}},h=async()=>{const o=await E();e.queues=o.map(t=>({label:t.queueName,value:t.queueName})),e.queues.length&&(u.queue=e.queues[0].value,e.formData.queue=e.queues[0].value)},p=async()=>{const o=await $();e.tenants=o.map(t=>({label:t.tenantCode,value:t.id})),e.tenants.length&&(u.tenantId=e.tenants[0].value,e.formData.tenantId=e.tenants[0].value)},v=()=>{e.formData={...u}},y=async o=>{try{return await e.formRef.validate(),e.saving?!1:(e.saving=!0,n!==e.formData.userName&&await P({userName:e.formData.userName}),o?await z({id:o,...e.formData}):await Z(e.formData),e.saving=!1,!0)}catch{return e.saving=!1,!1}},c=o=>{e.formData={...M.exports.pick(o,["userName","tenantId","email","queue","phone","state"]),userPassword:""},n=e.formData.userName};return q(async()=>{a&&(h(),p())}),{state:e,formRules:d,IS_ADMIN:a,onReset:v,onSave:y,onSetValues:c}}function w(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!C(s)}const T={show:{type:Boolean,default:!1},currentRecord:{type:Object,default:{}}},Re=R({name:"user-modal",props:T,emits:["cancel","update"],setup(s,i){var c;const{t:m}=b(),{state:a,IS_ADMIN:u,formRules:n,onReset:e,onSave:d,onSetValues:h}=O(),p=()=>{e(),i.emit("cancel")},v=async()=>{var t;!await d((t=s.currentRecord)==null?void 0:t.id)||(p(),i.emit("update"))},y=(c=S())==null?void 0:c.appContext.config.globalProperties.trim;return U(()=>s.show,()=>{var o;s.show&&((o=s.currentRecord)==null?void 0:o.id)&&h(s.currentRecord)}),{t:m,...A(a),IS_ADMIN:u,formRules:n,onCancel:p,onConfirm:v,trim:y}},render(s){let i,m;const{t:a}=this,{currentRecord:u}=s;return r(V,{show:this.show,title:`${a(u!=null&&u.id?"security.user.edit_user":"security.user.create_user")}`,onCancel:this.onCancel,confirmLoading:this.loading,onConfirm:this.onConfirm,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>[r(j,{ref:"formRef",model:this.formData,rules:this.formRules,labelPlacement:"left",labelAlign:"left",labelWidth:80},{default:()=>{var n;return[r(l,{label:a("security.user.username"),path:"userName"},{default:()=>[r(f,{allowInput:this.trim,class:"input-username",value:this.formData.userName,"onUpdate:value":e=>this.formData.userName=e,minlength:3,maxlength:39,placeholder:a("security.user.username_tips")},null)]}),!((n=this.currentRecord)!=null&&n.id)&&r(l,{label:a("security.user.user_password"),path:"userPassword"},{default:()=>[r(f,{allowInput:this.trim,class:"input-password",type:"password",value:this.formData.userPassword,"onUpdate:value":e=>this.formData.userPassword=e,placeholder:a("security.user.user_password_tips")},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.tenant_code"),path:"tenantId"},{default:()=>[r(_,{class:"select-tenant",options:this.tenants,value:this.formData.tenantId,"onUpdate:value":e=>this.formData.tenantId=e},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.queue"),path:"queue"},{default:()=>[r(_,{class:"select-queue",options:this.queues,value:this.formData.queue,"onUpdate:value":e=>this.formData.queue=e,placeholder:a("security.user.queue_tips")},null)]}),r(l,{label:a("security.user.email"),path:"email"},{default:()=>[r(f,{allowInput:this.trim,class:"input-email",value:this.formData.email,"onUpdate:value":e=>this.formData.email=e,placeholder:a("security.user.email_empty_tips")},null)]}),r(l,{label:a("security.user.phone"),path:"phone"},{default:()=>[r(f,{allowInput:this.trim,class:"input-phone",value:this.formData.phone,"onUpdate:value":e=>this.formData.phone=e,placeholder:a("security.user.phone_empty_tips")},null)]}),r(l,{label:a("security.user.state"),path:"state"},{default:()=>[r(x,{value:this.formData.state,"onUpdate:value":e=>this.formData.state=e},{default:()=>[r(L,null,{default:()=>[r(N,{value:1,class:"radio-state-enable"},w(i=this.t("security.user.enable"))?i:{default:()=>[i]}),r(N,{value:0,class:"radio-state-disable"},w(m=this.t("security.user.disable"))?m:{default:()=>[m]})]})]})]})]}})]})}});export{Re as UserModal,Re as default};

import{bJ as b,u as y,b5 as v,a as u,d as T,e as w,w as C,ba as R,c as i}from"./index.536c7d72.js";import{u as L}from"./index.990798b2.js";import{l}from"./lodash.bce5b897.js";import{a as M,b as P}from"./index.607eab70.js";import{f}from"./index.9c0cbe29.js";import S from"./state-card.cf2fb7ca.js";import H from"./definition-card.a93a5dd8.js";import{g as x}from"./DatePicker.9d2907ba.js";import{s as V}from"./index.32451d2c.js";import{N as D,a as h}from"./Grid.f7dd02c2.js";import"./service.4ca56d82.js";import"./Pie.eab71161.js";import"./index.d67ddc9d.js";import"./index.67b00418.js";import"./Card.1fac8dc8.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./index.7a579f81.js";import"./keysOf.10525521.js";import"./DataTable.4d10e01f.js";import"./ArrowDown.e4a7e0d5.js";import"./format-length.a0cbed4d.js";import"./Button.9dd5ee3c.js";import"./is-browser.f4bc45cf.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./Checkbox.9b98fe51.js";import"./RadioGroup.5a44255f.js";import"./flatten.f4456e1c.js";import"./get-slot.7f666ba0.js";import"./Radio.8f1c774c.js";import"./Popover.374e8a7f.js";import"./index.8209174c.js";import"./utils.ba7f47bf.js";import"./use-compitable.7f10f89e.js";import"./next-frame-once.e5ee25e8.js";import"./Suffix.4fa63b0d.js";import"./Dropdown.8c20a4f5.js";import"./Icon.36d6d904.js";import"./ChevronRight.ffdb37b1.js";import"./Selection.2ed26059.js";import"./use-locale.31127f4e.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./use-keyboard.3c40c702.js";import"./Ellipsis.b0d6a040.js";import"./Tooltip.2dc588a0.js";import"./Input.4b8b409e.js";import"./Select.eddb521d.js";import"./Forward.5223a2c3.js";import"./Bar.dac6af15.js";function _(){const n=b(),{t:r}=y(),e=v({taskLoadingRef:u(!1)});return{getTaskState:t=>{if(e.taskLoadingRef)return;e.taskLoadingRef=!0;const{state:p}=L(M({startDate:t?f(t[0],"yyyy-MM-dd HH:mm:ss"):"",endDate:t?f(t[1],"yyyy-MM-dd HH:mm:ss"):"",projectCode:Number(n.params.projectCode)}).then(a=>{const s=a.taskCountDtos.map((o,d)=>({state:r("home."+l.exports.toLower(o.taskStateType)),number:o.count})),c=a.taskCountDtos.map(o=>({value:o.count,name:r("home."+l.exports.toLower(o.taskStateType))}));return e.taskLoadingRef=!1,{table:s,chart:c}}),{table:[],chart:[]});return p},taskVariables:e}}function N(){const n=b(),{t:r}=y(),e=v({processLoadingRef:u(!1)});return{getProcessState:t=>{if(e.processLoadingRef)return;e.processLoadingRef=!0;const{state:p}=L(P({startDate:t?f(t[0],"yyyy-MM-dd HH:mm:ss"):"",endDate:t?f(t[1],"yyyy-MM-dd HH:mm:ss"):"",projectCode:Number(n.params.projectCode)}).then(a=>{const s=a.taskCountDtos.map((o,d)=>({state:r("home."+l.exports.toLower(o.taskStateType)),number:o.count})),c=a.taskCountDtos.map(o=>({value:o.count,name:r("home."+l.exports.toLower(o.taskStateType))}));return e.processLoadingRef=!1,{table:s,chart:c}}),{table:[],chart:[]});return p},processVariables:e}}const Vt=T({name:"workflow-monitor",setup(){const{t:n,locale:r}=y(),e=u([x(V()),Date.now()]),m=u(),t=u(),{getTaskState:p,taskVariables:a}=_(),{getProcessState:s,processVariables:c}=N(),o=k=>{m.value=p(k)},d=k=>{t.value=s(k)},g=()=>{m.value=p(e.value)||m.value,t.value=s(e.value)||t.value};return w(()=>{g()}),C(()=>r.value,()=>g()),{t:n,dateRef:e,handleTaskDate:o,handleProcessDate:d,taskStateRef:m,processStateRef:t,...R(a),...R(c)}},render(){const{t:n,dateRef:r,handleTaskDate:e,handleProcessDate:m,taskLoadingRef:t,processLoadingRef:p}=this;return i("div",null,[i(D,{"x-gap":12,cols:2},{default:()=>[i(h,null,{default:()=>{var a,s;return[i(S,{title:n("home.task_state_statistics"),date:r,tableData:(a=this.taskStateRef)==null?void 0:a.value.table,chartData:(s=this.taskStateRef)==null?void 0:s.value.chart,onUpdateDatePickerValue:e,loadingRef:t},null)]}}),i(h,null,{default:()=>{var a,s;return[i(S,{title:n("home.process_state_statistics"),date:r,tableData:(a=this.processStateRef)==null?void 0:a.value.table,chartData:(s=this.processStateRef)==null?void 0:s.value.chart,onUpdateDatePickerValue:m,loadingRef:p},null)]}})]}),i(D,{cols:1,style:"margin-top: 12px;"},{default:()=>[i(h,null,{default:()=>[i(H,{title:n("home.process_definition_statistics")},null)]})]})])}});export{Vt as default};

import{u as F,bo as a,b5 as g,a as f,bu as u,w as I,d as w,e as v,at as U,ba as b,c as t,ak as N}from"./index.536c7d72.js";import{g as C,u as _}from"./index.fe30cd62.js";import{C as R}from"./index.67b00418.js";import{M as y}from"./index.4d9d5980.js";import M from"./info.f9f34e6d.js";import{N as S}from"./Button.9dd5ee3c.js";import{N as x}from"./Form.b918a62f.js";import{N as l}from"./FormItem.67716b88.js";import{N as n}from"./Input.4b8b409e.js";import"./service.4ca56d82.js";import"./lodash.bce5b897.js";import"./Card.1fac8dc8.js";import"./use-rtl.b3456902.js";import"./resolve-slot.12a336d2.js";import"./index.7a579f81.js";import"./keysOf.10525521.js";import"./index.eb38a2cf.js";import"./index.8209174c.js";import"./flatten.f4456e1c.js";import"./Scrollbar.7c2bcabe.js";import"./fade-in.cssr.ef9eaee7.js";import"./VResizeObserver.0aad584a.js";import"./fade-in-scale-up.cssr.1167eea7.js";import"./utils.ba7f47bf.js";import"./is-browser.f4bc45cf.js";import"./Space.8c5cfc39.js";import"./get-slot.7f666ba0.js";import"./format-length.a0cbed4d.js";import"./use-locale.31127f4e.js";import"./Suffix.4fa63b0d.js";function q(){const{t:e,locale:i}=F(),r=a().userInfo,o=g({profileFormRef:f(),profileForm:{username:r.userName,email:r.email,phone:r.phone},saving:!1,rules:{username:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.username==="")return new Error(e("profile.username_tips"))}},email:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.email==="")return new Error(e("profile.email_tips"));if(!u.regex.email.test(o.profileForm.email||""))return new Error(e("profile.email_correct_tips"))}}}});return I(r,()=>{o.profileForm={username:r.userName,email:r.email,phone:r.phone}}),{state:o,t:e,locale:i}}function j(){const e=a();return{getUserInfo:async()=>{const r=await C();await e.setUserInfo(r)}}}function E(e){const r=a().userInfo;return{handleUpdate:async()=>{if(await e.profileFormRef.validate(),e.saving!==!0){e.saving=!0;try{await _({userPassword:"",id:r.id,userName:e.profileForm.username,tenantId:r.tenantId,email:e.profileForm.email,phone:e.profileForm.phone,state:r.state,queue:r.queue}),e.saving=!1}catch{e.saving=!1}}}}}function k(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!N(e)}const fe=w({name:"profile",setup(){var p;const e=a().userInfo,i=f(!1),{state:r,t:o}=q(),{handleUpdate:s}=E(r),{getUserInfo:m}=j();v(async()=>{await m()});const c=()=>{i.value=!1,r.profileForm.email=e.email,r.profileForm.phone=e.phone,r.profileForm.username=e.userName},d=async()=>{i.value=!1,await s(),await m()},h=(p=U())==null?void 0:p.appContext.config.globalProperties.trim;return{...b(r),showModalRef:i,t:o,onCancel:c,onConfirm:d,trim:h}},render(){const{t:e,onCancel:i,onConfirm:r}=this;return t("div",null,[t(R,{title:e("profile.profile")},{default:()=>t(M,null,null),"header-extra":()=>{let o;return t(S,{type:"info",size:"small",onClick:()=>this.showModalRef=!this.showModalRef},k(o=e("profile.edit"))?o:{default:()=>[o]})}}),t(y,{title:e("profile.edit_profile"),show:this.showModalRef,onCancel:i,onConfirm:r,confirmDisabled:!this.profileForm.username||!this.profileForm.email||!u.regex.email.test(this.profileForm.email),confirmLoading:this.saving},{default:()=>t(x,{rules:this.rules,ref:"profileFormRef"},{default:()=>[t(l,{label:e("profile.username"),path:"username"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.username,"onUpdate:value":o=>this.profileForm.username=o,placeholder:e("profile.username_tips")},null)]}),t(l,{label:e("profile.email"),path:"email"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.email,"onUpdate:value":o=>this.profileForm.email=o,placeholder:e("profile.email_tips")},null)]}),t(l,{label:e("profile.phone"),path:"phone"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.phone,"onUpdate:value":o=>this.profileForm.phone=o,placeholder:e("profile.phone_tips")},null)]})]})})])}});export{fe as default};

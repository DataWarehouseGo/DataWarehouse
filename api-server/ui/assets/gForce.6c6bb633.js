import{l as ub}from"./lodash.bce5b897.js";import{bf as su}from"./index.536c7d72.js";const Ff=e=>typeof e=="number",Zx=e=>Number.isNaN(Number(e)),Jx=e=>e!==null&&typeof e=="object",Co=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(r=>{t.push(r)}),t.map(r=>Co(r))}if(typeof e=="object"&&e!=={}){const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]=Co(t[r])}),t}return e};function cb(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xo;if(typeof cb=="function")try{xo=ub.exports}catch{}xo||(xo=window._);var xr=xo,nt=xr,Ru=bt,fb="\0",jn="\0",Gf="";function bt(e){this._isDirected=nt.has(e,"directed")?e.directed:!0,this._isMultigraph=nt.has(e,"multigraph")?e.multigraph:!1,this._isCompound=nt.has(e,"compound")?e.compound:!1,this._label=void 0,this._defaultNodeLabelFn=nt.constant(void 0),this._defaultEdgeLabelFn=nt.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[jn]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}bt.prototype._nodeCount=0;bt.prototype._edgeCount=0;bt.prototype.isDirected=function(){return this._isDirected};bt.prototype.isMultigraph=function(){return this._isMultigraph};bt.prototype.isCompound=function(){return this._isCompound};bt.prototype.setGraph=function(e){return this._label=e,this};bt.prototype.graph=function(){return this._label};bt.prototype.setDefaultNodeLabel=function(e){return nt.isFunction(e)||(e=nt.constant(e)),this._defaultNodeLabelFn=e,this};bt.prototype.nodeCount=function(){return this._nodeCount};bt.prototype.nodes=function(){return nt.keys(this._nodes)};bt.prototype.sources=function(){return nt.filter(this.nodes(),nt.bind(function(e){return nt.isEmpty(this._in[e])},this))};bt.prototype.sinks=function(){return nt.filter(this.nodes(),nt.bind(function(e){return nt.isEmpty(this._out[e])},this))};bt.prototype.setNodes=function(e,t){var r=arguments;return nt.each(e,nt.bind(function(n){r.length>1?this.setNode(n,t):this.setNode(n)},this)),this};bt.prototype.setNode=function(e,t){return nt.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=jn,this._children[e]={},this._children[jn][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)};bt.prototype.node=function(e){return this._nodes[e]};bt.prototype.hasNode=function(e){return nt.has(this._nodes,e)};bt.prototype.removeNode=function(e){var t=this;if(nt.has(this._nodes,e)){var r=function(n){t.removeEdge(t._edgeObjs[n])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],nt.each(this.children(e),nt.bind(function(n){this.setParent(n)},this)),delete this._children[e]),nt.each(nt.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],nt.each(nt.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this};bt.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(nt.isUndefined(t))t=jn;else{t+="";for(var r=t;!nt.isUndefined(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this};bt.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]};bt.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!==jn)return t}};bt.prototype.children=function(e){if(nt.isUndefined(e)&&(e=jn),this._isCompound){var t=this._children[e];if(t)return nt.keys(t)}else{if(e===jn)return this.nodes();if(this.hasNode(e))return[]}};bt.prototype.predecessors=function(e){var t=this._preds[e];if(t)return nt.keys(t)};bt.prototype.successors=function(e){var t=this._sucs[e];if(t)return nt.keys(t)};bt.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return nt.union(t,this.successors(e))};bt.prototype.isLeaf=function(e){var t;return this.isDirected()?t=this.successors(e):t=this.neighbors(e),t.length===0};bt.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph()),nt.each(this._nodes,nt.bind(function(a,o){e(o)&&t.setNode(o,a)},this)),nt.each(this._edgeObjs,nt.bind(function(a){t.hasNode(a.v)&&t.hasNode(a.w)&&t.setEdge(a,this.edge(a))},this));var r=this,n={};function i(a){var o=r.parent(a);return o===void 0||t.hasNode(o)?(n[a]=o,o):o in n?n[o]:i(o)}return this._isCompound&&nt.each(t.nodes(),function(a){t.setParent(a,i(a))}),t};bt.prototype.setDefaultEdgeLabel=function(e){return nt.isFunction(e)||(e=nt.constant(e)),this._defaultEdgeLabelFn=e,this};bt.prototype.edgeCount=function(){return this._edgeCount};bt.prototype.edges=function(){return nt.values(this._edgeObjs)};bt.prototype.setPath=function(e,t){var r=this,n=arguments;return nt.reduce(e,function(i,a){return n.length>1?r.setEdge(i,a,t):r.setEdge(i,a),a}),this};bt.prototype.setEdge=function(){var e,t,r,n,i=!1,a=arguments[0];typeof a=="object"&&a!==null&&"v"in a?(e=a.v,t=a.w,r=a.name,arguments.length===2&&(n=arguments[1],i=!0)):(e=a,t=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),e=""+e,t=""+t,nt.isUndefined(r)||(r=""+r);var o=ga(this._isDirected,e,t,r);if(nt.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=n),this;if(!nt.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[o]=i?n:this._defaultEdgeLabelFn(e,t,r);var s=lb(this._isDirected,e,t,r);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[o]=s,Bf(this._preds[t],e),Bf(this._sucs[e],t),this._in[t][o]=s,this._out[e][o]=s,this._edgeCount++,this};bt.prototype.edge=function(e,t,r){var n=arguments.length===1?Cu(this._isDirected,arguments[0]):ga(this._isDirected,e,t,r);return this._edgeLabels[n]};bt.prototype.hasEdge=function(e,t,r){var n=arguments.length===1?Cu(this._isDirected,arguments[0]):ga(this._isDirected,e,t,r);return nt.has(this._edgeLabels,n)};bt.prototype.removeEdge=function(e,t,r){var n=arguments.length===1?Cu(this._isDirected,arguments[0]):ga(this._isDirected,e,t,r),i=this._edgeObjs[n];return i&&(e=i.v,t=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],Uf(this._preds[t],e),Uf(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this};bt.prototype.inEdges=function(e,t){var r=this._in[e];if(r){var n=nt.values(r);return t?nt.filter(n,function(i){return i.v===t}):n}};bt.prototype.outEdges=function(e,t){var r=this._out[e];if(r){var n=nt.values(r);return t?nt.filter(n,function(i){return i.w===t}):n}};bt.prototype.nodeEdges=function(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))};function Bf(e,t){e[t]?e[t]++:e[t]=1}function Uf(e,t){--e[t]||delete e[t]}function ga(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}return i+Gf+a+Gf+(nt.isUndefined(n)?fb:n)}function lb(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}var s={v:i,w:a};return n&&(s.name=n),s}function Cu(e,t){return ga(e,t.v,t.w,t.name)}var db="2.1.4",hb={Graph:Ru,version:db},zr=xr,vb=Ru,pb={write:mb,read:Eb};function mb(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:yb(e),edges:_b(e)};return zr.isUndefined(e.graph())||(t.value=zr.clone(e.graph())),t}function yb(e){return zr.map(e.nodes(),function(t){var r=e.node(t),n=e.parent(t),i={v:t};return zr.isUndefined(r)||(i.value=r),zr.isUndefined(n)||(i.parent=n),i})}function _b(e){return zr.map(e.edges(),function(t){var r=e.edge(t),n={v:t.v,w:t.w};return zr.isUndefined(t.name)||(n.name=t.name),zr.isUndefined(r)||(n.value=r),n})}function Eb(e){var t=new vb(e.options).setGraph(e.value);return zr.each(e.nodes,function(r){t.setNode(r.v,r.value),r.parent&&t.setParent(r.v,r.parent)}),zr.each(e.edges,function(r){t.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),t}var no=xr,bb=gb;function gb(e){var t={},r=[],n;function i(a){no.has(t,a)||(t[a]=!0,n.push(a),no.each(e.successors(a),i),no.each(e.predecessors(a),i))}return no.each(e.nodes(),function(a){n=[],i(a),n.length&&r.push(n)}),r}var Om=xr,Im=Nr;function Nr(){this._arr=[],this._keyIndices={}}Nr.prototype.size=function(){return this._arr.length};Nr.prototype.keys=function(){return this._arr.map(function(e){return e.key})};Nr.prototype.has=function(e){return Om.has(this._keyIndices,e)};Nr.prototype.priority=function(e){var t=this._keyIndices[e];if(t!==void 0)return this._arr[t].priority};Nr.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};Nr.prototype.add=function(e,t){var r=this._keyIndices;if(e=String(e),!Om.has(r,e)){var n=this._arr,i=n.length;return r[e]=i,n.push({key:e,priority:t}),this._decrease(i),!0}return!1};Nr.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key};Nr.prototype.decrease=function(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)};Nr.prototype._heapify=function(e){var t=this._arr,r=2*e,n=r+1,i=e;r<t.length&&(i=t[r].priority<t[i].priority?r:i,n<t.length&&(i=t[n].priority<t[i].priority?n:i),i!==e&&(this._swap(e,i),this._heapify(i)))};Nr.prototype._decrease=function(e){for(var t=this._arr,r=t[e].priority,n;e!==0&&(n=e>>1,!(t[n].priority<r));)this._swap(e,n),e=n};Nr.prototype._swap=function(e,t){var r=this._arr,n=this._keyIndices,i=r[e],a=r[t];r[e]=a,r[t]=i,n[a.key]=e,n[i.key]=t};var Tb=xr,Ab=Im,Pm=wb,Sb=Tb.constant(1);function wb(e,t,r,n){return Rb(e,String(t),r||Sb,n||function(i){return e.outEdges(i)})}function Rb(e,t,r,n){var i={},a=new Ab,o,s,u=function(c){var f=c.v!==o?c.v:c.w,d=i[f],p=r(c),b=s.distance+p;if(p<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+c+" Weight: "+p);b<d.distance&&(d.distance=b,d.predecessor=o,a.decrease(f,b))};for(e.nodes().forEach(function(c){var f=c===t?0:Number.POSITIVE_INFINITY;i[c]={distance:f},a.add(c,f)});a.size()>0&&(o=a.removeMin(),s=i[o],s.distance!==Number.POSITIVE_INFINITY);)n(o).forEach(u);return i}var Cb=Pm,xb=xr,Nb=Ob;function Ob(e,t,r){return xb.transform(e.nodes(),function(n,i){n[i]=Cb(e,i,t,r)},{})}var $f=xr,Lm=Ib;function Ib(e){var t=0,r=[],n={},i=[];function a(o){var s=n[o]={onStack:!0,lowlink:t,index:t++};if(r.push(o),e.successors(o).forEach(function(f){$f.has(n,f)?n[f].onStack&&(s.lowlink=Math.min(s.lowlink,n[f].index)):(a(f),s.lowlink=Math.min(s.lowlink,n[f].lowlink))}),s.lowlink===s.index){var u=[],c;do c=r.pop(),n[c].onStack=!1,u.push(c);while(o!==c);i.push(u)}}return e.nodes().forEach(function(o){$f.has(n,o)||a(o)}),i}var Pb=xr,Lb=Lm,Mb=kb;function kb(e){return Pb.filter(Lb(e),function(t){return t.length>1||t.length===1&&e.hasEdge(t[0],t[0])})}var Db=xr,Fb=Bb,Gb=Db.constant(1);function Bb(e,t,r){return Ub(e,t||Gb,r||function(n){return e.outEdges(n)})}function Ub(e,t,r){var n={},i=e.nodes();return i.forEach(function(a){n[a]={},n[a][a]={distance:0},i.forEach(function(o){a!==o&&(n[a][o]={distance:Number.POSITIVE_INFINITY})}),r(a).forEach(function(o){var s=o.v===a?o.w:o.v,u=t(o);n[a][s]={distance:u,predecessor:a}})}),i.forEach(function(a){var o=n[a];i.forEach(function(s){var u=n[s];i.forEach(function(c){var f=u[a],d=o[c],p=u[c],b=f.distance+d.distance;b<p.distance&&(p.distance=b,p.predecessor=d.predecessor)})})}),n}var Xi=xr,Mm=km;km.CycleException=uu;function km(e){var t={},r={},n=[];function i(a){if(Xi.has(r,a))throw new uu;Xi.has(t,a)||(r[a]=!0,t[a]=!0,Xi.each(e.predecessors(a),i),delete r[a],n.push(a))}if(Xi.each(e.sinks(),i),Xi.size(t)!==e.nodeCount())throw new uu;return n}function uu(){}var Vf=Mm,$b=Vb;function Vb(e){try{Vf(e)}catch(t){if(t instanceof Vf.CycleException)return!1;throw t}return!0}var No=xr,Dm=jb;function jb(e,t,r){No.isArray(t)||(t=[t]);var n=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],a={};return No.each(t,function(o){if(!e.hasNode(o))throw new Error("Graph does not have node: "+o);Fm(e,o,r==="post",a,n,i)}),i}function Fm(e,t,r,n,i,a){No.has(n,t)||(n[t]=!0,r||a.push(t),No.each(i(t),function(o){Fm(e,o,r,n,i,a)}),r&&a.push(t))}var zb=Dm,Hb=Xb;function Xb(e,t){return zb(e,t,"post")}var Wb=Dm,Yb=qb;function qb(e,t){return Wb(e,t,"pre")}var jf=xr,Kb=Ru,Qb=Im,Zb=Jb;function Jb(e,t){var r=new Kb,n={},i=new Qb,a;function o(u){var c=u.v===a?u.w:u.v,f=i.priority(c);if(f!==void 0){var d=t(u);d<f&&(n[c]=a,i.decrease(c,d))}}if(e.nodeCount()===0)return r;jf.each(e.nodes(),function(u){i.add(u,Number.POSITIVE_INFINITY),r.setNode(u)}),i.decrease(e.nodes()[0],0);for(var s=!1;i.size()>0;){if(a=i.removeMin(),jf.has(n,a))r.setEdge(a,n[a]);else{if(s)throw new Error("Input graph is not connected: "+e);s=!0}e.nodeEdges(a).forEach(o)}return r}var eg={components:bb,dijkstra:Pm,dijkstraAll:Nb,findCycles:Mb,floydWarshall:Fb,isAcyclic:$b,postorder:Hb,preorder:Yb,prim:Zb,tarjan:Lm,topsort:Mm},zf=hb,tg={Graph:zf.Graph,json:pb,alg:eg,version:zf.version};let cu=tg;!cu&&typeof window<"u"&&(cu=window.graphlib);Array.prototype.flat||(Array.prototype.flat=function(e){let t=e||1;if(!isFinite(t))return;const r=this.length;let n=[];if(this.length===0)return this;for(;t--;){const i=[];let a=!1;if(n.length===0){a=!0;for(let o=0;o<r;o++)this[o]instanceof Array?n.push(...this[o]):n.push(this[o])}else{for(let o=0;o<n.length;o++)n[o]instanceof Array?(a=!0,i.push(...n[o])):i.push(n[o]);n=i}if(!a&&t===1/0)break}return n});const Sn=cu,Hf=e=>{e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev},rg=(e,t)=>{if(e!=="_next"&&e!=="_prev")return t};class ng{constructor(){const t={};t._next=t._prev=t,this.isentinel=t}dequeue(){const t=this.isentinel,r=t._prev;if(r!==t)return Hf(r),r}enqueue(){const t=this.isentinel,r=t._prev;if(r!==t)return Hf(r),r}toString(){const t=[],r=this.isentinel;let n=r._prev;for(;n!==r;)t.push(JSON.stringify(n,rg)),n=n._prev;return`[${t.join(", ")}]`}}const ig=Sn.Graph,ag=()=>1,og=(e,t)=>{var r;if(e.nodeCount()<=1)return[];const n=ug(e,t||ag);return(r=sg(n.graph,n.buckets,n.zeroIdx).map(a=>e.outEdges(a.v,a.w)))===null||r===void 0?void 0:r.flat()},sg=(e,t,r)=>{let n=[];const i=t[t.length-1],a=t[0];let o;for(;e.nodeCount();){for(;o=a.dequeue();)Gs(e,t,r,o);for(;o=i.dequeue();)Gs(e,t,r,o);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(o=t[s].dequeue(),o){n=n.concat(Gs(e,t,r,o,!0));break}}}return n},Gs=(e,t,r,n,i)=>{var a,o;const s=i?[]:void 0;return(a=e.inEdges(n.v))===null||a===void 0||a.forEach(u=>{const c=e.edge(u),f=e.node(u.v);i&&s.push({v:u.v,w:u.w}),f.out===void 0&&(f.out=0),f.out-=c,fu(t,r,f)}),(o=e.outEdges(n.v))===null||o===void 0||o.forEach(u=>{const c=e.edge(u),f=u.w,d=e.node(f);d.in===void 0&&(d.in=0),d.in-=c,fu(t,r,d)}),e.removeNode(n.v),s},ug=(e,t)=>{const r=new ig;let n=0,i=0;e.nodes().forEach(u=>{r.setNode(u,{v:u,in:0,out:0})}),e.edges().forEach(u=>{const c=r.edge(u.v,u.w)||0,f=t==null?void 0:t(u),d=c+f;r.setEdge(u.v,u.w,d),i=Math.max(i,r.node(u.v).out+=f),n=Math.max(n,r.node(u.w).in+=f)});const a=[],o=i+n+3;for(let u=0;u<o;u++)a.push(new ng);const s=n+1;return r.nodes().forEach(u=>{fu(a,s,r.node(u))}),{buckets:a,zeroIdx:s,graph:r}},fu=(e,t,r)=>{r.out?r.in?e[r.out-r.in+t].enqueue(r):e[e.length-1].enqueue(r):e[0].enqueue(r)},cg=e=>{const t=n=>i=>n.edge(i).weight,r=e.graph().acyclicer==="greedy"?og(e,t(e)):fg(e);r==null||r.forEach(n=>{const i=e.edge(n);e.removeEdge(n),i.forwardName=n.name,i.reversed=!0,e.setEdge(n.w,n.v,i,`rev-${Math.random()}`)})},fg=e=>{const t=[],r={},n={},i=a=>{var o;n.hasOwnProperty(a)||(n[a]=!0,r[a]=!0,(o=e.outEdges(a))===null||o===void 0||o.forEach(s=>{r.hasOwnProperty(s.w)?t.push(s):i(s.w)}),delete r[a])};return e.nodes().forEach(i),t},lg=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.reversed){e.removeEdge(t);const n=r.forwardName;delete r.reversed,delete r.forwardName,e.setEdge(t.w,t.v,r,n)}})},Xf={run:cg,undo:lg},Gm=Sn.Graph,Bm=(e,t,r,n)=>{let i;do i=`${n}${Math.random()}`;while(e.hasNode(i));return r.dummy=t,e.setNode(i,r),i},Um=e=>{const t=new Gm().setGraph(e.graph());return e.nodes().forEach(r=>{t.setNode(r,e.node(r))}),e.edges().forEach(r=>{const n=t.edge(r.v,r.w)||{weight:0,minlen:1},i=e.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),t},dg=e=>{const t=new Gm({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(r=>{var n;!((n=e.children(r))===null||n===void 0)&&n.length||t.setNode(r,e.node(r))}),e.edges().forEach(r=>t.setEdge(r,e.edge(r))),t},ko=(e,t)=>{const r={};return e==null||e.forEach((n,i)=>{r[n]=t[i]}),r},hg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.outEdges(r))===null||n===void 0||n.forEach(a=>{i[a.w]=(i[a.w]||0)+e.edge(a).weight}),i});return ko(e.nodes(),t)},vg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.inEdges(r))===null||n===void 0||n.forEach(a=>{i[a.v]=(i[a.v]||0)+e.edge(a).weight}),i});return ko(e.nodes(),t)},pg=(e,t)=>{const r=e.x,n=e.y,i=t.x-r,a=t.y-n;let o=e.width/2,s=e.height/2;if(!i&&!a)return{x:0,y:0};let u,c;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),u=s*i/a,c=s):(i<0&&(o=-o),u=o,c=o*a/i),{x:r+u,y:n+c}},mg=e=>{const t=[],r=[],n=jm(e)+1;for(let i=0;i<n;i++)t.push([]),r.push([]);return e.nodes().forEach(i=>{const o=e.node(i).rank;o!==void 0&&t[o]&&r[o].push(i)}),r==null||r.forEach((i,a)=>{i==null||i.sort((o,s)=>{var u,c;return((u=e.node(o))===null||u===void 0?void 0:u.order)-((c=e.node(s))===null||c===void 0?void 0:c.order)}),i.forEach(o=>{t[a].push(o)})}),t},$m=e=>{const t=e.nodes().filter(n=>e.node(n).rank!==void 0).map(n=>e.node(n).rank),r=Math.min(...t);e.nodes().forEach(n=>{const i=e.node(n);i.hasOwnProperty("rank")&&(i.rank||(i.rank=0),i.rank-=r)})},Vm=e=>{const t=e.nodes().filter(o=>e.node(o).rank!==void 0).map(o=>e.node(o).rank),r=Math.min(...t),n=[];e.nodes().forEach(o=>{var s;const u=(((s=e.node(o))===null||s===void 0?void 0:s.rank)||0)-r;n[u]||(n[u]=[]),n[u].push(o)});let i=0;const a=e.graph().nodeRankFactor||0;for(let o=0;o<n.length;o++){const s=n[o];s===void 0&&o%a!==0?--i:i&&(s==null||s.forEach(u=>{e.node(u).rank||(e.node(u).rank=0),e.node(u).rank+=i}))}},yg=(e,t,r,n)=>{const i={width:0,height:0};return Ff(r)&&Ff(n)&&(i.rank=r,i.order=n),Bm(e,"border",i,t)},jm=e=>{const t=e.nodes().map(r=>{const n=e.node(r).rank;return n!==void 0?n:-1/0});return Math.max(...t)},_g=(e,t)=>{const r={lhs:[],rhs:[]};return e==null||e.forEach(n=>{t(n)?r.lhs.push(n):r.rhs.push(n)}),r},Eg=(e,t)=>{const r=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-r}ms`)}},bg=(e,t)=>t(),xu=(e,t)=>{let r=1/0,n;return e==null||e.forEach(i=>{const a=t(i);r>a&&(r=a,n=i)}),n},Qt={addDummyNode:Bm,simplify:Um,asNonCompoundGraph:dg,successorWeights:hg,predecessorWeights:vg,intersectRect:pg,buildLayerMatrix:mg,normalizeRanks:$m,removeEmptyRanks:Vm,addBorderNode:yg,maxRank:jm,partition:_g,time:Eg,notime:bg,zipObject:ko,minBy:xu},gg=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>Tg(e,t))},Tg=(e,t)=>{var r,n;let i=t.v,a=e.node(i).rank;const o=t.w,s=e.node(o).rank,u=t.name,c=e.edge(t),f=c.labelRank;if(s===a+1)return;e.removeEdge(t);let d,p,b;for(b=0,++a;a<s;++b,++a)c.points=[],p={edgeLabel:c,width:0,height:0,edgeObj:t,rank:a},d=Qt.addDummyNode(e,"edge",p,"_d"),a===f&&(p.width=c.width,p.height=c.height,p.dummy="edge-label",p.labelpos=c.labelpos),e.setEdge(i,d,{weight:c.weight},u),b===0&&(e.graph().dummyChains||(e.graph().dummyChains=[]),(n=(r=e.graph())===null||r===void 0?void 0:r.dummyChains)===null||n===void 0||n.push(d)),i=d;e.setEdge(i,o,{weight:c.weight},u)},Ag=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(r=>{var n;let i=e.node(r);const a=i.edgeLabel;let o;i.edgeObj&&e.setEdge(i.edgeObj,a);let s=r;for(;i.dummy;)o=(n=e.successors(s))===null||n===void 0?void 0:n[0],e.removeNode(s),a.points.push({x:i.x,y:i.y}),i.dummy==="edge-label"&&(a.x=i.x,a.y=i.y,a.width=i.width,a.height=i.height),s=o,i=e.node(s)})},Wf={run:gg,undo:Ag},zm=e=>{var t;const r={},n=i=>{var a;const o=e.node(i);if(r.hasOwnProperty(i))return o.rank;r[i]=!0;const s=(a=e.outEdges(i))===null||a===void 0?void 0:a.map(c=>n(c.w)-e.edge(c).minlen||1/0);let u=Math.min(...s);return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),o.rank=u,u};(t=e.sources())===null||t===void 0||t.forEach(i=>n(i))},Sg=e=>{var t;const r={};let n=0;const i=o=>{var s;const u=e.node(o);if(r.hasOwnProperty(o))return u.rank;r[o]=!0;const c=(s=e.outEdges(o))===null||s===void 0?void 0:s.map(d=>i(d.w)-e.edge(d).minlen||1/0);let f=Math.min(...c);return(f===Number.POSITIVE_INFINITY||f===void 0||f===null)&&(f=0),u.rank=f,n=Math.min(u.rank,n),u.rank};(t=e.sources())===null||t===void 0||t.forEach(o=>i(o)),n+=1;const a=(o,s)=>{var u;const c=e.node(o),f=isNaN(c.layer)?s:c.layer;(c.rank===void 0||c.rank<f)&&(c.rank=f),(u=e.outEdges(o))===null||u===void 0||u.map(d=>{a(d.w,f+e.edge(d).minlen)})};e.nodes().forEach(o=>{const s=e.node(o);isNaN(s.layer)?s.rank-=n:a(o,s.layer)})},gn=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,Hm=Sn.Graph,wg=e=>{const t=new Hm({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;Rg(t,e)<n;)i=Xm(t,e),a=t.hasNode(i.v)?gn(e,i):-gn(e,i),Wm(t,e,a);return t},Rg=(e,t)=>{const r=n=>{t.nodeEdges(n).forEach(i=>{const a=i.v,o=n===a?i.w:a;!e.hasNode(o)&&!gn(t,i)&&(e.setNode(o,{}),e.setEdge(n,o,{}),r(o))})};return e.nodes().forEach(r),e.nodeCount()},Cg=e=>{const t=new Hm({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;xg(t,e)<n;)i=Xm(t,e),a=t.hasNode(i.v)?gn(e,i):-gn(e,i),Wm(t,e,a);return t},xg=(e,t)=>{const r=n=>{var i;(i=t.nodeEdges(n))===null||i===void 0||i.forEach(a=>{const o=a.v,s=n===o?a.w:o;!e.hasNode(s)&&(t.node(s).layer!==void 0||!gn(t,a))&&(e.setNode(s,{}),e.setEdge(n,s,{}),r(s))})};return e.nodes().forEach(r),e.nodeCount()},Xm=(e,t)=>xu(t.edges(),r=>e.hasNode(r.v)!==e.hasNode(r.w)?gn(t,r):1/0),Wm=(e,t,r)=>{e.nodes().forEach(n=>{t.node(n).rank||(t.node(n).rank=0),t.node(n).rank+=r})},Ng=Sn.alg,{preorder:Og,postorder:Ig}=Ng,Xn=e=>{e=Um(e),zm(e);const t=wg(e);Ou(t),Nu(t,e);let r,n;for(;r=Km(t);)n=Qm(t,e,r),Zm(t,e,r,n)},Nu=(e,t)=>{let r=Ig(e,e.nodes());r=r==null?void 0:r.slice(0,(r==null?void 0:r.length)-1),r==null||r.forEach(n=>{Pg(e,t,n)})},Pg=(e,t,r)=>{const i=e.node(r).parent;e.edge(r,i).cutvalue=Ym(e,t,r)},Ym=(e,t,r)=>{var n;const a=e.node(r).parent;let o=!0,s=t.edge(r,a),u=0;return s||(o=!1,s=t.edge(a,r)),u=s.weight,(n=t.nodeEdges(r))===null||n===void 0||n.forEach(c=>{const f=c.v===r,d=f?c.w:c.v;if(d!==a){const p=f===o,b=t.edge(c).weight;if(u+=p?b:-b,Mg(e,r,d)){const A=e.edge(r,d).cutvalue;u+=p?-A:A}}}),u},Ou=(e,t)=>{t!==void 0&&(t=e.nodes()[0]),qm(e,{},1,t)},qm=(e,t,r,n,i)=>{var a;const o=r;let s=r;const u=e.node(n);return t[n]=!0,(a=e.neighbors(n))===null||a===void 0||a.forEach(c=>{t.hasOwnProperty(c)||(s=qm(e,t,s,c,n))}),u.low=o,u.lim=s++,i?u.parent=i:delete u.parent,s},Km=e=>e.edges().find(t=>e.edge(t).cutvalue<0),Qm=(e,t,r)=>{let n=r.v,i=r.w;t.hasEdge(n,i)||(n=r.w,i=r.v);const a=e.node(n),o=e.node(i);let s=a,u=!1;a.lim>o.lim&&(s=o,u=!0);const c=t.edges().filter(f=>u===Yf(e,e.node(f.v),s)&&u!==Yf(e,e.node(f.w),s));return xu(c,f=>gn(t,f))},Zm=(e,t,r,n)=>{const i=r.v,a=r.w;e.removeEdge(i,a),e.setEdge(n.v,n.w,{}),Ou(e),Nu(e,t),Lg(e,t)},Lg=(e,t)=>{const r=e.nodes().find(i=>!t.node(i).parent);let n=Og(e,r);n=n==null?void 0:n.slice(1),n==null||n.forEach(i=>{const a=e.node(i).parent;let o=t.edge(i,a),s=!1;o||(o=t.edge(a,i),s=!0),t.node(i).rank=t.node(a).rank+(s?o.minlen:-o.minlen)})},Mg=(e,t,r)=>e.hasEdge(t,r),Yf=(e,t,r)=>r.low<=t.lim&&t.lim<=r.lim;Xn.initLowLimValues=Ou;Xn.initCutValues=Nu;Xn.calcCutValue=Ym;Xn.leaveEdge=Km;Xn.enterEdge=Qm;Xn.exchangeEdges=Zm;const kg=e=>{switch(e.graph().ranker){case"network-simplex":Fg(e);break;case"tight-tree":qf(e);break;case"longest-path":Dg(e);break;default:qf(e)}},Dg=zm,qf=e=>{Sg(e),Cg(e)},Fg=e=>{Xn(e)},Gg=e=>{var t;const r=Ug(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{var i,a;let o=e.node(n);const s=o.edgeObj;if(!s)return;const u=Bg(e,r,s.v,s.w),c=u.path,f=u.lca;let d=0,p=c[d],b=!0;for(;n!==s.w;){if(o=e.node(n),b){for(;(p=c[d])!==f&&e.node(p).maxRank<o.rank;)d++;p===f&&(b=!1)}if(!b){for(;d<c.length-1&&((i=e.node(p=c[d+1]))===null||i===void 0?void 0:i.minRank)<=o.rank;)d++;p=c[d]}e.setParent(n,p),n=(a=e.successors(n))===null||a===void 0?void 0:a[0]}})},Bg=(e,t,r,n)=>{const i=[],a=[],o=Math.min(t[r].low,t[n].low),s=Math.max(t[r].lim,t[n].lim);let u,c;u=r;do u=e.parent(u),i.push(u);while(u&&(t[u].low>o||s>t[u].lim));for(c=u,u=n;(u=e.parent(u))!==c;)a.push(u);return{lca:c,path:i.concat(a.reverse())}},Ug=e=>{var t;const r={};let n=0;const i=a=>{var o;const s=n;(o=e.children(a))===null||o===void 0||o.forEach(i),r[a]={low:s,lim:n++}};return(t=e.children())===null||t===void 0||t.forEach(i),r},$g=e=>{var t;const r=Qt.addDummyNode(e,"root",{},"_root"),n=Vg(e),i=Math.max(...Object.values(n))-1,a=2*i+1;e.graph().nestingRoot=r,e.edges().forEach(s=>{e.edge(s).minlen*=a});const o=jg(e)+1;(t=e.children())===null||t===void 0||t.forEach(s=>{Jm(e,r,a,o,i,n,s)}),e.graph().nodeRankFactor=a},Jm=(e,t,r,n,i,a,o)=>{const s=e.children(o);if(!(s!=null&&s.length)){o!==t&&e.setEdge(t,o,{weight:0,minlen:r});return}const u=Qt.addBorderNode(e,"_bt"),c=Qt.addBorderNode(e,"_bb"),f=e.node(o);e.setParent(u,o),f.borderTop=u,e.setParent(c,o),f.borderBottom=c,s==null||s.forEach(d=>{Jm(e,t,r,n,i,a,d);const p=e.node(d),b=p.borderTop?p.borderTop:d,A=p.borderBottom?p.borderBottom:d,x=p.borderTop?n:2*n,N=b!==A?1:i-a[o]+1;e.setEdge(u,b,{minlen:N,weight:x,nestingEdge:!0}),e.setEdge(A,c,{minlen:N,weight:x,nestingEdge:!0})}),e.parent(o)||e.setEdge(t,u,{weight:0,minlen:i+a[o]})},Vg=e=>{var t;const r={},n=(i,a)=>{const o=e.children(i);o==null||o.forEach(s=>n(s,a+1)),r[i]=a};return(t=e.children())===null||t===void 0||t.forEach(i=>n(i,1)),r},jg=e=>{let t=0;return e.edges().forEach(r=>{t+=e.edge(r).weight}),t},zg=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(r=>{e.edge(r).nestingEdge&&e.removeEdge(r)})},Kf={run:$g,cleanup:zg},Hg=e=>{var t;const r=n=>{const i=e.children(n),a=e.node(n);if(i!=null&&i.length&&i.forEach(o=>r(o)),a.hasOwnProperty("minRank")){a.borderLeft=[],a.borderRight=[];for(let o=a.minRank,s=a.maxRank+1;o<s;++o)Qf(e,"borderLeft","_bl",n,a,o),Qf(e,"borderRight","_br",n,a,o)}};(t=e.children())===null||t===void 0||t.forEach(n=>r(n))},Qf=(e,t,r,n,i,a)=>{const o={rank:a,width:0,height:0,borderType:t},s=i[t][a-1],u=Qt.addDummyNode(e,"border",o,r);i[t][a]=u,e.setParent(u,n),s&&e.setEdge(s,u,{weight:1})},Xg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="lr"||r==="rl")&&ey(e)},Wg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="bt"||r==="rl")&&Yg(e),(r==="lr"||r==="rl")&&(qg(e),ey(e))},ey=e=>{e.nodes().forEach(t=>{Zf(e.node(t))}),e.edges().forEach(t=>{Zf(e.edge(t))})},Zf=e=>{const t=e.width;e.width=e.height,e.height=t},Yg=e=>{e.nodes().forEach(t=>{Bs(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Bs(i)),n.hasOwnProperty("y")&&Bs(n)})},Bs=e=>{e.y=-e.y},qg=e=>{e.nodes().forEach(t=>{Us(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Us(i)),n.hasOwnProperty("x")&&Us(n)})},Us=e=>{const t=e.x;e.x=e.y,e.y=t},Jf={adjust:Xg,undo:Wg},el=e=>{const t={},r=e.nodes().filter(f=>{var d;return!(!((d=e.children(f))===null||d===void 0)&&d.length)}),n=r.map(f=>e.node(f).rank),i=Math.max(...n),a=[];for(let f=0;f<i+1;f++)a.push([]);const o=f=>{var d;if(t.hasOwnProperty(f))return;t[f]=!0;const p=e.node(f);isNaN(p.rank)||a[p.rank].push(f),(d=e.successors(f))===null||d===void 0||d.forEach(b=>o(b))},s=r.sort((f,d)=>e.node(f).rank-e.node(d).rank),c=s.filter(f=>e.node(f).fixorder!==void 0).sort((f,d)=>e.node(f).fixorder-e.node(d).fixorder);return c==null||c.forEach(f=>{isNaN(e.node(f).rank)||a[e.node(f).rank].push(f),t[f]=!0}),s==null||s.forEach(o),a},Kg=(e,t,r)=>{const n=ko(r,r.map((f,d)=>d)),a=t.map(f=>{var d;const p=(d=e.outEdges(f))===null||d===void 0?void 0:d.map(b=>({pos:n[b.w]||0,weight:e.edge(b).weight}));return p==null?void 0:p.sort((b,A)=>b.pos-A.pos)}).flat().filter(f=>f!==void 0);let o=1;for(;o<r.length;)o<<=1;const s=2*o-1;o-=1;const u=Array(s).fill(0,0,s);let c=0;return a==null||a.forEach(f=>{let d=f.pos+o;u[d]+=f.weight;let p=0;for(;d>0;)d%2&&(p+=u[d+1]),d=d-1>>1,u[d]+=f.weight;c+=f.weight*p}),c},tl=(e,t)=>{let r=0;for(let n=1;n<(t==null?void 0:t.length);++n)r+=Kg(e,t[n-1],t[n]);return r},Qg=Sn.Graph,Zg=(e,t,r)=>{const n=Jg(e),i=new Qg({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(a=>e.node(a));return e.nodes().forEach(a=>{const o=e.node(a),s=e.parent(a);(o.rank===t||o.minRank<=t&&t<=o.maxRank)&&(i.setNode(a),i.setParent(a,s||n),e[r](a).forEach(u=>{const c=u.v===a?u.w:u.v,f=i.edge(c,a),d=f!==void 0?f.weight:0;i.setEdge(c,a,{weight:e.edge(u).weight+d})}),o.hasOwnProperty("minRank")&&i.setNode(a,{borderLeft:o.borderLeft[t],borderRight:o.borderRight[t]}))}),i},Jg=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},eT=(e,t,r)=>{const n={};let i;r==null||r.forEach(a=>{let o=e.parent(a),s,u;for(;o;){if(s=e.parent(o),s?(u=n[s],n[s]=o):(u=i,i=o),u&&u!==o){t.setEdge(u,o);return}o=s}})},tT=(e,t)=>t.map(r=>{const n=e.inEdges(r);if(!(n!=null&&n.length))return{v:r};{const i={sum:0,weight:0};return n==null||n.forEach(a=>{const o=e.edge(a),s=e.node(a.v);i.sum+=o.weight*s.order,i.weight+=o.weight}),{v:r,barycenter:i.sum/i.weight,weight:i.weight}}}),rT=(e,t)=>{var r,n,i;const a={};e==null||e.forEach((s,u)=>{const c=a[s.v]={i:u,indegree:0,in:[],out:[],vs:[s.v]};s.barycenter!==void 0&&(c.barycenter=s.barycenter,c.weight=s.weight)}),(r=t.edges())===null||r===void 0||r.forEach(s=>{const u=a[s.v],c=a[s.w];u!==void 0&&c!==void 0&&(c.indegree++,u.out.push(a[s.w]))});const o=(i=(n=Object.values(a)).filter)===null||i===void 0?void 0:i.call(n,s=>!s.indegree);return nT(o)},nT=e=>{var t,r;const n=[],i=u=>c=>{c.merged||(c.barycenter===void 0||u.barycenter===void 0||c.barycenter>=u.barycenter)&&iT(u,c)},a=u=>c=>{c.in.push(u),--c.indegree===0&&e.push(c)};for(;e!=null&&e.length;){const u=e.pop();n.push(u),(t=u.in.reverse())===null||t===void 0||t.forEach(c=>i(u)(c)),(r=u.out)===null||r===void 0||r.forEach(c=>a(u)(c))}const o=n.filter(u=>!u.merged),s=["vs","i","barycenter","weight"];return o.map(u=>{const c={};return s==null||s.forEach(f=>{u[f]!==void 0&&(c[f]=u[f])}),c})},iT=(e,t)=>{var r;let n=0,i=0;e.weight&&(n+=e.barycenter*e.weight,i+=e.weight),t.weight&&(n+=t.barycenter*t.weight,i+=t.weight),e.vs=(r=t.vs)===null||r===void 0?void 0:r.concat(e.vs),e.barycenter=n/i,e.weight=i,e.i=Math.min(t.i,e.i),t.merged=!0},aT=(e,t,r)=>{const n=Qt.partition(e,d=>d.hasOwnProperty("fixorder")&&!isNaN(d.fixorder)||d.hasOwnProperty("barycenter")),i=n.lhs,a=n.rhs.sort((d,p)=>-d.i- -p.i),o=[];let s=0,u=0,c=0;i==null||i.sort(oT(!!t,!!r)),c=rl(o,a,c),i==null||i.forEach(d=>{var p;c+=(p=d.vs)===null||p===void 0?void 0:p.length,o.push(d.vs),s+=d.barycenter*d.weight,u+=d.weight,c=rl(o,a,c)});const f={vs:o.flat()};return u&&(f.barycenter=s/u,f.weight=u),f},rl=(e,t,r)=>{let n=r,i;for(;t.length&&(i=t[t.length-1]).i<=n;)t.pop(),e==null||e.push(i.vs),n++;return n},oT=(e,t)=>(r,n)=>{if(r.fixorder!==void 0&&n.fixorder!==void 0)return r.fixorder-n.fixorder;if(r.barycenter<n.barycenter)return-1;if(r.barycenter>n.barycenter)return 1;if(t&&r.order!==void 0&&n.order!==void 0){if(r.order<n.order)return-1;if(r.order>n.order)return 1}return e?n.i-r.i:r.i-n.i},ty=(e,t,r,n,i)=>{var a,o,s,u;let c=e.children(t);const f=e.node(t),d=f?f.borderLeft:void 0,p=f?f.borderRight:void 0,b={};d&&(c=c==null?void 0:c.filter(X=>X!==d&&X!==p));const A=tT(e,c||[]);A==null||A.forEach(X=>{var ae;if(!((ae=e.children(X.v))===null||ae===void 0)&&ae.length){const W=ty(e,X.v,r,n);b[X.v]=W,W.hasOwnProperty("barycenter")&&uT(X,W)}});const x=rT(A,r);sT(x,b),(a=x.filter(X=>{var ae;return!!X.vs||((ae=X.vs)===null||ae===void 0?void 0:ae.length)>0}))===null||a===void 0||a.forEach(X=>{const ae=e.node(X.vs[0]);X.fixorder=ae.fixorder,X.order=ae.order});const N=aT(x,n,i);if(d&&(N.vs=[d,N.vs,p].flat(),!((o=e.predecessors(d))===null||o===void 0)&&o.length)){const X=e.node(((s=e.predecessors(d))===null||s===void 0?void 0:s[0])||{}),ae=e.node(((u=e.predecessors(p))===null||u===void 0?void 0:u[0])||{});N.hasOwnProperty("barycenter")||(N.barycenter=0,N.weight=0),N.barycenter=(N.barycenter*N.weight+X.order+ae.order)/(N.weight+2),N.weight+=2}return N},sT=(e,t)=>{e==null||e.forEach(r=>{var n;const i=(n=r.vs)===null||n===void 0?void 0:n.map(a=>t[a]?t[a].vs:a);r.vs=i.flat()})},uT=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},cT=Sn.Graph,fT=e=>{const t=Qt.maxRank(e),r=[],n=[];for(let c=1;c<t+1;c++)r.push(c);for(let c=t-1;c>-1;c--)n.push(c);const i=nl(e,r,"inEdges"),a=nl(e,n,"outEdges");let o=el(e);$s(e,o);let s=Number.POSITIVE_INFINITY,u;for(let c=0,f=0;f<4;++c,++f){il(c%2?i:a,c%4>=2),o=Qt.buildLayerMatrix(e);const d=tl(e,o);d<s&&(f=0,u=Co(o),s=d)}o=el(e),$s(e,o);for(let c=0,f=0;f<4;++c,++f){il(c%2?i:a,c%4>=2,!0),o=Qt.buildLayerMatrix(e);const d=tl(e,o);d<s&&(f=0,u=Co(o),s=d)}$s(e,u)},nl=(e,t,r)=>t.map(n=>Zg(e,n,r)),il=(e,t,r)=>{const n=new cT;e==null||e.forEach(i=>{var a;const o=i.graph().root,s=ty(i,o,n,t,r);for(let u=0;u<((a=s.vs)===null||a===void 0?void 0:a.length);u++)i.node(s.vs[u]).order=u;eT(i,n,s.vs)})},$s=(e,t)=>{t==null||t.forEach(r=>{r==null||r.forEach((n,i)=>{e.node(n).order=i})})},lT=Sn.Graph,dT=(e,t)=>{const r={},n=(i,a)=>{let o=0,s=0;const u=i.length,c=a==null?void 0:a[(a==null?void 0:a.length)-1];return a==null||a.forEach((f,d)=>{var p;const b=vT(e,f),A=b?e.node(b).order:u;(b||f===c)&&((p=a.slice(s,d+1))===null||p===void 0||p.forEach(x=>{var N;(N=e.predecessors(x))===null||N===void 0||N.forEach(X=>{const ae=e.node(X),W=ae.order;(W<o||A<W)&&!(ae.dummy&&e.node(x).dummy)&&ry(r,X,x)})}),s=d+1,o=A)}),a};return t!=null&&t.length&&t.reduce(n),r},hT=(e,t)=>{const r={},n=(a,o,s,u,c)=>{let f;const d=[];for(let p=o;p<s;p++)d.push(p);d.forEach(p=>{var b;f=a[p],e.node(f).dummy&&((b=e.predecessors(f))===null||b===void 0||b.forEach(A=>{const x=e.node(A);x.dummy&&(x.order<u||x.order>c)&&ry(r,A,f)}))})},i=(a,o)=>{let s=-1,u,c=0;return o==null||o.forEach((f,d)=>{if(e.node(f).dummy==="border"){const p=e.predecessors(f)||[];p.length&&(u=e.node(p[0]).order,n(o,c,d,s,u),c=d,s=u)}n(o,c,o.length,u,a.length)}),o};return t!=null&&t.length&&t.reduce(i),r},vT=(e,t)=>{var r;if(e.node(t).dummy)return(r=e.predecessors(t))===null||r===void 0?void 0:r.find(n=>e.node(n).dummy)},ry=(e,t,r)=>{let n=t,i=r;if(n>i){const o=n;n=i,i=o}let a=e[n];a||(e[n]=a={}),a[i]=!0},pT=(e,t,r)=>{let n=t,i=r;if(n>i){const a=t;n=i,i=a}return e[n]&&e[n].hasOwnProperty(i)},mT=(e,t,r,n)=>{const i={},a={},o={};return t==null||t.forEach(s=>{s==null||s.forEach((u,c)=>{i[u]=u,a[u]=u,o[u]=c})}),t==null||t.forEach(s=>{let u=-1;s==null||s.forEach(c=>{let f=n(c);if(f.length){f=f.sort((p,b)=>o[p]-o[b]);const d=(f.length-1)/2;for(let p=Math.floor(d),b=Math.ceil(d);p<=b;++p){const A=f[p];a[c]===c&&u<o[A]&&!pT(r,c,A)&&(a[A]=c,a[c]=i[c]=i[A],u=o[A])}}})}),{root:i,align:a}},yT=(e,t,r,n,i)=>{var a;const o={},s=_T(e,t,r,i),u=i?"borderLeft":"borderRight",c=(p,b)=>{let A=s.nodes(),x=A.pop();const N={};for(;x;)N[x]?p(x):(N[x]=!0,A.push(x),A=A.concat(b(x))),x=A.pop()},f=p=>{o[p]=(s.inEdges(p)||[]).reduce((b,A)=>Math.max(b,(o[A.v]||0)+s.edge(A)),0)},d=p=>{const b=(s.outEdges(p)||[]).reduce((x,N)=>Math.min(x,(o[N.w]||0)-s.edge(N)),Number.POSITIVE_INFINITY),A=e.node(p);b!==Number.POSITIVE_INFINITY&&A.borderType!==u&&(o[p]=Math.max(o[p],b))};return c(f,s.predecessors.bind(s)),c(d,s.successors.bind(s)),(a=Object.values(n))===null||a===void 0||a.forEach(p=>{o[p]=o[r[p]]}),o},_T=(e,t,r,n)=>{const i=new lT,a=e.graph(),o=TT(a.nodesep,a.edgesep,n);return t==null||t.forEach(s=>{let u;s==null||s.forEach(c=>{const f=r[c];if(i.setNode(f),u){const d=r[u],p=i.edge(d,f);i.setEdge(d,f,Math.max(o(e,c,u),p||0))}u=c})}),i},ET=(e,t)=>Qt.minBy(Object.values(t),r=>{var n;let i=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return(n=Object.keys(r))===null||n===void 0||n.forEach(o=>{const s=r[o],u=AT(e,o)/2;i=Math.max(s+u,i),a=Math.min(s-u,a)}),i-a});function bT(e,t){const r=Object.values(t),n=Math.min(...r),i=Math.max(...r);["u","d"].forEach(a=>{["l","r"].forEach(o=>{const s=a+o,u=e[s];let c;if(u===t)return;const f=Object.values(u);c=o==="l"?n-Math.min(...f):i-Math.max(...f),c&&(e[s]={},Object.keys(u).forEach(d=>{e[s][d]=u[d]+c}))})})}const gT=(e,t)=>{const r={};return Object.keys(e.ul).forEach(n=>{if(t)r[n]=e[t.toLowerCase()][n];else{const a=Object.values(e).map(o=>o[n]).sort((o,s)=>o-s);r[n]=(a[1]+a[2])/2}}),r},TT=(e,t,r)=>(n,i,a)=>{const o=n.node(i),s=n.node(a);let u=0,c;if(u+=o.width/2,o.hasOwnProperty("labelpos"))switch((o.labelpos||"").toLowerCase()){case"l":c=-o.width/2;break;case"r":c=o.width/2;break}if(c&&(u+=r?c:-c),c=0,u+=(o.dummy?t:e)/2,u+=(s.dummy?t:e)/2,u+=s.width/2,s.hasOwnProperty("labelpos"))switch((s.labelpos||"").toLowerCase()){case"l":c=s.width/2;break;case"r":c=-s.width/2;break}return c&&(u+=r?c:-c),c=0,u},AT=(e,t)=>{var r;return((r=e.node(t))===null||r===void 0?void 0:r.width)||0},ST=e=>{const t=Qt.buildLayerMatrix(e),r=e.graph().ranksep;let n=0;t==null||t.forEach(i=>{const a=i.map(s=>e.node(s).height),o=Math.max(...a);i==null||i.forEach(s=>{e.node(s).y=n+o/2}),n+=o+r})},wT=e=>{const t=Qt.buildLayerMatrix(e),r=Object.assign(dT(e,t),hT(e,t)),n={};let i;["u","d"].forEach(o=>{i=o==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(i=i.map(d=>Object.values(d).reverse()));const u=(o==="u"?e.predecessors:e.successors).bind(e),c=mT(e,i,r,u),f=yT(e,i,c.root,c.align,s==="r");s==="r"&&Object.keys(f).forEach(d=>f[d]=-f[d]),n[o+s]=f})});const a=ET(e,n);return a&&bT(n,a),gT(n,e.graph().align)},RT=e=>{var t;e=Qt.asNonCompoundGraph(e),ST(e);const r=wT(e);(t=Object.keys(r))===null||t===void 0||t.forEach(n=>{e.node(n).x=r[n]})},CT=(e,t)=>{const n=e.nodes().filter(o=>{var s;return!(!((s=e.children(o))===null||s===void 0)&&s.length)}).map(o=>e.node(o).rank),i=Math.max(...n),a=[];for(let o=0;o<i+1;o++)a.push([]);t==null||t.forEach(o=>{const s=e.node(o);!s||s.dummy||isNaN(s.rank)||(s.fixorder=a[s.rank].length,a[s.rank].push(o))})},xT=Sn.Graph,e2=(e,t)=>{const r=t&&t.debugTiming?Qt.time:Qt.notime;r("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&r("  inheritOrder",()=>{OT(e,t.prevGraph)});const n=r("  buildLayoutGraph",()=>FT(e));t&&t.edgeLabelSpace===!1||r("  makeSpaceForEdgeLabels",()=>{GT(n)});try{r("  runLayout",()=>{NT(n,r,t)})}catch(i){if(i.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,i);return}throw i}r("  updateInputGraph",()=>{IT(e,n)})})},NT=(e,t,r)=>{t("    removeSelfEdges",()=>{WT(e)}),t("    acyclic",()=>{Xf.run(e)}),t("    nestingGraph.run",()=>{Kf.run(e)}),t("    rank",()=>{kg(Qt.asNonCompoundGraph(e))}),t("    injectEdgeLabelProxies",()=>{BT(e)}),t("    removeEmptyRanks",()=>{Vm(e)}),t("    nestingGraph.cleanup",()=>{Kf.cleanup(e)}),t("    normalizeRanks",()=>{$m(e)}),t("    assignRankMinMax",()=>{UT(e)}),t("    removeEdgeLabelProxies",()=>{$T(e)}),t("    normalize.run",()=>{Wf.run(e)}),t("    parentDummyChains",()=>{Gg(e)}),t("    addBorderSegments",()=>{Hg(e)}),r&&r.keepNodeOrder&&t("    initDataOrder",()=>{CT(e,r.nodeOrder)}),t("    order",()=>{fT(e)}),t("    insertSelfEdges",()=>{YT(e)}),t("    adjustCoordinateSystem",()=>{Jf.adjust(e)}),t("    position",()=>{RT(e)}),t("    positionSelfEdges",()=>{qT(e)}),t("    removeBorderNodes",()=>{XT(e)}),t("    normalize.undo",()=>{Wf.undo(e)}),t("    fixupEdgeLabelCoords",()=>{zT(e)}),t("    undoCoordinateSystem",()=>{Jf.undo(e)}),t("    translateGraph",()=>{VT(e)}),t("    assignNodeIntersects",()=>{jT(e)}),t("    reversePoints",()=>{HT(e)}),t("    acyclic.undo",()=>{Xf.undo(e)})},OT=(e,t)=>{const r=t._nodes||{};e.nodes().forEach(n=>{const i=e.node(n);r[n]!==void 0?(i.fixorder=r[n]._order,delete r[n]._order):delete i.fixorder})},IT=(e,t)=>{e.nodes().forEach(r=>{var n;const i=e.node(r),a=t.node(r);i&&(i.x=a.x,i.y=a.y,i._order=a.order,i._rank=a.rank,!((n=t.children(r))===null||n===void 0)&&n.length&&(i.width=a.width,i.height=a.height))}),e.edges().forEach(r=>{const n=e.edge(r),i=t.edge(r);n.points=i.points,i.hasOwnProperty("x")&&(n.x=i.x,n.y=i.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},PT=["nodesep","edgesep","ranksep","marginx","marginy"],LT={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Vs=["acyclicer","ranker","rankdir","align"],MT=["width","height","layer","fixorder"],al={width:0,height:0},kT=["minlen","weight","width","height","labeloffset"],DT={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},js=["labelpos"],FT=e=>{const t=new xT({multigraph:!0,compound:!0}),r=Hs(e.graph()),n={};return Vs==null||Vs.forEach(i=>{r[i]!==void 0&&(n[i]=r[i])}),t.setGraph(Object.assign({},LT,zs(r,PT),n)),e.nodes().forEach(i=>{const a=Hs(e.node(i)),o=zs(a,MT);Object.keys(al).forEach(s=>{o[s]===void 0&&(o[s]=al[s])}),t.setNode(i,o),t.setParent(i,e.parent(i))}),e.edges().forEach(i=>{const a=Hs(e.edge(i)),o={};js==null||js.forEach(s=>{a[s]!==void 0&&(o[s]=a[s])}),t.setEdge(i,Object.assign({},DT,zs(a,kT),o))}),t},GT=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(r=>{const n=e.node(r);isNaN(n.layer)||(n.layer?n.layer*=2:n.layer=0)}),e.edges().forEach(r=>{var n;const i=e.edge(r);i.minlen*=2,((n=i.labelpos)===null||n===void 0?void 0:n.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?i.width+=i.labeloffset:i.height+=i.labeloffset)})},BT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.width&&r.height){const n=e.node(t.v),i=e.node(t.w),a={e:t,rank:(i.rank-n.rank)/2+n.rank};Qt.addDummyNode(e,"edge-proxy",a,"_ep")}})},UT=e=>{let t=0;e.nodes().forEach(r=>{const n=e.node(r);n.borderTop&&(n.minRank=e.node(n.borderTop).rank,n.maxRank=e.node(n.borderBottom).rank,t=Math.max(t,n.maxRank||-1/0))}),e.graph().maxRank=t},$T=e=>{e.nodes().forEach(t=>{const r=e.node(t);r.dummy==="edge-proxy"&&(e.edge(r.e).labelRank=r.rank,e.removeNode(t))})},VT=e=>{let t=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,i=0;const a=e.graph(),o=a.marginx||0,s=a.marginy||0,u=c=>{if(!c)return;const f=c.x,d=c.y,p=c.width,b=c.height;!isNaN(f)&&!isNaN(p)&&(t=Math.min(t,f-p/2),r=Math.max(r,f+p/2)),!isNaN(d)&&!isNaN(b)&&(n=Math.min(n,d-b/2),i=Math.max(i,d+b/2))};e.nodes().forEach(c=>{u(e.node(c))}),e.edges().forEach(c=>{const f=e.edge(c);f.hasOwnProperty("x")&&u(f)}),t-=o,n-=s,e.nodes().forEach(c=>{const f=e.node(c);f.x-=t,f.y-=n}),e.edges().forEach(c=>{var f;const d=e.edge(c);(f=d.points)===null||f===void 0||f.forEach(p=>{p.x-=t,p.y-=n}),d.hasOwnProperty("x")&&(d.x-=t),d.hasOwnProperty("y")&&(d.y-=n)}),a.width=r-t+o,a.height=i-n+s},jT=e=>{e.edges().forEach(t=>{const r=e.edge(t),n=e.node(t.v),i=e.node(t.w);let a,o;r.points?(a=r.points[0],o=r.points[r.points.length-1]):(r.points=[],a=i,o=n),r.points.unshift(Qt.intersectRect(n,a)),r.points.push(Qt.intersectRect(i,o))})},zT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.hasOwnProperty("x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})},HT=e=>{e.edges().forEach(t=>{const r=e.edge(t);r.reversed&&r.points.reverse()})},XT=e=>{e.nodes().forEach(t=>{var r,n,i;if(!((r=e.children(t))===null||r===void 0)&&r.length){const a=e.node(t),o=e.node(a.borderTop),s=e.node(a.borderBottom),u=e.node(a.borderLeft[((n=a.borderLeft)===null||n===void 0?void 0:n.length)-1]),c=e.node(a.borderRight[((i=a.borderRight)===null||i===void 0?void 0:i.length)-1]);a.width=Math.abs((c==null?void 0:c.x)-(u==null?void 0:u.x))||10,a.height=Math.abs((s==null?void 0:s.y)-(o==null?void 0:o.y))||10,a.x=((u==null?void 0:u.x)||0)+a.width/2,a.y=((o==null?void 0:o.y)||0)+a.height/2}}),e.nodes().forEach(t=>{e.node(t).dummy==="border"&&e.removeNode(t)})},WT=e=>{e.edges().forEach(t=>{if(t.v===t.w){const r=e.node(t.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})},YT=e=>{const t=Qt.buildLayerMatrix(e);t==null||t.forEach(r=>{let n=0;r==null||r.forEach((i,a)=>{var o;const s=e.node(i);s.order=a+n,(o=s.selfEdges)===null||o===void 0||o.forEach(u=>{Qt.addDummyNode(e,"selfedge",{width:u.label.width,height:u.label.height,rank:s.rank,order:a+ ++n,e:u.e,label:u.label},"_se")}),delete s.selfEdges})})},qT=e=>{e.nodes().forEach(t=>{const r=e.node(t);if(r.dummy==="selfedge"){const n=e.node(r.e.v),i=n.x+n.width/2,a=n.y,o=r.x-i,s=n.height/2;e.setEdge(r.e,r.label),e.removeNode(t),r.label.points=[{x:i+2*o/3,y:a-s},{x:i+5*o/6,y:a-s},{y:a,x:i+o},{x:i+5*o/6,y:a+s},{x:i+2*o/3,y:a+s}],r.label.x=r.x,r.label.y=r.y}})},zs=(e,t)=>{const r={};return t==null||t.forEach(n=>{e[n]!==void 0&&(r[n]=+e[n])}),r},Hs=e=>{const t={};return Object.keys(e).forEach(r=>{const n=e[r];t[r.toLowerCase()]=n}),t};function Ve(e,t,r,n){!r||Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ol(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function We(e,t,r){return t&&ol(e.prototype,t),r&&ol(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function je(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(o,s){return s(e,t,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,t,a),a=null),a}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var sl;(function(e){(function(t){var r=typeof su=="object"?su:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(e);typeof r.Reflect>"u"?r.Reflect=e:n=i(r.Reflect,n),t(n);function i(a,o){return function(s,u){typeof a[s]!="function"&&Object.defineProperty(a,s,{configurable:!0,writable:!0,value:u}),o&&o(s,u)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",s={__proto__:[]}instanceof Array,u=!o&&!s,c={create:o?function(){return y(Object.create(null))}:s?function(){return y({__proto__:null})}:function(){return y({})},has:u?function(j,oe){return r.call(j,oe)}:function(j,oe){return oe in j},get:u?function(j,oe){return r.call(j,oe)?j[oe]:void 0}:function(j,oe){return j[oe]}},f=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Kn(),b=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:$o(),A=!d&&typeof WeakMap=="function"?WeakMap:Vo(),x=new A;function N(j,oe,Ae,Oe){if(mt(Ae)){if(!Sa(j))throw new TypeError;if(!Ci(oe))throw new TypeError;return ft(j,oe)}else{if(!Sa(j))throw new TypeError;if(!St(oe))throw new TypeError;if(!St(Oe)&&!mt(Oe)&&!ht(Oe))throw new TypeError;return ht(Oe)&&(Oe=void 0),Ae=Or(Ae),pt(j,oe,Ae,Oe)}}t("decorate",N);function X(j,oe){function Ae(Oe,Ue){if(!St(Oe))throw new TypeError;if(!mt(Ue)&&!wa(Ue))throw new TypeError;Ge(j,oe,Oe,Ue)}return Ae}t("metadata",X);function ae(j,oe,Ae,Oe){if(!St(Ae))throw new TypeError;return mt(Oe)||(Oe=Or(Oe)),Ge(j,oe,Ae,Oe)}t("defineMetadata",ae);function W(j,oe,Ae){if(!St(oe))throw new TypeError;return mt(Ae)||(Ae=Or(Ae)),me(j,oe,Ae)}t("hasMetadata",W);function Ee(j,oe,Ae){if(!St(oe))throw new TypeError;return mt(Ae)||(Ae=Or(Ae)),H(j,oe,Ae)}t("hasOwnMetadata",Ee);function he(j,oe,Ae){if(!St(oe))throw new TypeError;return mt(Ae)||(Ae=Or(Ae)),Ie(j,oe,Ae)}t("getMetadata",he);function we(j,oe,Ae){if(!St(oe))throw new TypeError;return mt(Ae)||(Ae=Or(Ae)),Ye(j,oe,Ae)}t("getOwnMetadata",we);function Me(j,oe){if(!St(j))throw new TypeError;return mt(oe)||(oe=Or(oe)),Fe(j,oe)}t("getMetadataKeys",Me);function He(j,oe){if(!St(j))throw new TypeError;return mt(oe)||(oe=Or(oe)),xt(j,oe)}t("getOwnMetadataKeys",He);function dt(j,oe,Ae){if(!St(oe))throw new TypeError;mt(Ae)||(Ae=Or(Ae));var Oe=Qe(oe,Ae,!1);if(mt(Oe)||!Oe.delete(j))return!1;if(Oe.size>0)return!0;var Ue=x.get(oe);return Ue.delete(Ae),Ue.size>0||x.delete(oe),!0}t("deleteMetadata",dt);function ft(j,oe){for(var Ae=j.length-1;Ae>=0;--Ae){var Oe=j[Ae],Ue=Oe(oe);if(!mt(Ue)&&!ht(Ue)){if(!Ci(Ue))throw new TypeError;oe=Ue}}return oe}function pt(j,oe,Ae,Oe){for(var Ue=j.length-1;Ue>=0;--Ue){var Zt=j[Ue],at=Zt(oe,Ae,Oe);if(!mt(at)&&!ht(at)){if(!St(at))throw new TypeError;Oe=at}}return Oe}function Qe(j,oe,Ae){var Oe=x.get(j);if(mt(Oe)){if(!Ae)return;Oe=new p,x.set(j,Oe)}var Ue=Oe.get(oe);if(mt(Ue)){if(!Ae)return;Ue=new p,Oe.set(oe,Ue)}return Ue}function me(j,oe,Ae){var Oe=H(j,oe,Ae);if(Oe)return!0;var Ue=qn(oe);return ht(Ue)?!1:me(j,Ue,Ae)}function H(j,oe,Ae){var Oe=Qe(oe,Ae,!1);return mt(Oe)?!1:Tr(Oe.has(j))}function Ie(j,oe,Ae){var Oe=H(j,oe,Ae);if(Oe)return Ye(j,oe,Ae);var Ue=qn(oe);if(!ht(Ue))return Ie(j,Ue,Ae)}function Ye(j,oe,Ae){var Oe=Qe(oe,Ae,!1);if(!mt(Oe))return Oe.get(j)}function Ge(j,oe,Ae,Oe){var Ue=Qe(Ae,Oe,!0);Ue.set(j,oe)}function Fe(j,oe){var Ae=xt(j,oe),Oe=qn(j);if(Oe===null)return Ae;var Ue=Fe(Oe,oe);if(Ue.length<=0)return Ae;if(Ae.length<=0)return Ue;for(var Zt=new b,at=[],vt=0,Je=Ae;vt<Je.length;vt++){var wt=Je[vt],At=Zt.has(wt);At||(Zt.add(wt),at.push(wt))}for(var Vt=0,Qn=Ue;Vt<Qn.length;Vt++){var wt=Qn[Vt],At=Zt.has(wt);At||(Zt.add(wt),at.push(wt))}return at}function xt(j,oe){var Ae=[],Oe=Qe(j,oe,!1);if(mt(Oe))return Ae;for(var Ue=Oe.keys(),Zt=Ra(Ue),at=0;;){var vt=Uo(Zt);if(!vt)return Ae.length=at,Ae;var Je=Ca(vt);try{Ae[at]=Je}catch(wt){try{dr(Zt)}finally{throw wt}}at++}}function Lt(j){if(j===null)return 1;switch(typeof j){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return j===null?1:6;default:return 6}}function mt(j){return j===void 0}function ht(j){return j===null}function Pt(j){return typeof j=="symbol"}function St(j){return typeof j=="object"?j!==null:typeof j=="function"}function Xr(j,oe){switch(Lt(j)){case 0:return j;case 1:return j;case 2:return j;case 3:return j;case 4:return j;case 5:return j}var Ae=oe===3?"string":oe===5?"number":"default",Oe=xi(j,i);if(Oe!==void 0){var Ue=Oe.call(j,Ae);if(St(Ue))throw new TypeError;return Ue}return Wr(j,Ae==="default"?"number":Ae)}function Wr(j,oe){if(oe==="string"){var Ae=j.toString;if(cn(Ae)){var Oe=Ae.call(j);if(!St(Oe))return Oe}var Ue=j.valueOf;if(cn(Ue)){var Oe=Ue.call(j);if(!St(Oe))return Oe}}else{var Ue=j.valueOf;if(cn(Ue)){var Oe=Ue.call(j);if(!St(Oe))return Oe}var Zt=j.toString;if(cn(Zt)){var Oe=Zt.call(j);if(!St(Oe))return Oe}}throw new TypeError}function Tr(j){return!!j}function Yr(j){return""+j}function Or(j){var oe=Xr(j,3);return Pt(oe)?oe:Yr(oe)}function Sa(j){return Array.isArray?Array.isArray(j):j instanceof Object?j instanceof Array:Object.prototype.toString.call(j)==="[object Array]"}function cn(j){return typeof j=="function"}function Ci(j){return typeof j=="function"}function wa(j){switch(Lt(j)){case 3:return!0;case 4:return!0;default:return!1}}function xi(j,oe){var Ae=j[oe];if(Ae!=null){if(!cn(Ae))throw new TypeError;return Ae}}function Ra(j){var oe=xi(j,a);if(!cn(oe))throw new TypeError;var Ae=oe.call(j);if(!St(Ae))throw new TypeError;return Ae}function Ca(j){return j.value}function Uo(j){var oe=j.next();return oe.done?!1:oe}function dr(j){var oe=j.return;oe&&oe.call(j)}function qn(j){var oe=Object.getPrototypeOf(j);if(typeof j!="function"||j===f||oe!==f)return oe;var Ae=j.prototype,Oe=Ae&&Object.getPrototypeOf(Ae);if(Oe==null||Oe===Object.prototype)return oe;var Ue=Oe.constructor;return typeof Ue!="function"||Ue===j?oe:Ue}function Kn(){var j={},oe=[],Ae=function(){function at(vt,Je,wt){this._index=0,this._keys=vt,this._values=Je,this._selector=wt}return at.prototype["@@iterator"]=function(){return this},at.prototype[a]=function(){return this},at.prototype.next=function(){var vt=this._index;if(vt>=0&&vt<this._keys.length){var Je=this._selector(this._keys[vt],this._values[vt]);return vt+1>=this._keys.length?(this._index=-1,this._keys=oe,this._values=oe):this._index++,{value:Je,done:!1}}return{value:void 0,done:!0}},at.prototype.throw=function(vt){throw this._index>=0&&(this._index=-1,this._keys=oe,this._values=oe),vt},at.prototype.return=function(vt){return this._index>=0&&(this._index=-1,this._keys=oe,this._values=oe),{value:vt,done:!0}},at}();return function(){function at(){this._keys=[],this._values=[],this._cacheKey=j,this._cacheIndex=-2}return Object.defineProperty(at.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),at.prototype.has=function(vt){return this._find(vt,!1)>=0},at.prototype.get=function(vt){var Je=this._find(vt,!1);return Je>=0?this._values[Je]:void 0},at.prototype.set=function(vt,Je){var wt=this._find(vt,!0);return this._values[wt]=Je,this},at.prototype.delete=function(vt){var Je=this._find(vt,!1);if(Je>=0){for(var wt=this._keys.length,At=Je+1;At<wt;At++)this._keys[At-1]=this._keys[At],this._values[At-1]=this._values[At];return this._keys.length--,this._values.length--,vt===this._cacheKey&&(this._cacheKey=j,this._cacheIndex=-2),!0}return!1},at.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=j,this._cacheIndex=-2},at.prototype.keys=function(){return new Ae(this._keys,this._values,Oe)},at.prototype.values=function(){return new Ae(this._keys,this._values,Ue)},at.prototype.entries=function(){return new Ae(this._keys,this._values,Zt)},at.prototype["@@iterator"]=function(){return this.entries()},at.prototype[a]=function(){return this.entries()},at.prototype._find=function(vt,Je){return this._cacheKey!==vt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=vt)),this._cacheIndex<0&&Je&&(this._cacheIndex=this._keys.length,this._keys.push(vt),this._values.push(void 0)),this._cacheIndex},at}();function Oe(at,vt){return at}function Ue(at,vt){return vt}function Zt(at,vt){return[at,vt]}}function $o(){return function(){function j(){this._map=new p}return Object.defineProperty(j.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),j.prototype.has=function(oe){return this._map.has(oe)},j.prototype.add=function(oe){return this._map.set(oe,oe),this},j.prototype.delete=function(oe){return this._map.delete(oe)},j.prototype.clear=function(){this._map.clear()},j.prototype.keys=function(){return this._map.keys()},j.prototype.values=function(){return this._map.values()},j.prototype.entries=function(){return this._map.entries()},j.prototype["@@iterator"]=function(){return this.keys()},j.prototype[a]=function(){return this.keys()},j}()}function Vo(){var j=16,oe=c.create(),Ae=Oe();return function(){function Je(){this._key=Oe()}return Je.prototype.has=function(wt){var At=Ue(wt,!1);return At!==void 0?c.has(At,this._key):!1},Je.prototype.get=function(wt){var At=Ue(wt,!1);return At!==void 0?c.get(At,this._key):void 0},Je.prototype.set=function(wt,At){var Vt=Ue(wt,!0);return Vt[this._key]=At,this},Je.prototype.delete=function(wt){var At=Ue(wt,!1);return At!==void 0?delete At[this._key]:!1},Je.prototype.clear=function(){this._key=Oe()},Je}();function Oe(){var Je;do Je="@@WeakMap@@"+vt();while(c.has(oe,Je));return oe[Je]=!0,Je}function Ue(Je,wt){if(!r.call(Je,Ae)){if(!wt)return;Object.defineProperty(Je,Ae,{value:c.create()})}return Je[Ae]}function Zt(Je,wt){for(var At=0;At<wt;++At)Je[At]=Math.random()*255|0;return Je}function at(Je){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Je)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Je)):Zt(new Uint8Array(Je),Je):Zt(new Array(Je),Je)}function vt(){var Je=at(j);Je[6]=Je[6]&79|64,Je[8]=Je[8]&191|128;for(var wt="",At=0;At<j;++At){var Vt=Je[At];(At===4||At===6||At===8)&&(wt+="-"),Vt<16&&(wt+="0"),wt+=Vt.toString(16).toLowerCase()}return wt}}function y(j){return j.__=void 0,delete j.__,j}})})(sl||(sl={}));var ny={exports:{}},iy={exports:{}};(function(e){function t(r){return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(iy);(function(e){var t=iy.exports.default;function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function f(me,H,Ie){return Object.defineProperty(me,H,{value:Ie,enumerable:!0,configurable:!0,writable:!0}),me[H]}try{f({},"")}catch{f=function(Ie,Ye,Ge){return Ie[Ye]=Ge}}function d(me,H,Ie,Ye){var Ge=H&&H.prototype instanceof A?H:A,Fe=Object.create(Ge.prototype),xt=new ft(Ye||[]);return Fe._invoke=function(Lt,mt,ht){var Pt="suspendedStart";return function(St,Xr){if(Pt==="executing")throw new Error("Generator is already running");if(Pt==="completed"){if(St==="throw")throw Xr;return Qe()}for(ht.method=St,ht.arg=Xr;;){var Wr=ht.delegate;if(Wr){var Tr=Me(Wr,ht);if(Tr){if(Tr===b)continue;return Tr}}if(ht.method==="next")ht.sent=ht._sent=ht.arg;else if(ht.method==="throw"){if(Pt==="suspendedStart")throw Pt="completed",ht.arg;ht.dispatchException(ht.arg)}else ht.method==="return"&&ht.abrupt("return",ht.arg);Pt="executing";var Yr=p(Lt,mt,ht);if(Yr.type==="normal"){if(Pt=ht.done?"completed":"suspendedYield",Yr.arg===b)continue;return{value:Yr.arg,done:ht.done}}Yr.type==="throw"&&(Pt="completed",ht.method="throw",ht.arg=Yr.arg)}}}(me,Ie,xt),Fe}function p(me,H,Ie){try{return{type:"normal",arg:me.call(H,Ie)}}catch(Ye){return{type:"throw",arg:Ye}}}n.wrap=d;var b={};function A(){}function x(){}function N(){}var X={};f(X,s,function(){return this});var ae=Object.getPrototypeOf,W=ae&&ae(ae(pt([])));W&&W!==i&&a.call(W,s)&&(X=W);var Ee=N.prototype=A.prototype=Object.create(X);function he(me){["next","throw","return"].forEach(function(H){f(me,H,function(Ie){return this._invoke(H,Ie)})})}function we(me,H){function Ie(Ge,Fe,xt,Lt){var mt=p(me[Ge],me,Fe);if(mt.type!=="throw"){var ht=mt.arg,Pt=ht.value;return Pt&&t(Pt)=="object"&&a.call(Pt,"__await")?H.resolve(Pt.__await).then(function(St){Ie("next",St,xt,Lt)},function(St){Ie("throw",St,xt,Lt)}):H.resolve(Pt).then(function(St){ht.value=St,xt(ht)},function(St){return Ie("throw",St,xt,Lt)})}Lt(mt.arg)}var Ye;this._invoke=function(Ge,Fe){function xt(){return new H(function(Lt,mt){Ie(Ge,Fe,Lt,mt)})}return Ye=Ye?Ye.then(xt,xt):xt()}}function Me(me,H){var Ie=me.iterator[H.method];if(Ie===void 0){if(H.delegate=null,H.method==="throw"){if(me.iterator.return&&(H.method="return",H.arg=void 0,Me(me,H),H.method==="throw"))return b;H.method="throw",H.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var Ye=p(Ie,me.iterator,H.arg);if(Ye.type==="throw")return H.method="throw",H.arg=Ye.arg,H.delegate=null,b;var Ge=Ye.arg;return Ge?Ge.done?(H[me.resultName]=Ge.value,H.next=me.nextLoc,H.method!=="return"&&(H.method="next",H.arg=void 0),H.delegate=null,b):Ge:(H.method="throw",H.arg=new TypeError("iterator result is not an object"),H.delegate=null,b)}function He(me){var H={tryLoc:me[0]};1 in me&&(H.catchLoc=me[1]),2 in me&&(H.finallyLoc=me[2],H.afterLoc=me[3]),this.tryEntries.push(H)}function dt(me){var H=me.completion||{};H.type="normal",delete H.arg,me.completion=H}function ft(me){this.tryEntries=[{tryLoc:"root"}],me.forEach(He,this),this.reset(!0)}function pt(me){if(me){var H=me[s];if(H)return H.call(me);if(typeof me.next=="function")return me;if(!isNaN(me.length)){var Ie=-1,Ye=function Ge(){for(;++Ie<me.length;)if(a.call(me,Ie))return Ge.value=me[Ie],Ge.done=!1,Ge;return Ge.value=void 0,Ge.done=!0,Ge};return Ye.next=Ye}}return{next:Qe}}function Qe(){return{value:void 0,done:!0}}return x.prototype=N,f(Ee,"constructor",N),f(N,"constructor",x),x.displayName=f(N,c,"GeneratorFunction"),n.isGeneratorFunction=function(me){var H=typeof me=="function"&&me.constructor;return!!H&&(H===x||(H.displayName||H.name)==="GeneratorFunction")},n.mark=function(me){return Object.setPrototypeOf?Object.setPrototypeOf(me,N):(me.__proto__=N,f(me,c,"GeneratorFunction")),me.prototype=Object.create(Ee),me},n.awrap=function(me){return{__await:me}},he(we.prototype),f(we.prototype,u,function(){return this}),n.AsyncIterator=we,n.async=function(me,H,Ie,Ye,Ge){Ge===void 0&&(Ge=Promise);var Fe=new we(d(me,H,Ie,Ye),Ge);return n.isGeneratorFunction(H)?Fe:Fe.next().then(function(xt){return xt.done?xt.value:Fe.next()})},he(Ee),f(Ee,c,"Generator"),f(Ee,s,function(){return this}),f(Ee,"toString",function(){return"[object Generator]"}),n.keys=function(me){var H=[];for(var Ie in me)H.push(Ie);return H.reverse(),function Ye(){for(;H.length;){var Ge=H.pop();if(Ge in me)return Ye.value=Ge,Ye.done=!1,Ye}return Ye.done=!0,Ye}},n.values=pt,ft.prototype={constructor:ft,reset:function(H){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(dt),!H)for(var Ie in this)Ie.charAt(0)==="t"&&a.call(this,Ie)&&!isNaN(+Ie.slice(1))&&(this[Ie]=void 0)},stop:function(){this.done=!0;var H=this.tryEntries[0].completion;if(H.type==="throw")throw H.arg;return this.rval},dispatchException:function(H){if(this.done)throw H;var Ie=this;function Ye(ht,Pt){return xt.type="throw",xt.arg=H,Ie.next=ht,Pt&&(Ie.method="next",Ie.arg=void 0),!!Pt}for(var Ge=this.tryEntries.length-1;Ge>=0;--Ge){var Fe=this.tryEntries[Ge],xt=Fe.completion;if(Fe.tryLoc==="root")return Ye("end");if(Fe.tryLoc<=this.prev){var Lt=a.call(Fe,"catchLoc"),mt=a.call(Fe,"finallyLoc");if(Lt&&mt){if(this.prev<Fe.catchLoc)return Ye(Fe.catchLoc,!0);if(this.prev<Fe.finallyLoc)return Ye(Fe.finallyLoc)}else if(Lt){if(this.prev<Fe.catchLoc)return Ye(Fe.catchLoc,!0)}else{if(!mt)throw new Error("try statement without catch or finally");if(this.prev<Fe.finallyLoc)return Ye(Fe.finallyLoc)}}}},abrupt:function(H,Ie){for(var Ye=this.tryEntries.length-1;Ye>=0;--Ye){var Ge=this.tryEntries[Ye];if(Ge.tryLoc<=this.prev&&a.call(Ge,"finallyLoc")&&this.prev<Ge.finallyLoc){var Fe=Ge;break}}Fe&&(H==="break"||H==="continue")&&Fe.tryLoc<=Ie&&Ie<=Fe.finallyLoc&&(Fe=null);var xt=Fe?Fe.completion:{};return xt.type=H,xt.arg=Ie,Fe?(this.method="next",this.next=Fe.finallyLoc,b):this.complete(xt)},complete:function(H,Ie){if(H.type==="throw")throw H.arg;return H.type==="break"||H.type==="continue"?this.next=H.arg:H.type==="return"?(this.rval=this.arg=H.arg,this.method="return",this.next="end"):H.type==="normal"&&Ie&&(this.next=Ie),b},finish:function(H){for(var Ie=this.tryEntries.length-1;Ie>=0;--Ie){var Ye=this.tryEntries[Ie];if(Ye.finallyLoc===H)return this.complete(Ye.completion,Ye.afterLoc),dt(Ye),b}},catch:function(H){for(var Ie=this.tryEntries.length-1;Ie>=0;--Ie){var Ye=this.tryEntries[Ie];if(Ye.tryLoc===H){var Ge=Ye.completion;if(Ge.type==="throw"){var Fe=Ge.arg;dt(Ye)}return Fe}}throw new Error("illegal catch attempt")},delegateYield:function(H,Ie,Ye){return this.delegate={iterator:pt(H),resultName:Ie,nextLoc:Ye},this.method==="next"&&(this.arg=void 0),b}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(ny);var To=ny.exports(),Pe=To;try{regeneratorRuntime=To}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=To:Function("r","regeneratorRuntime = r")(To)}function ul(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){r(c);return}s.done?t(u):Promise.resolve(u).then(n,i)}function Tt(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function o(u){ul(a,n,i,o,s,"next",u)}function s(u){ul(a,n,i,o,s,"throw",u)}o(void 0)})}}var KT=-1,QT=1;function jr(){return QT++}var Wn=function e(t){De(this,e)},Yn=function(){function e(t){De(this,e),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=t}return We(e,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(r){return this.lookup[r]>-1}},{key:"create",value:function(r,n){this.lookup[r]=this.components.length;var i=new this.clazz(n||{});return this.components.push(i),this.entities.push(r),i}},{key:"remove",value:function(r){var n=this.lookup[r];n>-1&&n<this.components.length-1&&(this.components[n]=this.components[this.components.length-1],this.entities[n]=this.entities[this.entities.length-1],this.lookup[this.entities[n]]=n),this.components.pop(),this.entities.pop(),delete this.lookup[r]}},{key:"removeKeepSorted",value:function(r){var n=this.lookup[r];if(n>-1){var i=this.entities[n];if(n<this.components.length-1){for(var a=n+1;a<this.components.length;++a)this.components[a-1]=this.components[a];for(var o=n+1;o<this.entities.length;++o)this.entities[o-1]=this.entities[o],this.lookup[this.entities[o-1]]=o-1}this.components.pop(),this.entities.pop(),delete this.lookup[i]}}},{key:"moveItem",value:function(r,n){if(r!==n){for(var i=this.components[r],a=this.entities[r],o=r<n?1:-1,s=r;s!==n;s+=o){var u=s+o;this.components[s]=this.components[u],this.entities[s]=this.entities[u],this.lookup[this.entities[s]]=s}this.components[n]=i,this.entities[n]=a,this.lookup[a]=n}}},{key:"getEntity",value:function(r){return this.entities[r]}},{key:"getComponent",value:function(r){return this.components[r]}},{key:"getComponentByEntity",value:function(r){var n=this.lookup[r];return n>-1?this.components[n]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a);if(this.lookup[o]===r)return o}return KT}},{key:"find",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return i}return null}},{key:"findIndex",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return n}return-1}},{key:"forEach",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a),s=this.lookup[o];r(o,this.getComponent(s))}}},{key:"forEachAsync",value:function(){var t=Tt(Pe.mark(function n(i){var a,o,s,u,c;return Pe.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:a=0,o=Object.keys(this.lookup);case 1:if(!(a<o.length)){d.next=10;break}return s=o[a],u=Number(s),c=this.lookup[u],d.next=7,i(u,this.getComponent(c));case 7:a++,d.next=1;break;case 10:case"end":return d.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"map",value:function(r){for(var n=[],i=0,a=Object.keys(this.lookup);i<a.length;i++){var o=a[i],s=Number(o),u=this.lookup[s];n.push(r(s,this.getComponent(u)))}return n}}]),e}();function ZT(e){if(Array.isArray(e))return e}function JT(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],i=!0,a=!1,o,s;try{for(r=r.call(e);!(i=(o=r.next()).done)&&(n.push(o.value),!(t&&n.length===t));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&r.return!=null&&r.return()}finally{if(a)throw s}}return n}}function lu(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ay(e,t){if(!!e){if(typeof e=="string")return lu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lu(e,t)}}function eA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Do(e,t){return ZT(e)||JT(e,t)||ay(e,t)||eA()}var kr="named",oy="name",Iu="unmanaged",sy="optional",Fo="inject",ya="multi_inject",uy="inversify:tagged",cy="inversify:tagged_props",du="inversify:paramtypes",tA="design:paramtypes",cl="post_construct";function rA(){return[Fo,ya,oy,Iu,kr,sy]}var fl=rA(),ur={Request:"Request",Singleton:"Singleton",Transient:"Transient"},sr={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},an={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},nA=0;function Ta(){return nA++}var iA=function(){function e(t,r){this.id=Ta(),this.activated=!1,this.serviceIdentifier=t,this.scope=r,this.type=sr.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===ur.Singleton?this.activated:!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}(),aA="Cannot apply @injectable decorator multiple times.",oA="Metadata key was used more than once in a parameter:",Wi="NULL argument",ll="Key Not Found",sA="Ambiguous match found for serviceIdentifier:",uA="Could not unbind serviceIdentifier:",cA="No matching bindings found for serviceIdentifier:",fA="Missing required @injectable annotation in:",lA="Missing required @inject or @multiInject annotation in:",dA=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},hA="Circular dependency found:",vA="Invalid binding type:",pA="No snapshot available to restore.",mA="Invalid return type in middleware. Middleware must return!",yA="Value provided to function binding must be a function!",_A="The toSelf function can only be applied when a constructor is used as service identifier",EA="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",bA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+(e[0]+" must be >= than the number of constructor arguments of its base class.")},gA="Invalid Container constructor argument. Container options must be an object.",TA="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",AA="Invalid Container option. Auto bind injectable must be a boolean",SA="Invalid Container option. Skip base check must be a boolean",wA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},RA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency "+("in one of the '"+e[0]+"' bindings. Please investigate bindings with")+("service identifier '"+e[1]+"'.")},CA="Maximum call stack size exceeded",xA=function(){function e(){}return e.prototype.getConstructorMetadata=function(t){var r=Reflect.getMetadata(du,t),n=Reflect.getMetadata(uy,t);return{compilerGeneratedMetadata:r,userGeneratedMetadata:n||{}}},e.prototype.getPropertiesMetadata=function(t){var r=Reflect.getMetadata(cy,t)||[];return r},e}(),Ao={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function fy(e){return e instanceof RangeError||e.message===CA}function _a(e){if(typeof e=="function"){var t=e;return t.name}else{if(typeof e=="symbol")return e.toString();var t=e;return t}}function dl(e,t,r){var n="",i=r(e,t);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(a){var o="Object";a.implementationType!==null&&(o=Go(a.implementationType)),n=n+`
 `+o,a.constraint.metaData&&(n=n+" - "+a.constraint.metaData)})),n}function ly(e,t){return e.parentRequest===null?!1:e.parentRequest.serviceIdentifier===t?!0:ly(e.parentRequest,t)}function NA(e){function t(n,i){i===void 0&&(i=[]);var a=_a(n.serviceIdentifier);return i.push(a),n.parentRequest!==null?t(n.parentRequest,i):i}var r=t(e);return r.reverse().join(" --> ")}function dy(e){e.childRequests.forEach(function(t){if(ly(t,t.serviceIdentifier)){var r=NA(t);throw new Error(hA+" "+r)}else dy(t)})}function OA(e,t){if(t.isTagged()||t.isNamed()){var r="",n=t.getNamedTag(),i=t.getCustomTags();return n!==null&&(r+=n.toString()+`
`),i!==null&&i.forEach(function(a){r+=a.toString()+`
`})," "+e+`
 `+e+" - "+r}else return" "+e}function Go(e){if(e.name)return e.name;var t=e.toString(),r=t.match(/^function\s*([^\s(]+)/);return r?r[1]:"Anonymous function: "+t}var hy=function(){function e(t){this.id=Ta(),this.container=t}return e.prototype.addPlan=function(t){this.plan=t},e.prototype.setCurrentRequest=function(t){this.currentRequest=t},e}(),Tn=function(){function e(t,r){this.key=t,this.value=r}return e.prototype.toString=function(){return this.key===kr?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}(),IA=function(){function e(t,r){this.parentContext=t,this.rootRequest=r}return e}();function vy(e,t,r,n){var i=uy;my(i,e,t,n,r)}function py(e,t,r){var n=cy;my(n,e.constructor,t,r)}function my(e,t,r,n,i){var a={},o=typeof i=="number",s=i!==void 0&&o?i.toString():r;if(o&&r!==void 0)throw new Error(EA);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var u=a[s];if(!Array.isArray(u))u=[];else for(var c=0,f=u;c<f.length;c++){var d=f[c];if(d.key===n.key)throw new Error(oA+" "+d.key.toString())}u.push(n),a[s]=u,Reflect.defineMetadata(e,a,t)}var PA=function(){function e(t){this._cb=t}return e.prototype.unwrap=function(){return this._cb()},e}();function ze(e){return function(t,r,n){if(e===void 0)throw new Error(dA(t.name));var i=new Tn(Fo,e);typeof n=="number"?vy(t,r,n,i):py(t,r,i)}}var LA=function(){function e(t){this.str=t}return e.prototype.startsWith=function(t){return this.str.indexOf(t)===0},e.prototype.endsWith=function(t){var r="",n=t.split("").reverse().join("");return r=this.str.split("").reverse().join(""),this.startsWith.call({str:r},n)},e.prototype.contains=function(t){return this.str.indexOf(t)!==-1},e.prototype.equals=function(t){return this.str===t},e.prototype.value=function(){return this.str},e}(),Bo=function(){function e(t,r,n,i){this.id=Ta(),this.type=t,this.serviceIdentifier=n,this.name=new LA(r||""),this.metadata=new Array;var a=null;typeof i=="string"?a=new Tn(kr,i):i instanceof Tn&&(a=i),a!==null&&this.metadata.push(a)}return e.prototype.hasTag=function(t){for(var r=0,n=this.metadata;r<n.length;r++){var i=n[r];if(i.key===t)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(ya)},e.prototype.matchesArray=function(t){return this.matchesTag(ya)(t)},e.prototype.isNamed=function(){return this.hasTag(kr)},e.prototype.isTagged=function(){return this.metadata.some(function(t){return fl.every(function(r){return t.key!==r})})},e.prototype.isOptional=function(){return this.matchesTag(sy)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===kr})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return fl.every(function(r){return t.key!==r})}):null},e.prototype.matchesNamedTag=function(t){return this.matchesTag(kr)(t)},e.prototype.matchesTag=function(t){var r=this;return function(n){for(var i=0,a=r.metadata;i<a.length;i++){var o=a[i];if(o.key===t&&o.value===n)return!0}return!1}},e}(),Oo=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function MA(e,t){var r=Go(t),n=yy(e,r,t,!1);return n}function yy(e,t,r,n){var i=e.getConstructorMetadata(r),a=i.compilerGeneratedMetadata;if(a===void 0){var o=fA+" "+t+".";throw new Error(o)}var s=i.userGeneratedMetadata,u=Object.keys(s),c=r.length===0&&u.length>0,f=u.length>r.length,d=c||f?u.length:r.length,p=DA(n,t,a,s,d),b=_y(e,r),A=Oo(Oo([],p),b);return A}function kA(e,t,r,n,i){var a=i[e.toString()]||[],o=by(a),s=o.unmanaged!==!0,u=n[e],c=o.inject||o.multiInject;if(u=c||u,u instanceof PA&&(u=u.unwrap()),s){var f=u===Object,d=u===Function,p=u===void 0,b=f||d||p;if(!t&&b){var A=lA+" argument "+e+" in class "+r+".";throw new Error(A)}var x=new Bo(an.ConstructorArgument,o.targetName,u);return x.metadata=a,x}return null}function DA(e,t,r,n,i){for(var a=[],o=0;o<i;o++){var s=o,u=kA(s,e,t,r,n);u!==null&&a.push(u)}return a}function _y(e,t){for(var r=e.getPropertiesMetadata(t),n=[],i=Object.keys(r),a=0,o=i;a<o.length;a++){var s=o[a],u=r[s],c=by(r[s]),f=c.targetName||s,d=c.inject||c.multiInject,p=new Bo(an.ClassProperty,f,d);p.metadata=u,n.push(p)}var b=Object.getPrototypeOf(t.prototype).constructor;if(b!==Object){var A=_y(e,b);n=Oo(Oo([],n),A)}return n}function Ey(e,t){var r=Object.getPrototypeOf(t.prototype).constructor;if(r!==Object){var n=Go(r),i=yy(e,n,r,!0),a=i.map(function(u){return u.metadata.filter(function(c){return c.key===Iu})}),o=[].concat.apply([],a).length,s=i.length-o;return s>0?s:Ey(e,r)}else return 0}function by(e){var t={};return e.forEach(function(r){t[r.key.toString()]=r.value}),{inject:t[Fo],multiInject:t[ya],targetName:t[oy],unmanaged:t[Iu]}}var Pu=function(){function e(t,r,n,i,a){this.id=Ta(),this.serviceIdentifier=t,this.parentContext=r,this.parentRequest=n,this.target=a,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return e.prototype.addChildRequest=function(t,r,n){var i=new e(t,this.parentContext,this,r,n);return this.childRequests.push(i),i},e}();function hu(e){return e._bindingDictionary}function FA(e,t,r,n,i,a){var o=e?ya:Fo,s=new Tn(o,r),u=new Bo(t,n,r,s);if(i!==void 0){var c=new Tn(i,a);u.metadata.push(c)}return u}function hl(e,t,r,n,i){var a=Ea(r.container,i.serviceIdentifier),o=[];return a.length===Ao.NoBindingsAvailable&&r.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(r.container.bind(i.serviceIdentifier).toSelf(),a=Ea(r.container,i.serviceIdentifier)),t?o=a:o=a.filter(function(s){var u=new Pu(s.serviceIdentifier,r,n,s,i);return s.constraint(u)}),GA(i.serviceIdentifier,o,i,r.container),o}function GA(e,t,r,n){switch(t.length){case Ao.NoBindingsAvailable:if(r.isOptional())return t;var i=_a(e),a=cA;throw a+=OA(i,r),a+=dl(n,i,Ea),new Error(a);case Ao.OnlyOneBindingAvailable:if(!r.isArray())return t;case Ao.MultipleBindingsAvailable:default:if(r.isArray())return t;var i=_a(e),a=sA+" "+i;throw a+=dl(n,i,Ea),new Error(a)}}function gy(e,t,r,n,i,a){var o,s;if(i===null){o=hl(e,t,n,null,a),s=new Pu(r,n,null,o,a);var u=new IA(n,s);n.addPlan(u)}else o=hl(e,t,n,i,a),s=i.addChildRequest(a.serviceIdentifier,o,a);o.forEach(function(c){var f=null;if(a.isArray())f=s.addChildRequest(c.serviceIdentifier,c,a);else{if(c.cache)return;f=s}if(c.type===sr.Instance&&c.implementationType!==null){var d=MA(e,c.implementationType);if(!n.container.options.skipBaseClassChecks){var p=Ey(e,c.implementationType);if(d.length<p){var b=bA(Go(c.implementationType));throw new Error(b)}}d.forEach(function(A){gy(e,!1,A.serviceIdentifier,n,f,A)})}})}function Ea(e,t){var r=[],n=hu(e);return n.hasKey(t)?r=n.get(t):e.parent!==null&&(r=Ea(e.parent,t)),r}function BA(e,t,r,n,i,a,o,s){s===void 0&&(s=!1);var u=new hy(t),c=FA(r,n,i,"",a,o);try{return gy(e,s,i,u,null,c),u}catch(f){throw fy(f)&&u.plan&&dy(u.plan.rootRequest),f}}function UA(e,t,r,n){var i=new Bo(an.Variable,"",t,new Tn(r,n)),a=new hy(e),o=new Pu(t,a,null,[],i);return o}var $A=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function VA(e,t,r){var n=t.filter(function(a){return a.target!==null&&a.target.type===an.ClassProperty}),i=n.map(r);return n.forEach(function(a,o){var s="";s=a.target.name.value();var u=i[o];e[s]=u}),e}function jA(e,t){return new(e.bind.apply(e,$A([void 0],t)))}function zA(e,t){if(Reflect.hasMetadata(cl,e)){var r=Reflect.getMetadata(cl,e);try{t[r.value]()}catch(n){throw new Error(wA(e.name,n.message))}}}function HA(e,t,r){var n=null;if(t.length>0){var i=t.filter(function(o){return o.target!==null&&o.target.type===an.ConstructorArgument}),a=i.map(r);n=jA(e,a),n=VA(n,t,r)}else n=new e;return zA(e,n),n}var Xs=function(e,t,r){try{return r()}catch(n){throw fy(n)?new Error(RA(e,t.toString())):n}},vu=function(e){return function(t){t.parentContext.setCurrentRequest(t);var r=t.bindings,n=t.childRequests,i=t.target&&t.target.isArray(),a=!t.parentRequest||!t.parentRequest.target||!t.target||!t.parentRequest.target.matchesArray(t.target.serviceIdentifier);if(i&&a)return n.map(function(d){var p=vu(e);return p(d)});var o=null;if(t.target.isOptional()&&r.length===0)return;var s=r[0],u=s.scope===ur.Singleton,c=s.scope===ur.Request;if(u&&s.activated)return s.cache;if(c&&e!==null&&e.has(s.id))return e.get(s.id);if(s.type===sr.ConstantValue)o=s.cache,s.activated=!0;else if(s.type===sr.Function)o=s.cache,s.activated=!0;else if(s.type===sr.Constructor)o=s.implementationType;else if(s.type===sr.DynamicValue&&s.dynamicValue!==null)o=Xs("toDynamicValue",s.serviceIdentifier,function(){return s.dynamicValue(t.parentContext)});else if(s.type===sr.Factory&&s.factory!==null)o=Xs("toFactory",s.serviceIdentifier,function(){return s.factory(t.parentContext)});else if(s.type===sr.Provider&&s.provider!==null)o=Xs("toProvider",s.serviceIdentifier,function(){return s.provider(t.parentContext)});else if(s.type===sr.Instance&&s.implementationType!==null)o=HA(s.implementationType,n,vu(e));else{var f=_a(t.serviceIdentifier);throw new Error(vA+" "+f)}return typeof s.onActivation=="function"&&(o=s.onActivation(t.parentContext,o)),u&&(s.cache=o,s.activated=!0),c&&e!==null&&!e.has(s.id)&&e.set(s.id,o),o}};function XA(e){var t=vu(e.plan.rootRequest.requestScope);return t(e.plan.rootRequest)}var rn=function(e,t){var r=e.parentRequest;return r!==null?t(r)?!0:rn(r,t):!1},fa=function(e){return function(t){var r=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(e)(t)};return r.metaData=new Tn(e,t),r}},io=fa(kr),Ws=function(e){return function(t){var r=null;if(t!==null)if(r=t.bindings[0],typeof e=="string"){var n=r.serviceIdentifier;return n===e}else{var i=t.bindings[0].implementationType;return e===i}return!1}},Lu=function(){function e(t){this._binding=t}return e.prototype.when=function(t){return this._binding.constraint=t,new or(this._binding)},e.prototype.whenTargetNamed=function(t){return this._binding.constraint=io(t),new or(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){var r=t.target!==null&&!t.target.isNamed()&&!t.target.isTagged();return r},new or(this._binding)},e.prototype.whenTargetTagged=function(t,r){return this._binding.constraint=fa(t)(r),new or(this._binding)},e.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(r){return Ws(t)(r.parentRequest)},new or(this._binding)},e.prototype.whenParentNamed=function(t){return this._binding.constraint=function(r){return io(t)(r.parentRequest)},new or(this._binding)},e.prototype.whenParentTagged=function(t,r){return this._binding.constraint=function(n){return fa(t)(r)(n.parentRequest)},new or(this._binding)},e.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(r){return rn(r,Ws(t))},new or(this._binding)},e.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(r){return!rn(r,Ws(t))},new or(this._binding)},e.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(r){return rn(r,io(t))},new or(this._binding)},e.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(r){return!rn(r,io(t))},new or(this._binding)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._binding.constraint=function(n){return rn(n,fa(t)(r))},new or(this._binding)},e.prototype.whenNoAncestorTagged=function(t,r){return this._binding.constraint=function(n){return!rn(n,fa(t)(r))},new or(this._binding)},e.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(r){return rn(r,t)},new or(this._binding)},e.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(r){return!rn(r,t)},new or(this._binding)},e}(),or=function(){function e(t){this._binding=t}return e.prototype.onActivation=function(t){return this._binding.onActivation=t,new Lu(this._binding)},e}(),_n=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Lu(this._binding),this._bindingOnSyntax=new or(this._binding)}return e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),WA=function(){function e(t){this._binding=t}return e.prototype.inRequestScope=function(){return this._binding.scope=ur.Request,new _n(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=ur.Transient,new _n(this._binding)},e}(),vl=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Lu(this._binding),this._bindingOnSyntax=new or(this._binding),this._bindingInSyntax=new WA(t)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),YA=function(){function e(t){this._binding=t}return e.prototype.to=function(t){return this._binding.type=sr.Instance,this._binding.implementationType=t,new vl(this._binding)},e.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+_A);var t=this._binding.serviceIdentifier;return this.to(t)},e.prototype.toConstantValue=function(t){return this._binding.type=sr.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.toDynamicValue=function(t){return this._binding.type=sr.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new vl(this._binding)},e.prototype.toConstructor=function(t){return this._binding.type=sr.Constructor,this._binding.implementationType=t,this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.toFactory=function(t){return this._binding.type=sr.Factory,this._binding.factory=t,this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.toFunction=function(t){if(typeof t!="function")throw new Error(yA);var r=this.toConstantValue(t);return this._binding.type=sr.Function,this._binding.scope=ur.Singleton,r},e.prototype.toAutoFactory=function(t){return this._binding.type=sr.Factory,this._binding.factory=function(r){var n=function(){return r.container.get(t)};return n},this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.toProvider=function(t){return this._binding.type=sr.Provider,this._binding.provider=t,this._binding.scope=ur.Singleton,new _n(this._binding)},e.prototype.toService=function(t){this.toDynamicValue(function(r){return r.container.get(t)})},e}(),qA=function(){function e(){}return e.of=function(t,r){var n=new e;return n.bindings=t,n.middleware=r,n},e}(),pl=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(t,r){if(t==null)throw new Error(Wi);if(r==null)throw new Error(Wi);var n=this._map.get(t);n!==void 0?(n.push(r),this._map.set(t,n)):this._map.set(t,[r])},e.prototype.get=function(t){if(t==null)throw new Error(Wi);var r=this._map.get(t);if(r!==void 0)return r;throw new Error(ll)},e.prototype.remove=function(t){if(t==null)throw new Error(Wi);if(!this._map.delete(t))throw new Error(ll)},e.prototype.removeByCondition=function(t){var r=this;this._map.forEach(function(n,i){var a=n.filter(function(o){return!t(o)});a.length>0?r._map.set(i,a):r._map.delete(i)})},e.prototype.hasKey=function(t){if(t==null)throw new Error(Wi);return this._map.has(t)},e.prototype.clone=function(){var t=new e;return this._map.forEach(function(r,n){r.forEach(function(i){return t.add(n,i.clone())})}),t},e.prototype.traverse=function(t){this._map.forEach(function(r,n){t(n,r)})},e}(),KA=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(f){try{c(n.next(f))}catch(d){o(d)}}function u(f){try{c(n.throw(f))}catch(d){o(d)}}function c(f){f.done?a(f.value):i(f.value).then(s,u)}c((n=n.apply(e,t||[])).next())})},QA=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(f){return u([c,f])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){r.label=c[1];break}if(c[0]===6&&r.label<a[1]){r.label=a[1],a=c;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(c);break}a[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(f){c=[6,f],i=0}finally{n=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},ZA=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},Ty=function(){function e(t){this._appliedMiddleware=[];var r=t||{};if(typeof r!="object")throw new Error(""+gA);if(r.defaultScope===void 0)r.defaultScope=ur.Transient;else if(r.defaultScope!==ur.Singleton&&r.defaultScope!==ur.Transient&&r.defaultScope!==ur.Request)throw new Error(""+TA);if(r.autoBindInjectable===void 0)r.autoBindInjectable=!1;else if(typeof r.autoBindInjectable!="boolean")throw new Error(""+AA);if(r.skipBaseClassChecks===void 0)r.skipBaseClassChecks=!1;else if(typeof r.skipBaseClassChecks!="boolean")throw new Error(""+SA);this.options={autoBindInjectable:r.autoBindInjectable,defaultScope:r.defaultScope,skipBaseClassChecks:r.skipBaseClassChecks},this.id=Ta(),this._bindingDictionary=new pl,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new xA}return e.merge=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a=new e,o=ZA([t,r],n).map(function(c){return hu(c)}),s=hu(a);function u(c,f){c.traverse(function(d,p){p.forEach(function(b){f.add(b.serviceIdentifier,b.clone())})})}return o.forEach(function(c){u(c,s)}),a},e.prototype.load=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=this._getContainerModuleHelpersFactory(),i=0,a=t;i<a.length;i++){var o=a[i],s=n(o.id);o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},e.prototype.loadAsync=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return KA(this,void 0,void 0,function(){var n,i,a,o,s;return QA(this,function(u){switch(u.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,a=t,u.label=1;case 1:return i<a.length?(o=a[i],s=n(o.id),[4,o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:u.sent(),u.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=function(a){return function(o){return o.moduleId===a}};r.forEach(function(a){var o=i(a.id);t._bindingDictionary.removeByCondition(o)})},e.prototype.bind=function(t){var r=this.options.defaultScope||ur.Transient,n=new iA(t,r);return this._bindingDictionary.add(t,n),new YA(n)},e.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},e.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(uA+" "+_a(t))}},e.prototype.unbindAll=function(){this._bindingDictionary=new pl},e.prototype.isBound=function(t){var r=this._bindingDictionary.hasKey(t);return!r&&this.parent&&(r=this.parent.isBound(t)),r},e.prototype.isBoundNamed=function(t,r){return this.isBoundTagged(t,kr,r)},e.prototype.isBoundTagged=function(t,r,n){var i=!1;if(this._bindingDictionary.hasKey(t)){var a=this._bindingDictionary.get(t),o=UA(this,t,r,n);i=a.some(function(s){return s.constraint(o)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(t,r,n)),i},e.prototype.snapshot=function(){this._snapshots.push(qA.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var t=this._snapshots.pop();if(t===void 0)throw new Error(pA);this._bindingDictionary=t.bindings,this._middleware=t.middleware},e.prototype.createChild=function(t){var r=new e(t||this.options);return r.parent=this,r},e.prototype.applyMiddleware=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(i,a){return a(i)},n)},e.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},e.prototype.get=function(t){return this._get(!1,!1,an.Variable,t)},e.prototype.getTagged=function(t,r,n){return this._get(!1,!1,an.Variable,t,r,n)},e.prototype.getNamed=function(t,r){return this.getTagged(t,kr,r)},e.prototype.getAll=function(t){return this._get(!0,!0,an.Variable,t)},e.prototype.getAllTagged=function(t,r,n){return this._get(!1,!0,an.Variable,t,r,n)},e.prototype.getAllNamed=function(t,r){return this.getAllTagged(t,kr,r)},e.prototype.resolve=function(t){var r=this.createChild();return r.bind(t).toSelf(),this._appliedMiddleware.forEach(function(n){r.applyMiddleware(n)}),r.get(t)},e.prototype._getContainerModuleHelpersFactory=function(){var t=this,r=function(s,u){s._binding.moduleId=u},n=function(s){return function(u){var c=t.bind.bind(t),f=c(u);return r(f,s),f}},i=function(s){return function(u){var c=t.unbind.bind(t);c(u)}},a=function(s){return function(u){var c=t.isBound.bind(t);return c(u)}},o=function(s){return function(u){var c=t.rebind.bind(t),f=c(u);return r(f,s),f}};return function(s){return{bindFunction:n(s),isboundFunction:a(),rebindFunction:o(s),unbindFunction:i()}}},e.prototype._get=function(t,r,n,i,a,o){var s=null,u={avoidConstraints:t,contextInterceptor:function(c){return c},isMultiInject:r,key:a,serviceIdentifier:i,targetType:n,value:o};if(this._middleware){if(s=this._middleware(u),s==null)throw new Error(mA)}else s=this._planAndResolve()(u);return s},e.prototype._planAndResolve=function(){var t=this;return function(r){var n=BA(t._metadataReader,t,r.isMultiInject,r.targetType,r.serviceIdentifier,r.key,r.value,r.avoidConstraints);n=r.contextInterceptor(n);var i=XA(n);return i}},e}();function Ct(){return function(e){if(Reflect.hasOwnMetadata(du,e))throw new Error(aA);var t=Reflect.getMetadata(tA,e)||[];return Reflect.defineMetadata(du,t,e),e}}function Hr(e){return function(t,r,n){var i=new Tn(kr,e);typeof n=="number"?vy(t,r,n,i):py(t,r,i)}}var re={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},JA=function e(){De(this,e),this.index=void 0},eS=function e(){De(this,e),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0},tS=function(){function e(){De(this,e),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return We(e,[{key:"read",value:function(r){return this.reads.find(function(n){return n.index===r.index})||this.reads.push(r),r}},{key:"sample",value:function(r){return this.read(r),r}},{key:"write",value:function(r,n){var i=this.writes.find(function(u){return u.index===n.index});if(i)return n;var a=r.getResourceNode(n);a.resource.version++,a.resource.imported&&(this.hasSideEffect=!0);var o=r.createResourceNode(a.resource),s=r.getResourceNode(o);return s.writer=this,this.writes.push(o),o}}]),e}();function pu(e,t){return pu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},pu(e,t)}function fr(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pu(e,t)}function sn(e){return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sn(e)}function $t(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lr(e,t){if(t&&(sn(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $t(e)}function Rt(e){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Rt(e)}var rS=function e(){De(this,e),this.first=void 0,this.last=void 0};function nS(e){var t=iS();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function iS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var ml=function(e){fr(r,e);var t=nS(r);function r(){var n;De(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),n.version=0,n.refs=0,n.name=void 0,n.imported=void 0,n.priority=void 0,n.discardStart=!0,n.discardEnd=!1,n.descriptor=void 0,n.resource=void 0,n}return We(r,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),r}(rS),aS=function e(){De(this,e),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0},yl,_l,El,Ys,bl,gl;function wr(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=oS(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function oS(e,t){if(!!e){if(typeof e=="string")return Tl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tl(e,t)}}function Tl(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var sS=(yl=Ct(),_l=ze(re.RenderEngine),yl(El=(Ys=(gl=function(){function e(){De(this,e),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],Ve(this,"engine",bl,this)}return We(e,[{key:"execute",value:function(){var t=Tt(Pe.mark(function n(i){return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.compile(),o.next=3,this.executePassNodes(i);case 3:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.frameGraphPasses.forEach(function(r){r.tearDown&&r.tearDown()}),this.reset()}},{key:"addPass",value:function(r,n,i,a){var o=new eS;o.execute=i,a&&(o.tearDown=a),o.name=r;var s=new tS;return s.name=r,this.passNodes.push(s),this.frameGraphPasses.push(o),n(this,s,o),o}},{key:"getPass",value:function(r){return this.frameGraphPasses.find(function(n){return n.name===r})}},{key:"compile",value:function(){var r=this,n=wr(this.passNodes),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.refCount=a.writes.length+(a.hasSideEffect?1:0),a.reads.forEach(function(Fe){r.resourceNodes[Fe.index].readerCount++})}}catch(Fe){n.e(Fe)}finally{n.f()}var o=[],s=wr(this.resourceNodes),u;try{for(s.s();!(u=s.n()).done;){var c=u.value;c.readerCount===0&&o.push(c)}}catch(Fe){s.e(Fe)}finally{s.f()}for(;o.length;){var f=o.pop(),d=f&&f.writer;if(d&&--d.refCount===0){var p=wr(d.reads),b;try{for(p.s();!(b=p.n()).done;){var A=b.value,x=this.resourceNodes[A.index];--x.readerCount===0&&o.push(x)}}catch(Fe){p.e(Fe)}finally{p.f()}}}this.resourceNodes.forEach(function(Fe){Fe.resource.refs+=Fe.readerCount});var N=wr(this.passNodes),X;try{for(N.s();!(X=N.n()).done;){var ae=X.value;if(!!ae.refCount){var W=wr(ae.reads),Ee;try{for(W.s();!(Ee=W.n()).done;){var he=Ee.value,we=this.resourceNodes[he.index].resource;we.first=we.first?we.first:ae,we.last=ae}}catch(Fe){W.e(Fe)}finally{W.f()}var Me=wr(ae.writes),He;try{for(Me.s();!(He=Me.n()).done;){var dt=He.value,ft=this.resourceNodes[dt.index].resource;ft.first=ft.first?ft.first:ae,ft.last=ae}}catch(Fe){Me.e(Fe)}finally{Me.f()}}}}catch(Fe){N.e(Fe)}finally{N.f()}for(var pt=0;pt<2;pt++){var Qe=wr(this.resourceNodes),me;try{for(Qe.s();!(me=Qe.n()).done;){var H=me.value,Ie=H.resource;if(Ie.priority===pt&&Ie.refs){var Ye=Ie.first,Ge=Ie.last;Ye&&Ge&&(Ye.devirtualize.push(Ie),Ge.destroy.push(Ie))}}}catch(Fe){Qe.e(Fe)}finally{Qe.f()}}}},{key:"executePassNodes",value:function(){var t=Tt(Pe.mark(function n(i){var a,o,s,u,c,f,d,p,b,A,x,N,X,ae,W,Ee,he;return Pe.wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:a=wr(this.passNodes.entries()),Me.prev=1,a.s();case 3:if((o=a.n()).done){Me.next=18;break}if(s=Do(o.value,2),u=s[0],c=s[1],!c.refCount){Me.next=16;break}f=wr(c.devirtualize);try{for(f.s();!(d=f.n()).done;)p=d.value,p.preExecuteDevirtualize(this.engine)}catch(He){f.e(He)}finally{f.f()}b=wr(c.destroy);try{for(b.s();!(A=b.n()).done;)x=A.value,x.preExecuteDestroy(this.engine)}catch(He){b.e(He)}finally{b.f()}return Me.next=12,this.frameGraphPasses[u].execute(this,this.frameGraphPasses[u],i);case 12:N=wr(c.devirtualize);try{for(N.s();!(X=N.n()).done;)ae=X.value,ae.postExecuteDevirtualize(this.engine)}catch(He){N.e(He)}finally{N.f()}W=wr(c.destroy);try{for(W.s();!(Ee=W.n()).done;)he=Ee.value,he.postExecuteDestroy(this.engine)}catch(He){W.e(He)}finally{W.f()}case 16:Me.next=3;break;case 18:Me.next=23;break;case 20:Me.prev=20,Me.t0=Me.catch(1),a.e(Me.t0);case 23:return Me.prev=23,a.f(),Me.finish(23);case 26:this.reset();case 27:case"end":return Me.stop()}},n,this,[[1,20,23,26]])}));function r(n){return t.apply(this,arguments)}return r}()},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(r){return this.resourceNodes[r.index]}},{key:"createResourceNode",value:function(r){var n=new aS;n.resource=r,n.version=r.version,this.resourceNodes.push(n);var i=new JA;return i.index=this.resourceNodes.length-1,i}},{key:"createTexture",value:function(r,n,i){var a=new ml;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"createRenderTarget",value:function(r,n,i){var a=new ml;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"present",value:function(r){this.addPass("Present",function(n,i){i.read(r),i.hasSideEffect=!0},Tt(Pe.mark(function n(){return Pe.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)})))}}]),e}(),gl),bl=je(Ys.prototype,"engine",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys))||El);function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var So=1e-6,mr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Aa(){var e=new mr(9);return mr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function uS(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function cS(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],p=t[10],b=t[11],A=t[12],x=t[13],N=t[14],X=t[15],ae=r*s-n*o,W=r*u-i*o,Ee=r*c-a*o,he=n*u-i*s,we=n*c-a*s,Me=i*c-a*u,He=f*x-d*A,dt=f*N-p*A,ft=f*X-b*A,pt=d*N-p*x,Qe=d*X-b*x,me=p*X-b*N,H=ae*me-W*Qe+Ee*pt+he*ft-we*dt+Me*He;return H?(H=1/H,e[0]=(s*me-u*Qe+c*pt)*H,e[1]=(u*ft-o*me-c*dt)*H,e[2]=(o*Qe-s*ft+c*He)*H,e[3]=(i*Qe-n*me-a*pt)*H,e[4]=(r*me-i*ft+a*dt)*H,e[5]=(n*ft-r*Qe-a*He)*H,e[6]=(x*Me-N*we+X*he)*H,e[7]=(N*Ee-A*Me-X*W)*H,e[8]=(A*we-x*Ee+X*ae)*H,e):null}function br(){var e=new mr(16);return mr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function fS(e){var t=new mr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ay(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Io(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],p=t[10],b=t[11],A=t[12],x=t[13],N=t[14],X=t[15],ae=r*s-n*o,W=r*u-i*o,Ee=r*c-a*o,he=n*u-i*s,we=n*c-a*s,Me=i*c-a*u,He=f*x-d*A,dt=f*N-p*A,ft=f*X-b*A,pt=d*N-p*x,Qe=d*X-b*x,me=p*X-b*N,H=ae*me-W*Qe+Ee*pt+he*ft-we*dt+Me*He;return H?(H=1/H,e[0]=(s*me-u*Qe+c*pt)*H,e[1]=(i*Qe-n*me-a*pt)*H,e[2]=(x*Me-N*we+X*he)*H,e[3]=(p*we-d*Me-b*he)*H,e[4]=(u*ft-o*me-c*dt)*H,e[5]=(r*me-i*ft+a*dt)*H,e[6]=(N*Ee-A*Me-X*W)*H,e[7]=(f*Me-p*Ee+b*W)*H,e[8]=(o*Qe-s*ft+c*He)*H,e[9]=(n*ft-r*Qe-a*He)*H,e[10]=(A*we-x*Ee+X*ae)*H,e[11]=(d*Ee-f*we-b*ae)*H,e[12]=(s*dt-o*pt-u*He)*H,e[13]=(r*pt-n*dt+i*He)*H,e[14]=(x*W-A*he-N*ae)*H,e[15]=(f*he-d*W+p*ae)*H,e):null}function Vn(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],f=t[7],d=t[8],p=t[9],b=t[10],A=t[11],x=t[12],N=t[13],X=t[14],ae=t[15],W=r[0],Ee=r[1],he=r[2],we=r[3];return e[0]=W*n+Ee*s+he*d+we*x,e[1]=W*i+Ee*u+he*p+we*N,e[2]=W*a+Ee*c+he*b+we*X,e[3]=W*o+Ee*f+he*A+we*ae,W=r[4],Ee=r[5],he=r[6],we=r[7],e[4]=W*n+Ee*s+he*d+we*x,e[5]=W*i+Ee*u+he*p+we*N,e[6]=W*a+Ee*c+he*b+we*X,e[7]=W*o+Ee*f+he*A+we*ae,W=r[8],Ee=r[9],he=r[10],we=r[11],e[8]=W*n+Ee*s+he*d+we*x,e[9]=W*i+Ee*u+he*p+we*N,e[10]=W*a+Ee*c+he*b+we*X,e[11]=W*o+Ee*f+he*A+we*ae,W=r[12],Ee=r[13],he=r[14],we=r[15],e[12]=W*n+Ee*s+he*d+we*x,e[13]=W*i+Ee*u+he*p+we*N,e[14]=W*a+Ee*c+he*b+we*X,e[15]=W*o+Ee*f+he*A+we*ae,e}function Yi(e,t,r){var n=r[0],i=r[1],a=r[2],o,s,u,c,f,d,p,b,A,x,N,X;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],f=t[4],d=t[5],p=t[6],b=t[7],A=t[8],x=t[9],N=t[10],X=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=f,e[5]=d,e[6]=p,e[7]=b,e[8]=A,e[9]=x,e[10]=N,e[11]=X,e[12]=o*n+f*i+A*a+t[12],e[13]=s*n+d*i+x*a+t[13],e[14]=u*n+p*i+N*a+t[14],e[15]=c*n+b*i+X*a+t[15]),e}function lS(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*n,e[5]=o*i+f*n,e[6]=s*i+d*n,e[7]=u*i+p*n,e[8]=c*i-a*n,e[9]=f*i-o*n,e[10]=d*i-s*n,e[11]=p*i-u*n,e}function dS(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*n,e[1]=o*i-f*n,e[2]=s*i-d*n,e[3]=u*i-p*n,e[8]=a*n+c*i,e[9]=o*n+f*i,e[10]=s*n+d*i,e[11]=u*n+p*i,e}function qi(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Ai(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],f=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(u,c,f),e}function Ki(e,t){var r=new mr(3);Ai(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],o=t[0]*n,s=t[1]*i,u=t[2]*a,c=t[4]*n,f=t[5]*i,d=t[6]*a,p=t[8]*n,b=t[9]*i,A=t[10]*a,x=o+f+A,N=0;return x>0?(N=Math.sqrt(x+1)*2,e[3]=.25*N,e[0]=(d-b)/N,e[1]=(p-u)/N,e[2]=(s-c)/N):o>f&&o>A?(N=Math.sqrt(1+o-f-A)*2,e[3]=(d-b)/N,e[0]=.25*N,e[1]=(s+c)/N,e[2]=(p+u)/N):f>A?(N=Math.sqrt(1+f-o-A)*2,e[3]=(p-u)/N,e[0]=(s+c)/N,e[1]=.25*N,e[2]=(d+b)/N):(N=Math.sqrt(1+A-o-f)*2,e[3]=(s-c)/N,e[0]=(p+u)/N,e[1]=(d+b)/N,e[2]=.25*N),e}function hS(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,f=o+o,d=i*u,p=i*c,b=i*f,A=a*c,x=a*f,N=o*f,X=s*u,ae=s*c,W=s*f,Ee=n[0],he=n[1],we=n[2];return e[0]=(1-(A+N))*Ee,e[1]=(p+W)*Ee,e[2]=(b-ae)*Ee,e[3]=0,e[4]=(p-W)*he,e[5]=(1-(d+N))*he,e[6]=(x+X)*he,e[7]=0,e[8]=(b+ae)*we,e[9]=(x-X)*we,e[10]=(1-(d+A))*we,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Al(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,c=r*o,f=n*o,d=n*s,p=i*o,b=i*s,A=i*u,x=a*o,N=a*s,X=a*u;return e[0]=1-d-A,e[1]=f+X,e[2]=p-N,e[3]=0,e[4]=f-X,e[5]=1-c-A,e[6]=b+x,e[7]=0,e[8]=p+N,e[9]=b-x,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vS(e,t,r,n,i){var a=1/Math.tan(t/2),o;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var pS=vS;function mS(e,t,r,n,i,a,o){var s=1/(t-r),u=1/(n-i),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(o+a)*c,e[15]=1,e}var yS=mS;function _S(e,t,r,n){var i,a,o,s,u,c,f,d,p,b,A=t[0],x=t[1],N=t[2],X=n[0],ae=n[1],W=n[2],Ee=r[0],he=r[1],we=r[2];return Math.abs(A-Ee)<So&&Math.abs(x-he)<So&&Math.abs(N-we)<So?Ay(e):(f=A-Ee,d=x-he,p=N-we,b=1/Math.hypot(f,d,p),f*=b,d*=b,p*=b,i=ae*p-W*d,a=W*f-X*p,o=X*d-ae*f,b=Math.hypot(i,a,o),b?(b=1/b,i*=b,a*=b,o*=b):(i=0,a=0,o=0),s=d*o-p*a,u=p*i-f*o,c=f*a-d*i,b=Math.hypot(s,u,c),b?(b=1/b,s*=b,u*=b,c*=b):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=u,e[6]=d,e[7]=0,e[8]=o,e[9]=c,e[10]=p,e[11]=0,e[12]=-(i*A+a*x+o*N),e[13]=-(s*A+u*x+c*N),e[14]=-(f*A+d*x+p*N),e[15]=1,e)}function Nt(){var e=new mr(3);return mr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function nn(e){var t=new mr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function wo(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function ct(e,t,r){var n=new mr(3);return n[0]=e,n[1]=t,n[2]=r,n}function cr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function vi(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function on(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function yu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function ES(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function ba(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function bS(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function ha(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Po(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qs(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2];return e[0]=i*u-a*s,e[1]=a*o-n*u,e[2]=n*s-i*o,e}function zn(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e}function Mu(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}function ku(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}function gS(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],u=t[1],c=t[2],f=i*c-a*u,d=a*s-n*c,p=n*u-i*s,b=i*p-a*d,A=a*f-n*p,x=n*d-i*f,N=o*2;return f*=N,d*=N,p*=N,b*=2,A*=2,x*=2,e[0]=s+f+b,e[1]=u+d+A,e[2]=c+p+x,e}var _u=yu,Sl=bS,Sy=wo;(function(){var e=Nt();return function(t,r,n,i,a,o){var s,u;for(r||(r=3),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function la(){var e=new mr(4);return mr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function wy(e,t,r,n){var i=new mr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function TS(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function AS(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function da(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}(function(){var e=la();return function(t,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function tr(){var e=new mr(4);return mr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Un(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Cr(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],c=r[2],f=r[3];return e[0]=n*f+o*s+i*c-a*u,e[1]=i*f+o*u+a*s-n*c,e[2]=a*f+o*c+n*u-i*s,e[3]=o*f-n*s-i*u-a*c,e}function Ro(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],c=r[1],f=r[2],d=r[3],p,b,A,x,N;return b=i*u+a*c+o*f+s*d,b<0&&(b=-b,u=-u,c=-c,f=-f,d=-d),1-b>So?(p=Math.acos(b),A=Math.sin(p),x=Math.sin((1-n)*p)/A,N=Math.sin(n*p)/A):(x=1-n,N=n),e[0]=x*i+N*u,e[1]=x*a+N*c,e[2]=x*o+N*f,e[3]=x*s+N*d,e}function wl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e}function SS(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[a*3+a]-t[o*3+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[a*3+o]-t[o*3+a])*n,e[a]=(t[a*3+i]+t[i*3+a])*n,e[o]=(t[o*3+i]+t[i*3+o])*n}return e}function Ks(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),u=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return e[0]=a*u*f-o*s*c,e[1]=o*s*f+a*u*c,e[2]=o*u*c-a*s*f,e[3]=o*u*f+a*s*c,e}var Qs=wy,Qi=TS,wS=Cr,Si=AS;(function(){var e=Nt(),t=ct(1,0,0),r=ct(0,1,0);return function(n,i,a){var o=Po(i,a);return o<-.999999?(qs(e,t,i),Sy(e)<1e-6&&qs(e,r,i),ha(e,e),Un(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(qs(e,i,a),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,Si(n,n))}})();(function(){var e=tr(),t=tr();return function(r,n,i,a,o,s){return Ro(e,n,o,s),Ro(t,i,a,s),Ro(r,e,t,2*s*(1-s)),r}})();(function(){var e=Aa();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Si(t,SS(t,e))}})();var RS=9007199254740991,CS="[object Arguments]",xS="[object Array]",NS="[object Boolean]",OS="[object Date]",IS="[object Error]",PS="[object Function]",LS="[object Map]",MS="[object Number]",kS="[object Object]",DS="[object RegExp]",FS="[object Set]",GS="[object String]",BS="[object WeakMap]",US="[object ArrayBuffer]",$S="[object DataView]",VS="[object Float32Array]",jS="[object Float64Array]",zS="[object Int8Array]",HS="[object Int16Array]",XS="[object Int32Array]",WS="[object Uint8Array]",YS="[object Uint8ClampedArray]",qS="[object Uint16Array]",KS="[object Uint32Array]",Mt={};Mt[VS]=Mt[jS]=Mt[zS]=Mt[HS]=Mt[XS]=Mt[WS]=Mt[YS]=Mt[qS]=Mt[KS]=!0;Mt[CS]=Mt[xS]=Mt[US]=Mt[NS]=Mt[$S]=Mt[OS]=Mt[IS]=Mt[PS]=Mt[LS]=Mt[MS]=Mt[kS]=Mt[DS]=Mt[FS]=Mt[GS]=Mt[BS]=!1;var QS=Object.prototype,ZS=QS.toString;function JS(e){return t1(e)&&e1(e.length)&&!!Mt[ZS.call(e)]}function e1(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=RS}function t1(e){return!!e&&sn(e)==="object"}var Rl=JS;function Cl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Cl(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r1(e){var t=n1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function n1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var i1=function(e){fr(r,e);var t=r1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.dirty=!0,i.attributes=[],i.indices=void 0,i.indicesBuffer=void 0,i.vertexCount=0,i.maxInstancedCount=void 0,i.aabb=void 0,i.entity=void 0,Object.assign($t(i),n),i}return We(r,[{key:"setAttribute",value:function(i,a,o,s){var u=this.attributes.find(function(c){return c.name===i});return u?(u.data=a,u.dirty=!0):this.attributes.push(xl(xl({dirty:!0,name:i,data:a},o),{},{bufferGetter:s})),this.dirty=!0,this}},{key:"setIndex",value:function(i){return this.indices=new Uint32Array(i.buffer?i.buffer:i),this.dirty=!0,this}},{key:"applyMatrix",value:function(i){var a=this.attributes.find(function(p){var b=p.name;return b==="position"}),o=this.attributes.find(function(p){var b=p.name;return b==="normal"});if(a&&(a.dirty=!0,a.data&&a.data.length))for(var s=0;s<a.data.length;s+=3){var u=wy(a.data[s],a.data[s+1],a.data[s+2],1);da(u,u,i),Rl(a.data)?a.data.set([u[0],u[1],u[2]],s):(a.data[s]=u[0],a.data[s+1]=u[1],a.data[s+2]=u[2])}if(o){var c=cS(Aa(),i);if(o.data&&o.data.length)for(var f=0;f<o.data.length;f+=3){var d=ct(o.data[f],o.data[f+1],o.data[f+2]);ku(d,d,c),ha(d,d),Rl(o.data)?o.data.set([d[0],d[1],d[2]],f):(o.data[f]=d[0],o.data[f+1]=d[1],o.data[f+2]=d[2])}}}}]),r}(Wn),M;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(M||(M={}));var Nl,Ol,Il,Pl,ao,Ll,Ml,kl,a1=(Nl=Ct(),Ol=ze(re.GeometryComponentManager),Il=ze(re.RenderEngine),Nl(Pl=(ao=(kl=function(){function e(){De(this,e),Ve(this,"geometry",Ll,this),Ve(this,"engine",Ml,this)}return We(e,[{key:"execute",value:function(){var t=Tt(Pe.mark(function n(){var i=this;return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.geometry.forEach(function(s,u){u.dirty&&(u.attributes.forEach(function(c){if(c.dirty&&c.data){if(!c.buffer)c.buffer=i.engine.createBuffer({data:c.data,type:M.FLOAT});else{var f;(f=c.buffer)===null||f===void 0||f.subData({data:c.data,offset:0})}c.dirty=!1}}),u.indices&&(u.indicesBuffer?u.indicesBuffer.subData({data:u.indices,offset:0}):u.indicesBuffer=i.engine.createElements({data:u.indices,count:u.indices.length,type:M.UNSIGNED_INT,usage:M.STATIC_DRAW})),u.dirty=!1)});case 1:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.geometry.forEach(function(r,n){n.indicesBuffer&&n.indicesBuffer.destroy(),n.attributes.forEach(function(i){i.buffer&&i.buffer.destroy()})}),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{vertexCount:3},n=r.vertexCount,i=jr();return this.geometry.create(i,{vertexCount:n})}},{key:"createInstancedBufferGeometry",value:function(r){var n=r.maxInstancedCount,i=r.vertexCount,a=jr();return this.geometry.create(a,{maxInstancedCount:n,vertexCount:i})}}]),e}(),kl),Ll=je(ao.prototype,"geometry",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml=je(ao.prototype,"engine",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao))||Pl);function Dl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Fl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Dl(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o1(e){var t=s1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function s1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var u1=function(e){fr(r,e);var t=o1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.vertexShaderGLSL=void 0,i.fragmentShaderGLSL=void 0,i.defines={},i.dirty=!0,i.uniforms=[],i.cull={enable:!0,face:M.BACK},i.depth={enable:!0},i.blend=void 0,i.entity=void 0,i.type=void 0,Object.assign($t(i),n),i}return We(r,[{key:"setDefines",value:function(i){return this.defines=Fl(Fl({},this.defines),i),this}},{key:"setCull",value:function(i){return this.cull=i,this}},{key:"setDepth",value:function(i){return this.depth=i,this}},{key:"setBlend",value:function(i){return this.blend=i,this}},{key:"setUniform",value:function(i,a){var o=this;if(typeof i!="string")return Object.keys(i).forEach(function(u){return o.setUniform(u,i[u])}),this;var s=this.uniforms.find(function(u){return u.name===i});return s?(s.dirty=!0,s.data=a):this.uniforms.push({name:i,dirty:!0,data:a}),this.dirty=!0,this}}]),r}(Wn),Gl,Bl,Ul,$l,Vl,Zi,jl,zl,Hl,Xl;function Wl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Yl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wl(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var c1=(Gl=Ct(),Bl=ze(re.MaterialComponentManager),Ul=ze(re.RenderEngine),$l=ze(re.ShaderModuleService),Gl(Vl=(Zi=(Xl=function(){function e(){De(this,e),Ve(this,"material",jl,this),Ve(this,"engine",zl,this),Ve(this,"shaderModule",Hl,this)}return We(e,[{key:"execute",value:function(){var t=Tt(Pe.mark(function n(){return Pe.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(r){var n=jr(),i=r.vertexShader,a=r.fragmentShader,o=[];if(!this.engine.supportWebGPU){var s="material-".concat(n);this.shaderModule.registerModule(s,{vs:r.vertexShader,fs:r.fragmentShader});var u=this.shaderModule.getModule(s);i=u.vs,a=u.fs,u.uniforms&&(o=Object.keys(u.uniforms).map(function(c){return{dirty:!0,name:c,data:u.uniforms[c]}}))}return this.material.create(n,Yl(Yl({vertexShaderGLSL:i,fragmentShaderGLSL:a},r),{},{uniforms:o}))}}]),e}(),Xl),jl=je(Zi.prototype,"material",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zl=je(Zi.prototype,"engine",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=je(Zi.prototype,"shaderModule",[$l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zi))||Vl);function f1(e){var t=l1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function l1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Eu;(function(e){e[e.Standard=0]="Standard"})(Eu||(Eu={}));var d1=function(e){fr(r,e);var t=f1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.strategy=Eu.Standard,i.visibilityPlaneMask=0,i.visible=!1,Object.assign($t(i),n),i}return r}(Wn),Du=function(){function e(t,r){De(this,e),this.center=void 0,this.halfExtents=void 0,this.min=Nt(),this.max=Nt(),this.update(t,r)}return We(e,[{key:"update",value:function(r,n){this.center=r||Nt(),this.halfExtents=n||ct(.5,.5,.5),this.min=_u(this.min,this.center,this.halfExtents),this.max=on(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(r,n){on(this.center,n,r),ba(this.center,this.center,.5),_u(this.halfExtents,n,r),ba(this.halfExtents,this.halfExtents,.5),cr(this.min,r),cr(this.max,n)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(r){var n=this.center,i=n[0],a=n[1],o=n[2],s=this.halfExtents,u=s[0],c=s[1],f=s[2],d=i-u,p=i+u,b=a-c,A=a+c,x=o-f,N=o+f,X=r.center,ae=X[0],W=X[1],Ee=X[2],he=r.halfExtents,we=he[0],Me=he[1],He=he[2],dt=ae-we,ft=ae+we,pt=W-Me,Qe=W+Me,me=Ee-He,H=Ee+He;dt<d&&(d=dt),ft>p&&(p=ft),pt<b&&(b=pt),Qe>A&&(A=Qe),me<x&&(x=me),H>N&&(N=H),n[0]=(d+p)*.5,n[1]=(b+A)*.5,n[2]=(x+N)*.5,s[0]=(p-d)*.5,s[1]=(A-b)*.5,s[2]=(N-x)*.5,this.min[0]=d,this.min[1]=b,this.min[2]=x,this.max[0]=p,this.max[1]=A,this.max[2]=N}},{key:"intersects",value:function(r){var n=this.getMax(),i=this.getMin(),a=r.getMax(),o=r.getMin();return i[0]<=a[0]&&n[0]>=o[0]&&i[1]<=a[1]&&n[1]>=o[1]&&i[2]<=a[2]&&n[2]>=o[2]}},{key:"containsPoint",value:function(r){var n=this.getMin(),i=this.getMax();return!(r[0]<n[0]||r[0]>i[0]||r[1]<n[1]||r[1]>i[1]||r[2]<n[2]||r[2]>i[2])}},{key:"getNegativeFarPoint",value:function(r){return r.pnVertexFlag===273?cr(Nt(),this.min):r.pnVertexFlag===272?ct(this.min[0],this.min[1],this.max[2]):r.pnVertexFlag===257?ct(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===256?ct(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===17?ct(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===16?ct(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===1?ct(this.max[0],this.max[1],this.min[2]):ct(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(r){return r.pnVertexFlag===273?cr(Nt(),this.max):r.pnVertexFlag===272?ct(this.max[0],this.max[1],this.min[2]):r.pnVertexFlag===257?ct(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===256?ct(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===17?ct(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===16?ct(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===1?ct(this.min[0],this.min[1],this.max[2]):ct(this.min[0],this.min[1],this.min[2])}}]),e}();function h1(e){var t=v1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function v1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var p1=function(e){fr(r,e);var t=h1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.material=void 0,i.geometry=void 0,i.aabb=new Du,i.aabbDirty=!0,i.model=void 0,i.visible=!0,i.children=[],Object.assign($t(i),n),i}return r}(Wn),m1=function(){function e(t,r){De(this,e),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=t||0,this.normal=r||ct(0,1,0),this.updatePNVertexFlag()}return We(e,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(r){return Po(r,this.normal)-this.distance}},{key:"normalize",value:function(){var r=1/Sy(this.normal);ba(this.normal,this.normal,r),this.distance*=r}},{key:"intersectsLine",value:function(r,n,i){var a=this.distanceToPoint(r),o=this.distanceToPoint(n),s=a/(a-o),u=s>=0&&s<=1;return u&&i&&zn(i,r,n,s),u}}]),e}(),yn;(function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"})(yn||(yn={}));var y1=function(){function e(t){if(De(this,e),this.planes=[],t)this.planes=t;else for(var r=0;r<6;r++)this.planes.push(new m1)}return We(e,[{key:"extractFromVPMatrix",value:function(r){var n=Do(r,16),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],f=n[6],d=n[7],p=n[8],b=n[9],A=n[10],x=n[11],N=n[12],X=n[13],ae=n[14],W=n[15];vi(this.planes[0].normal,s-i,d-u,x-p),this.planes[0].distance=-(W-N),vi(this.planes[1].normal,s+i,d+u,x+p),this.planes[1].distance=-(W+N),vi(this.planes[2].normal,s+a,d+c,x+b),this.planes[2].distance=-(W+X),vi(this.planes[3].normal,s-a,d-c,x-b),this.planes[3].distance=-(W-X),vi(this.planes[4].normal,s-o,d-f,x-A),this.planes[4].distance=-(W-ae),vi(this.planes[5].normal,s+o,d+f,x+A),this.planes[5].distance=-(W+ae),this.planes.forEach(function(Ee){Ee.normalize(),Ee.updatePNVertexFlag()})}}]),e}();function _1(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function E1(e){var t=Do(e,3),r=t[0],n=t[1],i=t[2],a=r+n*256+i*65536-1;return a}var ql,Kl,Ql,Zl,Jl,ed,td,Dn,rd,nd,id,ad,od,sd;function ud(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=b1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function b1(e,t){if(!!e){if(typeof e=="string")return cd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cd(e,t)}}function cd(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g1=(ql=Ct(),Kl=ze(re.MeshComponentManager),Ql=ze(re.CullableComponentManager),Zl=ze(re.GeometryComponentManager),Jl=ze(re.HierarchyComponentManager),ed=ze(re.TransformComponentManager),ql(td=(Dn=(sd=function(){function e(){De(this,e),Ve(this,"mesh",rd,this),Ve(this,"cullable",nd,this),Ve(this,"geometry",id,this),Ve(this,"hierarchy",ad,this),Ve(this,"transform",od,this),this.planes=void 0}return We(e,[{key:"setFrustumPlanes",value:function(r){this.planes=r}},{key:"execute",value:function(){var t=Tt(Pe.mark(function n(i){var a,o,s,u,c,f,d,p,b,A,x,N,X,ae,W,Ee,he,we,Me,He,dt;return Pe.wrap(function(pt){for(;;)switch(pt.prev=pt.next){case 0:a=ud(i);try{for(a.s();!(o=a.n()).done;){s=o.value,u=s.getScene(),c=s.getCamera(),f=ud(u.getEntities());try{for(f.s();!(d=f.n()).done;)p=d.value,b=this.mesh.getComponentByEntity(p),b&&(A=this.hierarchy.getComponentByEntity(p),x=this.cullable.getComponentByEntity(p),N=b.geometry,X=this.transform.getComponentByEntity(p),N&&N.aabb&&X&&b.aabbDirty&&(ae=X.worldTransform,W=N.aabb,Ee=W.center,he=W.halfExtents,we=Mu(Nt(),Ee,ae),Me=_1(ae,Aa()),He=ku(Nt(),he,Me),b.aabb.update(we,He),b.aabbDirty=!1),x&&N&&(dt=this.cullable.getComponentByEntity((A==null?void 0:A.parentID)||-1),x.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(b.aabb,(dt==null?void 0:dt.visibilityPlaneMask)||yn.INDETERMINATE,this.planes||c.getFrustum().planes),x.visible=x.visibilityPlaneMask!==yn.OUTSIDE))}catch(Qe){f.e(Qe)}finally{f.f()}}}catch(Qe){a.e(Qe)}finally{a.f()}case 2:case"end":return pt.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(r,n,i){if(n===yn.OUTSIDE||n===yn.INSIDE)return n;for(var a=yn.INSIDE,o=0,s=i.length;o<s;++o){var u=o<31?1<<o:0;if(!(o<31&&(n&u)===0)){var c=i[o],f=c.normal,d=c.distance;if(Po(f,r.getNegativeFarPoint(i[o]))+d>0)return yn.OUTSIDE;Po(f,r.getPositiveFarPoint(i[o]))+d>0&&(a|=u)}}return a}}]),e}(),sd),rd=je(Dn.prototype,"mesh",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=je(Dn.prototype,"cullable",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id=je(Dn.prototype,"geometry",[Zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=je(Dn.prototype,"hierarchy",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=je(Dn.prototype,"transform",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn))||td),fd,ld,dd,hd,vd,pd,md,yd,_d,Ed,bd,gd,Mr,Td,Ad,Sd,wd,Rd,Cd,xd,Nd,Od,Id,Pd;function oo(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=T1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function T1(e,t){if(!!e){if(typeof e=="string")return Ld(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ld(e,t)}}function Ld(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ri=(fd=Ct(),ld=ze(re.MeshComponentManager),dd=ze(re.GeometryComponentManager),hd=ze(re.MaterialComponentManager),vd=ze(re.CullableComponentManager),pd=ze(re.TransformComponentManager),md=ze(re.HierarchyComponentManager),yd=ze(re.Systems),_d=Hr(re.FrameGraphSystem),Ed=ze(re.RenderEngine),bd=ze(re.ResourcePool),fd(gd=(Mr=(Pd=Id=function(){function e(){var t=this;De(this,e),Ve(this,"mesh",Td,this),Ve(this,"geometry",Ad,this),Ve(this,"material",Sd,this),Ve(this,"cullable",wd,this),Ve(this,"transform",Rd,this),Ve(this,"hierarchy",Cd,this),Ve(this,"frameGraphSystem",xd,this),Ve(this,"engine",Nd,this),Ve(this,"resourcePool",Od,this),this.modelCache={},this.setup=function(r,n,i){var a=r.createRenderTarget(n,"color buffer",{width:1,height:1,usage:M.RENDER_ATTACHMENT|M.SAMPLED|M.COPY_SRC});i.data={output:n.write(r,a)}},this.execute=function(){var r=Tt(Pe.mark(function n(i,a,o){var s,u,c,f,d,p;return Pe.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:s=i.getResourceNode(a.data.output),u=t.resourcePool.getOrCreateResource(s.resource),c=oo(o),A.prev=3,c.s();case 5:if((f=c.n()).done){A.next=11;break}return d=f.value,A.next=9,t.initView(d);case 9:A.next=5;break;case 11:A.next=16;break;case 13:A.prev=13,A.t0=A.catch(3),c.e(A.t0);case 16:return A.prev=16,c.f(),A.finish(16);case 19:p=t.engine.getCanvas(),u.resize({width:p.width,height:p.height}),t.engine.setScissor({enable:!1}),t.engine.clear({framebuffer:u,color:o[0].getClearColor(),depth:1}),t.engine.useFramebuffer(u,function(){var x=oo(o),N;try{for(x.s();!(N=x.n()).done;){var X=N.value;t.renderView(X)}}catch(ae){x.e(ae)}finally{x.f()}});case 24:case"end":return A.stop()}},n,null,[[3,13,16,19]])}));return function(n,i,a){return r.apply(this,arguments)}}()}return We(e,[{key:"renderView",value:function(r){var n=r.getScene(),i=r.getCamera(),a=i.getViewTransform(),o=Vn(br(),i.getPerspective(),a);i.getFrustum().extractFromVPMatrix(o);var s=r.getViewport(),u=s.x,c=s.y,f=s.width,d=s.height;this.engine.viewport({x:u,y:c,width:f,height:d});var p=oo(n.getEntities()),b;try{for(p.s();!(b=p.n()).done;){var A=b.value;this.renderMesh(A,{camera:i,view:r,viewMatrix:a})}}catch(x){p.e(x)}finally{p.f()}}},{key:"renderMesh",value:function(r,n){var i=n.camera,a=n.view,o=n.viewMatrix,s=this.mesh.getComponentByEntity(r);if(!(!s||!s.visible)){var u=s.material,c=s.geometry;if(!(!c||c.dirty||!u)){var f=this.transform.getComponentByEntity(r),d=Vn(br(),o,f.worldTransform),p=a.getViewport(),b=p.width,A=p.height;u.setUniform({projectionMatrix:i.getPerspective(),modelViewMatrix:d,modelMatrix:f.worldTransform,viewMatrix:o,cameraPosition:i.getPosition(),u_viewport:[b,A]}),s.model&&(s.model.draw({uniforms:u.uniforms.reduce(function(x,N){return x[N.name]=N.data,x},{})}),u.uniforms.forEach(function(x){x.dirty=!1}),u.dirty=!1)}}}},{key:"initMesh",value:function(){var t=Tt(Pe.mark(function n(i,a){var o,s,u,c,f,d,p,b;return Pe.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(o=this.mesh.getComponentByEntity(i),o){x.next=3;break}return x.abrupt("return");case 3:if(s=o.material,u=o.geometry,!(!u||u.dirty||!s)){x.next=7;break}return x.abrupt("return");case 7:if(o.model){x.next=24;break}if(c="m-".concat(s.entity,"-g-").concat(u.entity),!this.modelCache[c]){x.next=12;break}return o.model=this.modelCache[c],x.abrupt("return");case 12:return s.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),f=this.engine,d=f.createModel,p=f.createAttribute,b={vs:s.vertexShaderGLSL,fs:s.fragmentShaderGLSL,defines:s.defines,attributes:u.attributes.reduce(function(N,X){return X.data&&X.buffer&&(N[X.name]=p({buffer:X.buffer,attributes:X.attributes,arrayStride:X.arrayStride,stepMode:X.stepMode,divisor:X.stepMode==="vertex"?0:1})),N},{}),uniforms:s.uniforms.reduce(function(N,X){return N[X.name]=X.data,N},{}),scissor:{enable:!0,box:function(){return a.getViewport()}}},s.cull&&(b.cull=s.cull),s.depth&&(b.depth=s.depth),s.blend&&(b.blend=s.blend),u.indicesBuffer&&(b.elements=u.indicesBuffer),u.maxInstancedCount&&(b.instances=u.maxInstancedCount,b.count=u.vertexCount||3),x.next=22,d(b);case 22:o.model=x.sent,this.modelCache[c]=o.model;case 24:case"end":return x.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"initView",value:function(){var t=Tt(Pe.mark(function n(i){var a,o,s,u;return Pe.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=i.getScene(),o=oo(a.getEntities()),f.prev=2,o.s();case 4:if((s=o.n()).done){f.next=10;break}return u=s.value,f.next=8,this.initMesh(u,i);case 8:f.next=4;break;case 10:f.next=15;break;case 12:f.prev=12,f.t0=f.catch(2),o.e(f.t0);case 15:return f.prev=15,o.f(),f.finish(15);case 18:case"end":return f.stop()}},n,this,[[2,12,15,18]])}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),Id.IDENTIFIER="Render Pass",Pd),Td=je(Mr.prototype,"mesh",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=je(Mr.prototype,"geometry",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=je(Mr.prototype,"material",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=je(Mr.prototype,"cullable",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=je(Mr.prototype,"transform",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=je(Mr.prototype,"hierarchy",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=je(Mr.prototype,"frameGraphSystem",[yd,_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=je(Mr.prototype,"engine",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od=je(Mr.prototype,"resourcePool",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mr))||gd),Md,kd,Dd,Fd,Gd,Bd,pi,Ud,$d,Vd,jd,zd,Hd;function Zs(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=A1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function A1(e,t){if(!!e){if(typeof e=="string")return Xd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xd(e,t)}}function Xd(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Js={NONE:0,ENCODE:1,HIGHLIGHT:2},bu=(Md=Ct(),kd=ze(re.RenderEngine),Dd=ze(re.ResourcePool),Fd=ze(re.RenderPassFactory),Gd=ze(re.MeshComponentManager),Md(Bd=(pi=(Hd=zd=function(){function e(){var t=this;De(this,e),Ve(this,"engine",Ud,this),Ve(this,"resourcePool",$d,this),Ve(this,"renderPassFactory",Vd,this),Ve(this,"mesh",jd,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(r,n,i){var a=r.createRenderTarget(n,"picking fbo",{width:1,height:1});i.data={output:n.write(r,a)},n.hasSideEffect=!0},this.execute=function(){var r=Tt(Pe.mark(function n(i,a,o){var s,u,c;return Pe.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(t.views=o,!t.alreadyInRendering){d.next=3;break}return d.abrupt("return");case 3:s=Zs(o);try{for(c=function(){var b=u.value,A=b.getViewport(),x=A.width,N=A.height;t.alreadyInRendering=!0;var X=i.getResourceNode(a.data.output);t.pickingFBO=t.resourcePool.getOrCreateResource(X.resource),t.pickingFBO.resize({width:x,height:N}),t.engine.useFramebuffer(t.pickingFBO,function(){t.engine.clear({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var ae=t.renderPassFactory(Ri.IDENTIFIER),W=[],Ee=b.getScene(),he=Zs(Ee.getEntities()),we;try{for(he.s();!(we=he.n()).done;){var Me=we.value,He=t.mesh.getComponentByEntity(Me),dt=He.material;dt.setUniform("u_PickingStage",Js.ENCODE),W.push(He)}}catch(ft){he.e(ft)}finally{he.f()}ae.renderView(b),W.forEach(function(ft){var pt=ft.material;pt.setUniform("u_PickingStage",Js.HIGHLIGHT)}),t.alreadyInRendering=!1})},s.s();!(u=s.n()).done;)c()}catch(p){s.e(p)}finally{s.f()}case 5:case"end":return d.stop()}},n)}));return function(n,i,a){return r.apply(this,arguments)}}(),this.pick=function(r,n){var i=r.x,a=r.y,o=t.engine,s=o.readPixels,u=o.useFramebuffer,c=n.getViewport(),f=c.width,d=c.height,p=i*window.devicePixelRatio,b=a*window.devicePixelRatio;if(!(p>f||p<0||b>d||b<0)){var A,x;return u(t.pickingFBO,function(){A=s({x:Math.round(p),y:Math.round(d-(a+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO}),(A[0]!==0||A[1]!==0||A[2]!==0)&&(x=E1(A),t.highlightEnabled&&t.highlightPickedFeature(A,n))}),x}}}return We(e,[{key:"enableHighlight",value:function(r){this.highlightEnabled=r}},{key:"setHighlightColor",value:function(r){this.highlightColor=r}},{key:"highlightPickedFeature",value:function(r,n){if(r){var i=Zs(n.getScene().getEntities()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=this.mesh.getComponentByEntity(o),u=s.material;u.setUniform("u_PickingStage",Js.HIGHLIGHT),u.setUniform("u_PickingColor",[r[0],r[1],r[2]]),u.setUniform("u_HighlightColor",this.highlightColor)}}catch(c){i.e(c)}finally{i.f()}}}}]),e}(),zd.IDENTIFIER="PixelPicking Pass",Hd),Ud=je(pi.prototype,"engine",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$d=je(pi.prototype,"resourcePool",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=je(pi.prototype,"renderPassFactory",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=je(pi.prototype,"mesh",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi))||Bd),Wd,Yd,qd,Kd,so,Qd,Zd,Jd,eh,S1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,w1=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,R1=`layout(set = 0, binding = 0) uniform sampler u_TextureSampler;
layout(set = 0, binding = 1) uniform texture2D u_Texture;

layout(location = 0) in vec2 v_UV;
layout(location = 0) out vec4 outColor;

void main() {
  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);
}`,C1=`layout(location = 0) in vec2 a_Position;
layout(location = 0) out vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lo=(Wd=Ct(),Yd=ze(re.RenderEngine),qd=ze(re.ResourcePool),Wd(Kd=(so=(eh=Jd=function e(){var t=this;De(this,e),Ve(this,"engine",Qd,this),Ve(this,"resourcePool",Zd,this),this.model=void 0,this.setup=function(r,n,i){var a=r.getPass(Ri.IDENTIFIER);if(a){var o=r.createRenderTarget(n,"render to screen",{width:1,height:1});i.data={input:n.read(a.data.output),output:n.write(r,o)}}},this.execute=function(){var r=Tt(Pe.mark(function n(i,a){var o,s,u,c,f,d,p;return Pe.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(o=t.engine,s=o.createModel,u=o.createAttribute,c=o.createBuffer,t.model){A.next=6;break}return A.next=4,s({vs:t.engine.supportWebGPU?C1:w1,fs:t.engine.supportWebGPU?R1:S1,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:M.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:f=A.sent,t.model=f;case 6:d=i.getResourceNode(a.data.input),p=t.resourcePool.getOrCreateResource(d.resource),t.engine.useFramebuffer(null,function(){t.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:{u_Texture:p}})});case 9:case"end":return A.stop()}},n)}));return function(n,i){return r.apply(this,arguments)}}(),this.tearDown=function(){t.model=void 0}},Jd.IDENTIFIER="Copy Pass",eh),Qd=je(so.prototype,"engine",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=je(so.prototype,"resourcePool",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so))||Kd),th,rh,nh,ih,ah,oh,sh,mi,uh,ch,fh,lh,dh,x1=(th=Ct(),rh=ze(re.Systems),nh=Hr(re.FrameGraphSystem),ih=ze(re.RenderPassFactory),ah=ze(re.ConfigService),oh=ze(re.ResourcePool),th(sh=(mi=(dh=function(){function e(){De(this,e),Ve(this,"frameGraphSystem",uh,this),Ve(this,"renderPassFactory",ch,this),Ve(this,"configService",fh,this),Ve(this,"resourcePool",lh,this)}return We(e,[{key:"execute",value:function(){var t=Tt(Pe.mark(function n(i){var a,o,s,u,c,f,d,p;return Pe.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:a=this.renderPassFactory(Ri.IDENTIFIER),o=a.setup,s=a.execute,this.frameGraphSystem.addPass(Ri.IDENTIFIER,o,s),u=this.renderPassFactory(Lo.IDENTIFIER),c=u.setup,f=u.execute,d=u.tearDown,p=this.frameGraphSystem.addPass(Lo.IDENTIFIER,c,f,d),this.frameGraphSystem.present(p.data.output);case 5:case"end":return A.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(r,n){var i=this.renderPassFactory(bu.IDENTIFIER);return i.pick(r,n)}}]),e}(),dh),uh=je(mi.prototype,"frameGraphSystem",[rh,nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=je(mi.prototype,"renderPassFactory",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fh=je(mi.prototype,"configService",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=je(mi.prototype,"resourcePool",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mi))||sh);function N1(e){var t=O1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function O1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var I1=function(e){fr(r,e);var t=N1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.parentID=void 0,Object.assign($t(i),n),i}return r}(Wn),hh,vh,ph,mh,yh,Ji,_h,Eh,bh,gh,P1=(hh=Ct(),vh=ze(re.HierarchyComponentManager),ph=ze(re.TransformComponentManager),mh=ze(re.MeshComponentManager),hh(yh=(Ji=(gh=function(){function e(){De(this,e),Ve(this,"hierarchy",_h,this),Ve(this,"transform",Eh,this),Ve(this,"mesh",bh,this)}return We(e,[{key:"execute",value:function(){var t=Tt(Pe.mark(function n(){return Pe.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var r=this;this.transform.forEach(function(n,i){(i.isDirty()||i.isLocalDirty())&&(r.setMeshAABBDirty(r.mesh.getComponentByEntity(n)),i.updateTransform())})}},{key:"runHierarchyUpdateSystem",value:function(){var r=this;this.hierarchy.forEach(function(n,i){var a=r.transform.getComponentByEntity(n),o=r.transform.getComponentByEntity(i.parentID);a!==null&&o!==null&&a.updateTransformWithParent(o)})}},{key:"attach",value:function(r,n,i){this.hierarchy.contains(r)&&this.detach(r),this.hierarchy.create(r,{parentID:n});var a=this.mesh.getComponentByEntity(n);if(this.setMeshAABBDirty(a),a&&a.children.indexOf(r)===-1&&a.children.push(r),this.hierarchy.getCount()>1)for(var o=this.hierarchy.getCount()-1;o>0;--o)for(var s=this.hierarchy.getEntity(o),u=0;u<o;++u){var c=this.hierarchy.getComponent(u);if(c.parentID===s){this.hierarchy.moveItem(o,u),++o;break}}this.hierarchy.getComponentByEntity(r);var f=this.transform.getComponentByEntity(n);f===null&&(f=this.transform.create(n));var d=this.transform.getComponentByEntity(r);d===null&&(d=this.transform.create(r),f=this.transform.getComponentByEntity(n)),d.parent=f,!i&&f&&(d.matrixTransform(Io(br(),f.worldTransform)),d.updateTransform()),f&&d.updateTransformWithParent(f)}},{key:"detach",value:function(r){var n=this.hierarchy.getComponentByEntity(r);if(n!==null){var i=this.transform.getComponentByEntity(r);i!==null&&(i.parent=null,i.applyTransform()),this.hierarchy.removeKeepSorted(r);var a=this.mesh.getComponentByEntity(n.parentID);if(a){var o=a.children.indexOf(r);a.children.splice(o,1)}this.setMeshAABBDirty(a)}}},{key:"detachChildren",value:function(r){var n=this.mesh.getComponentByEntity(r);n&&(n.children=[]);for(var i=0;i<this.hierarchy.getCount();){var a;if(((a=this.hierarchy.getComponent(i))===null||a===void 0?void 0:a.parentID)===r){var o=this.hierarchy.getEntity(i);this.detach(o)}else++i}}},{key:"setMeshAABBDirty",value:function(r){r&&(r.aabbDirty=!0)}}]),e}(),gh),_h=je(Ji.prototype,"hierarchy",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=je(Ji.prototype,"transform",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=je(Ji.prototype,"mesh",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ji))||yh);function L1(e){var t=M1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function M1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Ry=function(e){fr(r,e);var t=L1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.dirtyFlag=void 0,i.localDirtyFlag=void 0,i.parent=null,i.localPosition=ct(0,0,0),i.localRotation=Qs(0,0,0,1),i.localScale=ct(1,1,1),i.localTransform=br(),i.position=ct(0,0,0),i.rotation=Qs(0,0,0,1),i.scaling=ct(1,1,1),i.worldTransform=br(),i.matrixTransform=function(){var a=br();return function(o){Vn(a,i.getLocalTransform(),o),Ai(i.localScale,a),qi(i.localPosition,a),Ki(i.localRotation,a)}}(),i.rotateRollPitchYaw=function(){var a=tr(),o=tr(),s=tr();return function(u,c,f){i.setDirty(),Ks(a,u,0,0),Ks(o,0,c,0),Ks(s,0,0,f),Cr(i.localRotation,a,i.localRotation),Cr(i.localRotation,i.localRotation,o),Cr(i.localRotation,s,i.localRotation),Si(i.localRotation,i.localRotation)}}(),i.lerp=function(){var a=Nt(),o=tr(),s=Nt(),u=Nt(),c=tr(),f=Nt();return function(d,p,b){i.setDirty(),Ai(a,d.worldTransform),qi(s,d.worldTransform),Ki(o,d.worldTransform),Ai(u,p.worldTransform),qi(f,p.worldTransform),Ki(c,p.worldTransform),zn(i.localScale,a,u,b),Ro(i.localRotation,o,c,b),zn(i.localPosition,s,f,b)}}(),i.translate=function(){var a=Nt();return function(o){return on(a,i.getPosition(),o),i.setPosition(a),i.setDirty(!0),$t(i)}}(),i.translateLocal=function(){return function(a){return gS(a,a,i.localRotation),on(i.localPosition,i.localPosition,a),i.setLocalDirty(!0),$t(i)}}(),i.setPosition=function(){var a=br();return function(o){return i.position=o,i.setLocalDirty(!0),i.parent===null?cr(i.localPosition,o):(mu(a,i.parent.worldTransform),Io(a,a),Mu(i.localPosition,o,a)),$t(i)}}(),i.rotate=function(){var a=tr();return function(o){if(i.parent===null)Cr(i.localRotation,i.localRotation,o),Si(i.localRotation,i.localRotation);else{var s=i.getRotation(),u=i.parent.getRotation();Qi(a,u),wl(a,a),Cr(a,a,o),Cr(i.localRotation,o,s),Si(i.localRotation,i.localRotation)}return i.setLocalDirty(),$t(i)}}(),i.rotateLocal=function(){return function(a){return Cr(i.localRotation,i.localRotation,a),Si(i.localRotation,i.localRotation),i.setLocalDirty(!0),$t(i)}}(),i.setRotation=function(){var a=tr();return function(o){return i.parent===null?Qi(i.localRotation,o):(Qi(a,i.parent.getRotation()),wl(a,a),Qi(i.localRotation,a),wS(i.localRotation,i.localRotation,o)),i.setLocalDirty(!0),$t(i)}}(),i}return We(r,[{key:"setLocalPosition",value:function(i){cr(this.localPosition,i),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(i){cr(this.localScale,i),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(i){return Qi(this.localRotation,i),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?this.dirtyFlag|=r.DIRTY:this.dirtyFlag&=~r.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?(this.localDirtyFlag|=r.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~r.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&this.parent===null&&(mu(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(i){Vn(this.worldTransform,i.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),Ai(this.localScale,this.worldTransform),qi(this.localPosition,this.worldTransform),Ki(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=ct(0,0,0),this.localRotation=Qs(0,0,0,1),this.localScale=ct(1,1,1)}},{key:"scaleLocal",value:function(i){return this.setLocalDirty(),ES(this.localScale,this.localScale,i),this}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(hS(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return!this.isLocalDirty()&&!this.isDirty()?this.worldTransform:(this.parent&&this.parent.getWorldTransform(),this.updateTransform(),this.worldTransform)}},{key:"getPosition",value:function(){return qi(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return Ki(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return Ai(this.scaling,this.worldTransform),this.scaling}}]),r}(Wn);Ry.DIRTY=1<<0;var Th,Ah,Sh,eu,wh,Rh,k1=(Th=Ct(),Ah=ze(re.RenderEngine),Th(Sh=(eu=(Rh=function(){function e(){De(this,e),Ve(this,"engine",wh,this),this.resourcePool={}}return We(e,[{key:"getOrCreateResource",value:function(r){if(!this.resourcePool[r.name]){var n=r.descriptor,i=n.width,a=n.height,o=n.usage;this.resourcePool[r.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:i,height:a,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,usage:o})})}return this.resourcePool[r.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),e}(),Rh),wh=je(eu.prototype,"engine",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu))||Sh);function D1(e){var t=F1();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function F1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var G1=function(e){fr(r,e);var t=D1(r);function r(n){var i;return De(this,r),i=t.call(this,n),i.name=void 0,i.name=n.name||"",i}return r}(Wn),Ch,xh,Nh,B1=(Ch=Ct(),Ch(xh=(Nh=function(){function e(){De(this,e),this.config=void 0}return We(e,[{key:"get",value:function(){return this.config}},{key:"set",value:function(r){this.config=r}}]),e}(),Nh))||xh),Oh,Ih,Ph;(function(e){e.PANSTART="PANSTART",e.PANEND="PANEND",e.PANMOVE="PANMOVE",e.PINCH="PINCH",e.KEYDOWN="KEYDOWN",e.KEYUP="KEYUP",e.HOVER="HOVER"})(Ph||(Ph={}));var U1=(Oh=Ct(),Oh(Ih=function(){function e(){De(this,e)}return We(e,[{key:"listen",value:function(r){}},{key:"on",value:function(r,n){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),e}())||Ih);function $1(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}var V1=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Lh(e){var t={};return e=e.replace(V1,function(r,n,i){var a=i.split(":"),o=a[0].trim(),s="";switch(a.length>1&&(s=a[1].trim()),n){case"bool":s=s==="true";break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s?s=s.replace("[","").replace("]","").split(",").reduce(function(u,c){return u.push(Number(c.trim())),u},[]):s=new Array($1(n)).fill(0);break}return t[o]=s,"uniform ".concat(n," ").concat(o,`;
`)}),{content:e,uniforms:t}}function j1(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}var Mh,kh,Dh;function Fh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ea(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fh(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var z1=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,H1=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}`,X1=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}`,W1=/precision\s+(high|low|medium)p\s+float/,Y1=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,q1=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,K1=(Mh=Ct(),Mh(kh=(Dh=function(){function e(){De(this,e),this.moduleCache={},this.rawContentCache={}}return We(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:H1,fs:z1}),this.registerModule("sdf2d",{vs:"",fs:X1})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.uniforms,c=Lh(a),f=c.content,d=c.uniforms,p=Lh(s),b=p.content,A=p.uniforms;this.rawContentCache[r]={fs:b,uniforms:ea(ea(ea({},d),A),u),vs:f}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var i=this.rawContentCache[r].vs||"",a=this.rawContentCache[r].fs||"",o=this.processModule(i,[],"vs"),s=o.content,u=o.includeList,c=this.processModule(a,[],"fs"),f=c.content,d=c.includeList,p=f,b=j1(u.concat(d).concat(r)).reduce(function(A,x){return ea(ea({},A),n.rawContentCache[x].uniforms)},{});return W1.test(f)||(p=Y1+f),this.moduleCache[r]={fs:p.trim(),uniforms:b,vs:s.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var a=this,o=r.replace(q1,function(s,u){var c=u.split(" "),f=c[0].replace(/"/g,"");if(n.indexOf(f)>-1)return"";var d=a.rawContentCache[f][i];n.push(f);var p=a.processModule(d||"",n,i),b=p.content;return b});return{content:o,includeList:n}}}]),e}(),Dh))||kh),un=new Ty;un.bind(re.ShaderModuleService).to(K1).inSingletonScope();un.bind(re.NameComponentManager).toConstantValue(new Yn(G1));un.bind(re.HierarchyComponentManager).toConstantValue(new Yn(I1));un.bind(re.TransformComponentManager).toConstantValue(new Yn(Ry));un.bind(re.MeshComponentManager).toConstantValue(new Yn(p1));un.bind(re.CullableComponentManager).toConstantValue(new Yn(d1));un.bind(re.GeometryComponentManager).toConstantValue(new Yn(i1));un.bind(re.MaterialComponentManager).toConstantValue(new Yn(u1));function Q1(){var e=new Ty;return e.parent=un,e.bind(re.Systems).to(P1).inSingletonScope().whenTargetNamed(re.SceneGraphSystem),e.bind(re.Systems).to(sS).inSingletonScope().whenTargetNamed(re.FrameGraphSystem),e.bind(re.Systems).to(g1).inSingletonScope().whenTargetNamed(re.MeshSystem),e.bind(re.Systems).to(a1).inSingletonScope().whenTargetNamed(re.GeometrySystem),e.bind(re.Systems).to(c1).inSingletonScope().whenTargetNamed(re.MaterialSystem),e.bind(re.Systems).to(x1).inSingletonScope().whenTargetNamed(re.RendererSystem),e.bind(re.ResourcePool).to(k1).inSingletonScope(),e.bind(re.ConfigService).to(B1).inSingletonScope(),e.bind(re.InteractorService).to(U1).inSingletonScope(),e.bind(re.RenderPass).to(Ri).inSingletonScope().whenTargetNamed(Ri.IDENTIFIER),e.bind(re.RenderPass).to(Lo).inSingletonScope().whenTargetNamed(Lo.IDENTIFIER),e.bind(re.RenderPass).to(bu).inSingletonScope().whenTargetNamed(bu.IDENTIFIER),e.bind(re.RenderPassFactory).toFactory(function(t){return function(r){return t.container.getNamed(re.RenderPass,r)}}),e}function Fu(e){for(var t=new Du,r=ct(e[0],e[1],e[2]),n=ct(e[0],e[1],e[2]),i=3;i<e.length;){var a=e[i++],o=e[i++],s=e[i++];a<r[0]&&(r[0]=a),o<r[1]&&(r[1]=o),s<r[2]&&(r[2]=s),a>n[0]&&(n[0]=a),o>n[1]&&(n[1]=o),s>n[2]&&(n[2]=s)}return t.setMinMax(r,n),t}var Er=typeof navigator<"u"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);Nt();Nt();Nt();Nt();Nt();Nt();var Gh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Gh||(Gh={}));var Hn;(function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"})(Hn||(Hn={}));var Bh;(function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"})(Bh||(Bh={}));var An;(function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"})(An||(An={}));var va;(function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"})(va||(va={}));var Z1="__DefineValuePlaceholder__";function Gu(e){return typeof e=="number"}function Qr(e){return e===void 0?0:e>360||e<-360?e%360:e}function Fn(e,t,r){return Gu(e)?ct(e,t,r):e.length===3?nn(e):ct(e[0],e[1],e[2])}var Uh=function(){function e(t,r){De(this,e),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=fS(r.matrix),this.right=nn(r.right),this.up=nn(r.up),this.forward=nn(r.forward),this.position=nn(r.position),this.focalPoint=nn(r.focalPoint),this.distanceVector=nn(r.distanceVector),this.azimuth=r.azimuth,this.elevation=r.elevation,this.roll=r.roll,this.relAzimuth=r.relAzimuth,this.relElevation=r.relElevation,this.relRoll=r.relRoll,this.dollyingStep=r.dollyingStep,this.distance=r.distance}return We(e,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(r){r.matrix=mu(r.matrix,this.matrix),r.right=cr(r.right,this.right),r.up=cr(r.up,this.up),r.forward=cr(r.forward,this.forward),r.position=cr(r.position,this.position),r.focalPoint=cr(r.focalPoint,this.focalPoint),r.distanceVector=cr(r.distanceVector,this.distanceVector),r.azimuth=this.azimuth,r.elevation=this.elevation,r.roll=this.roll,r.relAzimuth=this.relAzimuth,r.relElevation=this.relElevation,r.relRoll=this.relRoll,r.dollyingStep=this.dollyingStep,r.distance=this.distance}}]),e}(),$h,Vh,jh,tu,zh,Hh,Xh,Ot;(function(e){e.ORBITING="ORBITING",e.EXPLORING="EXPLORING",e.TRACKING="TRACKING"})(Ot||(Ot={}));var Mo;(function(e){e.DEFAULT="DEFAULT",e.ROTATIONAL="ROTATIONAL",e.TRANSLATIONAL="TRANSLATIONAL",e.CINEMATIC="CINEMATIC"})(Mo||(Mo={}));var $n;(function(e){e.ORTHOGRAPHIC="ORTHOGRAPHIC",e.PERSPECTIVE="PERSPECTIVE"})($n||($n={}));var Zr=Math.PI/180,pn=180/Math.PI,Wh=($h=Ct(),Vh=ze(re.InteractorService),$h(jh=(tu=(Xh=Hh=function(){function e(){De(this,e),this.matrix=br(),this.right=ct(1,0,0),this.up=ct(0,1,0),this.forward=ct(0,0,1),this.position=ct(0,0,1),this.focalPoint=ct(0,0,0),this.distanceVector=ct(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.rotateWorld=!1,Ve(this,"interactor",zh,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=br(),this.view=void 0,this.following=void 0,this.type=Ot.EXPLORING,this.trackingMode=Mo.DEFAULT,this.projectionMode=$n.PERSPECTIVE,this.frustum=new y1,this.landmarks=[],this.landmarkAnimationID=void 0}return We(e,[{key:"clone",value:function(){var r=new e;return r.setType(this.type,void 0),r.interactor=this.interactor,r}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(r,n){return this.type=r,this.type===Ot.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Ot.TRACKING&&n!==void 0&&this.setTrackingMode(n),this}},{key:"setProjectionMode",value:function(r){return this.projectionMode=r,this}},{key:"setTrackingMode",value:function(r){if(this.type!==Ot.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=r,this}},{key:"setWorldRotation",value:function(r){this.rotateWorld=r,this._getAngles()}},{key:"getViewTransform",value:function(){return Io(br(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(r){return this.matrix=r,this._update(),this}},{key:"setAspect",value:function(r){return this.setPerspective(this.near,this.far,this.fov,r),this}},{key:"setViewOffset",value:function(r,n,i,a,o,s){return this.aspect=r/n,this.view===void 0&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=a,this.view.width=o,this.view.height=s,this.projectionMode===$n.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return this.view!==void 0&&(this.view.enabled=!1),this.projectionMode===$n.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(r,n,i,a){return this.projectionMode=$n.PERSPECTIVE,this.fov=i,this.near=r,this.far=n,this.aspect=a,pS(this.perspective,this.fov*Zr,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(r,n,i,a,o,s){this.projectionMode=$n.ORTHOGRAPHIC,this.rright=n,this.left=r,this.top=i,this.bottom=a,this.near=o,this.far=s;var u=(this.rright-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),f=(this.rright+this.left)/2,d=(this.top+this.bottom)/2,p=f-u,b=f+u,A=d+c,x=d-c;if(this.view!==void 0&&this.view.enabled){var N=(this.rright-this.left)/this.view.fullWidth/this.zoom,X=(this.top-this.bottom)/this.view.fullHeight/this.zoom;p+=N*this.view.offsetX,b=p+N*this.view.width,A-=X*this.view.offsetY,x=A-X*this.view.height}return yS(this.perspective,p,b,A,x,o,s),this}},{key:"setPosition",value:function(r,n,i){return this._setPosition(r,n,i),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(r,n,i){var a=ct(0,1,0);if(this.focalPoint=Fn(r,n,i),this.trackingMode===Mo.CINEMATIC){var o=yu(Nt(),this.focalPoint,this.position);r=o[0],n=o[1],i=o[2];var s=wo(o),u=Math.asin(n/s)*pn,c=90+Math.atan2(i,r)*pn,f=br();dS(f,f,c*Zr),lS(f,f,u*Zr),a=Mu(Nt(),[0,1,0],f)}return Io(this.matrix,_S(br(),this.position,this.focalPoint,a)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(r){if(!(this.distance===r||r<0)){this.distance=r,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var n=Nt();r=this.distance;var i=this.forward,a=this.focalPoint;return n[0]=r*i[0]+a[0],n[1]=r*i[1]+a[1],n[2]=r*i[2]+a[2],this._setPosition(n),this}}},{key:"setMaxDistance",value:function(r){return this.maxDistance=r,this}},{key:"setMinDistance",value:function(r){return this.minDistance=r,this}},{key:"changeAzimuth",value:function(r){return this.setAzimuth(this.azimuth+r),this}},{key:"changeElevation",value:function(r){return this.setElevation(this.elevation+r),this}},{key:"changeRoll",value:function(r){return this.setRoll(this.roll+r),this}},{key:"setAzimuth",value:function(r){return this.azimuth=Qr(r),this.computeMatrix(),this._getAxes(),this.type===Ot.ORBITING||this.type===Ot.EXPLORING?this._getPosition():this.type===Ot.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(r){return this.elevation=Qr(r),this.computeMatrix(),this._getAxes(),this.type===Ot.ORBITING||this.type===Ot.EXPLORING?this._getPosition():this.type===Ot.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(r){return this.roll=Qr(r),this.computeMatrix(),this._getAxes(),this.type===Ot.ORBITING||this.type===Ot.EXPLORING?this._getPosition():this.type===Ot.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(r,n,i){if(this.type===Ot.EXPLORING){r=Qr(r),n=Qr(n),i=Qr(i);var a=Un(tr(),[1,0,0],(this.rotateWorld?1:-1)*n*Zr),o=Un(tr(),[0,1,0],(this.rotateWorld?1:-1)*r*Zr),s=Un(tr(),[0,0,1],i*Zr),u=Cr(tr(),o,a);u=Cr(tr(),u,s);var c=Al(br(),u);Yi(this.matrix,this.matrix,[0,0,-this.distance]),Vn(this.matrix,this.matrix,c),Yi(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation+n)>90)return;this.relElevation=Qr(n),this.relAzimuth=Qr(r),this.relRoll=Qr(i),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===Ot.ORBITING||this.type===Ot.EXPLORING?this._getPosition():this.type===Ot.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(r,n){var i=Fn(r,n,0),a=nn(this.position);return on(a,a,ba(Nt(),this.right,i[0])),on(a,a,ba(Nt(),this.up,i[1])),this._setPosition(a),this}},{key:"dolly",value:function(r){var n=this.forward,i=nn(this.position),a=r*this.dollyingStep,o=this.distance+r*this.dollyingStep;return a=Math.max(Math.min(o,this.maxDistance),this.minDistance)-this.distance,i[0]+=a*n[0],i[1]+=a*n[1],i[2]+=a*n[2],this._setPosition(i),this.type===Ot.ORBITING||this.type===Ot.EXPLORING?this._getDistance():this.type===Ot.TRACKING&&on(this.focalPoint,i,this.distanceVector),this}},{key:"createLandmark",value:function(r,n){var i=this.clone();i.setPosition(n.position),i.setFocalPoint(n.focalPoint),n.roll!==void 0&&i.setRoll(n.roll);var a=new Uh(r,i);return this.landmarks.push(a),a}},{key:"setLandmark",value:function(r){var n=new Uh(r,this);return this.landmarks.push(n),this}},{key:"gotoLandmark",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3,a=this.landmarks.find(function(d){return d.name===r});if(a){if(i===0){a.retrieve(this);return}this.landmarkAnimationID!==void 0&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect();var o=a.getPosition(),s=a.getFocalPoint(),u=a.getRoll(),c,f=function d(p){c===void 0&&(c=p);var b=p-c,A=(1-Math.cos(b/i*Math.PI))/2,x=Nt(),N=Nt(),X=0;zn(x,n.focalPoint,s,A),zn(N,n.position,o,A),X=n.roll*(1-A)+u*A,n.setFocalPoint(x),n.setPosition(N),n.setRoll(X),n.computeMatrix();var ae=Sl(x,s)+Sl(N,o);if(!(ae>.01)){n.setFocalPoint(x),n.setPosition(N),n.setRoll(X),n.computeMatrix(),n.interactor.connect();return}b<i&&(n.landmarkAnimationID=window.requestAnimationFrame(d))};window.requestAnimationFrame(f)}}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var r,n,i=Un(tr(),[0,0,1],this.roll*Zr);Ay(this.matrix),r=Un(tr(),[1,0,0],(this.rotateWorld&&this.type!==Ot.TRACKING||this.type===Ot.TRACKING?1:-1)*this.elevation*Zr),n=Un(tr(),[0,1,0],(this.rotateWorld&&this.type!==Ot.TRACKING||this.type===Ot.TRACKING?1:-1)*this.azimuth*Zr);var a=Cr(tr(),n,r);a=Cr(tr(),a,i);var o=Al(br(),a);this.type===Ot.ORBITING||this.type===Ot.EXPLORING?(Yi(this.matrix,this.matrix,this.focalPoint),Vn(this.matrix,this.matrix,o),Yi(this.matrix,this.matrix,[0,0,this.distance])):this.type===Ot.TRACKING&&(Yi(this.matrix,this.matrix,this.position),Vn(this.matrix,this.matrix,o))}},{key:"_setPosition",value:function(r,n,i){this.position=Fn(r,n,i);var a=this.matrix;a[12]=this.position[0],a[13]=this.position[1],a[14]=this.position[2],a[15]=1}},{key:"_getAxes",value:function(){cr(this.right,Fn(da(la(),[1,0,0,0],this.matrix))),cr(this.up,Fn(da(la(),[0,1,0,0],this.matrix))),cr(this.forward,Fn(da(la(),[0,0,1,0],this.matrix))),ha(this.right,this.right),ha(this.up,this.up),ha(this.forward,this.forward)}},{key:"_getAngles",value:function(){var r=this.distanceVector[0],n=this.distanceVector[1],i=this.distanceVector[2],a=wo(this.distanceVector);if(a===0){this.elevation=0,this.azimuth=0;return}this.type===Ot.TRACKING?(this.elevation=Math.asin(n/a)*pn,this.azimuth=Math.atan2(-r,-i)*pn):this.rotateWorld?(this.elevation=Math.asin(n/a)*pn,this.azimuth=Math.atan2(-r,-i)*pn):(this.elevation=-Math.asin(n/a)*pn,this.azimuth=-Math.atan2(-r,-i)*pn)}},{key:"_getPosition",value:function(){cr(this.position,Fn(da(la(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){ku(this.distanceVector,[0,0,-this.distance],uS(Aa(),this.matrix)),on(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=yu(Nt(),this.focalPoint,this.position),this.distance=wo(this.distanceVector),this.dollyingStep=this.distance/100}}]),e}(),Hh.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},Xh),zh=je(tu.prototype,"interactor",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu))||jh),Yh,qh,Kh,ru,Qh,ta,Zh,bn=(Yh=Ct(),qh=ze(re.GeometryComponentManager),Yh(Kh=(ru=(Zh=ta=function(){function e(){De(this,e),this.config=void 0,Ve(this,"geometry",Qh,this),this.entity=void 0,this.component=void 0}return We(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.component=this.geometry.create(r),this.component.entity=r,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),ta.BOX="box",ta.SPHERE="sphere",ta.PLANE="plane",ta.MERGED="merged",Zh),Qh=je(ru.prototype,"geometry",[qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ru))||Kh),Te={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.TextureCompressionBC="texture-compression-bc"}(e.ExtensionName||(e.ExtensionName={})),function(t){t.ClampToEdge="clamp-to-edge",t.Repeat="repeat",t.MirrorRepeat="mirror-repeat"}(e.AddressMode||(e.AddressMode={})),function(t){t.UniformBuffer="uniform-buffer",t.StorageBuffer="storage-buffer",t.ReadonlyStorageBuffer="readonly-storage-buffer",t.Sampler="sampler",t.ComparisonSampler="comparison-sampler",t.SampledTexture="sampled-texture",t.ReadonlyStorageTexture="readonly-storage-texture",t.WriteonlyStorageTexture="writeonly-storage-texture"}(e.BindingType||(e.BindingType={})),function(t){t.Zero="zero",t.One="one",t.SrcColor="src-color",t.OneMinusSrcColor="one-minus-src-color",t.SrcAlpha="src-alpha",t.OneMinusSrcAlpha="one-minus-src-alpha",t.DstColor="dst-color",t.OneMinusDstColor="one-minus-dst-color",t.DstAlpha="dst-alpha",t.OneMinusDstAlpha="one-minus-dst-alpha",t.SrcAlphaSaturated="src-alpha-saturated",t.BlendColor="blend-color",t.OneMinusBlendColor="one-minus-blend-color"}(e.BlendFactor||(e.BlendFactor={})),function(t){t.Add="add",t.Subtract="subtract",t.ReverseSubtract="reverse-subtract",t.Min="min",t.Max="max"}(e.BlendOperation||(e.BlendOperation={})),function(t){t.Never="never",t.Less="less",t.Equal="equal",t.LessEqual="less-equal",t.Greater="greater",t.NotEqual="not-equal",t.GreaterEqual="greater-equal",t.Always="always"}(e.CompareFunction||(e.CompareFunction={})),function(t){t.None="none",t.Front="front",t.Back="back"}(e.CullMode||(e.CullMode={})),function(t){t.Nearest="nearest",t.Linear="linear"}(e.FilterMode||(e.FilterMode={})),function(t){t.CCW="ccw",t.CW="cw"}(e.FrontFace||(e.FrontFace={})),function(t){t.Uint16="uint16",t.Uint32="uint32"}(e.IndexFormat||(e.IndexFormat={})),function(t){t.Vertex="vertex",t.Instance="instance"}(e.InputStepMode||(e.InputStepMode={})),function(t){t.Load="load"}(e.LoadOp||(e.LoadOp={})),function(t){t.PointList="point-list",t.LineList="line-list",t.LineStrip="line-strip",t.TriangleList="triangle-list",t.TriangleStrip="triangle-strip"}(e.PrimitiveTopology||(e.PrimitiveTopology={})),function(t){t.Keep="keep",t.Zero="zero",t.Replace="replace",t.Invert="invert",t.IncrementClamp="increment-clamp",t.DecrementClamp="decrement-clamp",t.IncrementWrap="increment-wrap",t.DecrementWrap="decrement-wrap"}(e.StencilOperation||(e.StencilOperation={})),function(t){t.Store="store",t.Clear="clear"}(e.StoreOp||(e.StoreOp={})),function(t){t.E1d="1d",t.E2d="2d",t.E3d="3d"}(e.TextureDimension||(e.TextureDimension={})),function(t){t.R8Unorm="r8unorm",t.R8Snorm="r8snorm",t.R8Uint="r8uint",t.R8Sint="r8sint",t.R16Uint="r16uint",t.R16Sint="r16sint",t.R16Float="r16float",t.RG8Unorm="rg8unorm",t.RG8Snorm="rg8snorm",t.RG8Uint="rg8uint",t.RG8Sint="rg8sint",t.R32Uint="r32uint",t.R32Sint="r32sint",t.R32Float="r32float",t.RG16Uint="rg16uint",t.RG16Sint="rg16sint",t.RG16Float="rg16float",t.RGBA8Unorm="rgba8unorm",t.RGBA8UnormSRGB="rgba8unorm-srgb",t.RGBA8Snorm="rgba8snorm",t.RGBA8Uint="rgba8uint",t.RGBA8Sint="rgba8sint",t.BGRA8Unorm="bgra8unorm",t.BGRA8UnormSRGB="bgra8unorm-srgb",t.RGB10A2Unorm="rgb10a2unorm",t.RG11B10Float="rg11b10float",t.RG32Uint="rg32uint",t.RG32Sint="rg32sint",t.RG32Float="rg32float",t.RGBA16Uint="rgba16uint",t.RGBA16Sint="rgba16sint",t.RGBA16Float="rgba16float",t.RGBA32Uint="rgba32uint",t.RGBA32Sint="rgba32sint",t.RGBA32Float="rgba32float",t.Depth32Float="depth32float",t.Depth24Plus="depth24plus",t.Depth24PlusStencil8="depth24plus-stencil8"}(e.TextureFormat||(e.TextureFormat={})),function(t){t.Float="float",t.Sint="sint",t.Uint="uint"}(e.TextureComponentType||(e.TextureComponentType={})),function(t){t.E1d="1d",t.E2d="2d",t.E2dArray="2d-array",t.Cube="cube",t.CubeArray="cube-array",t.E3d="3d"}(e.TextureViewDimension||(e.TextureViewDimension={})),function(t){t.Uchar2="uchar2",t.Uchar4="uchar4",t.Char2="char2",t.Char4="char4",t.Uchar2Norm="uchar2norm",t.Uchar4Norm="uchar4norm",t.Char2Norm="char2norm",t.Char4Norm="char4norm",t.Ushort2="ushort2",t.Ushort4="ushort4",t.Short2="short2",t.Short4="short4",t.Ushort2Norm="ushort2norm",t.Ushort4Norm="ushort4norm",t.Short2Norm="short2norm",t.Short4Norm="short4norm",t.Half2="half2",t.Half4="half4",t.Float="float",t.Float2="float2",t.Float3="float3",t.Float4="float4",t.Uint="uint",t.Uint2="uint2",t.Uint3="uint3",t.Uint4="uint4",t.Int="int",t.Int2="int2",t.Int3="int3",t.Int4="int4"}(e.VertexFormat||(e.VertexFormat={})),function(t){t.All="all",t.StencilOnly="stencil-only",t.DepthOnly="depth-only"}(e.TextureAspect||(e.TextureAspect={})),function(t){t.Error="error",t.Warning="warning",t.Info="info"}(e.CompilationMessageType||(e.CompilationMessageType={})),function(t){t.Occlusion="occlusion"}(e.QueryType||(e.QueryType={})),function(t){t[t.MapRead=1]="MapRead",t[t.MapWrite=2]="MapWrite",t[t.CopySrc=4]="CopySrc",t[t.CopyDst=8]="CopyDst",t[t.Index=16]="Index",t[t.Vertex=32]="Vertex",t[t.Uniform=64]="Uniform",t[t.Storage=128]="Storage",t[t.Indirect=256]="Indirect",t[t.QueryResolve=512]="QueryResolve"}(e.BufferUsage||(e.BufferUsage={})),function(t){t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.All=15]="All"}(e.ColorWrite||(e.ColorWrite={})),function(t){t[t.Vertex=1]="Vertex",t[t.Fragment=2]="Fragment",t[t.Compute=4]="Compute"}(e.ShaderStage||(e.ShaderStage={})),function(t){t[t.CopySrc=1]="CopySrc",t[t.CopyDst=2]="CopyDst",t[t.Sampled=4]="Sampled",t[t.Storage=8]="Storage",t[t.OutputAttachment=16]="OutputAttachment"}(e.TextureUsage||(e.TextureUsage={})),function(t){t[t.Read=1]="Read",t[t.Write=2]="Write"}(e.MapMode||(e.MapMode={}))})(Te);function Cy(){if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var J1={}.toString,ew=function(t,r){return J1.call(t)==="[object "+r+"]"};const tw=function(e){return Array.isArray?Array.isArray(e):ew(e,"Array")};var rw=9007199254740991,nw="[object Arguments]",iw="[object Array]",aw="[object Boolean]",ow="[object Date]",sw="[object Error]",uw="[object Function]",cw="[object Map]",fw="[object Number]",lw="[object Object]",dw="[object RegExp]",hw="[object Set]",vw="[object String]",pw="[object WeakMap]",mw="[object ArrayBuffer]",yw="[object DataView]",_w="[object Float32Array]",Ew="[object Float64Array]",bw="[object Int8Array]",gw="[object Int16Array]",Tw="[object Int32Array]",Aw="[object Uint8Array]",Sw="[object Uint8ClampedArray]",ww="[object Uint16Array]",Rw="[object Uint32Array]",kt={};kt[_w]=kt[Ew]=kt[bw]=kt[gw]=kt[Tw]=kt[Aw]=kt[Sw]=kt[ww]=kt[Rw]=!0;kt[nw]=kt[iw]=kt[mw]=kt[aw]=kt[yw]=kt[ow]=kt[sw]=kt[uw]=kt[cw]=kt[fw]=kt[lw]=kt[dw]=kt[hw]=kt[vw]=kt[pw]=!1;var Cw=Object.prototype,xw=Cw.toString;function Nw(e){return Iw(e)&&Ow(e.length)&&!!kt[xw.call(e)]}function Ow(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=rw}function Iw(e){return!!e&&sn(e)==="object"}var xy=Nw,Jh,ev,tv,rv,uo,nv,iv,av;function ov(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function sv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ov(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ov(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uv=(Jh=Ct(),ev=ze(re.RenderEngine),tv=ze(re.ConfigService),Jh(rv=(uo=(av=function(){function e(){De(this,e),Ve(this,"engine",nv,this),Ve(this,"configService",iv,this),this.entity=jr(),this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}return We(e,[{key:"init",value:function(){var r=this.configService.get(),n=r.canvas,i=r.engineOptions;this.initPromise=this.engine.init(sv({canvas:n||Cy(),swapChainFormat:Te.TextureFormat.BGRA8Unorm,antialiasing:!1},i))}},{key:"setBundle",value:function(r){this.compiledBundle=JSON.parse(JSON.stringify(r))}},{key:"setDispatch",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=r),this}},{key:"setMaxIteration",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=r),this}},{key:"setBinding",value:function(r,n){var i=this;if(typeof r=="string"){var a=Gu(n)||xy(n)||tw(n);if(this.compiledBundle&&this.compiledBundle.context){var o=this.compiledBundle.context.defines.find(function(u){return u.name===r});if(o)return o.value=n,this;var s=this.compiledBundle.context.uniforms.find(function(u){return u.name===r});s&&(a?(s.data=n,s.isReferer=!1,s.storageClass===An.Uniform?this.model&&this.model.updateUniform(r,n):this.model&&this.model.updateBuffer(r,n)):(s.isReferer=!0,s.data=n))}}else Object.keys(r).forEach(function(u){i.setBinding(u,r[u])});return this}},{key:"execute",value:function(){var t=Tt(Pe.mark(function n(){var i=this,a,o,s=arguments;return Pe.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=s.length>0&&s[0]!==void 0?s[0]:1,!this.dirty){c.next=6;break}return this.compiledBundle.context&&(a>1?this.compiledBundle.context.maxIteration=a:this.compiledBundle.context.maxIteration++),c.next=5,this.compile();case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter(function(f){var d=f.isReferer;return d}).forEach(function(f){var d=f.data,p=f.name;i.model.confirmInput(d.model,p)}),o=0;o<a;o++)this.model.run();return this.engine.endFrame(),c.abrupt("return",this);case 12:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getOutput",value:function(){var t=Tt(Pe.mark(function n(){return Pe.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.model.readData());case 1:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"compile",value:function(){var t=Tt(Pe.mark(function n(){var i,a,o;return Pe.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.initPromise;case 2:return i=sv({},this.compiledBundle.context),a=this.engine.supportWebGPU?this.engine.useWGSL?va.WGSL:va.GLSL450:va.GLSL100,o=this.compiledBundle.shaders[a],i.defines.filter(function(c){return c.runtime}).forEach(function(c){var f="".concat(Z1).concat(c.name);o=o.replace(f,"".concat(c.value))}),i.shader=o,i.uniforms.forEach(function(c){if(!c.data&&c.storageClass===An.StorageBuffer){var f=1;c.type===Hn.FloatArray?f=1:c.type===Hn.Vector4FloatArray&&(f=4),c.data=new Float32Array(i.output.length*f).fill(0)}}),this.compiledBundle.context=i,u.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=u.sent;case 12:case"end":return u.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),av),nv=je(uo.prototype,"engine",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=je(uo.prototype,"configService",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uo))||rv),cv,fv,lv,nu,dv,hv,vv,Ny=(cv=Ct(),fv=ze(re.MaterialComponentManager),cv(lv=(nu=(vv=hv=function(){function e(){De(this,e),this.config=void 0,Ve(this,"material",dv,this),this.entity=void 0,this.component=void 0}return We(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r,n){this.entity=r,this.component=this.material.create(r),this.component.entity=r,this.component.type=n,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),hv.BASIC="basic",vv),dv=je(nu.prototype,"material",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nu))||lv),pv,mv,yv,_v,Ev,bv,gv,yi,Tv,Av,Sv,wv,co,Rv,En=(pv=Ct(),mv=ze(re.MeshComponentManager),yv=ze(re.CullableComponentManager),_v=ze(re.TransformComponentManager),Ev=ze(re.Systems),bv=Hr(re.SceneGraphSystem),pv(gv=(yi=(Rv=co=function(){function e(){De(this,e),this.attributes={},this.config=void 0,Ve(this,"mesh",Tv,this),Ve(this,"cullable",Av,this),Ve(this,"transform",Sv,this),Ve(this,"sceneGraphSystem",wv,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return We(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.cullable.create(r),this.meshComponent=this.mesh.create(r),this.transformComponent=this.transform.create(r),this.onEntityCreated()}},{key:"setMaterial",value:function(r){return this.meshComponent.material=r,this}},{key:"setGeometry",value:function(r){return this.meshComponent.geometry=r,this}},{key:"setAttributes",value:function(r){var n=this;Object.keys(r).forEach(function(i){r[i]!==void 0&&r[i]!==n.attributes[i]&&(n.onAttributeChanged({name:i,data:r[i]}),n.attributes[i]=r[i])})}},{key:"setVisible",value:function(r){var n=this;return this.meshComponent.visible=r,this.meshComponent.children.forEach(function(i){var a=n.mesh.getComponentByEntity(i);a&&(a.visible=r)}),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(r){return this.sceneGraphSystem.attach(this.entity,r.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(r){var n=r.name,i=r.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(n),i)}},{key:"convertAttributeName2UniformName",value:function(r){return r}}]),e}(),co.POINT="point",co.LINE="line",co.GRID="grid",Rv),Tv=je(yi.prototype,"mesh",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=je(yi.prototype,"cullable",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=je(yi.prototype,"transform",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=je(yi.prototype,"sceneGraphSystem",[Ev,bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yi))||gv),Oy={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(su,function(){var r=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},n=function(l,v){for(var T=Object.keys(v),B=0;B<T.length;++B)l[T[B]]=v[T[B]];return l},i=`
`;function a(l){return typeof atob<"u"?atob(l):"base64:"+l}function o(l){var v=new Error("(regl) "+l);throw console.error(v),v}function s(l,v){l||o(v)}function u(l){return l?": "+l:""}function c(l,v,T){l in v||o("unknown parameter ("+l+")"+u(T)+". possible values: "+Object.keys(v).join())}function f(l,v){r(l)||o("invalid parameter type"+u(v)+". must be a typed array")}function d(l,v){switch(v){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function p(l,v,T){d(l,v)||o("invalid parameter type"+u(T)+". expected "+v+", got "+typeof l)}function b(l,v){l>=0&&(l|0)===l||o("invalid parameter type, ("+l+")"+u(v)+". must be a nonnegative integer")}function A(l,v,T){v.indexOf(l)<0&&o("invalid value"+u(T)+". must be one of: "+v)}var x=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function N(l){Object.keys(l).forEach(function(v){x.indexOf(v)<0&&o('invalid regl constructor argument "'+v+'". must be one of '+x)})}function X(l,v){for(l=l+"";l.length<v;)l=" "+l;return l}function ae(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function W(l,v){this.number=l,this.line=v,this.errors=[]}function Ee(l,v,T){this.file=l,this.line=v,this.message=T}function he(){var l=new Error,v=(l.stack||l).toString(),T=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(T)return T[1];var B=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return B?B[1]:"unknown"}function we(){var l=new Error,v=(l.stack||l).toString(),T=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(T)return T[1];var B=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return B?B[1]:"unknown"}function Me(l,v){var T=l.split(`
`),B=1,K=0,G={unknown:new ae,0:new ae};G.unknown.name=G[0].name=v||he(),G.unknown.lines.push(new W(0,""));for(var $=0;$<T.length;++$){var ne=T[$],se=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ne);if(se)switch(se[1]){case"line":var le=/(\d+)(\s+\d+)?/.exec(se[2]);le&&(B=le[1]|0,le[2]&&(K=le[2]|0,K in G||(G[K]=new ae)));break;case"define":var ue=/SHADER_NAME(_B64)?\s+(.*)$/.exec(se[2]);ue&&(G[K].name=ue[1]?a(ue[2]):ue[2]);break}G[K].lines.push(new W(B++,ne))}return Object.keys(G).forEach(function(ve){var be=G[ve];be.lines.forEach(function(ie){be.index[ie.number]=ie})}),G}function He(l){var v=[];return l.split(`
`).forEach(function(T){if(!(T.length<5)){var B=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(T);B?v.push(new Ee(B[1]|0,B[2]|0,B[3].trim())):T.length>0&&v.push(new Ee("unknown",0,T))}}),v}function dt(l,v){v.forEach(function(T){var B=l[T.file];if(B){var K=B.index[T.line];if(K){K.errors.push(T),B.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(T)})}function ft(l,v,T,B,K){if(!l.getShaderParameter(v,l.COMPILE_STATUS)){var G=l.getShaderInfoLog(v),$=B===l.FRAGMENT_SHADER?"fragment":"vertex";Ge(T,"string",$+" shader source must be a string",K);var ne=Me(T,K),se=He(G);dt(ne,se),Object.keys(ne).forEach(function(le){var ue=ne[le];if(!ue.hasErrors)return;var ve=[""],be=[""];function ie(pe,L){ve.push(pe),be.push(L||"")}ie("file number "+le+": "+ue.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ue.lines.forEach(function(pe){if(pe.errors.length>0){ie(X(pe.number,4)+"|  ","background-color:yellow; font-weight:bold"),ie(pe.line+i,"color:red; background-color:yellow; font-weight:bold");var L=0;pe.errors.forEach(function(V){var fe=V.message,Se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Se){var J=Se[1];switch(fe=Se[2],J){case"assign":J="=";break}L=Math.max(pe.line.indexOf(J,L),0)}else L=0;ie(X("| ",6)),ie(X("^^^",L+3)+i,"font-weight:bold"),ie(X("| ",6)),ie(fe+i,"font-weight:bold")}),ie(X("| ",6)+i)}else ie(X(pe.number,4)+"|  "),ie(pe.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(be[0]=ve.join("%c"),console.log.apply(console,be)):console.log(ve.join(""))}),s.raise("Error compiling "+$+" shader, "+ne[0].name)}}function pt(l,v,T,B,K){if(!l.getProgramParameter(v,l.LINK_STATUS)){var G=l.getProgramInfoLog(v),$=Me(T,K),ne=Me(B,K),se='Error linking program with vertex shader, "'+ne[0].name+'", and fragment shader "'+$[0].name+'"';typeof document<"u"?console.log("%c"+se+i+"%c"+G,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(se+i+G),s.raise(se)}}function Qe(l){l._commandRef=he()}function me(l,v,T,B){Qe(l);function K(se){return se?B.id(se):0}l._fragId=K(l.static.frag),l._vertId=K(l.static.vert);function G(se,le){Object.keys(le).forEach(function(ue){se[B.id(ue)]=!0})}var $=l._uniformSet={};G($,v.static),G($,v.dynamic);var ne=l._attributeSet={};G(ne,T.static),G(ne,T.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function H(l,v){var T=we();o(l+" in command "+(v||he())+(T==="unknown"?"":" called from "+T))}function Ie(l,v,T){l||H(v,T||he())}function Ye(l,v,T,B){l in v||H("unknown parameter ("+l+")"+u(T)+". possible values: "+Object.keys(v).join(),B||he())}function Ge(l,v,T,B){d(l,v)||H("invalid parameter type"+u(T)+". expected "+v+", got "+typeof l,B||he())}function Fe(l){l()}function xt(l,v,T){l.texture?A(l.texture._texture.internalformat,v,"unsupported texture format for attachment"):A(l.renderbuffer._renderbuffer.format,T,"unsupported renderbuffer format for attachment")}var Lt=33071,mt=9728,ht=9984,Pt=9985,St=9986,Xr=9987,Wr=5120,Tr=5121,Yr=5122,Or=5123,Sa=5124,cn=5125,Ci=5126,wa=32819,xi=32820,Ra=33635,Ca=34042,Uo=36193,dr={};dr[Wr]=dr[Tr]=1,dr[Yr]=dr[Or]=dr[Uo]=dr[Ra]=dr[wa]=dr[xi]=2,dr[Sa]=dr[cn]=dr[Ci]=dr[Ca]=4;function qn(l,v){return l===xi||l===wa||l===Ra?2:l===Ca?4:dr[l]*v}function Kn(l){return!(l&l-1)&&!!l}function $o(l,v,T){var B,K=v.width,G=v.height,$=v.channels;s(K>0&&K<=T.maxTextureSize&&G>0&&G<=T.maxTextureSize,"invalid texture shape"),(l.wrapS!==Lt||l.wrapT!==Lt)&&s(Kn(K)&&Kn(G),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?K!==1&&G!==1&&s(l.minFilter!==ht&&l.minFilter!==St&&l.minFilter!==Pt&&l.minFilter!==Xr,"min filter requires mipmap"):(s(Kn(K)&&Kn(G),"texture must be a square power of 2 to support mipmapping"),s(v.mipmask===(K<<1)-1,"missing or incomplete mipmap data")),v.type===Ci&&(T.extensions.indexOf("oes_texture_float_linear")<0&&s(l.minFilter===mt&&l.magFilter===mt,"filter not supported, must enable oes_texture_float_linear"),s(!l.genMipmaps,"mipmap generation not supported with float textures"));var ne=v.images;for(B=0;B<16;++B)if(ne[B]){var se=K>>B,le=G>>B;s(v.mipmask&1<<B,"missing mipmap data");var ue=ne[B];if(s(ue.width===se&&ue.height===le,"invalid shape for mip images"),s(ue.format===v.format&&ue.internalformat===v.internalformat&&ue.type===v.type,"incompatible type for mip image"),!ue.compressed)if(ue.data){var ve=Math.ceil(qn(ue.type,$)*se/ue.unpackAlignment)*ue.unpackAlignment;s(ue.data.byteLength===ve*le,"invalid data for image, buffer size is inconsistent with image format")}else ue.element||ue.copy}else l.genMipmaps||s((v.mipmask&1<<B)===0,"extra mipmap data");v.compressed&&s(!l.genMipmaps,"mipmap generation for compressed images not supported")}function Vo(l,v,T,B){var K=l.width,G=l.height,$=l.channels;s(K>0&&K<=B.maxTextureSize&&G>0&&G<=B.maxTextureSize,"invalid texture shape"),s(K===G,"cube map must be square"),s(v.wrapS===Lt&&v.wrapT===Lt,"wrap mode not supported by cube map");for(var ne=0;ne<T.length;++ne){var se=T[ne];s(se.width===K&&se.height===G,"inconsistent cube map face shape"),v.genMipmaps&&(s(!se.compressed,"can not generate mipmap for compressed textures"),s(se.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var le=se.images,ue=0;ue<16;++ue){var ve=le[ue];if(ve){var be=K>>ue,ie=G>>ue;s(se.mipmask&1<<ue,"missing mipmap data"),s(ve.width===be&&ve.height===ie,"invalid shape for mip images"),s(ve.format===l.format&&ve.internalformat===l.internalformat&&ve.type===l.type,"incompatible type for mip image"),ve.compressed||(ve.data?s(ve.data.byteLength===be*ie*Math.max(qn(ve.type,$),ve.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ve.element||ve.copy)}}}}var y=n(s,{optional:Fe,raise:o,commandRaise:H,command:Ie,parameter:c,commandParameter:Ye,constructor:N,type:p,commandType:Ge,isTypedArray:f,nni:b,oneOf:A,shaderError:ft,linkError:pt,callSite:we,saveCommandRef:Qe,saveDrawInfo:me,framebufferFormat:xt,guessCommand:he,texture2D:$o,textureCube:Vo}),j=0,oe=0,Ae=5,Oe=6;function Ue(l,v){this.id=j++,this.type=l,this.data=v}function Zt(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function at(l){if(l.length===0)return[];var v=l.charAt(0),T=l.charAt(l.length-1);if(l.length>1&&v===T&&(v==='"'||v==="'"))return['"'+Zt(l.substr(1,l.length-2))+'"'];var B=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(B)return at(l.substr(0,B.index)).concat(at(B[1])).concat(at(l.substr(B.index+B[0].length)));var K=l.split(".");if(K.length===1)return['"'+Zt(l)+'"'];for(var G=[],$=0;$<K.length;++$)G=G.concat(at(K[$]));return G}function vt(l){return"["+at(l).join("][")+"]"}function Je(l,v){return new Ue(l,vt(v+""))}function wt(l){return typeof l=="function"&&!l._reglType||l instanceof Ue}function At(l,v){if(typeof l=="function")return new Ue(oe,l);if(typeof l=="number"||typeof l=="boolean")return new Ue(Ae,l);if(Array.isArray(l))return new Ue(Oe,l.map((T,B)=>At(T,v+"["+B+"]")));if(l instanceof Ue)return l;y(!1,"invalid option type in uniform "+v)}var Vt={DynamicVariable:Ue,define:Je,isDynamic:wt,unbox:At,accessor:vt},Qn={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},$u=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Jy(){var l={"":0},v=[""];return{id:function(T){var B=l[T];return B||(B=l[T]=v.length,v.push(T),B)},str:function(T){return v[T]}}}function e_(l,v,T){var B=document.createElement("canvas");n(B.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(B),l===document.body&&(B.style.position="absolute",n(l.style,{margin:0,padding:0}));function K(){var ne=window.innerWidth,se=window.innerHeight;if(l!==document.body){var le=l.getBoundingClientRect();ne=le.right-le.left,se=le.bottom-le.top}B.width=T*ne,B.height=T*se,n(B.style,{width:ne+"px",height:se+"px"})}var G;l!==document.body&&typeof ResizeObserver=="function"?(G=new ResizeObserver(function(){setTimeout(K)}),G.observe(l)):window.addEventListener("resize",K,!1);function $(){G?G.disconnect():window.removeEventListener("resize",K),l.removeChild(B)}return K(),{canvas:B,onDestroy:$}}function t_(l,v){function T(B){try{return l.getContext(B,v)}catch{return null}}return T("webgl")||T("experimental-webgl")||T("webgl-experimental")}function r_(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function n_(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function Vu(l){return typeof l=="string"?l.split():(y(Array.isArray(l),"invalid extension array"),l)}function ju(l){return typeof l=="string"?(y(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function i_(l){var v=l||{},T,B,K,G,$={},ne=[],se=[],le=typeof window>"u"?1:window.devicePixelRatio,ue=!1,ve=function(pe){pe&&y.raise(pe)},be=function(){};if(typeof v=="string"?(y(typeof document<"u","selector queries only supported in DOM enviroments"),T=document.querySelector(v),y(T,"invalid query string for element")):typeof v=="object"?r_(v)?T=v:n_(v)?(G=v,K=G.canvas):(y.constructor(v),"gl"in v?G=v.gl:"canvas"in v?K=ju(v.canvas):"container"in v&&(B=ju(v.container)),"attributes"in v&&($=v.attributes,y.type($,"object","invalid context attributes")),"extensions"in v&&(ne=Vu(v.extensions)),"optionalExtensions"in v&&(se=Vu(v.optionalExtensions)),"onDone"in v&&(y.type(v.onDone,"function","invalid or missing onDone callback"),ve=v.onDone),"profile"in v&&(ue=!!v.profile),"pixelRatio"in v&&(le=+v.pixelRatio,y(le>0,"invalid pixel ratio"))):y.raise("invalid arguments to regl"),T&&(T.nodeName.toLowerCase()==="canvas"?K=T:B=T),!G){if(!K){y(typeof document<"u","must manually specify webgl context outside of DOM environments");var ie=e_(B||document.body,ve,le);if(!ie)return null;K=ie.canvas,be=ie.onDestroy}$.premultipliedAlpha===void 0&&($.premultipliedAlpha=!0),G=t_(K,$)}return G?{gl:G,canvas:K,container:B,extensions:ne,optionalExtensions:se,pixelRatio:le,profile:ue,onDone:ve,onDestroy:be}:(be(),ve("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function a_(l,v){var T={};function B($){y.type($,"string","extension name must be string");var ne=$.toLowerCase(),se;try{se=T[ne]=l.getExtension(ne)}catch{}return!!se}for(var K=0;K<v.extensions.length;++K){var G=v.extensions[K];if(!B(G))return v.onDestroy(),v.onDone('"'+G+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(B),{extensions:T,restore:function(){Object.keys(T).forEach(function($){if(T[$]&&!B($))throw new Error("(regl): error restoring extension "+$)})}}}function yr(l,v){for(var T=Array(l),B=0;B<l;++B)T[B]=v(B);return T}var o_=5120,s_=5121,u_=5122,c_=5123,f_=5124,l_=5125,d_=5126;function h_(l){for(var v=16;v<=1<<28;v*=16)if(l<=v)return v;return 0}function zu(l){var v,T;return v=(l>65535)<<4,l>>>=v,T=(l>255)<<3,l>>>=T,v|=T,T=(l>15)<<2,l>>>=T,v|=T,T=(l>3)<<1,l>>>=T,v|=T,v|l>>1}function Hu(){var l=yr(8,function(){return[]});function v(G){var $=h_(G),ne=l[zu($)>>2];return ne.length>0?ne.pop():new ArrayBuffer($)}function T(G){l[zu(G.byteLength)>>2].push(G)}function B(G,$){var ne=null;switch(G){case o_:ne=new Int8Array(v($),0,$);break;case s_:ne=new Uint8Array(v($),0,$);break;case u_:ne=new Int16Array(v(2*$),0,$);break;case c_:ne=new Uint16Array(v(2*$),0,$);break;case f_:ne=new Int32Array(v(4*$),0,$);break;case l_:ne=new Uint32Array(v(4*$),0,$);break;case d_:ne=new Float32Array(v(4*$),0,$);break;default:return null}return ne.length!==$?ne.subarray(0,$):ne}function K(G){T(G.buffer)}return{alloc:v,free:T,allocType:B,freeType:K}}var jt=Hu();jt.zero=Hu();var v_=3408,p_=3410,m_=3411,y_=3412,__=3413,E_=3414,b_=3415,g_=33901,T_=33902,A_=3379,S_=3386,w_=34921,R_=36347,C_=36348,x_=35661,N_=35660,O_=34930,I_=36349,P_=34076,L_=34024,M_=7936,k_=7937,D_=7938,F_=35724,G_=34047,B_=36063,U_=34852,xa=3553,Xu=34067,$_=34069,V_=33984,Ni=6408,jo=5126,Wu=5121,zo=36160,j_=36053,z_=36064,H_=16384,X_=function(l,v){var T=1;v.ext_texture_filter_anisotropic&&(T=l.getParameter(G_));var B=1,K=1;v.webgl_draw_buffers&&(B=l.getParameter(U_),K=l.getParameter(B_));var G=!!v.oes_texture_float;if(G){var $=l.createTexture();l.bindTexture(xa,$),l.texImage2D(xa,0,Ni,1,1,0,Ni,jo,null);var ne=l.createFramebuffer();if(l.bindFramebuffer(zo,ne),l.framebufferTexture2D(zo,z_,xa,$,0),l.bindTexture(xa,null),l.checkFramebufferStatus(zo)!==j_)G=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear(H_);var se=jt.allocType(jo,4);l.readPixels(0,0,1,1,Ni,jo,se),l.getError()?G=!1:(l.deleteFramebuffer(ne),l.deleteTexture($),G=se[0]===1),jt.freeType(se)}}var le=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ue=!0;if(!le){var ve=l.createTexture(),be=jt.allocType(Wu,36);l.activeTexture(V_),l.bindTexture(Xu,ve),l.texImage2D($_,0,Ni,3,3,0,Ni,Wu,be),jt.freeType(be),l.bindTexture(Xu,null),l.deleteTexture(ve),ue=!l.getError()}return{colorBits:[l.getParameter(p_),l.getParameter(m_),l.getParameter(y_),l.getParameter(__)],depthBits:l.getParameter(E_),stencilBits:l.getParameter(b_),subpixelBits:l.getParameter(v_),extensions:Object.keys(v).filter(function(ie){return!!v[ie]}),maxAnisotropic:T,maxDrawbuffers:B,maxColorAttachments:K,pointSizeDims:l.getParameter(g_),lineWidthDims:l.getParameter(T_),maxViewportDims:l.getParameter(S_),maxCombinedTextureUnits:l.getParameter(x_),maxCubeMapSize:l.getParameter(P_),maxRenderbufferSize:l.getParameter(L_),maxTextureUnits:l.getParameter(O_),maxTextureSize:l.getParameter(A_),maxAttributes:l.getParameter(w_),maxVertexUniforms:l.getParameter(R_),maxVertexTextureUnits:l.getParameter(N_),maxVaryingVectors:l.getParameter(C_),maxFragmentUniforms:l.getParameter(I_),glsl:l.getParameter(F_),renderer:l.getParameter(k_),vendor:l.getParameter(M_),version:l.getParameter(D_),readFloat:G,npotTextureCube:ue}};function Ir(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||r(l.data))}var gr=function(l){return Object.keys(l).map(function(v){return l[v]})},Na={shape:K_,flatten:q_};function W_(l,v,T){for(var B=0;B<v;++B)T[B]=l[B]}function Y_(l,v,T,B){for(var K=0,G=0;G<v;++G)for(var $=l[G],ne=0;ne<T;++ne)B[K++]=$[ne]}function Yu(l,v,T,B,K,G){for(var $=G,ne=0;ne<v;++ne)for(var se=l[ne],le=0;le<T;++le)for(var ue=se[le],ve=0;ve<B;++ve)K[$++]=ue[ve]}function qu(l,v,T,B,K){for(var G=1,$=T+1;$<v.length;++$)G*=v[$];var ne=v[T];if(v.length-T===4){var se=v[T+1],le=v[T+2],ue=v[T+3];for($=0;$<ne;++$)Yu(l[$],se,le,ue,B,K),K+=G}else for($=0;$<ne;++$)qu(l[$],v,T+1,B,K),K+=G}function q_(l,v,T,B){var K=1;if(v.length)for(var G=0;G<v.length;++G)K*=v[G];else K=0;var $=B||jt.allocType(T,K);switch(v.length){case 0:break;case 1:W_(l,v[0],$);break;case 2:Y_(l,v[0],v[1],$);break;case 3:Yu(l,v[0],v[1],v[2],$,0);break;default:qu(l,v,0,$,0)}return $}function K_(l){for(var v=[],T=l;T.length;T=T[0])v.push(T.length);return v}var Ho={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Q_=5120,Z_=5122,J_=5124,e0=5121,t0=5123,r0=5125,n0=5126,i0=5126,wn={int8:Q_,int16:Z_,int32:J_,uint8:e0,uint16:t0,uint32:r0,float:n0,float32:i0},a0=35048,o0=35040,Oa={dynamic:a0,stream:o0,static:35044},Xo=Na.flatten,Ku=Na.shape,Qu=35044,s0=35040,Wo=5121,Yo=5126,fn=[];fn[5120]=1,fn[5122]=2,fn[5124]=4,fn[5121]=1,fn[5123]=2,fn[5125]=4,fn[5126]=4;function Ia(l){return Ho[Object.prototype.toString.call(l)]|0}function Zu(l,v){for(var T=0;T<v.length;++T)l[T]=v[T]}function Ju(l,v,T,B,K,G,$){for(var ne=0,se=0;se<T;++se)for(var le=0;le<B;++le)l[ne++]=v[K*se+G*le+$]}function u0(l,v,T,B){var K=0,G={};function $(L){this.id=K++,this.buffer=l.createBuffer(),this.type=L,this.usage=Qu,this.byteLength=0,this.dimension=1,this.dtype=Wo,this.persistentData=null,T.profile&&(this.stats={size:0})}$.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},$.prototype.destroy=function(){be(this)};var ne=[];function se(L,V){var fe=ne.pop();return fe||(fe=new $(L)),fe.bind(),ve(fe,V,s0,0,1,!1),fe}function le(L){ne.push(L)}function ue(L,V,fe){L.byteLength=V.byteLength,l.bufferData(L.type,V,fe)}function ve(L,V,fe,Se,J,Re){var te;if(L.usage=fe,Array.isArray(V)){if(L.dtype=Se||Yo,V.length>0){var ye;if(Array.isArray(V[0])){te=Ku(V);for(var ee=1,_e=1;_e<te.length;++_e)ee*=te[_e];L.dimension=ee,ye=Xo(V,te,L.dtype),ue(L,ye,fe),Re?L.persistentData=ye:jt.freeType(ye)}else if(typeof V[0]=="number"){L.dimension=J;var ke=jt.allocType(L.dtype,V.length);Zu(ke,V),ue(L,ke,fe),Re?L.persistentData=ke:jt.freeType(ke)}else r(V[0])?(L.dimension=V[0].length,L.dtype=Se||Ia(V[0])||Yo,ye=Xo(V,[V.length,V[0].length],L.dtype),ue(L,ye,fe),Re?L.persistentData=ye:jt.freeType(ye)):y.raise("invalid buffer data")}}else if(r(V))L.dtype=Se||Ia(V),L.dimension=J,ue(L,V,fe),Re&&(L.persistentData=new Uint8Array(new Uint8Array(V.buffer)));else if(Ir(V)){te=V.shape;var qe=V.stride,ge=V.offset,de=0,Z=0,Xe=0,et=0;te.length===1?(de=te[0],Z=1,Xe=qe[0],et=0):te.length===2?(de=te[0],Z=te[1],Xe=qe[0],et=qe[1]):y.raise("invalid shape"),L.dtype=Se||Ia(V.data)||Yo,L.dimension=Z;var xe=jt.allocType(L.dtype,de*Z);Ju(xe,V.data,de,Z,Xe,et,ge),ue(L,xe,fe),Re?L.persistentData=xe:jt.freeType(xe)}else V instanceof ArrayBuffer?(L.dtype=Wo,L.dimension=J,ue(L,V,fe),Re&&(L.persistentData=new Uint8Array(new Uint8Array(V)))):y.raise("invalid buffer data")}function be(L){v.bufferCount--,B(L);var V=L.buffer;y(V,"buffer must not be deleted already"),l.deleteBuffer(V),L.buffer=null,delete G[L.id]}function ie(L,V,fe,Se){v.bufferCount++;var J=new $(V);G[J.id]=J;function Re(ee){var _e=Qu,ke=null,qe=0,ge=0,de=1;return Array.isArray(ee)||r(ee)||Ir(ee)||ee instanceof ArrayBuffer?ke=ee:typeof ee=="number"?qe=ee|0:ee&&(y.type(ee,"object","buffer arguments must be an object, a number or an array"),"data"in ee&&(y(ke===null||Array.isArray(ke)||r(ke)||Ir(ke),"invalid data for buffer"),ke=ee.data),"usage"in ee&&(y.parameter(ee.usage,Oa,"invalid buffer usage"),_e=Oa[ee.usage]),"type"in ee&&(y.parameter(ee.type,wn,"invalid buffer type"),ge=wn[ee.type]),"dimension"in ee&&(y.type(ee.dimension,"number","invalid dimension"),de=ee.dimension|0),"length"in ee&&(y.nni(qe,"buffer length must be a nonnegative integer"),qe=ee.length|0)),J.bind(),ke?ve(J,ke,_e,ge,de,Se):(qe&&l.bufferData(J.type,qe,_e),J.dtype=ge||Wo,J.usage=_e,J.dimension=de,J.byteLength=qe),T.profile&&(J.stats.size=J.byteLength*fn[J.dtype]),Re}function te(ee,_e){y(_e+ee.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ee.byteLength+" starting from offset "+_e+" to a buffer of size "+J.byteLength),l.bufferSubData(J.type,_e,ee)}function ye(ee,_e){var ke=(_e||0)|0,qe;if(J.bind(),r(ee)||ee instanceof ArrayBuffer)te(ee,ke);else if(Array.isArray(ee)){if(ee.length>0)if(typeof ee[0]=="number"){var ge=jt.allocType(J.dtype,ee.length);Zu(ge,ee),te(ge,ke),jt.freeType(ge)}else if(Array.isArray(ee[0])||r(ee[0])){qe=Ku(ee);var de=Xo(ee,qe,J.dtype);te(de,ke),jt.freeType(de)}else y.raise("invalid buffer data")}else if(Ir(ee)){qe=ee.shape;var Z=ee.stride,Xe=0,et=0,xe=0,ot=0;qe.length===1?(Xe=qe[0],et=1,xe=Z[0],ot=0):qe.length===2?(Xe=qe[0],et=qe[1],xe=Z[0],ot=Z[1]):y.raise("invalid shape");var Ke=Array.isArray(ee.data)?J.dtype:Ia(ee.data),it=jt.allocType(Ke,Xe*et);Ju(it,ee.data,Xe,et,xe,ot,ee.offset),te(it,ke),jt.freeType(it)}else y.raise("invalid data for buffer subdata");return Re}return fe||Re(L),Re._reglType="buffer",Re._buffer=J,Re.subdata=ye,T.profile&&(Re.stats=J.stats),Re.destroy=function(){be(J)},Re}function pe(){gr(G).forEach(function(L){L.buffer=l.createBuffer(),l.bindBuffer(L.type,L.buffer),l.bufferData(L.type,L.persistentData||L.byteLength,L.usage)})}return T.profile&&(v.getTotalBufferSize=function(){var L=0;return Object.keys(G).forEach(function(V){L+=G[V].stats.size}),L}),{create:ie,createStream:se,destroyStream:le,clear:function(){gr(G).forEach(be),ne.forEach(be)},getBuffer:function(L){return L&&L._buffer instanceof $?L._buffer:null},restore:pe,_initBuffer:ve}}var c0=0,f0=0,l0=1,d0=1,h0=4,v0=4,Zn={points:c0,point:f0,lines:l0,line:d0,triangles:h0,triangle:v0,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},p0=0,m0=1,Oi=4,y0=5120,Jn=5121,ec=5122,ei=5123,tc=5124,Rn=5125,qo=34963,_0=35040,E0=35044;function b0(l,v,T,B){var K={},G=0,$={uint8:Jn,uint16:ei};v.oes_element_index_uint&&($.uint32=Rn);function ne(pe){this.id=G++,K[this.id]=this,this.buffer=pe,this.primType=Oi,this.vertCount=0,this.type=0}ne.prototype.bind=function(){this.buffer.bind()};var se=[];function le(pe){var L=se.pop();return L||(L=new ne(T.create(null,qo,!0,!1)._buffer)),ve(L,pe,_0,-1,-1,0,0),L}function ue(pe){se.push(pe)}function ve(pe,L,V,fe,Se,J,Re){pe.buffer.bind();var te;if(L){var ye=Re;!Re&&(!r(L)||Ir(L)&&!r(L.data))&&(ye=v.oes_element_index_uint?Rn:ei),T._initBuffer(pe.buffer,L,V,ye,3)}else l.bufferData(qo,J,V),pe.buffer.dtype=te||Jn,pe.buffer.usage=V,pe.buffer.dimension=3,pe.buffer.byteLength=J;if(te=Re,!Re){switch(pe.buffer.dtype){case Jn:case y0:te=Jn;break;case ei:case ec:te=ei;break;case Rn:case tc:te=Rn;break;default:y.raise("unsupported type for element array")}pe.buffer.dtype=te}pe.type=te,y(te!==Rn||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ee=Se;ee<0&&(ee=pe.buffer.byteLength,te===ei?ee>>=1:te===Rn&&(ee>>=2)),pe.vertCount=ee;var _e=fe;if(fe<0){_e=Oi;var ke=pe.buffer.dimension;ke===1&&(_e=p0),ke===2&&(_e=m0),ke===3&&(_e=Oi)}pe.primType=_e}function be(pe){B.elementsCount--,y(pe.buffer!==null,"must not double destroy elements"),delete K[pe.id],pe.buffer.destroy(),pe.buffer=null}function ie(pe,L){var V=T.create(null,qo,!0),fe=new ne(V._buffer);B.elementsCount++;function Se(J){if(!J)V(),fe.primType=Oi,fe.vertCount=0,fe.type=Jn;else if(typeof J=="number")V(J),fe.primType=Oi,fe.vertCount=J|0,fe.type=Jn;else{var Re=null,te=E0,ye=-1,ee=-1,_e=0,ke=0;Array.isArray(J)||r(J)||Ir(J)?Re=J:(y.type(J,"object","invalid arguments for elements"),"data"in J&&(Re=J.data,y(Array.isArray(Re)||r(Re)||Ir(Re),"invalid data for element buffer")),"usage"in J&&(y.parameter(J.usage,Oa,"invalid element buffer usage"),te=Oa[J.usage]),"primitive"in J&&(y.parameter(J.primitive,Zn,"invalid element buffer primitive"),ye=Zn[J.primitive]),"count"in J&&(y(typeof J.count=="number"&&J.count>=0,"invalid vertex count for elements"),ee=J.count|0),"type"in J&&(y.parameter(J.type,$,"invalid buffer type"),ke=$[J.type]),"length"in J?_e=J.length|0:(_e=ee,ke===ei||ke===ec?_e*=2:(ke===Rn||ke===tc)&&(_e*=4))),ve(fe,Re,te,ye,ee,_e,ke)}return Se}return Se(pe),Se._reglType="elements",Se._elements=fe,Se.subdata=function(J,Re){return V.subdata(J,Re),Se},Se.destroy=function(){be(fe)},Se}return{create:ie,createStream:le,destroyStream:ue,getElements:function(pe){return typeof pe=="function"&&pe._elements instanceof ne?pe._elements:null},clear:function(){gr(K).forEach(be)}}}var rc=new Float32Array(1),g0=new Uint32Array(rc.buffer),T0=5123;function nc(l){for(var v=jt.allocType(T0,l.length),T=0;T<l.length;++T)if(isNaN(l[T]))v[T]=65535;else if(l[T]===1/0)v[T]=31744;else if(l[T]===-1/0)v[T]=64512;else{rc[0]=l[T];var B=g0[0],K=B>>>31<<15,G=(B<<1>>>24)-127,$=B>>13&(1<<10)-1;if(G<-24)v[T]=K;else if(G<-14){var ne=-14-G;v[T]=K+($+(1<<10)>>ne)}else G>15?v[T]=K+31744:v[T]=K+(G+15<<10)+$}return v}function Gt(l){return Array.isArray(l)||r(l)}var ic=function(l){return!(l&l-1)&&!!l},A0=34467,Dr=3553,Ko=34067,Pa=34069,Cn=6408,Qo=6406,La=6407,Ii=6409,Ma=6410,ac=32854,Zo=32855,oc=36194,S0=32819,w0=32820,R0=33635,C0=34042,Jo=6402,ka=34041,es=35904,ts=35906,ti=36193,rs=33776,ns=33777,is=33778,as=33779,sc=35986,uc=35987,cc=34798,fc=35840,lc=35841,dc=35842,hc=35843,vc=36196,ri=5121,os=5123,ss=5125,Pi=5126,x0=10242,N0=10243,O0=10497,us=33071,I0=33648,P0=10240,L0=10241,cs=9728,M0=9729,fs=9984,pc=9985,mc=9986,ls=9987,k0=33170,Da=4352,D0=4353,F0=4354,G0=34046,B0=3317,U0=37440,$0=37441,V0=37443,yc=37444,Li=33984,j0=[fs,mc,pc,ls],Fa=[0,Ii,Ma,La,Cn],Ar={};Ar[Ii]=Ar[Qo]=Ar[Jo]=1,Ar[ka]=Ar[Ma]=2,Ar[La]=Ar[es]=3,Ar[Cn]=Ar[ts]=4;function ni(l){return"[object "+l+"]"}var _c=ni("HTMLCanvasElement"),Ec=ni("OffscreenCanvas"),bc=ni("CanvasRenderingContext2D"),gc=ni("ImageBitmap"),Tc=ni("HTMLImageElement"),Ac=ni("HTMLVideoElement"),z0=Object.keys(Ho).concat([_c,Ec,bc,gc,Tc,Ac]),ii=[];ii[ri]=1,ii[Pi]=4,ii[ti]=2,ii[os]=2,ii[ss]=4;var rr=[];rr[ac]=2,rr[Zo]=2,rr[oc]=2,rr[ka]=4,rr[rs]=.5,rr[ns]=.5,rr[is]=1,rr[as]=1,rr[sc]=.5,rr[uc]=1,rr[cc]=1,rr[fc]=.5,rr[lc]=.25,rr[dc]=.5,rr[hc]=.25,rr[vc]=.5;function Sc(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function wc(l){if(!Array.isArray(l))return!1;var v=l.length;return!(v===0||!Gt(l[0]))}function xn(l){return Object.prototype.toString.call(l)}function Rc(l){return xn(l)===_c}function Cc(l){return xn(l)===Ec}function H0(l){return xn(l)===bc}function X0(l){return xn(l)===gc}function W0(l){return xn(l)===Tc}function Y0(l){return xn(l)===Ac}function ds(l){if(!l)return!1;var v=xn(l);return z0.indexOf(v)>=0?!0:Sc(l)||wc(l)||Ir(l)}function xc(l){return Ho[Object.prototype.toString.call(l)]|0}function q0(l,v){var T=v.length;switch(l.type){case ri:case os:case ss:case Pi:var B=jt.allocType(l.type,T);B.set(v),l.data=B;break;case ti:l.data=nc(v);break;default:y.raise("unsupported texture type, must specify a typed array")}}function Nc(l,v){return jt.allocType(l.type===ti?Pi:l.type,v)}function Oc(l,v){l.type===ti?(l.data=nc(v),jt.freeType(v)):l.data=v}function K0(l,v,T,B,K,G){for(var $=l.width,ne=l.height,se=l.channels,le=$*ne*se,ue=Nc(l,le),ve=0,be=0;be<ne;++be)for(var ie=0;ie<$;++ie)for(var pe=0;pe<se;++pe)ue[ve++]=v[T*ie+B*be+K*pe+G];Oc(l,ue)}function Ga(l,v,T,B,K,G){var $;if(typeof rr[l]<"u"?$=rr[l]:$=Ar[l]*ii[v],G&&($*=6),K){for(var ne=0,se=T;se>=1;)ne+=$*se*se,se/=2;return ne}else return $*T*B}function Q0(l,v,T,B,K,G,$){var ne={"don't care":Da,"dont care":Da,nice:F0,fast:D0},se={repeat:O0,clamp:us,mirror:I0},le={nearest:cs,linear:M0},ue=n({mipmap:ls,"nearest mipmap nearest":fs,"linear mipmap nearest":pc,"nearest mipmap linear":mc,"linear mipmap linear":ls},le),ve={none:0,browser:yc},be={uint8:ri,rgba4:S0,rgb565:R0,"rgb5 a1":w0},ie={alpha:Qo,luminance:Ii,"luminance alpha":Ma,rgb:La,rgba:Cn,rgba4:ac,"rgb5 a1":Zo,rgb565:oc},pe={};v.ext_srgb&&(ie.srgb=es,ie.srgba=ts),v.oes_texture_float&&(be.float32=be.float=Pi),v.oes_texture_half_float&&(be.float16=be["half float"]=ti),v.webgl_depth_texture&&(n(ie,{depth:Jo,"depth stencil":ka}),n(be,{uint16:os,uint32:ss,"depth stencil":C0})),v.webgl_compressed_texture_s3tc&&n(pe,{"rgb s3tc dxt1":rs,"rgba s3tc dxt1":ns,"rgba s3tc dxt3":is,"rgba s3tc dxt5":as}),v.webgl_compressed_texture_atc&&n(pe,{"rgb atc":sc,"rgba atc explicit alpha":uc,"rgba atc interpolated alpha":cc}),v.webgl_compressed_texture_pvrtc&&n(pe,{"rgb pvrtc 4bppv1":fc,"rgb pvrtc 2bppv1":lc,"rgba pvrtc 4bppv1":dc,"rgba pvrtc 2bppv1":hc}),v.webgl_compressed_texture_etc1&&(pe["rgb etc1"]=vc);var L=Array.prototype.slice.call(l.getParameter(A0));Object.keys(pe).forEach(function(g){var U=pe[g];L.indexOf(U)>=0&&(ie[g]=U)});var V=Object.keys(ie);T.textureFormats=V;var fe=[];Object.keys(ie).forEach(function(g){var U=ie[g];fe[U]=g});var Se=[];Object.keys(be).forEach(function(g){var U=be[g];Se[U]=g});var J=[];Object.keys(le).forEach(function(g){var U=le[g];J[U]=g});var Re=[];Object.keys(ue).forEach(function(g){var U=ue[g];Re[U]=g});var te=[];Object.keys(se).forEach(function(g){var U=se[g];te[U]=g});var ye=V.reduce(function(g,U){var F=ie[U];return F===Ii||F===Qo||F===Ii||F===Ma||F===Jo||F===ka||v.ext_srgb&&(F===es||F===ts)?g[F]=F:F===Zo||U.indexOf("rgba")>=0?g[F]=Cn:g[F]=La,g},{});function ee(){this.internalformat=Cn,this.format=Cn,this.type=ri,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yc,this.width=0,this.height=0,this.channels=0}function _e(g,U){g.internalformat=U.internalformat,g.format=U.format,g.type=U.type,g.compressed=U.compressed,g.premultiplyAlpha=U.premultiplyAlpha,g.flipY=U.flipY,g.unpackAlignment=U.unpackAlignment,g.colorSpace=U.colorSpace,g.width=U.width,g.height=U.height,g.channels=U.channels}function ke(g,U){if(!(typeof U!="object"||!U)){if("premultiplyAlpha"in U&&(y.type(U.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),g.premultiplyAlpha=U.premultiplyAlpha),"flipY"in U&&(y.type(U.flipY,"boolean","invalid texture flip"),g.flipY=U.flipY),"alignment"in U&&(y.oneOf(U.alignment,[1,2,4,8],"invalid texture unpack alignment"),g.unpackAlignment=U.alignment),"colorSpace"in U&&(y.parameter(U.colorSpace,ve,"invalid colorSpace"),g.colorSpace=ve[U.colorSpace]),"type"in U){var F=U.type;y(v.oes_texture_float||!(F==="float"||F==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),y(v.oes_texture_half_float||!(F==="half float"||F==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),y(v.webgl_depth_texture||!(F==="uint16"||F==="uint32"||F==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(F,be,"invalid texture type"),g.type=be[F]}var Ce=g.width,st=g.height,_=g.channels,h=!1;"shape"in U?(y(Array.isArray(U.shape)&&U.shape.length>=2,"shape must be an array"),Ce=U.shape[0],st=U.shape[1],U.shape.length===3&&(_=U.shape[2],y(_>0&&_<=4,"invalid number of channels"),h=!0),y(Ce>=0&&Ce<=T.maxTextureSize,"invalid width"),y(st>=0&&st<=T.maxTextureSize,"invalid height")):("radius"in U&&(Ce=st=U.radius,y(Ce>=0&&Ce<=T.maxTextureSize,"invalid radius")),"width"in U&&(Ce=U.width,y(Ce>=0&&Ce<=T.maxTextureSize,"invalid width")),"height"in U&&(st=U.height,y(st>=0&&st<=T.maxTextureSize,"invalid height")),"channels"in U&&(_=U.channels,y(_>0&&_<=4,"invalid number of channels"),h=!0)),g.width=Ce|0,g.height=st|0,g.channels=_|0;var w=!1;if("format"in U){var P=U.format;y(v.webgl_depth_texture||!(P==="depth"||P==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(P,ie,"invalid texture format");var k=g.internalformat=ie[P];g.format=ye[k],P in be&&("type"in U||(g.type=be[P])),P in pe&&(g.compressed=!0),w=!0}!h&&w?g.channels=Ar[g.format]:h&&!w?g.channels!==Fa[g.format]&&(g.format=g.internalformat=Fa[g.channels]):w&&h&&y(g.channels===Ar[g.format],"number of channels inconsistent with specified format")}}function qe(g){l.pixelStorei(U0,g.flipY),l.pixelStorei($0,g.premultiplyAlpha),l.pixelStorei(V0,g.colorSpace),l.pixelStorei(B0,g.unpackAlignment)}function ge(){ee.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function de(g,U){var F=null;if(ds(U)?F=U:U&&(y.type(U,"object","invalid pixel data type"),ke(g,U),"x"in U&&(g.xOffset=U.x|0),"y"in U&&(g.yOffset=U.y|0),ds(U.data)&&(F=U.data)),y(!g.compressed||F instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),U.copy){y(!F,"can not specify copy and data field for the same texture");var Ce=K.viewportWidth,st=K.viewportHeight;g.width=g.width||Ce-g.xOffset,g.height=g.height||st-g.yOffset,g.needsCopy=!0,y(g.xOffset>=0&&g.xOffset<Ce&&g.yOffset>=0&&g.yOffset<st&&g.width>0&&g.width<=Ce&&g.height>0&&g.height<=st,"copy texture read out of bounds")}else if(!F)g.width=g.width||1,g.height=g.height||1,g.channels=g.channels||4;else if(r(F))g.channels=g.channels||4,g.data=F,!("type"in U)&&g.type===ri&&(g.type=xc(F));else if(Sc(F))g.channels=g.channels||4,q0(g,F),g.alignment=1,g.needsFree=!0;else if(Ir(F)){var _=F.data;!Array.isArray(_)&&g.type===ri&&(g.type=xc(_));var h=F.shape,w=F.stride,P,k,C,R,O,E;h.length===3?(C=h[2],E=w[2]):(y(h.length===2,"invalid ndarray pixel data, must be 2 or 3D"),C=1,E=1),P=h[0],k=h[1],R=w[0],O=w[1],g.alignment=1,g.width=P,g.height=k,g.channels=C,g.format=g.internalformat=Fa[C],g.needsFree=!0,K0(g,_,R,O,E,F.offset)}else if(Rc(F)||Cc(F)||H0(F))Rc(F)||Cc(F)?g.element=F:g.element=F.canvas,g.width=g.element.width,g.height=g.element.height,g.channels=4;else if(X0(F))g.element=F,g.width=F.width,g.height=F.height,g.channels=4;else if(W0(F))g.element=F,g.width=F.naturalWidth,g.height=F.naturalHeight,g.channels=4;else if(Y0(F))g.element=F,g.width=F.videoWidth,g.height=F.videoHeight,g.channels=4;else if(wc(F)){var S=g.width||F[0].length,m=g.height||F.length,I=g.channels;Gt(F[0][0])?I=I||F[0][0].length:I=I||1;for(var D=Na.shape(F),Y=1,Q=0;Q<D.length;++Q)Y*=D[Q];var z=Nc(g,Y);Na.flatten(F,D,"",z),Oc(g,z),g.alignment=1,g.width=S,g.height=m,g.channels=I,g.format=g.internalformat=Fa[I],g.needsFree=!0}g.type===Pi?y(T.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):g.type===ti&&y(T.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Z(g,U,F){var Ce=g.element,st=g.data,_=g.internalformat,h=g.format,w=g.type,P=g.width,k=g.height;qe(g),Ce?l.texImage2D(U,F,h,h,w,Ce):g.compressed?l.compressedTexImage2D(U,F,_,P,k,0,st):g.needsCopy?(B(),l.copyTexImage2D(U,F,h,g.xOffset,g.yOffset,P,k,0)):l.texImage2D(U,F,h,P,k,0,h,w,st||null)}function Xe(g,U,F,Ce,st){var _=g.element,h=g.data,w=g.internalformat,P=g.format,k=g.type,C=g.width,R=g.height;qe(g),_?l.texSubImage2D(U,st,F,Ce,P,k,_):g.compressed?l.compressedTexSubImage2D(U,st,F,Ce,w,C,R,h):g.needsCopy?(B(),l.copyTexSubImage2D(U,st,F,Ce,g.xOffset,g.yOffset,C,R)):l.texSubImage2D(U,st,F,Ce,C,R,P,k,h)}var et=[];function xe(){return et.pop()||new ge}function ot(g){g.needsFree&&jt.freeType(g.data),ge.call(g),et.push(g)}function Ke(){ee.call(this),this.genMipmaps=!1,this.mipmapHint=Da,this.mipmask=0,this.images=Array(16)}function it(g,U,F){var Ce=g.images[0]=xe();g.mipmask=1,Ce.width=g.width=U,Ce.height=g.height=F,Ce.channels=g.channels=4}function _t(g,U){var F=null;if(ds(U))F=g.images[0]=xe(),_e(F,g),de(F,U),g.mipmask=1;else if(ke(g,U),Array.isArray(U.mipmap))for(var Ce=U.mipmap,st=0;st<Ce.length;++st)F=g.images[st]=xe(),_e(F,g),F.width>>=st,F.height>>=st,de(F,Ce[st]),g.mipmask|=1<<st;else F=g.images[0]=xe(),_e(F,g),de(F,U),g.mipmask=1;_e(g,g.images[0]),g.compressed&&(g.internalformat===rs||g.internalformat===ns||g.internalformat===is||g.internalformat===as)&&y(g.width%4===0&&g.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ht(g,U){for(var F=g.images,Ce=0;Ce<F.length;++Ce){if(!F[Ce])return;Z(F[Ce],U,Ce)}}var Jt=[];function lt(){var g=Jt.pop()||new Ke;ee.call(g),g.mipmask=0;for(var U=0;U<16;++U)g.images[U]=null;return g}function Wt(g){for(var U=g.images,F=0;F<U.length;++F)U[F]&&ot(U[F]),U[F]=null;Jt.push(g)}function It(){this.minFilter=cs,this.magFilter=cs,this.wrapS=us,this.wrapT=us,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Da}function Xt(g,U){if("min"in U){var F=U.min;y.parameter(F,ue),g.minFilter=ue[F],j0.indexOf(g.minFilter)>=0&&!("faces"in U)&&(g.genMipmaps=!0)}if("mag"in U){var Ce=U.mag;y.parameter(Ce,le),g.magFilter=le[Ce]}var st=g.wrapS,_=g.wrapT;if("wrap"in U){var h=U.wrap;typeof h=="string"?(y.parameter(h,se),st=_=se[h]):Array.isArray(h)&&(y.parameter(h[0],se),y.parameter(h[1],se),st=se[h[0]],_=se[h[1]])}else{if("wrapS"in U){var w=U.wrapS;y.parameter(w,se),st=se[w]}if("wrapT"in U){var P=U.wrapT;y.parameter(P,se),_=se[P]}}if(g.wrapS=st,g.wrapT=_,"anisotropic"in U){var k=U.anisotropic;y(typeof k=="number"&&k>=1&&k<=T.maxAnisotropic,"aniso samples must be between 1 and "),g.anisotropic=U.anisotropic}if("mipmap"in U){var C=!1;switch(typeof U.mipmap){case"string":y.parameter(U.mipmap,ne,"invalid mipmap hint"),g.mipmapHint=ne[U.mipmap],g.genMipmaps=!0,C=!0;break;case"boolean":C=g.genMipmaps=U.mipmap;break;case"object":y(Array.isArray(U.mipmap),"invalid mipmap type"),g.genMipmaps=!1,C=!0;break;default:y.raise("invalid mipmap type")}C&&!("min"in U)&&(g.minFilter=fs)}}function Yt(g,U){l.texParameteri(U,L0,g.minFilter),l.texParameteri(U,P0,g.magFilter),l.texParameteri(U,x0,g.wrapS),l.texParameteri(U,N0,g.wrapT),v.ext_texture_filter_anisotropic&&l.texParameteri(U,G0,g.anisotropic),g.genMipmaps&&(l.hint(k0,g.mipmapHint),l.generateMipmap(U))}var qt=0,er={},nr=T.maxTextureUnits,Bt=Array(nr).map(function(){return null});function tt(g){ee.call(this),this.mipmask=0,this.internalformat=Cn,this.id=qt++,this.refCount=1,this.target=g,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new It,$.profile&&(this.stats={size:0})}function ir(g){l.activeTexture(Li),l.bindTexture(g.target,g.texture)}function gt(){var g=Bt[0];g?l.bindTexture(g.target,g.texture):l.bindTexture(Dr,null)}function Be(g){var U=g.texture;y(U,"must not double destroy texture");var F=g.unit,Ce=g.target;F>=0&&(l.activeTexture(Li+F),l.bindTexture(Ce,null),Bt[F]=null),l.deleteTexture(U),g.texture=null,g.params=null,g.pixels=null,g.refCount=0,delete er[g.id],G.textureCount--}n(tt.prototype,{bind:function(){var g=this;g.bindCount+=1;var U=g.unit;if(U<0){for(var F=0;F<nr;++F){var Ce=Bt[F];if(Ce){if(Ce.bindCount>0)continue;Ce.unit=-1}Bt[F]=g,U=F;break}U>=nr&&y.raise("insufficient number of texture units"),$.profile&&G.maxTextureUnits<U+1&&(G.maxTextureUnits=U+1),g.unit=U,l.activeTexture(Li+U),l.bindTexture(g.target,g.texture)}return U},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Be(this)}});function ut(g,U){var F=new tt(Dr);er[F.id]=F,G.textureCount++;function Ce(h,w){var P=F.texInfo;It.call(P);var k=lt();return typeof h=="number"?typeof w=="number"?it(k,h|0,w|0):it(k,h|0,h|0):h?(y.type(h,"object","invalid arguments to regl.texture"),Xt(P,h),_t(k,h)):it(k,1,1),P.genMipmaps&&(k.mipmask=(k.width<<1)-1),F.mipmask=k.mipmask,_e(F,k),y.texture2D(P,k,T),F.internalformat=k.internalformat,Ce.width=k.width,Ce.height=k.height,ir(F),Ht(k,Dr),Yt(P,Dr),gt(),Wt(k),$.profile&&(F.stats.size=Ga(F.internalformat,F.type,k.width,k.height,P.genMipmaps,!1)),Ce.format=fe[F.internalformat],Ce.type=Se[F.type],Ce.mag=J[P.magFilter],Ce.min=Re[P.minFilter],Ce.wrapS=te[P.wrapS],Ce.wrapT=te[P.wrapT],Ce}function st(h,w,P,k){y(!!h,"must specify image data");var C=w|0,R=P|0,O=k|0,E=xe();return _e(E,F),E.width=0,E.height=0,de(E,h),E.width=E.width||(F.width>>O)-C,E.height=E.height||(F.height>>O)-R,y(F.type===E.type&&F.format===E.format&&F.internalformat===E.internalformat,"incompatible format for texture.subimage"),y(C>=0&&R>=0&&C+E.width<=F.width&&R+E.height<=F.height,"texture.subimage write out of bounds"),y(F.mipmask&1<<O,"missing mipmap data"),y(E.data||E.element||E.needsCopy,"missing image data"),ir(F),Xe(E,Dr,C,R,O),gt(),ot(E),Ce}function _(h,w){var P=h|0,k=w|0||P;if(P===F.width&&k===F.height)return Ce;Ce.width=F.width=P,Ce.height=F.height=k,ir(F);for(var C=0;F.mipmask>>C;++C){var R=P>>C,O=k>>C;if(!R||!O)break;l.texImage2D(Dr,C,F.format,R,O,0,F.format,F.type,null)}return gt(),$.profile&&(F.stats.size=Ga(F.internalformat,F.type,P,k,!1,!1)),Ce}return Ce(g,U),Ce.subimage=st,Ce.resize=_,Ce._reglType="texture2d",Ce._texture=F,$.profile&&(Ce.stats=F.stats),Ce.destroy=function(){F.decRef()},Ce}function yt(g,U,F,Ce,st,_){var h=new tt(Ko);er[h.id]=h,G.cubeCount++;var w=new Array(6);function P(R,O,E,S,m,I){var D,Y=h.texInfo;for(It.call(Y),D=0;D<6;++D)w[D]=lt();if(typeof R=="number"||!R){var Q=R|0||1;for(D=0;D<6;++D)it(w[D],Q,Q)}else if(typeof R=="object")if(O)_t(w[0],R),_t(w[1],O),_t(w[2],E),_t(w[3],S),_t(w[4],m),_t(w[5],I);else if(Xt(Y,R),ke(h,R),"faces"in R){var z=R.faces;for(y(Array.isArray(z)&&z.length===6,"cube faces must be a length 6 array"),D=0;D<6;++D)y(typeof z[D]=="object"&&!!z[D],"invalid input for cube map face"),_e(w[D],h),_t(w[D],z[D])}else for(D=0;D<6;++D)_t(w[D],R);else y.raise("invalid arguments to cube map");for(_e(h,w[0]),T.npotTextureCube||y(ic(h.width)&&ic(h.height),"your browser does not support non power or two texture dimensions"),Y.genMipmaps?h.mipmask=(w[0].width<<1)-1:h.mipmask=w[0].mipmask,y.textureCube(h,Y,w,T),h.internalformat=w[0].internalformat,P.width=w[0].width,P.height=w[0].height,ir(h),D=0;D<6;++D)Ht(w[D],Pa+D);for(Yt(Y,Ko),gt(),$.profile&&(h.stats.size=Ga(h.internalformat,h.type,P.width,P.height,Y.genMipmaps,!0)),P.format=fe[h.internalformat],P.type=Se[h.type],P.mag=J[Y.magFilter],P.min=Re[Y.minFilter],P.wrapS=te[Y.wrapS],P.wrapT=te[Y.wrapT],D=0;D<6;++D)Wt(w[D]);return P}function k(R,O,E,S,m){y(!!O,"must specify image data"),y(typeof R=="number"&&R===(R|0)&&R>=0&&R<6,"invalid face");var I=E|0,D=S|0,Y=m|0,Q=xe();return _e(Q,h),Q.width=0,Q.height=0,de(Q,O),Q.width=Q.width||(h.width>>Y)-I,Q.height=Q.height||(h.height>>Y)-D,y(h.type===Q.type&&h.format===Q.format&&h.internalformat===Q.internalformat,"incompatible format for texture.subimage"),y(I>=0&&D>=0&&I+Q.width<=h.width&&D+Q.height<=h.height,"texture.subimage write out of bounds"),y(h.mipmask&1<<Y,"missing mipmap data"),y(Q.data||Q.element||Q.needsCopy,"missing image data"),ir(h),Xe(Q,Pa+R,I,D,Y),gt(),ot(Q),P}function C(R){var O=R|0;if(O!==h.width){P.width=h.width=O,P.height=h.height=O,ir(h);for(var E=0;E<6;++E)for(var S=0;h.mipmask>>S;++S)l.texImage2D(Pa+E,S,h.format,O>>S,O>>S,0,h.format,h.type,null);return gt(),$.profile&&(h.stats.size=Ga(h.internalformat,h.type,P.width,P.height,!1,!0)),P}}return P(g,U,F,Ce,st,_),P.subimage=k,P.resize=C,P._reglType="textureCube",P._texture=h,$.profile&&(P.stats=h.stats),P.destroy=function(){h.decRef()},P}function Ut(){for(var g=0;g<nr;++g)l.activeTexture(Li+g),l.bindTexture(Dr,null),Bt[g]=null;gr(er).forEach(Be),G.cubeCount=0,G.textureCount=0}$.profile&&(G.getTotalTextureSize=function(){var g=0;return Object.keys(er).forEach(function(U){g+=er[U].stats.size}),g});function Gr(){for(var g=0;g<nr;++g){var U=Bt[g];U&&(U.bindCount=0,U.unit=-1,Bt[g]=null)}gr(er).forEach(function(F){F.texture=l.createTexture(),l.bindTexture(F.target,F.texture);for(var Ce=0;Ce<32;++Ce)if((F.mipmask&1<<Ce)!==0)if(F.target===Dr)l.texImage2D(Dr,Ce,F.internalformat,F.width>>Ce,F.height>>Ce,0,F.internalformat,F.type,null);else for(var st=0;st<6;++st)l.texImage2D(Pa+st,Ce,F.internalformat,F.width>>Ce,F.height>>Ce,0,F.internalformat,F.type,null);Yt(F.texInfo,F.target)})}function kn(){for(var g=0;g<nr;++g){var U=Bt[g];U&&(U.bindCount=0,U.unit=-1,Bt[g]=null),l.activeTexture(Li+g),l.bindTexture(Dr,null),l.bindTexture(Ko,null)}}return{create2D:ut,createCube:yt,clear:Ut,getTexture:function(g){return null},restore:Gr,refresh:kn}}var ln=36161,Ba=32854,Ic=32855,Pc=36194,Lc=33189,Mc=36168,kc=34041,Dc=35907,Fc=34836,Gc=34842,Bc=34843,Pr=[];Pr[Ba]=2,Pr[Ic]=2,Pr[Pc]=2,Pr[Lc]=2,Pr[Mc]=1,Pr[kc]=4,Pr[Dc]=4,Pr[Fc]=16,Pr[Gc]=8,Pr[Bc]=6;function Uc(l,v,T){return Pr[l]*v*T}var Z0=function(l,v,T,B,K){var G={rgba4:Ba,rgb565:Pc,"rgb5 a1":Ic,depth:Lc,stencil:Mc,"depth stencil":kc};v.ext_srgb&&(G.srgba=Dc),v.ext_color_buffer_half_float&&(G.rgba16f=Gc,G.rgb16f=Bc),v.webgl_color_buffer_float&&(G.rgba32f=Fc);var $=[];Object.keys(G).forEach(function(ie){var pe=G[ie];$[pe]=ie});var ne=0,se={};function le(ie){this.id=ne++,this.refCount=1,this.renderbuffer=ie,this.format=Ba,this.width=0,this.height=0,K.profile&&(this.stats={size:0})}le.prototype.decRef=function(){--this.refCount<=0&&ue(this)};function ue(ie){var pe=ie.renderbuffer;y(pe,"must not double destroy renderbuffer"),l.bindRenderbuffer(ln,null),l.deleteRenderbuffer(pe),ie.renderbuffer=null,ie.refCount=0,delete se[ie.id],B.renderbufferCount--}function ve(ie,pe){var L=new le(l.createRenderbuffer());se[L.id]=L,B.renderbufferCount++;function V(Se,J){var Re=0,te=0,ye=Ba;if(typeof Se=="object"&&Se){var ee=Se;if("shape"in ee){var _e=ee.shape;y(Array.isArray(_e)&&_e.length>=2,"invalid renderbuffer shape"),Re=_e[0]|0,te=_e[1]|0}else"radius"in ee&&(Re=te=ee.radius|0),"width"in ee&&(Re=ee.width|0),"height"in ee&&(te=ee.height|0);"format"in ee&&(y.parameter(ee.format,G,"invalid renderbuffer format"),ye=G[ee.format])}else typeof Se=="number"?(Re=Se|0,typeof J=="number"?te=J|0:te=Re):Se?y.raise("invalid arguments to renderbuffer constructor"):Re=te=1;if(y(Re>0&&te>0&&Re<=T.maxRenderbufferSize&&te<=T.maxRenderbufferSize,"invalid renderbuffer size"),!(Re===L.width&&te===L.height&&ye===L.format))return V.width=L.width=Re,V.height=L.height=te,L.format=ye,l.bindRenderbuffer(ln,L.renderbuffer),l.renderbufferStorage(ln,ye,Re,te),y(l.getError()===0,"invalid render buffer format"),K.profile&&(L.stats.size=Uc(L.format,L.width,L.height)),V.format=$[L.format],V}function fe(Se,J){var Re=Se|0,te=J|0||Re;return Re===L.width&&te===L.height||(y(Re>0&&te>0&&Re<=T.maxRenderbufferSize&&te<=T.maxRenderbufferSize,"invalid renderbuffer size"),V.width=L.width=Re,V.height=L.height=te,l.bindRenderbuffer(ln,L.renderbuffer),l.renderbufferStorage(ln,L.format,Re,te),y(l.getError()===0,"invalid render buffer format"),K.profile&&(L.stats.size=Uc(L.format,L.width,L.height))),V}return V(ie,pe),V.resize=fe,V._reglType="renderbuffer",V._renderbuffer=L,K.profile&&(V.stats=L.stats),V.destroy=function(){L.decRef()},V}K.profile&&(B.getTotalRenderbufferSize=function(){var ie=0;return Object.keys(se).forEach(function(pe){ie+=se[pe].stats.size}),ie});function be(){gr(se).forEach(function(ie){ie.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(ln,ie.renderbuffer),l.renderbufferStorage(ln,ie.format,ie.width,ie.height)}),l.bindRenderbuffer(ln,null)}return{create:ve,clear:function(){gr(se).forEach(ue)},restore:be}},qr=36160,hs=36161,Nn=3553,Ua=34069,$c=36064,Vc=36096,jc=36128,zc=33306,Hc=36053,J0=36054,eE=36055,tE=36057,rE=36061,nE=36193,iE=5121,aE=5126,Xc=6407,Wc=6408,oE=6402,sE=[Xc,Wc],vs=[];vs[Wc]=4,vs[Xc]=3;var $a=[];$a[iE]=1,$a[aE]=4,$a[nE]=2;var uE=32854,cE=32855,fE=36194,lE=33189,dE=36168,Yc=34041,hE=35907,vE=34836,pE=34842,mE=34843,yE=[uE,cE,fE,hE,pE,mE,vE],ai={};ai[Hc]="complete",ai[J0]="incomplete attachment",ai[tE]="incomplete dimensions",ai[eE]="incomplete, missing attachment",ai[rE]="unsupported";function _E(l,v,T,B,K,G){var $={cur:null,next:null,dirty:!1,setFBO:null},ne=["rgba"],se=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&se.push("srgba"),v.ext_color_buffer_half_float&&se.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&se.push("rgba32f");var le=["uint8"];v.oes_texture_half_float&&le.push("half float","float16"),v.oes_texture_float&&le.push("float","float32");function ue(ge,de,Z){this.target=ge,this.texture=de,this.renderbuffer=Z;var Xe=0,et=0;de?(Xe=de.width,et=de.height):Z&&(Xe=Z.width,et=Z.height),this.width=Xe,this.height=et}function ve(ge){ge&&(ge.texture&&ge.texture._texture.decRef(),ge.renderbuffer&&ge.renderbuffer._renderbuffer.decRef())}function be(ge,de,Z){if(!!ge)if(ge.texture){var Xe=ge.texture._texture,et=Math.max(1,Xe.width),xe=Math.max(1,Xe.height);y(et===de&&xe===Z,"inconsistent width/height for supplied texture"),Xe.refCount+=1}else{var ot=ge.renderbuffer._renderbuffer;y(ot.width===de&&ot.height===Z,"inconsistent width/height for renderbuffer"),ot.refCount+=1}}function ie(ge,de){de&&(de.texture?l.framebufferTexture2D(qr,ge,de.target,de.texture._texture.texture,0):l.framebufferRenderbuffer(qr,ge,hs,de.renderbuffer._renderbuffer.renderbuffer))}function pe(ge){var de=Nn,Z=null,Xe=null,et=ge;typeof ge=="object"&&(et=ge.data,"target"in ge&&(de=ge.target|0)),y.type(et,"function","invalid attachment data");var xe=et._reglType;return xe==="texture2d"?(Z=et,y(de===Nn)):xe==="textureCube"?(Z=et,y(de>=Ua&&de<Ua+6,"invalid cube map target")):xe==="renderbuffer"?(Xe=et,de=hs):y.raise("invalid regl object for attachment"),new ue(de,Z,Xe)}function L(ge,de,Z,Xe,et){if(Z){var xe=B.create2D({width:ge,height:de,format:Xe,type:et});return xe._texture.refCount=0,new ue(Nn,xe,null)}else{var ot=K.create({width:ge,height:de,format:Xe});return ot._renderbuffer.refCount=0,new ue(hs,null,ot)}}function V(ge){return ge&&(ge.texture||ge.renderbuffer)}function fe(ge,de,Z){ge&&(ge.texture?ge.texture.resize(de,Z):ge.renderbuffer&&ge.renderbuffer.resize(de,Z),ge.width=de,ge.height=Z)}var Se=0,J={};function Re(){this.id=Se++,J[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function te(ge){ge.colorAttachments.forEach(ve),ve(ge.depthAttachment),ve(ge.stencilAttachment),ve(ge.depthStencilAttachment)}function ye(ge){var de=ge.framebuffer;y(de,"must not double destroy framebuffer"),l.deleteFramebuffer(de),ge.framebuffer=null,G.framebufferCount--,delete J[ge.id]}function ee(ge){var de;l.bindFramebuffer(qr,ge.framebuffer);var Z=ge.colorAttachments;for(de=0;de<Z.length;++de)ie($c+de,Z[de]);for(de=Z.length;de<T.maxColorAttachments;++de)l.framebufferTexture2D(qr,$c+de,Nn,null,0);l.framebufferTexture2D(qr,zc,Nn,null,0),l.framebufferTexture2D(qr,Vc,Nn,null,0),l.framebufferTexture2D(qr,jc,Nn,null,0),ie(Vc,ge.depthAttachment),ie(jc,ge.stencilAttachment),ie(zc,ge.depthStencilAttachment);var Xe=l.checkFramebufferStatus(qr);!l.isContextLost()&&Xe!==Hc&&y.raise("framebuffer configuration not supported, status = "+ai[Xe]),l.bindFramebuffer(qr,$.next?$.next.framebuffer:null),$.cur=$.next,l.getError()}function _e(ge,de){var Z=new Re;G.framebufferCount++;function Xe(xe,ot){var Ke;y($.next!==Z,"can not update framebuffer which is currently in use");var it=0,_t=0,Ht=!0,Jt=!0,lt=null,Wt=!0,It="rgba",Xt="uint8",Yt=1,qt=null,er=null,nr=null,Bt=!1;if(typeof xe=="number")it=xe|0,_t=ot|0||it;else if(!xe)it=_t=1;else{y.type(xe,"object","invalid arguments for framebuffer");var tt=xe;if("shape"in tt){var ir=tt.shape;y(Array.isArray(ir)&&ir.length>=2,"invalid shape for framebuffer"),it=ir[0],_t=ir[1]}else"radius"in tt&&(it=_t=tt.radius),"width"in tt&&(it=tt.width),"height"in tt&&(_t=tt.height);("color"in tt||"colors"in tt)&&(lt=tt.color||tt.colors,Array.isArray(lt)&&y(lt.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),lt||("colorCount"in tt&&(Yt=tt.colorCount|0,y(Yt>0,"invalid color buffer count")),"colorTexture"in tt&&(Wt=!!tt.colorTexture,It="rgba4"),"colorType"in tt&&(Xt=tt.colorType,Wt?(y(v.oes_texture_float||!(Xt==="float"||Xt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),y(v.oes_texture_half_float||!(Xt==="half float"||Xt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Xt==="half float"||Xt==="float16"?(y(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),It="rgba16f"):(Xt==="float"||Xt==="float32")&&(y(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),It="rgba32f"),y.oneOf(Xt,le,"invalid color type")),"colorFormat"in tt&&(It=tt.colorFormat,ne.indexOf(It)>=0?Wt=!0:se.indexOf(It)>=0?Wt=!1:Wt?y.oneOf(tt.colorFormat,ne,"invalid color format for texture"):y.oneOf(tt.colorFormat,se,"invalid color format for renderbuffer"))),("depthTexture"in tt||"depthStencilTexture"in tt)&&(Bt=!!(tt.depthTexture||tt.depthStencilTexture),y(!Bt||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in tt&&(typeof tt.depth=="boolean"?Ht=tt.depth:(qt=tt.depth,Jt=!1)),"stencil"in tt&&(typeof tt.stencil=="boolean"?Jt=tt.stencil:(er=tt.stencil,Ht=!1)),"depthStencil"in tt&&(typeof tt.depthStencil=="boolean"?Ht=Jt=tt.depthStencil:(nr=tt.depthStencil,Ht=!1,Jt=!1))}var gt=null,Be=null,ut=null,yt=null;if(Array.isArray(lt))gt=lt.map(pe);else if(lt)gt=[pe(lt)];else for(gt=new Array(Yt),Ke=0;Ke<Yt;++Ke)gt[Ke]=L(it,_t,Wt,It,Xt);y(v.webgl_draw_buffers||gt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),y(gt.length<=T.maxColorAttachments,"too many color attachments, not supported"),it=it||gt[0].width,_t=_t||gt[0].height,qt?Be=pe(qt):Ht&&!Jt&&(Be=L(it,_t,Bt,"depth","uint32")),er?ut=pe(er):Jt&&!Ht&&(ut=L(it,_t,!1,"stencil","uint8")),nr?yt=pe(nr):!qt&&!er&&Jt&&Ht&&(yt=L(it,_t,Bt,"depth stencil","depth stencil")),y(!!qt+!!er+!!nr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ut=null;for(Ke=0;Ke<gt.length;++Ke)if(be(gt[Ke],it,_t),y(!gt[Ke]||gt[Ke].texture&&sE.indexOf(gt[Ke].texture._texture.format)>=0||gt[Ke].renderbuffer&&yE.indexOf(gt[Ke].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ke+" is invalid"),gt[Ke]&&gt[Ke].texture){var Gr=vs[gt[Ke].texture._texture.format]*$a[gt[Ke].texture._texture.type];Ut===null?Ut=Gr:y(Ut===Gr,"all color attachments much have the same number of bits per pixel.")}return be(Be,it,_t),y(!Be||Be.texture&&Be.texture._texture.format===oE||Be.renderbuffer&&Be.renderbuffer._renderbuffer.format===lE,"invalid depth attachment for framebuffer object"),be(ut,it,_t),y(!ut||ut.renderbuffer&&ut.renderbuffer._renderbuffer.format===dE,"invalid stencil attachment for framebuffer object"),be(yt,it,_t),y(!yt||yt.texture&&yt.texture._texture.format===Yc||yt.renderbuffer&&yt.renderbuffer._renderbuffer.format===Yc,"invalid depth-stencil attachment for framebuffer object"),te(Z),Z.width=it,Z.height=_t,Z.colorAttachments=gt,Z.depthAttachment=Be,Z.stencilAttachment=ut,Z.depthStencilAttachment=yt,Xe.color=gt.map(V),Xe.depth=V(Be),Xe.stencil=V(ut),Xe.depthStencil=V(yt),Xe.width=Z.width,Xe.height=Z.height,ee(Z),Xe}function et(xe,ot){y($.next!==Z,"can not resize a framebuffer which is currently in use");var Ke=Math.max(xe|0,1),it=Math.max(ot|0||Ke,1);if(Ke===Z.width&&it===Z.height)return Xe;for(var _t=Z.colorAttachments,Ht=0;Ht<_t.length;++Ht)fe(_t[Ht],Ke,it);return fe(Z.depthAttachment,Ke,it),fe(Z.stencilAttachment,Ke,it),fe(Z.depthStencilAttachment,Ke,it),Z.width=Xe.width=Ke,Z.height=Xe.height=it,ee(Z),Xe}return Xe(ge,de),n(Xe,{resize:et,_reglType:"framebuffer",_framebuffer:Z,destroy:function(){ye(Z),te(Z)},use:function(xe){$.setFBO({framebuffer:Xe},xe)}})}function ke(ge){var de=Array(6);function Z(et){var xe;y(de.indexOf($.next)<0,"can not update framebuffer which is currently in use");var ot={color:null},Ke=0,it=null,_t="rgba",Ht="uint8",Jt=1;if(typeof et=="number")Ke=et|0;else if(!et)Ke=1;else{y.type(et,"object","invalid arguments for framebuffer");var lt=et;if("shape"in lt){var Wt=lt.shape;y(Array.isArray(Wt)&&Wt.length>=2,"invalid shape for framebuffer"),y(Wt[0]===Wt[1],"cube framebuffer must be square"),Ke=Wt[0]}else"radius"in lt&&(Ke=lt.radius|0),"width"in lt?(Ke=lt.width|0,"height"in lt&&y(lt.height===Ke,"must be square")):"height"in lt&&(Ke=lt.height|0);("color"in lt||"colors"in lt)&&(it=lt.color||lt.colors,Array.isArray(it)&&y(it.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),it||("colorCount"in lt&&(Jt=lt.colorCount|0,y(Jt>0,"invalid color buffer count")),"colorType"in lt&&(y.oneOf(lt.colorType,le,"invalid color type"),Ht=lt.colorType),"colorFormat"in lt&&(_t=lt.colorFormat,y.oneOf(lt.colorFormat,ne,"invalid color format for texture"))),"depth"in lt&&(ot.depth=lt.depth),"stencil"in lt&&(ot.stencil=lt.stencil),"depthStencil"in lt&&(ot.depthStencil=lt.depthStencil)}var It;if(it)if(Array.isArray(it))for(It=[],xe=0;xe<it.length;++xe)It[xe]=it[xe];else It=[it];else{It=Array(Jt);var Xt={radius:Ke,format:_t,type:Ht};for(xe=0;xe<Jt;++xe)It[xe]=B.createCube(Xt)}for(ot.color=Array(It.length),xe=0;xe<It.length;++xe){var Yt=It[xe];y(typeof Yt=="function"&&Yt._reglType==="textureCube","invalid cube map"),Ke=Ke||Yt.width,y(Yt.width===Ke&&Yt.height===Ke,"invalid cube map shape"),ot.color[xe]={target:Ua,data:It[xe]}}for(xe=0;xe<6;++xe){for(var qt=0;qt<It.length;++qt)ot.color[qt].target=Ua+xe;xe>0&&(ot.depth=de[0].depth,ot.stencil=de[0].stencil,ot.depthStencil=de[0].depthStencil),de[xe]?de[xe](ot):de[xe]=_e(ot)}return n(Z,{width:Ke,height:Ke,color:It})}function Xe(et){var xe,ot=et|0;if(y(ot>0&&ot<=T.maxCubeMapSize,"invalid radius for cube fbo"),ot===Z.width)return Z;var Ke=Z.color;for(xe=0;xe<Ke.length;++xe)Ke[xe].resize(ot);for(xe=0;xe<6;++xe)de[xe].resize(ot);return Z.width=Z.height=ot,Z}return Z(ge),n(Z,{faces:de,resize:Xe,_reglType:"framebufferCube",destroy:function(){de.forEach(function(et){et.destroy()})}})}function qe(){$.cur=null,$.next=null,$.dirty=!0,gr(J).forEach(function(ge){ge.framebuffer=l.createFramebuffer(),ee(ge)})}return n($,{getFramebuffer:function(ge){if(typeof ge=="function"&&ge._reglType==="framebuffer"){var de=ge._framebuffer;if(de instanceof Re)return de}return null},create:_e,createCube:ke,clear:function(){gr(J).forEach(ye)},restore:qe})}var EE=5126,qc=34962;function ps(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=EE,this.offset=0,this.stride=0,this.divisor=0}function bE(l,v,T,B,K){for(var G=T.maxAttributes,$=new Array(G),ne=0;ne<G;++ne)$[ne]=new ps;var se=0,le={},ue={Record:ps,scope:{},state:$,currentVAO:null,targetVAO:null,restore:be()?J:function(){},createVAO:Re,getVAO:pe,destroyBuffer:ve,setVAO:be()?L:V,clear:be()?fe:function(){}};function ve(te){for(var ye=0;ye<$.length;++ye){var ee=$[ye];ee.buffer===te&&(l.disableVertexAttribArray(ye),ee.buffer=null)}}function be(){return v.oes_vertex_array_object}function ie(){return v.angle_instanced_arrays}function pe(te){return typeof te=="function"&&te._vao?te._vao:null}function L(te){if(te!==ue.currentVAO){var ye=be();te?ye.bindVertexArrayOES(te.vao):ye.bindVertexArrayOES(null),ue.currentVAO=te}}function V(te){if(te!==ue.currentVAO){if(te)te.bindAttrs();else for(var ye=ie(),ee=0;ee<$.length;++ee){var _e=$[ee];_e.buffer?(l.enableVertexAttribArray(ee),l.vertexAttribPointer(ee,_e.size,_e.type,_e.normalized,_e.stride,_e.offfset),ye&&_e.divisor&&ye.vertexAttribDivisorANGLE(ee,_e.divisor)):(l.disableVertexAttribArray(ee),l.vertexAttrib4f(ee,_e.x,_e.y,_e.z,_e.w))}ue.currentVAO=te}}function fe(){gr(le).forEach(function(te){te.destroy()})}function Se(){this.id=++se,this.attributes=[];var te=be();te?this.vao=te.createVertexArrayOES():this.vao=null,le[this.id]=this,this.buffers=[]}Se.prototype.bindAttrs=function(){for(var te=ie(),ye=this.attributes,ee=0;ee<ye.length;++ee){var _e=ye[ee];_e.buffer?(l.enableVertexAttribArray(ee),l.bindBuffer(qc,_e.buffer.buffer),l.vertexAttribPointer(ee,_e.size,_e.type,_e.normalized,_e.stride,_e.offset),te&&_e.divisor&&te.vertexAttribDivisorANGLE(ee,_e.divisor)):(l.disableVertexAttribArray(ee),l.vertexAttrib4f(ee,_e.x,_e.y,_e.z,_e.w))}for(var ke=ye.length;ke<G;++ke)l.disableVertexAttribArray(ke)},Se.prototype.refresh=function(){var te=be();te&&(te.bindVertexArrayOES(this.vao),this.bindAttrs(),ue.currentVAO=this)},Se.prototype.destroy=function(){if(this.vao){var te=be();this===ue.currentVAO&&(ue.currentVAO=null,te.bindVertexArrayOES(null)),te.deleteVertexArrayOES(this.vao),this.vao=null}le[this.id]&&(delete le[this.id],B.vaoCount-=1)};function J(){var te=be();te&&gr(le).forEach(function(ye){ye.refresh()})}function Re(te){var ye=new Se;B.vaoCount+=1;function ee(_e){y(Array.isArray(_e),"arguments to vertex array constructor must be an array"),y(_e.length<G,"too many attributes"),y(_e.length>0,"must specify at least one attribute");var ke={},qe=ye.attributes;qe.length=_e.length;for(var ge=0;ge<_e.length;++ge){var de=_e[ge],Z=qe[ge]=new ps,Xe=de.data||de;if(Array.isArray(Xe)||r(Xe)||Ir(Xe)){var et;ye.buffers[ge]&&(et=ye.buffers[ge],r(Xe)&&et._buffer.byteLength>=Xe.byteLength?et.subdata(Xe):(et.destroy(),ye.buffers[ge]=null)),ye.buffers[ge]||(et=ye.buffers[ge]=K.create(de,qc,!1,!0)),Z.buffer=K.getBuffer(et),Z.size=Z.buffer.dimension|0,Z.normalized=!1,Z.type=Z.buffer.dtype,Z.offset=0,Z.stride=0,Z.divisor=0,Z.state=1,ke[ge]=1}else K.getBuffer(de)?(Z.buffer=K.getBuffer(de),Z.size=Z.buffer.dimension|0,Z.normalized=!1,Z.type=Z.buffer.dtype,Z.offset=0,Z.stride=0,Z.divisor=0,Z.state=1):K.getBuffer(de.buffer)?(Z.buffer=K.getBuffer(de.buffer),Z.size=(+de.size||Z.buffer.dimension)|0,Z.normalized=!!de.normalized||!1,"type"in de?(y.parameter(de.type,wn,"invalid buffer type"),Z.type=wn[de.type]):Z.type=Z.buffer.dtype,Z.offset=(de.offset||0)|0,Z.stride=(de.stride||0)|0,Z.divisor=(de.divisor||0)|0,Z.state=1,y(Z.size>=1&&Z.size<=4,"size must be between 1 and 4"),y(Z.offset>=0,"invalid offset"),y(Z.stride>=0&&Z.stride<=255,"stride must be between 0 and 255"),y(Z.divisor>=0,"divisor must be positive"),y(!Z.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in de?(y(ge>0,"first attribute must not be a constant"),Z.x=+de.x||0,Z.y=+de.y||0,Z.z=+de.z||0,Z.w=+de.w||0,Z.state=2):y(!1,"invalid attribute spec for location "+ge)}for(var xe=0;xe<ye.buffers.length;++xe)!ke[xe]&&ye.buffers[xe]&&(ye.buffers[xe].destroy(),ye.buffers[xe]=null);return ye.refresh(),ee}return ee.destroy=function(){for(var _e=0;_e<ye.buffers.length;++_e)ye.buffers[_e]&&ye.buffers[_e].destroy();ye.buffers.length=0,ye.destroy()},ee._vao=ye,ee._reglType="vao",ee(te)}return ue}var Kc=35632,gE=35633,TE=35718,AE=35721;function SE(l,v,T,B){var K={},G={};function $(L,V,fe,Se){this.name=L,this.id=V,this.location=fe,this.info=Se}function ne(L,V){for(var fe=0;fe<L.length;++fe)if(L[fe].id===V.id){L[fe].location=V.location;return}L.push(V)}function se(L,V,fe){var Se=L===Kc?K:G,J=Se[V];if(!J){var Re=v.str(V);J=l.createShader(L),l.shaderSource(J,Re),l.compileShader(J),y.shaderError(l,J,Re,L,fe),Se[V]=J}return J}var le={},ue=[],ve=0;function be(L,V){this.id=ve++,this.fragId=L,this.vertId=V,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,B.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ie(L,V,fe){var Se,J,Re=se(Kc,L.fragId),te=se(gE,L.vertId),ye=L.program=l.createProgram();if(l.attachShader(ye,Re),l.attachShader(ye,te),fe)for(Se=0;Se<fe.length;++Se){var ee=fe[Se];l.bindAttribLocation(ye,ee[0],ee[1])}l.linkProgram(ye),y.linkError(l,ye,v.str(L.fragId),v.str(L.vertId),V);var _e=l.getProgramParameter(ye,TE);B.profile&&(L.stats.uniformsCount=_e);var ke=L.uniforms;for(Se=0;Se<_e;++Se)if(J=l.getActiveUniform(ye,Se),J)if(J.size>1)for(var qe=0;qe<J.size;++qe){var ge=J.name.replace("[0]","["+qe+"]");ne(ke,new $(ge,v.id(ge),l.getUniformLocation(ye,ge),J))}else ne(ke,new $(J.name,v.id(J.name),l.getUniformLocation(ye,J.name),J));var de=l.getProgramParameter(ye,AE);B.profile&&(L.stats.attributesCount=de);var Z=L.attributes;for(Se=0;Se<de;++Se)J=l.getActiveAttrib(ye,Se),J&&ne(Z,new $(J.name,v.id(J.name),l.getAttribLocation(ye,J.name),J))}B.profile&&(T.getMaxUniformsCount=function(){var L=0;return ue.forEach(function(V){V.stats.uniformsCount>L&&(L=V.stats.uniformsCount)}),L},T.getMaxAttributesCount=function(){var L=0;return ue.forEach(function(V){V.stats.attributesCount>L&&(L=V.stats.attributesCount)}),L});function pe(){K={},G={};for(var L=0;L<ue.length;++L)ie(ue[L],null,ue[L].attributes.map(function(V){return[V.location,V.name]}))}return{clear:function(){var L=l.deleteShader.bind(l);gr(K).forEach(L),K={},gr(G).forEach(L),G={},ue.forEach(function(V){l.deleteProgram(V.program)}),ue.length=0,le={},T.shaderCount=0},program:function(L,V,fe,Se){y.command(L>=0,"missing vertex shader",fe),y.command(V>=0,"missing fragment shader",fe);var J=le[V];J||(J=le[V]={});var Re=J[L];if(Re&&(Re.refCount++,!Se))return Re;var te=new be(V,L);return T.shaderCount++,ie(te,fe,Se),Re||(J[L]=te),ue.push(te),n(te,{destroy:function(){if(te.refCount--,te.refCount<=0){l.deleteProgram(te.program);var ye=ue.indexOf(te);ue.splice(ye,1),T.shaderCount--}J[te.vertId].refCount<=0&&(l.deleteShader(G[te.vertId]),delete G[te.vertId],delete le[te.fragId][te.vertId]),Object.keys(le[te.fragId]).length||(l.deleteShader(K[te.fragId]),delete K[te.fragId],delete le[te.fragId])}})},restore:pe,shader:se,frag:-1,vert:-1}}var wE=6408,Mi=5121,RE=3333,Va=5126;function CE(l,v,T,B,K,G,$){function ne(ue){var ve;v.next===null?(y(K.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ve=Mi):(y(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ve=v.next.colorAttachments[0].texture._texture.type,G.oes_texture_float?(y(ve===Mi||ve===Va,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ve===Va&&y($.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):y(ve===Mi,"Reading from a framebuffer is only allowed for the type 'uint8'"));var be=0,ie=0,pe=B.framebufferWidth,L=B.framebufferHeight,V=null;r(ue)?V=ue:ue&&(y.type(ue,"object","invalid arguments to regl.read()"),be=ue.x|0,ie=ue.y|0,y(be>=0&&be<B.framebufferWidth,"invalid x offset for regl.read"),y(ie>=0&&ie<B.framebufferHeight,"invalid y offset for regl.read"),pe=(ue.width||B.framebufferWidth-be)|0,L=(ue.height||B.framebufferHeight-ie)|0,V=ue.data||null),V&&(ve===Mi?y(V instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ve===Va&&y(V instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),y(pe>0&&pe+be<=B.framebufferWidth,"invalid width for read pixels"),y(L>0&&L+ie<=B.framebufferHeight,"invalid height for read pixels"),T();var fe=pe*L*4;return V||(ve===Mi?V=new Uint8Array(fe):ve===Va&&(V=V||new Float32Array(fe))),y.isTypedArray(V,"data buffer for regl.read() must be a typedarray"),y(V.byteLength>=fe,"data buffer for regl.read() too small"),l.pixelStorei(RE,4),l.readPixels(be,ie,pe,L,wE,ve,V),V}function se(ue){var ve;return v.setFBO({framebuffer:ue.framebuffer},function(){ve=ne(ue)}),ve}function le(ue){return!ue||!("framebuffer"in ue)?ne(ue):se(ue)}return le}function oi(l){return Array.prototype.slice.call(l)}function si(l){return oi(l).join("")}function xE(){var l=0,v=[],T=[];function B(ve){for(var be=0;be<T.length;++be)if(T[be]===ve)return v[be];var ie="g"+l++;return v.push(ie),T.push(ve),ie}function K(){var ve=[];function be(){ve.push.apply(ve,oi(arguments))}var ie=[];function pe(){var L="v"+l++;return ie.push(L),arguments.length>0&&(ve.push(L,"="),ve.push.apply(ve,oi(arguments)),ve.push(";")),L}return n(be,{def:pe,toString:function(){return si([ie.length>0?"var "+ie.join(",")+";":"",si(ve)])}})}function G(){var ve=K(),be=K(),ie=ve.toString,pe=be.toString;function L(V,fe){be(V,fe,"=",ve.def(V,fe),";")}return n(function(){ve.apply(ve,oi(arguments))},{def:ve.def,entry:ve,exit:be,save:L,set:function(V,fe,Se){L(V,fe),ve(V,fe,"=",Se,";")},toString:function(){return ie()+pe()}})}function $(){var ve=si(arguments),be=G(),ie=G(),pe=be.toString,L=ie.toString;return n(be,{then:function(){return be.apply(be,oi(arguments)),this},else:function(){return ie.apply(ie,oi(arguments)),this},toString:function(){var V=L();return V&&(V="else{"+V+"}"),si(["if(",ve,"){",pe(),"}",V])}})}var ne=K(),se={};function le(ve,be){var ie=[];function pe(){var J="a"+ie.length;return ie.push(J),J}be=be||0;for(var L=0;L<be;++L)pe();var V=G(),fe=V.toString,Se=se[ve]=n(V,{arg:pe,toString:function(){return si(["function(",ie.join(),"){",fe(),"}"])}});return Se}function ue(){var ve=['"use strict";',ne,"return {"];Object.keys(se).forEach(function(pe){ve.push('"',pe,'":',se[pe].toString(),",")}),ve.push("}");var be=si(ve).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ie=Function.apply(null,v.concat(be));return ie.apply(null,T)}return{global:ne,link:B,block:K,proc:le,scope:G,cond:$,compile:ue}}var ui="xyzw".split(""),Qc=5121,ci=1,ms=2,ys=0,_s=1,Es=2,bs=3,ja=4,Zc=5,Jc=6,ef="dither",tf="blend.enable",rf="blend.color",gs="blend.equation",Ts="blend.func",nf="depth.enable",af="depth.func",of="depth.range",sf="depth.mask",As="colorMask",uf="cull.enable",cf="cull.face",Ss="frontFace",ws="lineWidth",ff="polygonOffset.enable",Rs="polygonOffset.offset",lf="sample.alpha",df="sample.enable",Cs="sample.coverage",hf="stencil.enable",vf="stencil.mask",xs="stencil.func",Ns="stencil.opFront",ki="stencil.opBack",pf="scissor.enable",za="scissor.box",Kr="viewport",Di="profile",On="framebuffer",Fi="vert",Gi="frag",In="elements",Pn="primitive",Ln="count",Ha="offset",Xa="instances",Bi="vao",Os="Width",Is="Height",fi=On+Os,li=On+Is,NE=Kr+Os,OE=Kr+Is,mf="drawingBuffer",yf=mf+Os,_f=mf+Is,IE=[Ts,gs,xs,Ns,ki,Cs,Kr,za,Rs],di=34962,PE=34963,LE=35632,ME=35633,Ef=3553,kE=34067,DE=2884,FE=3042,GE=3024,BE=2960,UE=2929,$E=3089,VE=32823,jE=32926,zE=32928,Ps=5126,Wa=35664,Ya=35665,qa=35666,Ls=5124,Ka=35667,Qa=35668,Za=35669,Ms=35670,Ja=35671,eo=35672,to=35673,Ui=35674,$i=35675,Vi=35676,ji=35678,zi=35680,bf=4,Hi=1028,Mn=1029,gf=2304,ks=2305,HE=32775,XE=32776,WE=519,dn=7680,Tf=0,Af=1,Sf=32774,YE=513,wf=36160,qE=36064,Fr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],hi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},hn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Cf={frag:LE,vert:ME},Ds={cw:gf,ccw:ks};function ro(l){return Array.isArray(l)||r(l)||Ir(l)}function xf(l){return l.sort(function(v,T){return v===Kr?-1:T===Kr?1:v<T?-1:1})}function hr(l,v,T,B){this.thisDep=l,this.contextDep=v,this.propDep=T,this.append=B}function vn(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function zt(l){return new hr(!1,!1,!1,l)}function _r(l,v){var T=l.type;if(T===ys){var B=l.data.length;return new hr(!0,B>=1,B>=2,v)}else if(T===ja){var K=l.data;return new hr(K.thisDep,K.contextDep,K.propDep,v)}else{if(T===Zc)return new hr(!1,!1,!1,v);if(T===Jc){for(var G=!1,$=!1,ne=!1,se=0;se<l.data.length;++se){var le=l.data[se];if(le.type===_s)ne=!0;else if(le.type===Es)$=!0;else if(le.type===bs)G=!0;else if(le.type===ys){G=!0;var ue=le.data;ue>=1&&($=!0),ue>=2&&(ne=!0)}else le.type===ja&&(G=G||le.data.thisDep,$=$||le.data.contextDep,ne=ne||le.data.propDep)}return new hr(G,$,ne,v)}else return new hr(T===bs,T===Es,T===_s,v)}}var Nf=new hr(!1,!1,!1,function(){});function KE(l,v,T,B,K,G,$,ne,se,le,ue,ve,be,ie,pe){var L=le.Record,V={add:32774,subtract:32778,"reverse subtract":32779};T.ext_blend_minmax&&(V.min=HE,V.max=XE);var fe=T.angle_instanced_arrays,Se=T.webgl_draw_buffers,J={dirty:!0,profile:pe.profile},Re={},te=[],ye={},ee={};function _e(_){return _.replace(".","_")}function ke(_,h,w){var P=_e(_);te.push(_),Re[P]=J[P]=!!w,ye[P]=h}function qe(_,h,w){var P=_e(_);te.push(_),Array.isArray(w)?(J[P]=w.slice(),Re[P]=w.slice()):J[P]=Re[P]=w,ee[P]=h}ke(ef,GE),ke(tf,FE),qe(rf,"blendColor",[0,0,0,0]),qe(gs,"blendEquationSeparate",[Sf,Sf]),qe(Ts,"blendFuncSeparate",[Af,Tf,Af,Tf]),ke(nf,UE,!0),qe(af,"depthFunc",YE),qe(of,"depthRange",[0,1]),qe(sf,"depthMask",!0),qe(As,As,[!0,!0,!0,!0]),ke(uf,DE),qe(cf,"cullFace",Mn),qe(Ss,Ss,ks),qe(ws,ws,1),ke(ff,VE),qe(Rs,"polygonOffset",[0,0]),ke(lf,jE),ke(df,zE),qe(Cs,"sampleCoverage",[1,!1]),ke(hf,BE),qe(vf,"stencilMask",-1),qe(xs,"stencilFunc",[WE,0,-1]),qe(Ns,"stencilOpSeparate",[Hi,dn,dn,dn]),qe(ki,"stencilOpSeparate",[Mn,dn,dn,dn]),ke(pf,$E),qe(za,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),qe(Kr,Kr,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var ge={gl:l,context:be,strings:v,next:Re,current:J,draw:ve,elements:G,buffer:K,shader:ue,attributes:le.state,vao:le,uniforms:se,framebuffer:ne,extensions:T,timer:ie,isBufferArgs:ro},de={primTypes:Zn,compareFuncs:hi,blendFuncs:Fr,blendEquations:V,stencilOps:hn,glTypes:wn,orientationType:Ds};y.optional(function(){ge.isArrayLike=Gt}),Se&&(de.backBuffer=[Mn],de.drawBuffer=yr(B.maxDrawbuffers,function(_){return _===0?[0]:yr(_,function(h){return qE+h})}));var Z=0;function Xe(){var _=xE(),h=_.link,w=_.global;_.id=Z++,_.batchId="0";var P=h(ge),k=_.shared={props:"a0"};Object.keys(ge).forEach(function(S){k[S]=w.def(P,".",S)}),y.optional(function(){_.CHECK=h(y),_.commandStr=y.guessCommand(),_.command=h(_.commandStr),_.assert=function(S,m,I){S("if(!(",m,"))",this.CHECK,".commandRaise(",h(I),",",this.command,");")},de.invalidBlendCombinations=Rf});var C=_.next={},R=_.current={};Object.keys(ee).forEach(function(S){Array.isArray(J[S])&&(C[S]=w.def(k.next,".",S),R[S]=w.def(k.current,".",S))});var O=_.constants={};Object.keys(de).forEach(function(S){O[S]=w.def(JSON.stringify(de[S]))}),_.invoke=function(S,m){switch(m.type){case ys:var I=["this",k.context,k.props,_.batchId];return S.def(h(m.data),".call(",I.slice(0,Math.max(m.data.length+1,4)),")");case _s:return S.def(k.props,m.data);case Es:return S.def(k.context,m.data);case bs:return S.def("this",m.data);case ja:return m.data.append(_,S),m.data.ref;case Zc:return m.data.toString();case Jc:return m.data.map(function(D){return _.invoke(S,D)})}},_.attribCache={};var E={};return _.scopeAttrib=function(S){var m=v.id(S);if(m in E)return E[m];var I=le.scope[m];I||(I=le.scope[m]=new L);var D=E[m]=h(I);return D},_}function et(_){var h=_.static,w=_.dynamic,P;if(Di in h){var k=!!h[Di];P=zt(function(R,O){return k}),P.enable=k}else if(Di in w){var C=w[Di];P=_r(C,function(R,O){return R.invoke(O,C)})}return P}function xe(_,h){var w=_.static,P=_.dynamic;if(On in w){var k=w[On];return k?(k=ne.getFramebuffer(k),y.command(k,"invalid framebuffer object"),zt(function(R,O){var E=R.link(k),S=R.shared;O.set(S.framebuffer,".next",E);var m=S.context;return O.set(m,"."+fi,E+".width"),O.set(m,"."+li,E+".height"),E})):zt(function(R,O){var E=R.shared;O.set(E.framebuffer,".next","null");var S=E.context;return O.set(S,"."+fi,S+"."+yf),O.set(S,"."+li,S+"."+_f),"null"})}else if(On in P){var C=P[On];return _r(C,function(R,O){var E=R.invoke(O,C),S=R.shared,m=S.framebuffer,I=O.def(m,".getFramebuffer(",E,")");y.optional(function(){R.assert(O,"!"+E+"||"+I,"invalid framebuffer object")}),O.set(m,".next",I);var D=S.context;return O.set(D,"."+fi,I+"?"+I+".width:"+D+"."+yf),O.set(D,"."+li,I+"?"+I+".height:"+D+"."+_f),I})}else return null}function ot(_,h,w){var P=_.static,k=_.dynamic;function C(E){if(E in P){var S=P[E];y.commandType(S,"object","invalid "+E,w.commandStr);var m=!0,I=S.x|0,D=S.y|0,Y,Q;return"width"in S?(Y=S.width|0,y.command(Y>=0,"invalid "+E,w.commandStr)):m=!1,"height"in S?(Q=S.height|0,y.command(Q>=0,"invalid "+E,w.commandStr)):m=!1,new hr(!m&&h&&h.thisDep,!m&&h&&h.contextDep,!m&&h&&h.propDep,function(Le,rt){var Ne=Le.shared.context,$e=Y;"width"in S||($e=rt.def(Ne,".",fi,"-",I));var Ze=Q;return"height"in S||(Ze=rt.def(Ne,".",li,"-",D)),[I,D,$e,Ze]})}else if(E in k){var z=k[E],ce=_r(z,function(Le,rt){var Ne=Le.invoke(rt,z);y.optional(function(){Le.assert(rt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+E)});var $e=Le.shared.context,Ze=rt.def(Ne,".x|0"),Et=rt.def(Ne,".y|0"),Ft=rt.def('"width" in ',Ne,"?",Ne,".width|0:","(",$e,".",fi,"-",Ze,")"),vr=rt.def('"height" in ',Ne,"?",Ne,".height|0:","(",$e,".",li,"-",Et,")");return y.optional(function(){Le.assert(rt,Ft+">=0&&"+vr+">=0","invalid "+E)}),[Ze,Et,Ft,vr]});return h&&(ce.thisDep=ce.thisDep||h.thisDep,ce.contextDep=ce.contextDep||h.contextDep,ce.propDep=ce.propDep||h.propDep),ce}else return h?new hr(h.thisDep,h.contextDep,h.propDep,function(Le,rt){var Ne=Le.shared.context;return[0,0,rt.def(Ne,".",fi),rt.def(Ne,".",li)]}):null}var R=C(Kr);if(R){var O=R;R=new hr(R.thisDep,R.contextDep,R.propDep,function(E,S){var m=O.append(E,S),I=E.shared.context;return S.set(I,"."+NE,m[2]),S.set(I,"."+OE,m[3]),m})}return{viewport:R,scissor_box:C(za)}}function Ke(_,h){var w=_.static,P=typeof w[Gi]=="string"&&typeof w[Fi]=="string";if(P){if(Object.keys(h.dynamic).length>0)return null;var k=h.static,C=Object.keys(k);if(C.length>0&&typeof k[C[0]]=="number"){for(var R=[],O=0;O<C.length;++O)y(typeof k[C[O]]=="number","must specify all vertex attribute locations when using vaos"),R.push([k[C[O]]|0,C[O]]);return R}}return null}function it(_,h,w){var P=_.static,k=_.dynamic;function C(m){if(m in P){var I=v.id(P[m]);y.optional(function(){ue.shader(Cf[m],I,y.guessCommand())});var D=zt(function(){return I});return D.id=I,D}else if(m in k){var Y=k[m];return _r(Y,function(Q,z){var ce=Q.invoke(z,Y),Le=z.def(Q.shared.strings,".id(",ce,")");return y.optional(function(){z(Q.shared.shader,".shader(",Cf[m],",",Le,",",Q.command,");")}),Le})}return null}var R=C(Gi),O=C(Fi),E=null,S;return vn(R)&&vn(O)?(E=ue.program(O.id,R.id,null,w),S=zt(function(m,I){return m.link(E)})):S=new hr(R&&R.thisDep||O&&O.thisDep,R&&R.contextDep||O&&O.contextDep,R&&R.propDep||O&&O.propDep,function(m,I){var D=m.shared.shader,Y;R?Y=R.append(m,I):Y=I.def(D,".",Gi);var Q;O?Q=O.append(m,I):Q=I.def(D,".",Fi);var z=D+".program("+Q+","+Y;return y.optional(function(){z+=","+m.command}),I.def(z+")")}),{frag:R,vert:O,progVar:S,program:E}}function _t(_,h){var w=_.static,P=_.dynamic;function k(){if(In in w){var m=w[In];ro(m)?m=G.getElements(G.create(m,!0)):m&&(m=G.getElements(m),y.command(m,"invalid elements",h.commandStr));var I=zt(function(Y,Q){if(m){var z=Y.link(m);return Y.ELEMENTS=z,z}return Y.ELEMENTS=null,null});return I.value=m,I}else if(In in P){var D=P[In];return _r(D,function(Y,Q){var z=Y.shared,ce=z.isBufferArgs,Le=z.elements,rt=Y.invoke(Q,D),Ne=Q.def("null"),$e=Q.def(ce,"(",rt,")"),Ze=Y.cond($e).then(Ne,"=",Le,".createStream(",rt,");").else(Ne,"=",Le,".getElements(",rt,");");return y.optional(function(){Y.assert(Ze.else,"!"+rt+"||"+Ne,"invalid elements")}),Q.entry(Ze),Q.exit(Y.cond($e).then(Le,".destroyStream(",Ne,");")),Y.ELEMENTS=Ne,Ne})}return null}var C=k();function R(){if(Pn in w){var m=w[Pn];return y.commandParameter(m,Zn,"invalid primitve",h.commandStr),zt(function(D,Y){return Zn[m]})}else if(Pn in P){var I=P[Pn];return _r(I,function(D,Y){var Q=D.constants.primTypes,z=D.invoke(Y,I);return y.optional(function(){D.assert(Y,z+" in "+Q,"invalid primitive, must be one of "+Object.keys(Zn))}),Y.def(Q,"[",z,"]")})}else if(C)return vn(C)?C.value?zt(function(D,Y){return Y.def(D.ELEMENTS,".primType")}):zt(function(){return bf}):new hr(C.thisDep,C.contextDep,C.propDep,function(D,Y){var Q=D.ELEMENTS;return Y.def(Q,"?",Q,".primType:",bf)});return null}function O(m,I){if(m in w){var D=w[m]|0;return y.command(!I||D>=0,"invalid "+m,h.commandStr),zt(function(Q,z){return I&&(Q.OFFSET=D),D})}else if(m in P){var Y=P[m];return _r(Y,function(Q,z){var ce=Q.invoke(z,Y);return I&&(Q.OFFSET=ce,y.optional(function(){Q.assert(z,ce+">=0","invalid "+m)})),ce})}else if(I&&C)return zt(function(Q,z){return Q.OFFSET="0",0});return null}var E=O(Ha,!0);function S(){if(Ln in w){var m=w[Ln]|0;return y.command(typeof m=="number"&&m>=0,"invalid vertex count",h.commandStr),zt(function(){return m})}else if(Ln in P){var I=P[Ln];return _r(I,function(Q,z){var ce=Q.invoke(z,I);return y.optional(function(){Q.assert(z,"typeof "+ce+'==="number"&&'+ce+">=0&&"+ce+"===("+ce+"|0)","invalid vertex count")}),ce})}else if(C)if(vn(C)){if(C)return E?new hr(E.thisDep,E.contextDep,E.propDep,function(Q,z){var ce=z.def(Q.ELEMENTS,".vertCount-",Q.OFFSET);return y.optional(function(){Q.assert(z,ce+">=0","invalid vertex offset/element buffer too small")}),ce}):zt(function(Q,z){return z.def(Q.ELEMENTS,".vertCount")});var D=zt(function(){return-1});return y.optional(function(){D.MISSING=!0}),D}else{var Y=new hr(C.thisDep||E.thisDep,C.contextDep||E.contextDep,C.propDep||E.propDep,function(Q,z){var ce=Q.ELEMENTS;return Q.OFFSET?z.def(ce,"?",ce,".vertCount-",Q.OFFSET,":-1"):z.def(ce,"?",ce,".vertCount:-1")});return y.optional(function(){Y.DYNAMIC=!0}),Y}return null}return{elements:C,primitive:R(),count:S(),instances:O(Xa,!1),offset:E}}function Ht(_,h){var w=_.static,P=_.dynamic,k={};return te.forEach(function(C){var R=_e(C);function O(E,S){if(C in w){var m=E(w[C]);k[R]=zt(function(){return m})}else if(C in P){var I=P[C];k[R]=_r(I,function(D,Y){return S(D,Y,D.invoke(Y,I))})}}switch(C){case uf:case tf:case ef:case hf:case nf:case pf:case ff:case lf:case df:case sf:return O(function(E){return y.commandType(E,"boolean",C,h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="boolean"',"invalid flag "+C,E.commandStr)}),m});case af:return O(function(E){return y.commandParameter(E,hi,"invalid "+C,h.commandStr),hi[E]},function(E,S,m){var I=E.constants.compareFuncs;return y.optional(function(){E.assert(S,m+" in "+I,"invalid "+C+", must be one of "+Object.keys(hi))}),S.def(I,"[",m,"]")});case of:return O(function(E){return y.command(Gt(E)&&E.length===2&&typeof E[0]=="number"&&typeof E[1]=="number"&&E[0]<=E[1],"depth range is 2d array",h.commandStr),E},function(E,S,m){y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===2&&typeof "+m+'[0]==="number"&&typeof '+m+'[1]==="number"&&'+m+"[0]<="+m+"[1]","depth range must be a 2d array")});var I=S.def("+",m,"[0]"),D=S.def("+",m,"[1]");return[I,D]});case Ts:return O(function(E){y.commandType(E,"object","blend.func",h.commandStr);var S="srcRGB"in E?E.srcRGB:E.src,m="srcAlpha"in E?E.srcAlpha:E.src,I="dstRGB"in E?E.dstRGB:E.dst,D="dstAlpha"in E?E.dstAlpha:E.dst;return y.commandParameter(S,Fr,R+".srcRGB",h.commandStr),y.commandParameter(m,Fr,R+".srcAlpha",h.commandStr),y.commandParameter(I,Fr,R+".dstRGB",h.commandStr),y.commandParameter(D,Fr,R+".dstAlpha",h.commandStr),y.command(Rf.indexOf(S+", "+I)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+S+", "+I+")",h.commandStr),[Fr[S],Fr[I],Fr[m],Fr[D]]},function(E,S,m){var I=E.constants.blendFuncs;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});function D(Ne,$e){var Ze=S.def('"',Ne,$e,'" in ',m,"?",m,".",Ne,$e,":",m,".",Ne);return y.optional(function(){E.assert(S,Ze+" in "+I,"invalid "+C+"."+Ne+$e+", must be one of "+Object.keys(Fr))}),Ze}var Y=D("src","RGB"),Q=D("dst","RGB");y.optional(function(){var Ne=E.constants.invalidBlendCombinations;E.assert(S,Ne+".indexOf("+Y+'+", "+'+Q+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var z=S.def(I,"[",Y,"]"),ce=S.def(I,"[",D("src","Alpha"),"]"),Le=S.def(I,"[",Q,"]"),rt=S.def(I,"[",D("dst","Alpha"),"]");return[z,Le,ce,rt]});case gs:return O(function(E){if(typeof E=="string")return y.commandParameter(E,V,"invalid "+C,h.commandStr),[V[E],V[E]];if(typeof E=="object")return y.commandParameter(E.rgb,V,C+".rgb",h.commandStr),y.commandParameter(E.alpha,V,C+".alpha",h.commandStr),[V[E.rgb],V[E.alpha]];y.commandRaise("invalid blend.equation",h.commandStr)},function(E,S,m){var I=E.constants.blendEquations,D=S.def(),Y=S.def(),Q=E.cond("typeof ",m,'==="string"');return y.optional(function(){function z(ce,Le,rt){E.assert(ce,rt+" in "+I,"invalid "+Le+", must be one of "+Object.keys(V))}z(Q.then,C,m),E.assert(Q.else,m+"&&typeof "+m+'==="object"',"invalid "+C),z(Q.else,C+".rgb",m+".rgb"),z(Q.else,C+".alpha",m+".alpha")}),Q.then(D,"=",Y,"=",I,"[",m,"];"),Q.else(D,"=",I,"[",m,".rgb];",Y,"=",I,"[",m,".alpha];"),S(Q),[D,Y]});case rf:return O(function(E){return y.command(Gt(E)&&E.length===4,"blend.color must be a 4d array",h.commandStr),yr(4,function(S){return+E[S]})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","blend.color must be a 4d array")}),yr(4,function(I){return S.def("+",m,"[",I,"]")})});case vf:return O(function(E){return y.commandType(E,"number",R,h.commandStr),E|0},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"',"invalid stencil.mask")}),S.def(m,"|0")});case xs:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.cmp||"keep",m=E.ref||0,I="mask"in E?E.mask:-1;return y.commandParameter(S,hi,C+".cmp",h.commandStr),y.commandType(m,"number",C+".ref",h.commandStr),y.commandType(I,"number",C+".mask",h.commandStr),[hi[S],m,I]},function(E,S,m){var I=E.constants.compareFuncs;y.optional(function(){function z(){E.assert(S,Array.prototype.join.call(arguments,""),"invalid stencil.func")}z(m+"&&typeof ",m,'==="object"'),z('!("cmp" in ',m,")||(",m,".cmp in ",I,")")});var D=S.def('"cmp" in ',m,"?",I,"[",m,".cmp]",":",dn),Y=S.def(m,".ref|0"),Q=S.def('"mask" in ',m,"?",m,".mask|0:-1");return[D,Y,Q]});case Ns:case ki:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.fail||"keep",m=E.zfail||"keep",I=E.zpass||"keep";return y.commandParameter(S,hn,C+".fail",h.commandStr),y.commandParameter(m,hn,C+".zfail",h.commandStr),y.commandParameter(I,hn,C+".zpass",h.commandStr),[C===ki?Mn:Hi,hn[S],hn[m],hn[I]]},function(E,S,m){var I=E.constants.stencilOps;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+C)});function D(Y){return y.optional(function(){E.assert(S,'!("'+Y+'" in '+m+")||("+m+"."+Y+" in "+I+")","invalid "+C+"."+Y+", must be one of "+Object.keys(hn))}),S.def('"',Y,'" in ',m,"?",I,"[",m,".",Y,"]:",dn)}return[C===ki?Mn:Hi,D("fail"),D("zfail"),D("zpass")]});case Rs:return O(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.factor|0,m=E.units|0;return y.commandType(S,"number",R+".factor",h.commandStr),y.commandType(m,"number",R+".units",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+C)});var I=S.def(m,".factor|0"),D=S.def(m,".units|0");return[I,D]});case cf:return O(function(E){var S=0;return E==="front"?S=Hi:E==="back"&&(S=Mn),y.command(!!S,R,h.commandStr),S},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="front"||'+m+'==="back"',"invalid cull.face")}),S.def(m,'==="front"?',Hi,":",Mn)});case ws:return O(function(E){return y.command(typeof E=="number"&&E>=B.lineWidthDims[0]&&E<=B.lineWidthDims[1],"invalid line width, must be a positive number between "+B.lineWidthDims[0]+" and "+B.lineWidthDims[1],h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"&&'+m+">="+B.lineWidthDims[0]+"&&"+m+"<="+B.lineWidthDims[1],"invalid line width")}),m});case Ss:return O(function(E){return y.commandParameter(E,Ds,R,h.commandStr),Ds[E]},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="cw"||'+m+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),S.def(m+'==="cw"?'+gf+":"+ks)});case As:return O(function(E){return y.command(Gt(E)&&E.length===4,"color.mask must be length 4 array",h.commandStr),E.map(function(S){return!!S})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","invalid color.mask")}),yr(4,function(I){return"!!"+m+"["+I+"]"})});case Cs:return O(function(E){y.command(typeof E=="object"&&E,R,h.commandStr);var S="value"in E?E.value:1,m=!!E.invert;return y.command(typeof S=="number"&&S>=0&&S<=1,"sample.coverage.value must be a number between 0 and 1",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid sample.coverage")});var I=S.def('"value" in ',m,"?+",m,".value:1"),D=S.def("!!",m,".invert");return[I,D]})}}),k}function Jt(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(C){var R=w[C],O;if(typeof R=="number"||typeof R=="boolean")O=zt(function(){return R});else if(typeof R=="function"){var E=R._reglType;E==="texture2d"||E==="textureCube"?O=zt(function(S){return S.link(R)}):E==="framebuffer"||E==="framebufferCube"?(y.command(R.color.length>0,'missing color attachment for framebuffer sent to uniform "'+C+'"',h.commandStr),O=zt(function(S){return S.link(R.color[0])})):y.commandRaise('invalid data for uniform "'+C+'"',h.commandStr)}else Gt(R)?O=zt(function(S){var m=S.global.def("[",yr(R.length,function(I){return y.command(typeof R[I]=="number"||typeof R[I]=="boolean","invalid uniform "+C,S.commandStr),R[I]}),"]");return m}):y.commandRaise('invalid or missing data for uniform "'+C+'"',h.commandStr);O.value=R,k[C]=O}),Object.keys(P).forEach(function(C){var R=P[C];k[C]=_r(R,function(O,E){return O.invoke(E,R)})}),k}function lt(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(C){var R=w[C],O=v.id(C),E=new L;if(ro(R))E.state=ci,E.buffer=K.getBuffer(K.create(R,di,!1,!0)),E.type=0;else{var S=K.getBuffer(R);if(S)E.state=ci,E.buffer=S,E.type=0;else if(y.command(typeof R=="object"&&R,"invalid data for attribute "+C,h.commandStr),"constant"in R){var m=R.constant;E.buffer="null",E.state=ms,typeof m=="number"?E.x=m:(y.command(Gt(m)&&m.length>0&&m.length<=4,"invalid constant for attribute "+C,h.commandStr),ui.forEach(function(Le,rt){rt<m.length&&(E[Le]=m[rt])}))}else{ro(R.buffer)?S=K.getBuffer(K.create(R.buffer,di,!1,!0)):S=K.getBuffer(R.buffer),y.command(!!S,'missing buffer for attribute "'+C+'"',h.commandStr);var I=R.offset|0;y.command(I>=0,'invalid offset for attribute "'+C+'"',h.commandStr);var D=R.stride|0;y.command(D>=0&&D<256,'invalid stride for attribute "'+C+'", must be integer betweeen [0, 255]',h.commandStr);var Y=R.size|0;y.command(!("size"in R)||Y>0&&Y<=4,'invalid size for attribute "'+C+'", must be 1,2,3,4',h.commandStr);var Q=!!R.normalized,z=0;"type"in R&&(y.commandParameter(R.type,wn,"invalid type for attribute "+C,h.commandStr),z=wn[R.type]);var ce=R.divisor|0;"divisor"in R&&(y.command(ce===0||fe,'cannot specify divisor for attribute "'+C+'", instancing not supported',h.commandStr),y.command(ce>=0,'invalid divisor for attribute "'+C+'"',h.commandStr)),y.optional(function(){var Le=h.commandStr,rt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(R).forEach(function(Ne){y.command(rt.indexOf(Ne)>=0,'unknown parameter "'+Ne+'" for attribute pointer "'+C+'" (valid parameters are '+rt+")",Le)})}),E.buffer=S,E.state=ci,E.size=Y,E.normalized=Q,E.type=z||S.dtype,E.offset=I,E.stride=D,E.divisor=ce}}k[C]=zt(function(Le,rt){var Ne=Le.attribCache;if(O in Ne)return Ne[O];var $e={isStream:!1};return Object.keys(E).forEach(function(Ze){$e[Ze]=E[Ze]}),E.buffer&&($e.buffer=Le.link(E.buffer),$e.type=$e.type||$e.buffer+".dtype"),Ne[O]=$e,$e})}),Object.keys(P).forEach(function(C){var R=P[C];function O(E,S){var m=E.invoke(S,R),I=E.shared,D=E.constants,Y=I.isBufferArgs,Q=I.buffer;y.optional(function(){E.assert(S,m+"&&(typeof "+m+'==="object"||typeof '+m+'==="function")&&('+Y+"("+m+")||"+Q+".getBuffer("+m+")||"+Q+".getBuffer("+m+".buffer)||"+Y+"("+m+'.buffer)||("constant" in '+m+"&&(typeof "+m+'.constant==="number"||'+I.isArrayLike+"("+m+".constant))))",'invalid dynamic attribute "'+C+'"')});var z={isStream:S.def(!1)},ce=new L;ce.state=ci,Object.keys(ce).forEach(function($e){z[$e]=S.def(""+ce[$e])});var Le=z.buffer,rt=z.type;S("if(",Y,"(",m,")){",z.isStream,"=true;",Le,"=",Q,".createStream(",di,",",m,");",rt,"=",Le,".dtype;","}else{",Le,"=",Q,".getBuffer(",m,");","if(",Le,"){",rt,"=",Le,".dtype;",'}else if("constant" in ',m,"){",z.state,"=",ms,";","if(typeof "+m+'.constant === "number"){',z[ui[0]],"=",m,".constant;",ui.slice(1).map(function($e){return z[$e]}).join("="),"=0;","}else{",ui.map(function($e,Ze){return z[$e]+"="+m+".constant.length>"+Ze+"?"+m+".constant["+Ze+"]:0;"}).join(""),"}}else{","if(",Y,"(",m,".buffer)){",Le,"=",Q,".createStream(",di,",",m,".buffer);","}else{",Le,"=",Q,".getBuffer(",m,".buffer);","}",rt,'="type" in ',m,"?",D.glTypes,"[",m,".type]:",Le,".dtype;",z.normalized,"=!!",m,".normalized;");function Ne($e){S(z[$e],"=",m,".",$e,"|0;")}return Ne("size"),Ne("offset"),Ne("stride"),Ne("divisor"),S("}}"),S.exit("if(",z.isStream,"){",Q,".destroyStream(",Le,");","}"),z}k[C]=_r(R,O)}),k}function Wt(_,h){var w=_.static,P=_.dynamic;if(Bi in w){var k=w[Bi];return k!==null&&le.getVAO(k)===null&&(k=le.createVAO(k)),zt(function(R){return R.link(le.getVAO(k))})}else if(Bi in P){var C=P[Bi];return _r(C,function(R,O){var E=R.invoke(O,C);return O.def(R.shared.vao+".getVAO("+E+")")})}return null}function It(_){var h=_.static,w=_.dynamic,P={};return Object.keys(h).forEach(function(k){var C=h[k];P[k]=zt(function(R,O){return typeof C=="number"||typeof C=="boolean"?""+C:R.link(C)})}),Object.keys(w).forEach(function(k){var C=w[k];P[k]=_r(C,function(R,O){return R.invoke(O,C)})}),P}function Xt(_,h,w,P,k){var C=_.static,R=_.dynamic;y.optional(function(){var Ne=[On,Fi,Gi,In,Pn,Ha,Ln,Xa,Di,Bi].concat(te);function $e(Ze){Object.keys(Ze).forEach(function(Et){y.command(Ne.indexOf(Et)>=0,'unknown parameter "'+Et+'"',k.commandStr)})}$e(C),$e(R)});var O=Ke(_,h),E=xe(_),S=ot(_,E,k),m=_t(_,k),I=Ht(_,k),D=it(_,k,O);function Y(Ne){var $e=S[Ne];$e&&(I[Ne]=$e)}Y(Kr),Y(_e(za));var Q=Object.keys(I).length>0,z={framebuffer:E,draw:m,shader:D,state:I,dirty:Q,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(z.profile=et(_),z.uniforms=Jt(w,k),z.drawVAO=z.scopeVAO=Wt(_),!z.drawVAO&&D.program&&!O&&T.angle_instanced_arrays){var ce=!0,Le=D.program.attributes.map(function(Ne){var $e=h.static[Ne];return ce=ce&&!!$e,$e});if(ce&&Le.length>0){var rt=le.getVAO(le.createVAO(Le));z.drawVAO=new hr(null,null,null,function(Ne,$e){return Ne.link(rt)}),z.useVAO=!0}}return O?z.useVAO=!0:z.attributes=lt(h,k),z.context=It(P),z}function Yt(_,h,w){var P=_.shared,k=P.context,C=_.scope();Object.keys(w).forEach(function(R){h.save(k,"."+R);var O=w[R],E=O.append(_,h);Array.isArray(E)?C(k,".",R,"=[",E.join(),"];"):C(k,".",R,"=",E,";")}),h(C)}function qt(_,h,w,P){var k=_.shared,C=k.gl,R=k.framebuffer,O;Se&&(O=h.def(k.extensions,".webgl_draw_buffers"));var E=_.constants,S=E.drawBuffer,m=E.backBuffer,I;w?I=w.append(_,h):I=h.def(R,".next"),P||h("if(",I,"!==",R,".cur){"),h("if(",I,"){",C,".bindFramebuffer(",wf,",",I,".framebuffer);"),Se&&h(O,".drawBuffersWEBGL(",S,"[",I,".colorAttachments.length]);"),h("}else{",C,".bindFramebuffer(",wf,",null);"),Se&&h(O,".drawBuffersWEBGL(",m,");"),h("}",R,".cur=",I,";"),P||h("}")}function er(_,h,w){var P=_.shared,k=P.gl,C=_.current,R=_.next,O=P.current,E=P.next,S=_.cond(O,".dirty");te.forEach(function(m){var I=_e(m);if(!(I in w.state)){var D,Y;if(I in R){D=R[I],Y=C[I];var Q=yr(J[I].length,function(ce){return S.def(D,"[",ce,"]")});S(_.cond(Q.map(function(ce,Le){return ce+"!=="+Y+"["+Le+"]"}).join("||")).then(k,".",ee[I],"(",Q,");",Q.map(function(ce,Le){return Y+"["+Le+"]="+ce}).join(";"),";"))}else{D=S.def(E,".",I);var z=_.cond(D,"!==",O,".",I);S(z),I in ye?z(_.cond(D).then(k,".enable(",ye[I],");").else(k,".disable(",ye[I],");"),O,".",I,"=",D,";"):z(k,".",ee[I],"(",D,");",O,".",I,"=",D,";")}}}),Object.keys(w.state).length===0&&S(O,".dirty=false;"),h(S)}function nr(_,h,w,P){var k=_.shared,C=_.current,R=k.current,O=k.gl;xf(Object.keys(w)).forEach(function(E){var S=w[E];if(!(P&&!P(S))){var m=S.append(_,h);if(ye[E]){var I=ye[E];vn(S)?m?h(O,".enable(",I,");"):h(O,".disable(",I,");"):h(_.cond(m).then(O,".enable(",I,");").else(O,".disable(",I,");")),h(R,".",E,"=",m,";")}else if(Gt(m)){var D=C[E];h(O,".",ee[E],"(",m,");",m.map(function(Y,Q){return D+"["+Q+"]="+Y}).join(";"),";")}else h(O,".",ee[E],"(",m,");",R,".",E,"=",m,";")}})}function Bt(_,h){fe&&(_.instancing=h.def(_.shared.extensions,".angle_instanced_arrays"))}function tt(_,h,w,P,k){var C=_.shared,R=_.stats,O=C.current,E=C.timer,S=w.profile;function m(){return typeof performance>"u"?"Date.now()":"performance.now()"}var I,D;function Y(Ne){I=h.def(),Ne(I,"=",m(),";"),typeof k=="string"?Ne(R,".count+=",k,";"):Ne(R,".count++;"),ie&&(P?(D=h.def(),Ne(D,"=",E,".getNumPendingQueries();")):Ne(E,".beginQuery(",R,");"))}function Q(Ne){Ne(R,".cpuTime+=",m(),"-",I,";"),ie&&(P?Ne(E,".pushScopeStats(",D,",",E,".getNumPendingQueries(),",R,");"):Ne(E,".endQuery();"))}function z(Ne){var $e=h.def(O,".profile");h(O,".profile=",Ne,";"),h.exit(O,".profile=",$e,";")}var ce;if(S){if(vn(S)){S.enable?(Y(h),Q(h.exit),z("true")):z("false");return}ce=S.append(_,h),z(ce)}else ce=h.def(O,".profile");var Le=_.block();Y(Le),h("if(",ce,"){",Le,"}");var rt=_.block();Q(rt),h.exit("if(",ce,"){",rt,"}")}function ir(_,h,w,P,k){var C=_.shared;function R(E){switch(E){case Wa:case Ka:case Ja:return 2;case Ya:case Qa:case eo:return 3;case qa:case Za:case to:return 4;default:return 1}}function O(E,S,m){var I=C.gl,D=h.def(E,".location"),Y=h.def(C.attributes,"[",D,"]"),Q=m.state,z=m.buffer,ce=[m.x,m.y,m.z,m.w],Le=["buffer","normalized","offset","stride"];function rt(){h("if(!",Y,".buffer){",I,".enableVertexAttribArray(",D,");}");var $e=m.type,Ze;if(m.size?Ze=h.def(m.size,"||",S):Ze=S,h("if(",Y,".type!==",$e,"||",Y,".size!==",Ze,"||",Le.map(function(Ft){return Y+"."+Ft+"!=="+m[Ft]}).join("||"),"){",I,".bindBuffer(",di,",",z,".buffer);",I,".vertexAttribPointer(",[D,Ze,$e,m.normalized,m.stride,m.offset],");",Y,".type=",$e,";",Y,".size=",Ze,";",Le.map(function(Ft){return Y+"."+Ft+"="+m[Ft]+";"}).join(""),"}"),fe){var Et=m.divisor;h("if(",Y,".divisor!==",Et,"){",_.instancing,".vertexAttribDivisorANGLE(",[D,Et],");",Y,".divisor=",Et,";}")}}function Ne(){h("if(",Y,".buffer){",I,".disableVertexAttribArray(",D,");",Y,".buffer=null;","}if(",ui.map(function($e,Ze){return Y+"."+$e+"!=="+ce[Ze]}).join("||"),"){",I,".vertexAttrib4f(",D,",",ce,");",ui.map(function($e,Ze){return Y+"."+$e+"="+ce[Ze]+";"}).join(""),"}")}Q===ci?rt():Q===ms?Ne():(h("if(",Q,"===",ci,"){"),rt(),h("}else{"),Ne(),h("}"))}P.forEach(function(E){var S=E.name,m=w.attributes[S],I;if(m){if(!k(m))return;I=m.append(_,h)}else{if(!k(Nf))return;var D=_.scopeAttrib(S);y.optional(function(){_.assert(h,D+".state","missing attribute "+S)}),I={},Object.keys(new L).forEach(function(Y){I[Y]=h.def(D,".",Y)})}O(_.link(E),R(E.info.type),I)})}function gt(_,h,w,P,k){for(var C=_.shared,R=C.gl,O,E=0;E<P.length;++E){var S=P[E],m=S.name,I=S.info.type,D=w.uniforms[m],Y=_.link(S),Q=Y+".location",z;if(D){if(!k(D))continue;if(vn(D)){var ce=D.value;if(y.command(ce!==null&&typeof ce<"u",'missing uniform "'+m+'"',_.commandStr),I===ji||I===zi){y.command(typeof ce=="function"&&(I===ji&&(ce._reglType==="texture2d"||ce._reglType==="framebuffer")||I===zi&&(ce._reglType==="textureCube"||ce._reglType==="framebufferCube")),"invalid texture for uniform "+m,_.commandStr);var Le=_.link(ce._texture||ce.color[0]._texture);h(R,".uniform1i(",Q,",",Le+".bind());"),h.exit(Le,".unbind();")}else if(I===Ui||I===$i||I===Vi){y.optional(function(){y.command(Gt(ce),"invalid matrix for uniform "+m,_.commandStr),y.command(I===Ui&&ce.length===4||I===$i&&ce.length===9||I===Vi&&ce.length===16,"invalid length for matrix uniform "+m,_.commandStr)});var rt=_.global.def("new Float32Array(["+Array.prototype.slice.call(ce)+"])"),Ne=2;I===$i?Ne=3:I===Vi&&(Ne=4),h(R,".uniformMatrix",Ne,"fv(",Q,",false,",rt,");")}else{switch(I){case Ps:y.commandType(ce,"number","uniform "+m,_.commandStr),O="1f";break;case Wa:y.command(Gt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2f";break;case Ya:y.command(Gt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3f";break;case qa:y.command(Gt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4f";break;case Ms:y.commandType(ce,"boolean","uniform "+m,_.commandStr),O="1i";break;case Ls:y.commandType(ce,"number","uniform "+m,_.commandStr),O="1i";break;case Ja:y.command(Gt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2i";break;case Ka:y.command(Gt(ce)&&ce.length===2,"uniform "+m,_.commandStr),O="2i";break;case eo:y.command(Gt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3i";break;case Qa:y.command(Gt(ce)&&ce.length===3,"uniform "+m,_.commandStr),O="3i";break;case to:y.command(Gt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4i";break;case Za:y.command(Gt(ce)&&ce.length===4,"uniform "+m,_.commandStr),O="4i";break}h(R,".uniform",O,"(",Q,",",Gt(ce)?Array.prototype.slice.call(ce):ce,");")}continue}else z=D.append(_,h)}else{if(!k(Nf))continue;z=h.def(C.uniforms,"[",v.id(m),"]")}I===ji?(y(!Array.isArray(z),"must specify a scalar prop for textures"),h("if(",z,"&&",z,'._reglType==="framebuffer"){',z,"=",z,".color[0];","}")):I===zi&&(y(!Array.isArray(z),"must specify a scalar prop for cube maps"),h("if(",z,"&&",z,'._reglType==="framebufferCube"){',z,"=",z,".color[0];","}")),y.optional(function(){function vr(Lr,Df){_.assert(h,Lr,'bad data or missing for uniform "'+m+'".  '+Df)}function Fs(Lr){y(!Array.isArray(z),"must not specify an array type for uniform"),vr("typeof "+z+'==="'+Lr+'"',"invalid type, expected "+Lr)}function Sr(Lr,Df){Array.isArray(z)?y(z.length===Lr,"must have length "+Lr):vr(C.isArrayLike+"("+z+")&&"+z+".length==="+Lr,"invalid vector, should have length "+Lr,_.commandStr)}function kf(Lr){y(!Array.isArray(z),"must not specify a value type"),vr("typeof "+z+'==="function"&&'+z+'._reglType==="texture'+(Lr===Ef?"2d":"Cube")+'"',"invalid texture type",_.commandStr)}switch(I){case Ls:Fs("number");break;case Ka:Sr(2);break;case Qa:Sr(3);break;case Za:Sr(4);break;case Ps:Fs("number");break;case Wa:Sr(2);break;case Ya:Sr(3);break;case qa:Sr(4);break;case Ms:Fs("boolean");break;case Ja:Sr(2);break;case eo:Sr(3);break;case to:Sr(4);break;case Ui:Sr(4);break;case $i:Sr(9);break;case Vi:Sr(16);break;case ji:kf(Ef);break;case zi:kf(kE);break}});var $e=1;switch(I){case ji:case zi:var Ze=h.def(z,"._texture");h(R,".uniform1i(",Q,",",Ze,".bind());"),h.exit(Ze,".unbind();");continue;case Ls:case Ms:O="1i";break;case Ka:case Ja:O="2i",$e=2;break;case Qa:case eo:O="3i",$e=3;break;case Za:case to:O="4i",$e=4;break;case Ps:O="1f";break;case Wa:O="2f",$e=2;break;case Ya:O="3f",$e=3;break;case qa:O="4f",$e=4;break;case Ui:O="Matrix2fv";break;case $i:O="Matrix3fv";break;case Vi:O="Matrix4fv";break}if(h(R,".uniform",O,"(",Q,","),O.charAt(0)==="M"){var Et=Math.pow(I-Ui+2,2),Ft=_.global.def("new Float32Array(",Et,")");Array.isArray(z)?h("false,(",yr(Et,function(vr){return Ft+"["+vr+"]="+z[vr]}),",",Ft,")"):h("false,(Array.isArray(",z,")||",z," instanceof Float32Array)?",z,":(",yr(Et,function(vr){return Ft+"["+vr+"]="+z+"["+vr+"]"}),",",Ft,")")}else $e>1?h(yr($e,function(vr){return Array.isArray(z)?z[vr]:z+"["+vr+"]"})):(y(!Array.isArray(z),"uniform value must not be an array"),h(z));h(");")}}function Be(_,h,w,P){var k=_.shared,C=k.gl,R=k.draw,O=P.draw;function E(){var Ze=O.elements,Et,Ft=h;return Ze?((Ze.contextDep&&P.contextDynamic||Ze.propDep)&&(Ft=w),Et=Ze.append(_,Ft)):Et=Ft.def(R,".",In),Et&&Ft("if("+Et+")"+C+".bindBuffer("+PE+","+Et+".buffer.buffer);"),Et}function S(){var Ze=O.count,Et,Ft=h;return Ze?((Ze.contextDep&&P.contextDynamic||Ze.propDep)&&(Ft=w),Et=Ze.append(_,Ft),y.optional(function(){Ze.MISSING&&_.assert(h,"false","missing vertex count"),Ze.DYNAMIC&&_.assert(Ft,Et+">=0","missing vertex count")})):(Et=Ft.def(R,".",Ln),y.optional(function(){_.assert(Ft,Et+">=0","missing vertex count")})),Et}var m=E();function I(Ze){var Et=O[Ze];return Et?Et.contextDep&&P.contextDynamic||Et.propDep?Et.append(_,w):Et.append(_,h):h.def(R,".",Ze)}var D=I(Pn),Y=I(Ha),Q=S();if(typeof Q=="number"){if(Q===0)return}else w("if(",Q,"){"),w.exit("}");var z,ce;fe&&(z=I(Xa),ce=_.instancing);var Le=m+".type",rt=O.elements&&vn(O.elements);function Ne(){function Ze(){w(ce,".drawElementsInstancedANGLE(",[D,Q,Le,Y+"<<(("+Le+"-"+Qc+")>>1)",z],");")}function Et(){w(ce,".drawArraysInstancedANGLE(",[D,Y,Q,z],");")}m?rt?Ze():(w("if(",m,"){"),Ze(),w("}else{"),Et(),w("}")):Et()}function $e(){function Ze(){w(C+".drawElements("+[D,Q,Le,Y+"<<(("+Le+"-"+Qc+")>>1)"]+");")}function Et(){w(C+".drawArrays("+[D,Y,Q]+");")}m?rt?Ze():(w("if(",m,"){"),Ze(),w("}else{"),Et(),w("}")):Et()}fe&&(typeof z!="number"||z>=0)?typeof z=="string"?(w("if(",z,">0){"),Ne(),w("}else if(",z,"<0){"),$e(),w("}")):Ne():$e()}function ut(_,h,w,P,k){var C=Xe(),R=C.proc("body",k);return y.optional(function(){C.commandStr=h.commandStr,C.command=C.link(h.commandStr)}),fe&&(C.instancing=R.def(C.shared.extensions,".angle_instanced_arrays")),_(C,R,w,P),C.compile().body}function yt(_,h,w,P){Bt(_,h),w.useVAO?w.drawVAO?h(_.shared.vao,".setVAO(",w.drawVAO.append(_,h),");"):h(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(h(_.shared.vao,".setVAO(null);"),ir(_,h,w,P.attributes,function(){return!0})),gt(_,h,w,P.uniforms,function(){return!0}),Be(_,h,h,w)}function Ut(_,h){var w=_.proc("draw",1);Bt(_,w),Yt(_,w,h.context),qt(_,w,h.framebuffer),er(_,w,h),nr(_,w,h.state),tt(_,w,h,!1,!0);var P=h.shader.progVar.append(_,w);if(w(_.shared.gl,".useProgram(",P,".program);"),h.shader.program)yt(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var k=_.global.def("{}"),C=w.def(P,".id"),R=w.def(k,"[",C,"]");w(_.cond(R).then(R,".call(this,a0);").else(R,"=",k,"[",C,"]=",_.link(function(O){return ut(yt,_,h,O,1)}),"(",P,");",R,".call(this,a0);"))}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function Gr(_,h,w,P){_.batchId="a1",Bt(_,h);function k(){return!0}ir(_,h,w,P.attributes,k),gt(_,h,w,P.uniforms,k),Be(_,h,h,w)}function kn(_,h,w,P){Bt(_,h);var k=w.contextDep,C=h.def(),R="a0",O="a1",E=h.def();_.shared.props=E,_.batchId=C;var S=_.scope(),m=_.scope();h(S.entry,"for(",C,"=0;",C,"<",O,";++",C,"){",E,"=",R,"[",C,"];",m,"}",S.exit);function I(Le){return Le.contextDep&&k||Le.propDep}function D(Le){return!I(Le)}if(w.needsContext&&Yt(_,m,w.context),w.needsFramebuffer&&qt(_,m,w.framebuffer),nr(_,m,w.state,I),w.profile&&I(w.profile)&&tt(_,m,w,!1,!0),P)w.useVAO?w.drawVAO?I(w.drawVAO)?m(_.shared.vao,".setVAO(",w.drawVAO.append(_,m),");"):S(_.shared.vao,".setVAO(",w.drawVAO.append(_,S),");"):S(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(S(_.shared.vao,".setVAO(null);"),ir(_,S,w,P.attributes,D),ir(_,m,w,P.attributes,I)),gt(_,S,w,P.uniforms,D),gt(_,m,w,P.uniforms,I),Be(_,S,m,w);else{var Y=_.global.def("{}"),Q=w.shader.progVar.append(_,m),z=m.def(Q,".id"),ce=m.def(Y,"[",z,"]");m(_.shared.gl,".useProgram(",Q,".program);","if(!",ce,"){",ce,"=",Y,"[",z,"]=",_.link(function(Le){return ut(Gr,_,w,Le,2)}),"(",Q,");}",ce,".call(this,a0[",C,"],",C,");")}}function g(_,h){var w=_.proc("batch",2);_.batchId="0",Bt(_,w);var P=!1,k=!0;Object.keys(h.context).forEach(function(Y){P=P||h.context[Y].propDep}),P||(Yt(_,w,h.context),k=!1);var C=h.framebuffer,R=!1;C?(C.propDep?P=R=!0:C.contextDep&&P&&(R=!0),R||qt(_,w,C)):qt(_,w,null),h.state.viewport&&h.state.viewport.propDep&&(P=!0);function O(Y){return Y.contextDep&&P||Y.propDep}er(_,w,h),nr(_,w,h.state,function(Y){return!O(Y)}),(!h.profile||!O(h.profile))&&tt(_,w,h,!1,"a1"),h.contextDep=P,h.needsContext=k,h.needsFramebuffer=R;var E=h.shader.progVar;if(E.contextDep&&P||E.propDep)kn(_,w,h,null);else{var S=E.append(_,w);if(w(_.shared.gl,".useProgram(",S,".program);"),h.shader.program)kn(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var m=_.global.def("{}"),I=w.def(S,".id"),D=w.def(m,"[",I,"]");w(_.cond(D).then(D,".call(this,a0,a1);").else(D,"=",m,"[",I,"]=",_.link(function(Y){return ut(kn,_,h,Y,2)}),"(",S,");",D,".call(this,a0,a1);"))}}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function U(_,h){var w=_.proc("scope",3);_.batchId="a2";var P=_.shared,k=P.current;Yt(_,w,h.context),h.framebuffer&&h.framebuffer.append(_,w),xf(Object.keys(h.state)).forEach(function(R){var O=h.state[R],E=O.append(_,w);Gt(E)?E.forEach(function(S,m){w.set(_.next[R],"["+m+"]",S)}):w.set(P.next,"."+R,E)}),tt(_,w,h,!0,!0),[In,Ha,Ln,Xa,Pn].forEach(function(R){var O=h.draw[R];!O||w.set(P.draw,"."+R,""+O.append(_,w))}),Object.keys(h.uniforms).forEach(function(R){var O=h.uniforms[R].append(_,w);Array.isArray(O)&&(O="["+O.join()+"]"),w.set(P.uniforms,"["+v.id(R)+"]",O)}),Object.keys(h.attributes).forEach(function(R){var O=h.attributes[R].append(_,w),E=_.scopeAttrib(R);Object.keys(new L).forEach(function(S){w.set(E,"."+S,O[S])})}),h.scopeVAO&&w.set(P.vao,".targetVAO",h.scopeVAO.append(_,w));function C(R){var O=h.shader[R];O&&w.set(P.shader,"."+R,O.append(_,w))}C(Fi),C(Gi),Object.keys(h.state).length>0&&(w(k,".dirty=true;"),w.exit(k,".dirty=true;")),w("a1(",_.shared.context,",a0,",_.batchId,");")}function F(_){if(!(typeof _!="object"||Gt(_))){for(var h=Object.keys(_),w=0;w<h.length;++w)if(Vt.isDynamic(_[h[w]]))return!0;return!1}}function Ce(_,h,w){var P=h.static[w];if(!P||!F(P))return;var k=_.global,C=Object.keys(P),R=!1,O=!1,E=!1,S=_.global.def("{}");C.forEach(function(I){var D=P[I];if(Vt.isDynamic(D)){typeof D=="function"&&(D=P[I]=Vt.unbox(D));var Y=_r(D,null);R=R||Y.thisDep,E=E||Y.propDep,O=O||Y.contextDep}else{switch(k(S,".",I,"="),typeof D){case"number":k(D);break;case"string":k('"',D,'"');break;case"object":Array.isArray(D)&&k("[",D.join(),"]");break;default:k(_.link(D));break}k(";")}});function m(I,D){C.forEach(function(Y){var Q=P[Y];if(!!Vt.isDynamic(Q)){var z=I.invoke(D,Q);D(S,".",Y,"=",z,";")}})}h.dynamic[w]=new Vt.DynamicVariable(ja,{thisDep:R,contextDep:O,propDep:E,ref:S,append:m}),delete h.static[w]}function st(_,h,w,P,k){var C=Xe();C.stats=C.link(k),Object.keys(h.static).forEach(function(O){Ce(C,h,O)}),IE.forEach(function(O){Ce(C,_,O)});var R=Xt(_,h,w,P,C);return Ut(C,R),U(C,R),g(C,R),n(C.compile(),{destroy:function(){R.shader.program.destroy()}})}return{next:Re,current:J,procs:function(){var _=Xe(),h=_.proc("poll"),w=_.proc("refresh"),P=_.block();h(P),w(P);var k=_.shared,C=k.gl,R=k.next,O=k.current;P(O,".dirty=false;"),qt(_,h),qt(_,w,null,!0);var E;fe&&(E=_.link(fe)),T.oes_vertex_array_object&&w(_.link(T.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var S=0;S<B.maxAttributes;++S){var m=w.def(k.attributes,"[",S,"]"),I=_.cond(m,".buffer");I.then(C,".enableVertexAttribArray(",S,");",C,".bindBuffer(",di,",",m,".buffer.buffer);",C,".vertexAttribPointer(",S,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(C,".disableVertexAttribArray(",S,");",C,".vertexAttrib4f(",S,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),w(I),fe&&w(E,".vertexAttribDivisorANGLE(",S,",",m,".divisor);")}return w(_.shared.vao,".currentVAO=null;",_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"),Object.keys(ye).forEach(function(D){var Y=ye[D],Q=P.def(R,".",D),z=_.block();z("if(",Q,"){",C,".enable(",Y,")}else{",C,".disable(",Y,")}",O,".",D,"=",Q,";"),w(z),h("if(",Q,"!==",O,".",D,"){",z,"}")}),Object.keys(ee).forEach(function(D){var Y=ee[D],Q=J[D],z,ce,Le=_.block();if(Le(C,".",Y,"("),Gt(Q)){var rt=Q.length;z=_.global.def(R,".",D),ce=_.global.def(O,".",D),Le(yr(rt,function(Ne){return z+"["+Ne+"]"}),");",yr(rt,function(Ne){return ce+"["+Ne+"]="+z+"["+Ne+"];"}).join("")),h("if(",yr(rt,function(Ne){return z+"["+Ne+"]!=="+ce+"["+Ne+"]"}).join("||"),"){",Le,"}")}else z=P.def(R,".",D),ce=P.def(O,".",D),Le(z,");",O,".",D,"=",z,";"),h("if(",z,"!==",ce,"){",Le,"}");w(Le)}),_.compile()}(),compile:st}}function QE(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ZE=34918,JE=34919,Of=35007,eb=function(l,v){if(!v.ext_disjoint_timer_query)return null;var T=[];function B(){return T.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function K(fe){T.push(fe)}var G=[];function $(fe){var Se=B();v.ext_disjoint_timer_query.beginQueryEXT(Of,Se),G.push(Se),ie(G.length-1,G.length,fe)}function ne(){v.ext_disjoint_timer_query.endQueryEXT(Of)}function se(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var le=[];function ue(){return le.pop()||new se}function ve(fe){le.push(fe)}var be=[];function ie(fe,Se,J){var Re=ue();Re.startQueryIndex=fe,Re.endQueryIndex=Se,Re.sum=0,Re.stats=J,be.push(Re)}var pe=[],L=[];function V(){var fe,Se,J=G.length;if(J!==0){L.length=Math.max(L.length,J+1),pe.length=Math.max(pe.length,J+1),pe[0]=0,L[0]=0;var Re=0;for(fe=0,Se=0;Se<G.length;++Se){var te=G[Se];v.ext_disjoint_timer_query.getQueryObjectEXT(te,JE)?(Re+=v.ext_disjoint_timer_query.getQueryObjectEXT(te,ZE),K(te)):G[fe++]=te,pe[Se+1]=Re,L[Se+1]=fe}for(G.length=fe,fe=0,Se=0;Se<be.length;++Se){var ye=be[Se],ee=ye.startQueryIndex,_e=ye.endQueryIndex;ye.sum+=pe[_e]-pe[ee];var ke=L[ee],qe=L[_e];qe===ke?(ye.stats.gpuTime+=ye.sum/1e6,ve(ye)):(ye.startQueryIndex=ke,ye.endQueryIndex=qe,be[fe++]=ye)}be.length=fe}}return{beginQuery:$,endQuery:ne,pushScopeStats:ie,update:V,getNumPendingQueries:function(){return G.length},clear:function(){T.push.apply(T,G);for(var fe=0;fe<T.length;fe++)v.ext_disjoint_timer_query.deleteQueryEXT(T[fe]);G.length=0,T.length=0},restore:function(){G.length=0,T.length=0}}},tb=16384,rb=256,nb=1024,ib=34962,If="webglcontextlost",Pf="webglcontextrestored",Lf=1,ab=2,ob=3;function Mf(l,v){for(var T=0;T<l.length;++T)if(l[T]===v)return T;return-1}function sb(l){var v=i_(l);if(!v)return null;var T=v.gl,B=T.getContextAttributes(),K=T.isContextLost(),G=a_(T,v);if(!G)return null;var $=Jy(),ne=QE(),se=G.extensions,le=eb(T,se),ue=$u(),ve=T.drawingBufferWidth,be=T.drawingBufferHeight,ie={tick:0,time:0,viewportWidth:ve,viewportHeight:be,framebufferWidth:ve,framebufferHeight:be,drawingBufferWidth:ve,drawingBufferHeight:be,pixelRatio:v.pixelRatio},pe={},L={elements:null,primitive:4,count:-1,offset:0,instances:-1},V=X_(T,se),fe=u0(T,ne,v,J),Se=bE(T,se,V,ne,fe);function J(Be){return Se.destroyBuffer(Be)}var Re=b0(T,se,fe,ne),te=SE(T,$,ne,v),ye=Q0(T,se,V,function(){ke.procs.poll()},ie,ne,v),ee=Z0(T,se,V,ne,v),_e=_E(T,se,V,ye,ee,ne),ke=KE(T,$,se,V,fe,Re,ye,_e,pe,Se,te,L,ie,le,v),qe=CE(T,_e,ke.procs.poll,ie,B,se,V),ge=ke.next,de=T.canvas,Z=[],Xe=[],et=[],xe=[v.onDestroy],ot=null;function Ke(){if(Z.length===0){le&&le.update(),ot=null;return}ot=Qn.next(Ke),nr();for(var Be=Z.length-1;Be>=0;--Be){var ut=Z[Be];ut&&ut(ie,null,0)}T.flush(),le&&le.update()}function it(){!ot&&Z.length>0&&(ot=Qn.next(Ke))}function _t(){ot&&(Qn.cancel(Ke),ot=null)}function Ht(Be){Be.preventDefault(),K=!0,_t(),Xe.forEach(function(ut){ut()})}function Jt(Be){T.getError(),K=!1,G.restore(),te.restore(),fe.restore(),ye.restore(),ee.restore(),_e.restore(),Se.restore(),le&&le.restore(),ke.procs.refresh(),it(),et.forEach(function(ut){ut()})}de&&(de.addEventListener(If,Ht,!1),de.addEventListener(Pf,Jt,!1));function lt(){Z.length=0,_t(),de&&(de.removeEventListener(If,Ht),de.removeEventListener(Pf,Jt)),te.clear(),_e.clear(),ee.clear(),ye.clear(),Re.clear(),fe.clear(),Se.clear(),le&&le.clear(),xe.forEach(function(Be){Be()})}function Wt(Be){y(!!Be,"invalid args to regl({...})"),y.type(Be,"object","invalid args to regl({...})");function ut(k){var C=n({},k);delete C.uniforms,delete C.attributes,delete C.context,delete C.vao,"stencil"in C&&C.stencil.op&&(C.stencil.opBack=C.stencil.opFront=C.stencil.op,delete C.stencil.op);function R(O){if(O in C){var E=C[O];delete C[O],Object.keys(E).forEach(function(S){C[O+"."+S]=E[S]})}}return R("blend"),R("depth"),R("cull"),R("stencil"),R("polygonOffset"),R("scissor"),R("sample"),"vao"in k&&(C.vao=k.vao),C}function yt(k,C){var R={},O={};return Object.keys(k).forEach(function(E){var S=k[E];if(Vt.isDynamic(S)){O[E]=Vt.unbox(S,E);return}else if(C&&Array.isArray(S)){for(var m=0;m<S.length;++m)if(Vt.isDynamic(S[m])){O[E]=Vt.unbox(S,E);return}}R[E]=S}),{dynamic:O,static:R}}var Ut=yt(Be.context||{},!0),Gr=yt(Be.uniforms||{},!0),kn=yt(Be.attributes||{},!1),g=yt(ut(Be),!1),U={gpuTime:0,cpuTime:0,count:0},F=ke.compile(g,kn,Gr,Ut,U),Ce=F.draw,st=F.batch,_=F.scope,h=[];function w(k){for(;h.length<k;)h.push(null);return h}function P(k,C){var R;if(K&&y.raise("context lost"),typeof k=="function")return _.call(this,null,k,0);if(typeof C=="function")if(typeof k=="number")for(R=0;R<k;++R)_.call(this,null,C,R);else if(Array.isArray(k))for(R=0;R<k.length;++R)_.call(this,k[R],C,R);else return _.call(this,k,C,0);else if(typeof k=="number"){if(k>0)return st.call(this,w(k|0),k|0)}else if(Array.isArray(k)){if(k.length)return st.call(this,k,k.length)}else return Ce.call(this,k)}return n(P,{stats:U,destroy:function(){F.destroy()}})}var It=_e.setFBO=Wt({framebuffer:Vt.define.call(null,Lf,"framebuffer")});function Xt(Be,ut){var yt=0;ke.procs.poll();var Ut=ut.color;Ut&&(T.clearColor(+Ut[0]||0,+Ut[1]||0,+Ut[2]||0,+Ut[3]||0),yt|=tb),"depth"in ut&&(T.clearDepth(+ut.depth),yt|=rb),"stencil"in ut&&(T.clearStencil(ut.stencil|0),yt|=nb),y(!!yt,"called regl.clear with no buffer specified"),T.clear(yt)}function Yt(Be){if(y(typeof Be=="object"&&Be,"regl.clear() takes an object as input"),"framebuffer"in Be)if(Be.framebuffer&&Be.framebuffer_reglType==="framebufferCube")for(var ut=0;ut<6;++ut)It(n({framebuffer:Be.framebuffer.faces[ut]},Be),Xt);else It(Be,Xt);else Xt(null,Be)}function qt(Be){y.type(Be,"function","regl.frame() callback must be a function"),Z.push(Be);function ut(){var yt=Mf(Z,Be);y(yt>=0,"cannot cancel a frame twice");function Ut(){var Gr=Mf(Z,Ut);Z[Gr]=Z[Z.length-1],Z.length-=1,Z.length<=0&&_t()}Z[yt]=Ut}return it(),{cancel:ut}}function er(){var Be=ge.viewport,ut=ge.scissor_box;Be[0]=Be[1]=ut[0]=ut[1]=0,ie.viewportWidth=ie.framebufferWidth=ie.drawingBufferWidth=Be[2]=ut[2]=T.drawingBufferWidth,ie.viewportHeight=ie.framebufferHeight=ie.drawingBufferHeight=Be[3]=ut[3]=T.drawingBufferHeight}function nr(){ie.tick+=1,ie.time=tt(),er(),ke.procs.poll()}function Bt(){ye.refresh(),er(),ke.procs.refresh(),le&&le.update()}function tt(){return($u()-ue)/1e3}Bt();function ir(Be,ut){y.type(ut,"function","listener callback must be a function");var yt;switch(Be){case"frame":return qt(ut);case"lost":yt=Xe;break;case"restore":yt=et;break;case"destroy":yt=xe;break;default:y.raise("invalid event, must be one of frame,lost,restore,destroy")}return yt.push(ut),{cancel:function(){for(var Ut=0;Ut<yt.length;++Ut)if(yt[Ut]===ut){yt[Ut]=yt[yt.length-1],yt.pop();return}}}}var gt=n(Wt,{clear:Yt,prop:Vt.define.bind(null,Lf),context:Vt.define.bind(null,ab),this:Vt.define.bind(null,ob),draw:Wt({}),buffer:function(Be){return fe.create(Be,ib,!1,!1)},elements:function(Be){return Re.create(Be,!1)},texture:ye.create2D,cube:ye.createCube,renderbuffer:ee.create,framebuffer:_e.create,framebufferCube:_e.createCube,vao:Se.createVAO,attributes:B,frame:qt,on:ir,limits:V,hasExtension:function(Be){return V.extensions.indexOf(Be.toLowerCase())>=0},read:qe,destroy:lt,_gl:T,_refresh:Bt,poll:function(){nr(),le&&le.update()},now:tt,stats:ne});return v.onDone(null,gt),gt}return sb})})(Oy);const Pw=Oy.exports;var Lw=function(){function e(t,r){De(this,e),this.attribute=void 0,this.buffer=void 0;var n=r.buffer,i=r.offset,a=r.stride,o=r.normalized,s=r.size,u=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return We(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Jr,ra,en,Rr,na,mn,ia,fo,Br,Gn,ar,Ur,$r,lo,Mw=(Jr={},q(Jr,M.POINTS,"points"),q(Jr,M.LINES,"lines"),q(Jr,M.LINE_LOOP,"line loop"),q(Jr,M.LINE_STRIP,"line strip"),q(Jr,M.TRIANGLES,"triangles"),q(Jr,M.TRIANGLE_FAN,"triangle fan"),q(Jr,M.TRIANGLE_STRIP,"triangle strip"),Jr),Iy=(ra={},q(ra,M.STATIC_DRAW,"static"),q(ra,M.DYNAMIC_DRAW,"dynamic"),q(ra,M.STREAM_DRAW,"stream"),ra),Bu=(en={},q(en,M.BYTE,"int8"),q(en,M.UNSIGNED_INT,"int16"),q(en,M.INT,"int32"),q(en,M.UNSIGNED_BYTE,"uint8"),q(en,M.UNSIGNED_SHORT,"uint16"),q(en,M.UNSIGNED_INT,"uint32"),q(en,M.FLOAT,"float"),en),kw=(Rr={},q(Rr,M.ALPHA,"alpha"),q(Rr,M.LUMINANCE,"luminance"),q(Rr,M.LUMINANCE_ALPHA,"luminance alpha"),q(Rr,M.RGB,"rgb"),q(Rr,M.RGBA,"rgba"),q(Rr,M.RGBA4,"rgba4"),q(Rr,M.RGB5_A1,"rgb5 a1"),q(Rr,M.RGB565,"rgb565"),q(Rr,M.DEPTH_COMPONENT,"depth"),q(Rr,M.DEPTH_STENCIL,"depth stencil"),Rr),Dw=(na={},q(na,M.DONT_CARE,"dont care"),q(na,M.NICEST,"nice"),q(na,M.FASTEST,"fast"),na),Cv=(mn={},q(mn,M.NEAREST,"nearest"),q(mn,M.LINEAR,"linear"),q(mn,M.LINEAR_MIPMAP_LINEAR,"mipmap"),q(mn,M.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),q(mn,M.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),q(mn,M.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),mn),xv=(ia={},q(ia,M.REPEAT,"repeat"),q(ia,M.CLAMP_TO_EDGE,"clamp"),q(ia,M.MIRRORED_REPEAT,"mirror"),ia),Fw=(fo={},q(fo,M.NONE,"none"),q(fo,M.BROWSER_DEFAULT_WEBGL,"browser"),fo),Gw=(Br={},q(Br,M.NEVER,"never"),q(Br,M.ALWAYS,"always"),q(Br,M.LESS,"less"),q(Br,M.LEQUAL,"lequal"),q(Br,M.GREATER,"greater"),q(Br,M.GEQUAL,"gequal"),q(Br,M.EQUAL,"equal"),q(Br,M.NOTEQUAL,"notequal"),Br),Nv=(Gn={},q(Gn,M.FUNC_ADD,"add"),q(Gn,M.MIN_EXT,"min"),q(Gn,M.MAX_EXT,"max"),q(Gn,M.FUNC_SUBTRACT,"subtract"),q(Gn,M.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Gn),ho=(ar={},q(ar,M.ZERO,"zero"),q(ar,M.ONE,"one"),q(ar,M.SRC_COLOR,"src color"),q(ar,M.ONE_MINUS_SRC_COLOR,"one minus src color"),q(ar,M.SRC_ALPHA,"src alpha"),q(ar,M.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),q(ar,M.DST_COLOR,"dst color"),q(ar,M.ONE_MINUS_DST_COLOR,"one minus dst color"),q(ar,M.DST_ALPHA,"dst alpha"),q(ar,M.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),q(ar,M.CONSTANT_COLOR,"constant color"),q(ar,M.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),q(ar,M.CONSTANT_ALPHA,"constant alpha"),q(ar,M.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),q(ar,M.SRC_ALPHA_SATURATE,"src alpha saturate"),ar),Bw=(Ur={},q(Ur,M.NEVER,"never"),q(Ur,M.ALWAYS,"always"),q(Ur,M.LESS,"less"),q(Ur,M.LEQUAL,"lequal"),q(Ur,M.GREATER,"greater"),q(Ur,M.GEQUAL,"gequal"),q(Ur,M.EQUAL,"equal"),q(Ur,M.NOTEQUAL,"notequal"),Ur),_i=($r={},q($r,M.ZERO,"zero"),q($r,M.KEEP,"keep"),q($r,M.REPLACE,"replace"),q($r,M.INVERT,"invert"),q($r,M.INCR,"increment"),q($r,M.DECR,"decrement"),q($r,M.INCR_WRAP,"increment wrap"),q($r,M.DECR_WRAP,"decrement wrap"),$r),Uw=(lo={},q(lo,M.FRONT,"front"),q(lo,M.BACK,"back"),lo),$w=function(){function e(t,r){De(this,e),this.buffer=void 0;var n=r.data,i=r.usage,a=r.type;this.buffer=t.buffer({data:n,usage:Iy[i||M.STATIC_DRAW],type:Bu[a||M.UNSIGNED_BYTE]})}return We(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}();function Vw(e){if(Array.isArray(e))return lu(e)}function jw(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zw(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kt(e){return Vw(e)||jw(e)||ay(e)||zw()}var Hw=9007199254740991,Xw="[object Arguments]",Ww="[object Array]",Yw="[object Boolean]",qw="[object Date]",Kw="[object Error]",Qw="[object Function]",Zw="[object Map]",Jw="[object Number]",eR="[object Object]",tR="[object RegExp]",rR="[object Set]",nR="[object String]",iR="[object WeakMap]",aR="[object ArrayBuffer]",oR="[object DataView]",sR="[object Float32Array]",uR="[object Float64Array]",cR="[object Int8Array]",fR="[object Int16Array]",lR="[object Int32Array]",dR="[object Uint8Array]",hR="[object Uint8ClampedArray]",vR="[object Uint16Array]",pR="[object Uint32Array]",Dt={};Dt[sR]=Dt[uR]=Dt[cR]=Dt[fR]=Dt[lR]=Dt[dR]=Dt[hR]=Dt[vR]=Dt[pR]=!0;Dt[Xw]=Dt[Ww]=Dt[aR]=Dt[Yw]=Dt[oR]=Dt[qw]=Dt[Kw]=Dt[Qw]=Dt[Zw]=Dt[Jw]=Dt[eR]=Dt[tR]=Dt[rR]=Dt[nR]=Dt[iR]=!1;var mR=Object.prototype,yR=mR.toString;function _R(e){return bR(e)&&ER(e.length)&&!!Dt[yR.call(e)]}function ER(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=Hw}function bR(e){return!!e&&sn(e)==="object"}var gu=_R;function Ov(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Iv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ov(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ov(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var gR=`attribute vec3 a_Position;
attribute vec2 a_TexCoord;

varying vec2 v_TexCoord;

void main() {
  gl_Position = vec4(a_Position, 1.0);
  v_TexCoord = a_TexCoord;
}`,Pv=0,TR=function(){function e(t,r){var n=this;De(this,e),this.reGl=t,this.context=r,this.entity=jr(),this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var i={};this.context.uniforms.forEach(function(c){var f=c.name,d=c.type,p=c.data,b=c.isReferer,A=c.storageClass;if(A===An.StorageBuffer){if(b)n.textureCache[f]={data:void 0},i["".concat(f,"Size")]=function(){return p.compiledBundle.context.output.textureSize};else{n.textureCache[f]=n.calcDataTexture(f,d,p);var x=n.textureCache[f],N=x.textureWidth,X=x.isOutput;i["".concat(f,"Size")]=[N,N],X&&(n.outputTextureName=f,n.context.needPingpong&&(n.outputTextureName="".concat(f,"Output"),n.textureCache[n.outputTextureName]=n.calcDataTexture(f,d,p)))}i[f]=function(){return n.textureCache[f].texture}}else if(A===An.Uniform){if(p&&(Array.isArray(p)||gu(p))&&p.length>16)throw new Error("invalid data type ".concat(d));i[f]=function(){return c.data}}});var a=this.getOuputDataTexture(),o=a.textureWidth,s=a.texelCount;i.u_OutputTextureSize=[o,o],i.u_OutputTexelCount=s,this.context.output.textureSize=[o,o];var u={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(this.context.shader),uniforms:i,vert:gR,primitive:"triangle strip",count:4};this.computeCommand=this.reGl(u)}return We(e,[{key:"run",value:function(){var r=this;this.context.maxIteration>1&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use(function(){r.computeCommand()})}},{key:"readData",value:function(){var t=Tt(Pe.mark(function n(){var i=this,a,o,s,u,c,f,d,p;return Pe.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.reGl({framebuffer:this.texFBO})(function(){a=i.reGl.read()}),!a){A.next=6;break}if(o=this.getOuputDataTexture(),s=o.originalDataLength,u=o.elementsPerTexel,c=o.typedArrayConstructor,f=c===void 0?Float32Array:c,d=[],u!==4)for(p=0;p<a.length;p+=4)u===1?d.push(a[p]):u===2?d.push(a[p],a[p+1]):d.push(a[p],a[p+1],a[p+2]);else d=a;return A.abrupt("return",new f(d.slice(0,s)));case 6:return A.abrupt("return",new Float32Array);case 7:case"end":return A.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"confirmInput",value:function(r,n){var i;this.entity===r.entity?(this.dynamicPingpong=!0,i=this):i=r,this.textureCache[n].id=i.getOuputDataTexture().id,this.textureCache[n].texture=i.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(r,n){var i=this.context.uniforms.find(function(u){var c=u.name;return c===r});if(i){var a=this.calcDataTexture(r,i.type,n),o=a.texture,s=a.data;this.textureCache[r].data=s,this.textureCache[r].texture=o}}},{key:"destroy",value:function(){}},{key:"swap",value:function(){if(this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong){var r=this.context.output.name;this.textureCache[r].id=this.getOuputDataTexture().id,this.textureCache[r].texture=this.getOuputDataTexture().texture}var n=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=n}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var r=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=r}},{key:"cloneDataTexture",value:function(r){var n=r.data,i=r.textureWidth;return Iv(Iv({},r),{},{id:Pv++,texture:this.reGl.texture({width:i,height:i,data:n,type:"float"})})}},{key:"calcDataTexture",value:function(r,n,i){var a=1;n===Hn.Vector4FloatArray&&(a=4);for(var o=[],s=0;s<i.length;s+=a)a===1?o.push(i[s],0,0,0):a===2?o.push(i[s],i[s+1],0,0):a===3?o.push(i[s],i[s+1],i[s+2],0):a===4&&o.push(i[s],i[s+1],i[s+2],i[s+3]);var u=i.length,c=Math.ceil(u/a),f=Math.ceil(Math.sqrt(c)),d=f*f;c<d&&o.push.apply(o,Kt(new Array((d-c)*4).fill(0)));var p=this.reGl.texture({width:f,height:f,data:o,type:"float"});return{id:Pv++,data:o,originalDataLength:u,typedArrayConstructor:gu(i)?i.constructor:void 0,textureWidth:f,texture:p,texelCount:c,elementsPerTexel:a,isOutput:r===this.context.output.name}}}]),e}(),AR=function(){function e(t,r){De(this,e),this.elements=void 0;var n=r.data,i=r.usage,a=r.type,o=r.count;this.elements=t.elements({data:n,usage:Iy[i||M.STATIC_DRAW],type:Bu[a||M.UNSIGNED_BYTE],count:o})}return We(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){this.elements.destroy()}}]),e}(),SR=function(){function e(t,r){De(this,e),this.framebuffer=void 0;var n=r.width,i=r.height,a=r.color,o=r.colors;r.depth,r.stencil;var s={width:n,height:i};Array.isArray(o)&&(s.colors=o.map(function(u){return u.get()})),a&&typeof a!="boolean"&&(s.color=a.get()),this.framebuffer=t.framebuffer(s)}return We(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}();function wR(e){var t=sn(e);return e!=null&&(t==="object"||t==="function")}function pa(e){var t={};return Object.keys(e).forEach(function(r){Tu(r,e[r],t,"")}),t}function Tu(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||gu(t)||t===""||t.resize!==void 0){r["".concat(n&&n+".").concat(e)]=t;return}wR(t)&&Object.keys(t).forEach(function(i){Tu(i,t[i],r,"".concat(n&&n+".").concat(e))}),Array.isArray(t)&&t.forEach(function(i,a){Object.keys(i).forEach(function(o){Tu(o,i[o],r,"".concat(n&&n+".").concat(e,"[").concat(a,"]"))})})}function Lv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ei(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lv(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var RR=function(){function e(t,r){De(this,e),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=t;var n=r.vs,i=r.fs,a=r.defines,o=r.attributes,s=r.uniforms,u=r.primitive,c=r.count,f=r.elements,d=r.depth,p=r.blend,b=r.stencil,A=r.cull,x=r.instances,N=r.scissor,X=r.viewport,ae={};s&&(this.uniforms=pa(s),Object.keys(s).forEach(function(we){ae[we]=t.prop(we)}));var W={};Object.keys(o).forEach(function(we){W[we]=o[we].get()});var Ee=a&&this.generateDefines(a)||"",he={attributes:W,frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(Ee,`
`).concat(i),uniforms:ae,vert:`
`.concat(Ee,`
`).concat(n),primitive:Mw[u===void 0?M.TRIANGLES:u]};x&&(he.instances=x),c&&(he.count=c),f&&(he.elements=f.get()),N&&(he.scissor=N),X&&(he.viewport=X),this.initDepthDrawParams({depth:d},he),this.initBlendDrawParams({blend:p},he),this.initStencilDrawParams({stencil:b},he),this.initCullDrawParams({cull:A},he),this.drawCommand=t(he)}return We(e,[{key:"addUniforms",value:function(r){this.uniforms=Ei(Ei({},this.uniforms),pa(r))}},{key:"draw",value:function(r){var n=Ei(Ei({},this.uniforms),pa(r.uniforms||{})),i={};Object.keys(n).forEach(function(a){var o=sn(n[a]);o==="boolean"||o==="number"||Array.isArray(n[a])||n[a].BYTES_PER_ELEMENT?i[a]=n[a]:o==="string"||(i[a]=n[a].get())}),this.drawCommand(i)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:Gw[i.func||M.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var i=r.blend;if(i){var a=i.enable,o=i.func,s=i.equation,u=i.color,c=u===void 0?[0,0,0,0]:u;n.blend={enable:!!a,func:{srcRGB:ho[o&&o.srcRGB||M.SRC_ALPHA],srcAlpha:ho[o&&o.srcAlpha||M.SRC_ALPHA],dstRGB:ho[o&&o.dstRGB||M.ONE_MINUS_SRC_ALPHA],dstAlpha:ho[o&&o.dstAlpha||M.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Nv[s&&s.rgb||M.FUNC_ADD],alpha:Nv[s&&s.alpha||M.FUNC_ADD]},color:c}}}},{key:"initStencilDrawParams",value:function(r,n){var i=r.stencil;if(i){var a=i.enable,o=i.mask,s=o===void 0?-1:o,u=i.func,c=u===void 0?{cmp:M.ALWAYS,ref:0,mask:-1}:u,f=i.opFront,d=f===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:f,p=i.opBack,b=p===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:p;n.stencil={enable:!!a,mask:s,func:Ei(Ei({},c),{},{cmp:Bw[c.cmp]}),opFront:{fail:_i[d.fail],zfail:_i[d.zfail],zpass:_i[d.zpass]},opBack:{fail:_i[b.fail],zfail:_i[b.zfail],zpass:_i[b.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var a=i.enable,o=i.face,s=o===void 0?M.BACK:o;n.cull={enable:!!a,face:Uw[s]}}}},{key:"generateDefines",value:function(r){return Object.keys(r).map(function(n){return"#define ".concat(n," ").concat(Number(r[n]))}).join(`
`)}}]),e}(),CR=function(){function e(t,r){De(this,e),this.texture=void 0,this.width=void 0,this.height=void 0;var n=r.data,i=r.type,a=i===void 0?M.UNSIGNED_BYTE:i,o=r.width,s=r.height,u=r.flipY,c=u===void 0?!1:u,f=r.format,d=f===void 0?M.RGBA:f,p=r.mipmap,b=p===void 0?!1:p,A=r.wrapS,x=A===void 0?M.CLAMP_TO_EDGE:A,N=r.wrapT,X=N===void 0?M.CLAMP_TO_EDGE:N,ae=r.aniso,W=ae===void 0?0:ae,Ee=r.alignment,he=Ee===void 0?1:Ee,we=r.premultiplyAlpha,Me=we===void 0?!1:we,He=r.mag,dt=He===void 0?M.NEAREST:He,ft=r.min,pt=ft===void 0?M.NEAREST:ft,Qe=r.colorSpace,me=Qe===void 0?M.BROWSER_DEFAULT_WEBGL:Qe;this.width=o,this.height=s;var H={width:o,height:s,type:Bu[a],format:kw[d],wrapS:xv[x],wrapT:xv[X],mag:Cv[dt],min:Cv[pt],alignment:he,flipY:c,colorSpace:Fw[me],premultiplyAlpha:Me,aniso:W};n&&(H.data=n),typeof b=="number"?H.mipmap=Dw[b]:typeof b=="boolean"&&(H.mipmap=b),this.texture=t.texture(H)}return We(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),Mv,kv,Dv,xR=(Mv=Ct(),Mv(kv=(Dv=function(){function e(){var t=this;De(this,e),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var r=Tt(Pe.mark(function n(i){return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!i.uniforms){o.next=3;break}return o.next=3,Promise.all(Object.keys(i.uniforms).map(function(){var s=Tt(Pe.mark(function u(c){var f;return Pe.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(i.uniforms[c]&&i.uniforms[c].load!==void 0)){p.next=5;break}return p.next=3,i.uniforms[c].load();case 3:f=p.sent,i.uniforms[c]=f;case 5:case"end":return p.stop()}},u)}));return function(u){return s.apply(this,arguments)}}()));case 3:return o.abrupt("return",new RR(t.gl,i));case 4:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new Lw(t.gl,r)},this.createBuffer=function(r){return new $w(t.gl,r)},this.createElements=function(r){return new AR(t.gl,r)},this.createTexture2D=function(r){return new CR(t.gl,r)},this.createFramebuffer=function(r){return new SR(t.gl,r)},this.useFramebuffer=function(r,n){t.gl({framebuffer:r?r.get():null})(n)},this.createComputeModel=function(){var r=Tt(Pe.mark(function n(i){return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new TR(t.gl,i));case 1:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.clear=function(r){var n=r.color,i=r.depth,a=r.stencil,o=r.framebuffer,s=o===void 0?null:o,u={color:n,depth:i,stencil:a};u.framebuffer=s===null?s:s.get(),t.gl.clear(u)},this.setScissor=function(r){t.gl&&t.gl._gl&&(r.enable&&r.box?(t.gl._gl.enable(M.SCISSOR_TEST),t.gl._gl.scissor(r.box.x,r.box.y,r.box.width,r.box.height)):t.gl._gl.disable(M.SCISSOR_TEST),t.gl._refresh())},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;t.gl&&t.gl._gl&&(t.gl._gl.viewport(n,i,a,o),t.gl._refresh())},this.readPixels=function(r){var n=r.framebuffer,i=r.x,a=r.y,o=r.width,s=r.height,u={x:i,y:a,width:o,height:s};return n&&(u.framebuffer=n.get()),t.gl.read(u)},this.getCanvas=function(){return t.$canvas},this.getGLContext=function(){return t.gl._gl},this.destroy=function(){t.gl&&(t.gl.destroy(),t.inited=!1)}}return We(e,[{key:"init",value:function(){var t=Tt(Pe.mark(function n(i){return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.inited){o.next=2;break}return o.abrupt("return");case 2:return this.$canvas=i.canvas,o.next=5,new Promise(function(s,u){Pw({canvas:i.canvas,attributes:{alpha:!0,antialias:i.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(f,d){(f||!d)&&u(f),s(d)}})});case 5:this.gl=o.sent,this.inited=!0;case 7:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Dv))||kv);function NR(){return typeof window<"u"}function OR(e,t,r,n){if(!!NR()){var i=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),n&&(a.id=n),a.onload=function(){t&&t()},a.onerror=function(o){r&&r("Unable to load script '".concat(e,"'"),o)},i.appendChild(a)}}function IR(e,t){return new Promise(function(r,n){OR(e,function(){r()},function(i,a){n(a)})})}var vo;function PR(){return Au.apply(this,arguments)}function Au(){return Au=Tt(Pe.mark(function e(){return Pe.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!vo){r.next=2;break}return r.abrupt("return",vo);case 2:return r.next=4,IR("https://preview.babylonjs.com/glslang/glslang.js");case 4:return vo=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),r.abrupt("return",vo);case 6:case"end":return r.stop()}},e)})),Au.apply(this,arguments)}var LR=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.attribute=void 0,this.buffer=void 0;var n=r,i=n.buffer,a=n.offset,o=n.stride,s=n.normalized,u=n.size,c=n.divisor,f=n.arrayStride,d=n.attributes,p=n.stepMode;this.buffer=i,this.attribute={buffer:i.get(),offset:a||0,stride:o||0,normalized:s||!1,divisor:c||0,arrayStride:f||0,attributes:d,stepMode:p||"vertex"},u&&(this.attribute.size=u)}return We(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),wi=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.buffer=void 0;var n=r,i=n.data,a=n.usage;n.type,this.buffer=this.createBuffer(i instanceof Array?new Float32Array(i):i,a||Te.BufferUsage.Vertex|Te.BufferUsage.CopyDst)}return We(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.setSubData(this.buffer,i,n instanceof Array?new Float32Array(n):n)}},{key:"createBuffer",value:function(r,n){var i=r.byteLength%4,a={size:r.byteLength+i,usage:n},o=this.engine.device.createBuffer(a);return this.setSubData(o,0,r),o}},{key:"setSubData",value:function(r,n,i){var a=Er?this.engine.device.getQueue():this.engine.device.defaultQueue;a.writeBuffer(r,n,i)}}]),e}();function MR(e){return typeof e=="number"}var kR=function(){function e(t,r){De(this,e),this.engine=t,this.context=r,this.entity=jr(),this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}return We(e,[{key:"init",value:function(){var t=Tt(Pe.mark(function n(){var i=this,a,o,s,u,c,f,d;return Pe.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:a=b.sent,o=a.computeStage,s=this.context.uniforms.filter(function(A){return A.storageClass===An.StorageBuffer}),u=this.context.uniforms.filter(function(A){return A.storageClass===An.Uniform}),c=u.length?1:0,this.bindGroupEntries=[],c&&(f=0,d=[],u.forEach(function(A){if(MR(A.data))i.uniformGPUBufferLayout.push({name:A.name,offset:f}),f+=4,d.push(A.data);else{var x,N=((x=A.data)===null||x===void 0?void 0:x.length)||1;N===3&&(N=4,A.data.push(0));var X=f/4%4;if(X>0){var ae=4-X;if(N>1&&N<=ae)N===2&&(ae===3&&(f+=4,d.push(0)),d.push.apply(d,Kt(A.data)),i.uniformGPUBufferLayout.push({name:A.name,offset:f}));else{for(var W=0;W<ae;W++)f+=4,d.push(0);d.push.apply(d,Kt(A.data)),i.uniformGPUBufferLayout.push({name:A.name,offset:f})}}f+=4*N}}),this.uniformBuffer=new wi(this.engine,{data:d instanceof Array?new Float32Array(d):d,usage:Te.BufferUsage.Uniform|Te.BufferUsage.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),s.forEach(function(A){if(A.data!==null&&(A.type===Hn.Vector4FloatArray||A.type===Hn.FloatArray)){var x;A.name===i.context.output.name?(x=new wi(i.engine,{data:isFinite(Number(A.data))?[A.data]:A.data,usage:Te.BufferUsage.Storage|Te.BufferUsage.CopyDst|Te.BufferUsage.CopySrc}),i.outputBuffer=x,i.context.output={name:A.name,length:isFinite(Number(A.data))?1:A.data.length,typedArrayConstructor:Float32Array,gpuBuffer:x.get()}):A.isReferer?A.data.model&&A.data.model.outputBuffer&&(x=A.data.model.outputBuffer):x=new wi(i.engine,{data:isFinite(Number(A.data))?[A.data]:A.data,usage:Te.BufferUsage.Storage|Te.BufferUsage.CopyDst|Te.BufferUsage.CopySrc}),i.vertexBuffers[A.name]=x,i.bindGroupEntries.push({binding:c,resource:{name:A.name,refer:x?void 0:A.data,buffer:x?x.get():void 0}}),c++}}),this.computePipeline=this.engine.device.createComputePipeline({computeStage:o}),console.log(this.bindGroupEntries),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return b.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach(function(n){return r.vertexBuffers[n].destroy()})}},{key:"readData",value:function(){var t=Tt(Pe.mark(function n(){var i,a,o,s,u,c,f,d,p,b;return Pe.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(i=this.context.output,!i){x.next=16;break}if(a=i.length,o=i.typedArrayConstructor,s=i.gpuBuffer,!s){x.next=16;break}return u=a*o.BYTES_PER_ELEMENT,c=this.engine.device.createBuffer({size:u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f=this.engine.device.createCommandEncoder(),f.copyBufferToBuffer(s,0,c,0,u),d=Er?this.engine.device.getQueue():this.engine.device.defaultQueue,d.submit([f.finish()]),x.next=12,c.mapAsync(Te.MapMode.Read);case 12:return p=c.getMappedRange(),b=new o(p.slice(0)),c.unmap(),x.abrupt("return",b);case 16:return x.abrupt("return",new Float32Array);case 17:case"end":return x.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"run",value:function(){if(this.engine.currentComputePass){var r;this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(r=this.engine.currentComputePass).dispatch.apply(r,Kt(this.context.dispatch))}}},{key:"updateBuffer",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=this.vertexBuffers[r];a&&a.subData({data:n,offset:i})}},{key:"updateUniform",value:function(r,n){var i=this.uniformGPUBufferLayout.find(function(a){return a.name===r});i&&this.uniformBuffer.subData({data:Number.isFinite(n)?new Float32Array([n]):new Float32Array(n),offset:i.offset})}},{key:"confirmInput",value:function(r,n){var i=this.vertexBuffers[n],a=r.outputBuffer;if(i&&a&&i!==a){var o=this.engine.device.createCommandEncoder(),s=r.context.output,u=s.length,c=s.typedArrayConstructor,f=u*c.BYTES_PER_ELEMENT;o.copyBufferToBuffer(a.get(),0,i.get(),0,f);var d=Er?this.engine.device.getQueue():this.engine.device.defaultQueue;d.submit([o.finish()])}}},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"compileComputePipelineStageDescriptor",value:function(){var t=Tt(Pe.mark(function n(i){var a,o;return Pe.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(a=i,o=`#version 450
`,this.engine.options.useWGSL){u.next=6;break}return u.next=5,this.compileShaderToSpirV(i,"compute",o);case 5:a=u.sent;case 6:return u.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:a,isWHLSL:Er}),entryPoint:"main"}});case 7:case"end":return u.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),DR=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.indexCount=void 0,this.buffer=void 0;var n=r,i=n.data;n.usage,n.type;var a=n.count;this.indexCount=a||0,this.buffer=new wi(t,{data:i instanceof Array?new Uint16Array(i):i,usage:Te.BufferUsage.Index|Te.BufferUsage.CopyDst})}return We(e,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),FR=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;var n=r;n.width,n.height;var i=n.color;n.colors;var a=n.depth;n.stencil,i&&(this.colorTexture=i),a&&(this.depthTexture=a)}return We(e,[{key:"get",value:function(){var r,n;return{color:(r=this.colorTexture)===null||r===void 0?void 0:r.get(),depth:(n=this.depthTexture)===null||n===void 0?void 0:n.get()}}},{key:"destroy",value:function(){var r,n;(r=this.colorTexture)===null||r===void 0||r.destroy(),(n=this.depthTexture)===null||n===void 0||n.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;if(n!==this.width||i!==this.height){var a,o;(a=this.colorTexture)===null||a===void 0||a.resize({width:n,height:i}),(o=this.depthTexture)===null||o===void 0||o.resize({width:n,height:i})}this.width=n,this.height=i}}]),e}(),tn,Vr,Bn,pr,bi,po,aa,GR=(tn={},q(tn,M.POINTS,Te.PrimitiveTopology.PointList),q(tn,M.LINES,Te.PrimitiveTopology.LineList),q(tn,M.LINE_LOOP,Te.PrimitiveTopology.LineList),q(tn,M.LINE_STRIP,Te.PrimitiveTopology.LineStrip),q(tn,M.TRIANGLES,Te.PrimitiveTopology.TriangleList),q(tn,M.TRIANGLE_FAN,Te.PrimitiveTopology.TriangleList),q(tn,M.TRIANGLE_STRIP,Te.PrimitiveTopology.TriangleStrip),tn),BR=(Vr={},q(Vr,M.NEVER,Te.CompareFunction.Never),q(Vr,M.ALWAYS,Te.CompareFunction.Always),q(Vr,M.LESS,Te.CompareFunction.Less),q(Vr,M.LEQUAL,Te.CompareFunction.LessEqual),q(Vr,M.GREATER,Te.CompareFunction.Greater),q(Vr,M.GEQUAL,Te.CompareFunction.GreaterEqual),q(Vr,M.EQUAL,Te.CompareFunction.Equal),q(Vr,M.NOTEQUAL,Te.CompareFunction.NotEqual),Vr),Fv=(Bn={},q(Bn,M.FUNC_ADD,Te.BlendOperation.Add),q(Bn,M.MIN_EXT,Te.BlendOperation.Min),q(Bn,M.MAX_EXT,Te.BlendOperation.Max),q(Bn,M.FUNC_SUBTRACT,Te.BlendOperation.Subtract),q(Bn,M.FUNC_REVERSE_SUBTRACT,Te.BlendOperation.ReverseSubtract),Bn),mo=(pr={},q(pr,M.ZERO,Te.BlendFactor.Zero),q(pr,M.ONE,Te.BlendFactor.One),q(pr,M.SRC_COLOR,Te.BlendFactor.SrcColor),q(pr,M.ONE_MINUS_SRC_COLOR,Te.BlendFactor.OneMinusSrcColor),q(pr,M.SRC_ALPHA,Te.BlendFactor.SrcAlpha),q(pr,M.ONE_MINUS_SRC_ALPHA,Te.BlendFactor.OneMinusSrcAlpha),q(pr,M.DST_COLOR,Te.BlendFactor.DstColor),q(pr,M.ONE_MINUS_DST_COLOR,Te.BlendFactor.OneMinusDstColor),q(pr,M.DST_ALPHA,Te.BlendFactor.DstAlpha),q(pr,M.ONE_MINUS_DST_ALPHA,Te.BlendFactor.OneMinusDstAlpha),q(pr,M.CONSTANT_COLOR,Te.BlendFactor.BlendColor),q(pr,M.ONE_MINUS_CONSTANT_COLOR,Te.BlendFactor.OneMinusBlendColor),q(pr,M.SRC_ALPHA_SATURATE,Te.BlendFactor.SrcAlphaSaturated),pr),UR=(bi={},q(bi,M.ALPHA,"r8unorm"),q(bi,M.RGBA,"rgba8unorm"),q(bi,M.DEPTH_COMPONENT,"depth32float"),q(bi,M.DEPTH_STENCIL,"depth24plus-stencil8"),bi),Gv=(po={},q(po,M.NEAREST,"nearest"),q(po,M.LINEAR,"linear"),po),iu=(aa={},q(aa,M.REPEAT,"repeat"),q(aa,M.CLAMP_TO_EDGE,"clamp-to-edge"),q(aa,M.MIRRORED_REPEAT,"mirror-repeat"),aa);function $R(e){var t=e.cull;if(!t||!t.enable)return Te.CullMode.None;if(t.face)return t.face===M.FRONT?Te.CullMode.Front:Te.CullMode.Back}function VR(e){var t=e.depth;e.stencil;var r={compare:Te.CompareFunction.Always,depthFailOp:Te.StencilOperation.Keep,failOp:Te.StencilOperation.Keep,passOp:Te.StencilOperation.Keep};return{depthWriteEnabled:t&&t.enable,depthCompare:BR[(t==null?void 0:t.func)||M.ALWAYS],format:Te.TextureFormat.Depth24PlusStencil8,stencilFront:r,stencilBack:r,stencilReadMask:4294967295,stencilWriteMask:4294967295}}function jR(e,t){var r=e.blend;return[{format:t,alphaBlend:{srcFactor:mo[r&&r.func&&r.func.srcAlpha||M.ONE],dstFactor:mo[r&&r.func&&r.func.dstAlpha||M.ZERO],operation:Fv[r&&r.equation&&r.equation.alpha||M.FUNC_ADD]},colorBlend:{srcFactor:mo[r&&r.func&&r.func.srcRGB||M.ONE],dstFactor:mo[r&&r.func&&r.func.dstRGB||M.ZERO],operation:Fv[r&&r.equation&&r.equation.rgb||M.FUNC_ADD]},writeMask:Te.ColorWrite.All}]}function Bv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function gi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Bv(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zR(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var u=new e(t),c=0,f=0,d=n;f<d.length;f++){var p=d[f];u.set(p,c),c+=p.length}return u}var HR=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}return We(e,[{key:"init",value:function(){var t=Tt(Pe.mark(function n(){var i=this,a,o,s,u,c,f,d,p,b,A,x,N,X,ae,W,Ee;return Pe.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return a=this.options,o=a.vs,s=a.fs,u=a.attributes,c=a.uniforms,f=a.primitive,a.count,d=a.elements,p=a.depth,b=a.blend,A=a.stencil,x=a.cull,a.instances,we.next=3,this.compilePipelineStageDescriptor(o,s,null);case 3:N=we.sent,X=N.vertexStage,ae=N.fragmentStage,c&&this.buildUniformBindGroup(c),d&&(this.indexBuffer=d.get(),this.indexCount=d.indexCount),W={vertexBuffers:Object.keys(u).map(function(Me,He){var dt=u[Me],ft=dt.get(),pt=ft.arrayStride,Qe=ft.stepMode,me=ft.attributes;return i.attributeCache[Me]=dt,{arrayStride:pt,stepMode:Qe,attributes:me}})},Ee={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:GR[f||M.TRIANGLES],rasterizationState:gi(gi({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:$R({cull:x})}),depthStencilState:VR({depth:p,stencil:A}),colorStates:jR({blend:b},this.engine.options.swapChainFormat),layout:this.pipelineLayout,vertexStage:X,fragmentStage:ae,vertexState:W},this.renderPipeline=this.engine.device.createRenderPipeline(Ee);case 11:case"end":return we.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"addUniforms",value:function(r){this.uniforms=gi(gi({},this.uniforms),pa(r))}},{key:"draw",value:function(r){var n=this,i=this.engine.getCurrentRenderPass(),a=gi(gi({},this.uniforms),pa(r.uniforms||{})),o=[];Object.keys(a).forEach(function(s){var u=sn(a[s]);if(u==="boolean"||u==="number"||Array.isArray(a[s])||a[s].BYTES_PER_ELEMENT){var c,f=(c=n.uniformGPUBufferLayout.find(function(X){var ae=X.name;return ae===s}))===null||c===void 0?void 0:c.offset;f!==null&&n.uniformBuffer.subData({data:a[s],offset:f})}else{var d,p=(d=n.uniformGPUBufferLayout.find(function(X){var ae=X.name;return ae===s}))===null||d===void 0?void 0:d.offset;if(p!==null){var b=a[s].get(),A=b.color||b,x=A.texture,N=A.sampler;N&&(o.push({binding:p,resource:N}),p++),o.push({binding:p,resource:x.createView()})}}}),this.uniformBuffer&&(o[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:o}),this.renderPipeline&&i.setPipeline(this.renderPipeline),i.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&i.setIndexBuffer(this.indexBuffer.get(),Te.IndexFormat.Uint32,0),Object.keys(this.attributeCache).forEach(function(s,u){i.setVertexBuffer(0+u,n.attributeCache[s].get().buffer,0)}),this.indexBuffer?i.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):i.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:function(){var t=Tt(Pe.mark(function n(i,a,o){var s,u,c;return Pe.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=`#version 450
`,u=i,c=a,this.engine.options.useWGSL){d.next=10;break}return d.next=6,this.compileShaderToSpirV(i,"vertex",s);case 6:return u=d.sent,d.next=9,this.compileShaderToSpirV(a,"fragment",s);case 9:c=d.sent;case 10:return d.abrupt("return",this.createPipelineStageDescriptor(u,c));case 11:case"end":return d.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"createPipelineStageDescriptor",value:function(r,n){return{vertexStage:{module:this.engine.device.createShaderModule({code:r,isWHLSL:Er}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:Er}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:Te.FrontFace.CCW,cullMode:Te.CullMode.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(r){var n=this,i=0,a=zR.apply(void 0,[Float32Array].concat(Kt(Object.keys(r).map(function(u){return r[u]?(n.uniformGPUBufferLayout.push({name:u,offset:i}),i+=(r[u].length||1)*4,r[u]):[]})))),o=[],s=!1;a.length&&(s=!0,o.push({binding:0,visibility:Te.ShaderStage.Fragment|Te.ShaderStage.Vertex,type:Te.BindingType.UniformBuffer})),Object.keys(r).filter(function(u){return r[u]===null}).forEach(function(u,c){n.uniformGPUBufferLayout.push({name:u,offset:c*2+(s?1:0)}),o.push({binding:c*2+(s?1:0),visibility:Te.ShaderStage.Fragment,type:Te.BindingType.Sampler},{binding:c*2+(s?1:0)+1,visibility:Te.ShaderStage.Fragment,type:Te.BindingType.SampledTexture})}),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:o}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),s&&(this.uniformBuffer=new wi(this.engine,{data:a instanceof Array?new Float32Array(a):a,usage:Te.BufferUsage.Uniform|Te.BufferUsage.CopyDst}))}}]),e}(),XR=function(){function e(t,r){De(this,e),this.engine=t,this.options=r,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return We(e,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(r){var n=r.width,i=r.height;(n!==this.width||i!==this.height)&&(this.destroy(),this.createTexture()),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var r=this.options;r.data;var n=r.type;n===void 0&&M.UNSIGNED_BYTE;var i=r.width,a=r.height;r.flipY;var o=r.format,s=o===void 0?M.RGBA:o;r.mipmap;var u=r.wrapS,c=u===void 0?M.CLAMP_TO_EDGE:u,f=r.wrapT,d=f===void 0?M.CLAMP_TO_EDGE:f,p=r.aniso,b=p===void 0?0:p;r.alignment,r.premultiplyAlpha;var A=r.mag,x=A===void 0?M.NEAREST:A,N=r.min,X=N===void 0?M.NEAREST:N,ae=r.colorSpace;ae===void 0&&M.BROWSER_DEFAULT_WEBGL;var W=r.usage;this.width=i,this.height=a,this.texture=this.engine.device.createTexture({size:[i,a,1],mipLevelCount:1,sampleCount:1,dimension:Te.TextureDimension.E2d,format:UR[s],usage:W||Te.TextureUsage.Sampled|Te.TextureUsage.CopyDst}),(!W||W&Te.TextureUsage.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:iu[c],addressModeV:iu[d],addressModeW:iu[c],magFilter:Gv[x],minFilter:Gv[X],maxAnisotropy:b}))}}]),e}(),Uv,$v,Vv,WR=(Uv=Ct(),Uv($v=(Vv=function(){function e(){var t=this;De(this,e),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(r){r.framebuffer;var n=r.color,i=r.depth,a=r.stencil;t.options.supportCompute&&t.startComputePass(),t.currentRenderTarget?(t.currentRenderPass&&t.endRenderTargetRenderPass(),t.startRenderTargetRenderPass(t.currentRenderTarget,n||null,!!i,!!a)):(t.mainColorAttachments[0].loadValue=n||Te.LoadOp.Load,t.mainDepthAttachment.depthLoadValue=i||Te.LoadOp.Load,t.mainDepthAttachment.stencilLoadValue=a?t.clearStencilValue:Te.LoadOp.Load,t.mainRenderPass&&t.endMainRenderPass(),t.startMainRenderPass())},this.createModel=function(){var r=Tt(Pe.mark(function n(i){var a;return Pe.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new HR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new LR(t,r)},this.createBuffer=function(r){return new wi(t,r)},this.createElements=function(r){return new DR(t,r)},this.createTexture2D=function(r){return new XR(t,r)},this.createFramebuffer=function(r){return new FR(t,r)},this.useFramebuffer=function(r,n){t.currentRenderTarget&&t.unbindFramebuffer(t.currentRenderTarget),t.currentRenderTarget=r,t.currentRenderTargetViewDescriptor={dimension:Te.TextureViewDimension.E2d,arrayLayerCount:1,aspect:Te.TextureAspect.All},t.currentRenderPass=null,n()},this.createComputeModel=function(){var r=Tt(Pe.mark(function n(i){var a;return Pe.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new kR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.getCanvas=function(){return t.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;if(!t.currentRenderPass)t.transientViewport={x:n,y:i,width:a,height:o};else if(t.transientViewport.x!==1/0){var s=t.getCurrentRenderPass();s.setViewport(t.transientViewport.x,t.transientViewport.y,t.transientViewport.width,t.transientViewport.height,0,1)}else if(n!==t.cachedViewport.x||i!==t.cachedViewport.y||a!==t.cachedViewport.width||o!==t.cachedViewport.height){t.cachedViewport={x:n,y:i,width:a,height:o};var u=t.getCurrentRenderPass();u.setViewport(n,i,a,o,0,1)}},this.readPixels=function(r){throw new Error("Method not implemented.")}}return We(e,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:function(){var t=Tt(Pe.mark(function n(i){return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.canvas=i.canvas,this.options=i,this.useWGSL=!!i.useWGSL,this.mainPassSampleCount=i.antialiasing?this.defaultSampleCount:1,o.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"setScissor",value:function(r){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach(function(r){return r.destroy()}),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),Er?this.device.getQueue().submit(this.commandBuffers.filter(function(r){return r})):this.device.defaultQueue.submit(this.commandBuffers.filter(function(r){return r}))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:function(){var t=Tt(Pe.mark(function n(){var i,a;return Pe.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,PR();case 2:return this.glslang=s.sent,s.next=5,(i=navigator)===null||i===void 0||(a=i.gpu)===null||a===void 0?void 0:a.requestAdapter();case 5:return this.adapter=s.sent,s.next=8,this.adapter.requestDevice();case 8:this.device=s.sent;case 9:case"end":return s.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(Er?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:Te.TextureUsage.OutputAttachment|Te.TextureUsage.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var r={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Te.TextureDimension.E2d,format:Te.TextureFormat.BGRA8Unorm,usage:Te.TextureUsage.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(r),this.mainColorAttachments=[{attachment:Er?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:Te.StoreOp.Store}]}else this.mainColorAttachments=[{attachment:Er?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:Te.StoreOp.Store}];var n={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Te.TextureDimension.E2d,format:Er?"depth32float-stencil8":Te.TextureFormat.Depth24PlusStencil8,usage:Te.TextureUsage.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(n),this.mainDepthAttachment={attachment:Er?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:Te.StoreOp.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:Te.StoreOp.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=Er?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=Er?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(r,n,i){var a,o,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,u=(a=r.get().color)===null||a===void 0?void 0:a.texture,c;u&&(c=u.createView(this.currentRenderTargetViewDescriptor));var f=(o=r.get().depth)===null||o===void 0?void 0:o.texture,d;f&&(d=f.createView());var p=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:c,loadValue:n!==null?n:Te.LoadOp.Load,storeOp:Te.StoreOp.Store}],depthStencilAttachment:f&&d?{attachment:d,depthLoadValue:i?this.clearDepthValue:Te.LoadOp.Load,depthStoreOp:Te.StoreOp.Store,stencilLoadValue:s?this.clearStencilValue:Te.LoadOp.Load,stencilStoreOp:Te.StoreOp.Store}:void 0});this.currentRenderPass=p,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&this.currentRenderPass!==null&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(r){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),e}(),Vv))||$v),jv,zv;function YR(e){var t=qR();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function qR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Su=4/64,Hv=1-Su*2,KR=(jv=Ct(),jv(zv=function(e){fr(r,e);var t=YR(r);function r(){return De(this,r),t.apply(this,arguments)}return We(r,[{key:"onEntityCreated",value:function(){var i=this.config,a=i.widthSegments,o=a===void 0?1:a,s=i.heightSegments,u=s===void 0?1:s,c=i.depthSegments,f=c===void 0?1:c,d=i.halfExtents,p=d===void 0?ct(.5,.5,.5):d,b=o,A=u,x=f,N=Do(p,3),X=N[0],ae=N[1],W=N[2],Ee=[ct(-X,-ae,W),ct(X,-ae,W),ct(X,ae,W),ct(-X,ae,W),ct(X,-ae,-W),ct(-X,-ae,-W),ct(-X,ae,-W),ct(X,ae,-W)],he=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],we=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Me={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},He=[],dt=[],ft=[],pt=[],Qe=0,me=function(Ge,Fe,xt){var Lt,mt,ht,Pt;for(ht=0;ht<=Fe;ht++)for(Pt=0;Pt<=xt;Pt++){var St=Nt(),Xr=Nt(),Wr=Nt(),Tr=Nt();zn(St,Ee[he[Ge][0]],Ee[he[Ge][1]],ht/Fe),zn(Xr,Ee[he[Ge][0]],Ee[he[Ge][2]],Pt/xt),_u(Wr,Xr,Ee[he[Ge][0]]),on(Tr,St,Wr),Lt=ht/Fe,mt=Pt/xt,He.push(Tr[0],Tr[1],Tr[2]),dt.push(we[Ge][0],we[Ge][1],we[Ge][2]),ft.push(Lt,mt),Lt/=3,mt/=3,Lt=Lt*Hv+Su,mt=mt*Hv+Su,Lt+=Ge%3/3,mt+=Math.floor(Ge/3)/3,ht<Fe&&Pt<xt&&(pt.push(Qe+xt+1,Qe+1,Qe),pt.push(Qe+xt+1,Qe+xt+2,Qe+1)),Qe++}};me(Me.FRONT,b,A),me(Me.BACK,b,A),me(Me.TOP,b,x),me(Me.BOTTOM,b,x),me(Me.RIGHT,x,A),me(Me.LEFT,x,A);var H=Fu(He),Ie=this.getComponent();Ie.indices=Uint32Array.from(pt),Ie.aabb=H,Ie.vertexCount=Qe,Ie.attributes=[{dirty:!0,name:"position",data:Float32Array.from(He),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(dt),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(ft),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(bn))||zv);function QR(e,t){if(!e&&!t)throw new Error("Please specify valid arguments for parameters a and b.");if(!t||t.length===0)return e;if(!e||e.length===0)return t;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}var Xv,Wv;function ZR(e){var t=JR();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function JR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var eC=(Xv=Ct(),Xv(Wv=function(e){fr(r,e);var t=ZR(r);function r(){return De(this,r),t.apply(this,arguments)}return We(r,[{key:"onEntityCreated",value:function(){var i=this.config.geometries,a=i===void 0?[]:i,o=this.getComponent();o.aabb=new Du;var s=[],u=[],c=0;a.forEach(function(f){var d=f.aabb,p=f.indices,b=f.vertexCount,A=f.attributes;o.aabb.add(d),o.vertexCount+=b,p&&u.push.apply(u,Kt(p.map(function(x){return x+c}))),c+=b,A.forEach(function(x,N){s[N]?x.data&&(Gu(x.data)?s[N].push(x.data):xy(x.data)?s[N].data=QR(s[N].data,x.data):s[N].data=s[N].data.concat(x.data)):(s[N]=x,s[N].dirty=!0)})}),o.attributes=s,o.indices=Uint32Array.from(u),o.dirty=!0}}]),r}(bn))||Wv),Yv,qv;function tC(e){var t=rC();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function rC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var nC=(Yv=Ct(),Yv(qv=function(e){fr(r,e);var t=tC(r);function r(){return De(this,r),t.apply(this,arguments)}return We(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.halfExtents,o=a===void 0?[.5,.5]:a,s=i.widthSegments,u=s===void 0?5:s,c=i.lengthSegments,f=c===void 0?5:c,d=[],p=[],b=[],A=[],x=0,N=0;N<=u;N++)for(var X=0;X<=f;X++){var ae=-o[0]+2*o[0]*N/u,W=0,Ee=-(-o[1]+2*o[1]*X/f),he=N/u,we=X/f;d.push(ae,W,Ee),p.push(0,1,0),b.push(he,we),N<u&&X<f&&(A.push(x+f+1,x+1,x),A.push(x+f+1,x+f+2,x+1)),x++}var Me=Fu(d),He=this.getComponent();He.indices=Uint32Array.from(A),He.aabb=Me,He.vertexCount=x,He.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(p),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(b),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(bn))||qv),Kv,Qv;function iC(e){var t=aC();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function aC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var oC=(Kv=Ct(),Kv(Qv=function(e){fr(r,e);var t=iC(r);function r(){return De(this,r),t.apply(this,arguments)}return We(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.radius,o=a===void 0?.5:a,s=i.latitudeBands,u=s===void 0?16:s,c=i.longitudeBands,f=c===void 0?16:c,d=[],p=[],b=[],A=[],x=0;x<=u;x++)for(var N=x*Math.PI/u,X=Math.sin(N),ae=Math.cos(N),W=0;W<=f;W++){var Ee=W*2*Math.PI/f-Math.PI/2,he=Math.sin(Ee),we=Math.cos(Ee),Me=we*X,He=ae,dt=he*X,ft=1-W/f,pt=1-x/u;d.push(Me*o,He*o,dt*o),p.push(Me,He,dt),b.push(ft,pt)}for(var Qe=0;Qe<u;++Qe)for(var me=0;me<f;++me){var H=Qe*(f+1)+me,Ie=H+f+1;A.push(H+1,Ie,H),A.push(H+1,Ie+1,Ie)}var Ye=Fu(d),Ge=this.getComponent();Ge.indices=Uint32Array.from(A),Ge.aabb=Ye,Ge.vertexCount=d.length/3,Ge.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(p),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(b),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(bn))||Qv),Zv,Jv,ep,tp,yo,rp,np,ip;function sC(e){var t=uC();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function uC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var cC=`varying vec4 fragColor;

#pragma include "uv.frag.declaration"
#pragma include "map.frag.declaration"

void main() {
  vec4 diffuseColor = fragColor;

  #pragma include "map.frag.main"

  gl_FragColor = diffuseColor;
}`,fC=`attribute vec3 position;
attribute vec3 normal;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform vec4 color;

varying vec4 fragColor;

#pragma include "uv.vert.declaration"

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  fragColor = color;

  #pragma include "uv.vert.main"
}`,lC=`// layout(set = 0, binding = 1) uniform WireframeUniforms {
//   float lineWidth;
//   vec4 lineColor;
// } wireframe;

layout(location = 0) in vec4 fragColor;
// layout(location = 1) in vec3 v_Barycentric;

layout(location = 0) out vec4 outColor;

// wireframe
// float edgeFactor() {
//   vec3 d = fwidth(v_Barycentric);
//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);
//   return min(min(a3.x, a3.y), a3.z);
// }

void main() {
  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));
  outColor = fragColor;
}`,dC=`layout(set = 0, binding = 0) uniform Uniforms {
  vec4 color;
  mat4 projectionMatrix;
  mat4 modelViewMatrix;
} uniforms;

layout(location = 0) in vec3 position;
// layout(location = 1) in vec3 barycentric;

layout(location = 0) out vec4 fragColor;
// layout(location = 1) out vec3 v_Barycentric;

void main() {
  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);
  fragColor = uniforms.color;
  // v_Barycentric = barycentric;
}`,hC=(Zv=Ct(),Jv=ze(re.RenderEngine),ep=ze(re.ShaderModuleService),Zv(tp=(yo=(ip=function(e){fr(r,e);var t=sC(r);function r(){var n;De(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ve(n,"engine",rp,$t(n)),Ve(n,"shaderModuleService",np,$t(n)),n}return We(r,[{key:"onEntityCreated",value:function(){var i=this.getComponent(),a=this.engine.supportWebGPU?dC:fC,o=this.engine.supportWebGPU?lC:cC;this.shaderModuleService.registerModule("material-basic",{vs:a,fs:o});var s=this.shaderModuleService.getModule("material-basic"),u=s.vs,c=s.fs,f=s.uniforms;i.vertexShaderGLSL=u,i.fragmentShaderGLSL=c,i.setUniform(f),this.config.map&&(i.setDefines({USE_UV:1,USE_MAP:1}),i.setUniform({map:this.config.map,uvTransform:Aa()}))}}]),r}(Ny),ip),rp=je(yo.prototype,"engine",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np=je(yo.prototype,"shaderModuleService",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo))||tp),ap,op,sp,up,cp,fp,lp,oa,dp,hp,vp,pp;function vC(e){var t=pC();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function pC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var mC=`// generate grid, borrow from clay.gl viewer
// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl
#extension GL_OES_standard_derivatives : enable

varying vec3 v_Position;
// varying vec3 v_Normal;

uniform float u_GridSize : 5;
uniform float u_GridSize2 : .5;
uniform vec4 u_GridColor : [0, 0, 0, 1];
uniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];
uniform bool u_GridEnabled : true;

// uniform vec3 u_LightDirection;
// uniform vec3 u_LightColor;
// uniform vec3 u_Camera;

void main() {
  // vec3 n = v_Normal;
  // vec3 l = normalize(u_LightDirection);
  // float NdotL = clamp(dot(n, l), 0.001, 1.0);

  gl_FragColor = vec4(1.);

  if (u_GridEnabled) {
    float wx = v_Position.x;
    float wz = v_Position.z;
    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;
    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;

    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;
    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;

    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);
    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);
    // if (v0 > 0.1) {
        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);
    // }
    // else {
        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);
    // }
  }

  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);
  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;

  // gl_FragColor.rgb *= diffuseColor;
}`,yC=`attribute vec3 a_Position;

varying vec3 v_Position;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

void main() {
  v_Position = a_Position;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);
}`,_C=(ap=Ct(),op=ze(re.Systems),sp=Hr(re.MaterialSystem),up=ze(re.Systems),cp=Hr(re.GeometrySystem),fp=ze(re.ShaderModuleService),ap(lp=(oa=(pp=function(e){fr(r,e);var t=vC(r);function r(){var n;De(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ve(n,"materialSystem",dp,$t(n)),Ve(n,"geometrySystem",hp,$t(n)),Ve(n,"shaderModuleService",vp,$t(n)),n}return We(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="gridColor"?(s.material.setUniform("u_GridColor",o),s.material.setUniform("u_GridColor2",o)):a==="gridSize"&&(s.material.setUniform("u_GridSize",o),s.material.setUniform("u_GridSize2",o)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:yC,fs:mC});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o});this.setMaterial(u);var c=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(c),u.setCull({enable:!1,face:M.BACK}).setDepth({enable:!0,func:M.LESS}),u.setUniform(s),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),c.setIndex([0,3,2,2,1,0]),c.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),r}(En),pp),dp=je(oa.prototype,"materialSystem",[op,sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp=je(oa.prototype,"geometrySystem",[up,cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=je(oa.prototype,"shaderModuleService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa))||lp),Py=1e-6,Ly=EC;function EC(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e}var bC=gC;function gC(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}var TC=AC;function AC(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}var SC=wC;function wC(e,t){return e[0]=t[0],e[1]=t[1],e}var My=RC;function RC(e,t,r){return e[0]=t,e[1]=r,e}var CC=xC,mp=Py;function xC(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=mp*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=mp*Math.max(1,Math.abs(n),Math.abs(a))}var NC=OC;function OC(e,t){return e[0]===t[0]&&e[1]===t[1]}var ky=IC;function IC(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}var Uu=PC;function PC(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}var Dy={exports:{}};(function(e){e.exports=Uu})(Dy);var Fy=LC;function LC(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}var Gy={exports:{}};(function(e){e.exports=Fy})(Gy);var By=MC;function MC(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}var Uy={exports:{}};(function(e){e.exports=By})(Uy);var kC=DC;function DC(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}var FC=GC;function GC(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}var BC=UC;function UC(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var $C=VC;function VC(e,t,r){var n=Math.cos(r),i=Math.sin(r),a=t[0],o=t[1];return e[0]=a*n-o*i,e[1]=a*i+o*n,e}var jC=zC;function zC(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}var HC=XC;function XC(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}var WC=YC;function YC(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}var qC=KC;function KC(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}var QC=ZC;function ZC(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}var $y=JC;function JC(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}var Vy={exports:{}};(function(e){e.exports=$y})(Vy);var jy=ex;function ex(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}var zy={exports:{}};(function(e){e.exports=jy})(zy);var Hy=tx;function tx(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}var Xy={exports:{}};(function(e){e.exports=Hy})(Xy);var Wy=rx;function rx(e){var t=e[0],r=e[1];return t*t+r*r}var Yy={exports:{}};(function(e){e.exports=Wy})(Yy);var nx=ix;function ix(e,t){return e[0]=-t[0],e[1]=-t[1],e}var qy=ax;function ax(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}var Ky=ox;function ox(e,t){return e[0]*t[0]+e[1]*t[1]}var sx=ux;function ux(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}var cx=fx;function fx(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}var lx=dx;function dx(e,t){t=t||1;var r=Math.random()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}var hx=vx;function vx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}var px=mx;function mx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}var yx=_x;function _x(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}var Ex=bx;function bx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}var gx=Tx,Ti=Ly();function Tx(e,t,r,n,i,a){var o,s;for(t||(t=2),r||(r=0),n?s=Math.min(n*t+r,e.length):s=e.length,o=r;o<s;o+=t)Ti[0]=e[o],Ti[1]=e[o+1],i(Ti,Ti,a),e[o]=Ti[0],e[o+1]=Ti[1];return e}var Ax=Sx;function Sx(e,t,r){var n=t[0]*t[0]+t[1]*t[1];if(n>r*r){var i=Math.sqrt(n);e[0]=t[0]/i*r,e[1]=t[1]/i*r}else e[0]=t[0],e[1]=t[1];return e}var _o={EPSILON:Py,create:Ly,clone:bC,fromValues:TC,copy:SC,set:My,equals:CC,exactEquals:NC,add:ky,subtract:Uu,sub:Dy.exports,multiply:Fy,mul:Gy.exports,divide:By,div:Uy.exports,inverse:kC,min:FC,max:BC,rotate:$C,floor:jC,ceil:HC,round:WC,scale:qC,scaleAndAdd:QC,distance:$y,dist:Vy.exports,squaredDistance:jy,sqrDist:zy.exports,length:Hy,len:Xy.exports,squaredLength:Wy,sqrLen:Yy.exports,negate:nx,normalize:qy,dot:Ky,cross:sx,lerp:cx,random:lx,transformMat2:hx,transformMat2d:px,transformMat3:yx,transformMat4:Ex,forEach:gx,limit:Ax},wx=ky,wu=My,Qy=qy,Rx=Uu,Cx=Ky,yp=[0,0],xx=function(t,r,n,i,a){return wx(t,n,i),Qy(t,t),wu(r,-t[1],t[0]),wu(yp,-n[1],n[0]),a/Cx(r,yp)},Eo=function(t,r){return wu(t,-r[1],r[0]),t},_p=function(t,r,n){return Rx(t,r,n),Qy(t,t),t};function bo(e,t,r,n,i){ma(t,n,-i),ma(t,n,i),e.push(r),e.push(r)}function ma(e,t,r){e.push([[t[0],t[1]],r])}function Nx(e,t,r){var n=[0,0],i=[0,0],a=[0,0],o=[0,0],s=-1,u=!1,c=null,f=_o.create(),d=r||0,p=3,b=[],A=[],x=[],N=[0,0];t&&(e=e.slice(),e.push(e[0]));for(var X=e.length,ae=1;ae<X;ae++){var W=d,Ee=e[ae-1],he=e[ae],we=ae<e.length-1?e[ae+1]:null;if(N.push(ae/X,ae/X),_p(n,he,Ee),c||(c=[0,0],Eo(c,n)),u||(u=!0,bo(A,b,Ee,c,1)),x.push([W+0,W+1,W+2]),!we)Eo(c,n),bo(A,b,he,c,1),x.push(s===1?[W,W+2,W+3]:[W+2,W+1,W+3]),d+=2;else{_p(i,we,he);var Me=xx(a,o,n,i,1),He=_o.dot(a,c)<0?-1:1,dt=Me>p;if(!isFinite(Me)){Eo(c,n),bo(A,b,he,c,1),x.push(s===1?[W,W+2,W+3]:[W+2,W+1,W+3]),d+=2,s=He;continue}dt?(Me=p,N.push(ae/X),ma(b,c,-He),A.push(he),ma(b,o,Me*He),A.push(he),x.push(s!==-He?[W,W+2,W+3]:[W+2,W+1,W+3]),x.push([W+2,W+3,W+4]),Eo(f,i),_o.copy(c,f),ma(b,c,-He),A.push(he),d+=3):(bo(A,b,he,o,Me),x.push(s===1?[W,W+2,W+3]:[W+2,W+1,W+3]),He=-1,_o.copy(c,o),d+=2),s=He}}return{normals:b,attrIndex:x,attrPos:A,attrCounters:N}}var Ep,bp,gp,Tp,Ap,Sp,wp,sa,Rp,Cp,xp,Np;function Ox(e){var t=Ix();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function Ix(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Px=`uniform float u_dash_array : 0.02;
uniform float u_dash_offset : 0;
uniform float u_dash_ratio : 0;
uniform float u_thickness : 0.02;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
    float blur = 1. - smoothstep(0.98, 1., length(v_normal));

    gl_FragColor = v_color;
    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));
}`,Lx=`attribute vec2 a_pos;
attribute vec4 a_color;
attribute float a_line_miter;
attribute vec2 a_line_normal;
attribute float a_counters;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform float u_thickness : 0.02;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
  v_color = a_color;
  v_counters = a_counters;

  vec3 normal = normalize(vec3(a_line_normal, 0.0));

  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);

  v_normal = vec2(normal * sign(a_line_miter));

  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;
}
`,Mx=(Ep=Ct(),bp=ze(re.Systems),gp=Hr(re.MaterialSystem),Tp=ze(re.Systems),Ap=Hr(re.GeometrySystem),Sp=ze(re.ShaderModuleService),Ep(wp=(sa=(Np=function(e){fr(r,e);var t=Ox(r);function r(){var n;De(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ve(n,"materialSystem",Rp,$t(n)),Ve(n,"geometrySystem",Cp,$t(n)),Ve(n,"shaderModuleService",xp,$t(n)),n.vertexCount=void 0,n}return We(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();if(s&&s.material)switch(a){case"dashArray":s.material.setUniform("u_dash_array",o);break;case"dashOffset":s.material.setUniform("u_dash_offset",o);break;case"dashRatio":s.material.setUniform("u_dash_ratio",o);break;case"thickness":s.material.setUniform("u_thickness",o);break;case"color":var u=new Array(this.vertexCount).fill(void 0).map(function(){return o}).reduce(function(c,f){return[].concat(Kt(c),Kt(f))},[]);s.geometry.setAttribute("a_color",Float32Array.from(u),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]});break}}},{key:"onEntityCreated",value:function(){var i=this;this.shaderModuleService.registerModule("line",{vs:Lx,fs:Px});var a=this.shaderModuleService.getModule("line"),o=a.vs,s=a.fs,u=a.uniforms,c=this.materialSystem.createShaderMaterial({vertexShader:o,fragmentShader:s}),f=Nx(this.config.points,!1),d=f.normals,p=f.attrIndex,b=f.attrPos,A=f.attrCounters,x=b.length;this.vertexCount=x;var N=this.geometrySystem.createBufferGeometry({vertexCount:x});this.setMaterial(c),this.setGeometry(N),c.setCull({enable:!1,face:M.BACK}).setUniform(u),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var X=[],ae=[];d.forEach(function(Ee){var he=Ee[0],we=Ee[1];X.push([he[0],he[1]]),ae.push(we)}),N.setIndex(p.reduce(function(Ee,he){return[].concat(Kt(Ee),Kt(he))},[])),N.setAttribute("a_pos",Float32Array.from(b.reduce(function(Ee,he){return[].concat(Kt(Ee),Kt(he))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});var W=new Array(x).fill(void 0).map(function(){return Kt(i.config.color)}).reduce(function(Ee,he){return[].concat(Kt(Ee),Kt(he))},[]);N.setAttribute("a_color",Float32Array.from(W),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),N.setAttribute("a_line_miter",Float32Array.from(ae),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),N.setAttribute("a_line_normal",Float32Array.from(X.reduce(function(Ee,he){return[].concat(Kt(Ee),Kt(he))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),N.setAttribute("a_counters",Float32Array.from(A),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),r}(En),Np),Rp=je(sa.prototype,"materialSystem",[bp,gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=je(sa.prototype,"geometrySystem",[Tp,Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=je(sa.prototype,"shaderModuleService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa))||wp);function kx(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}var Op,Ip,Pp,Lp,Mp,kp,Dp,ua,Fp,Gp,Bp,Up;function $p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Dx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$p(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$p(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fx(e){var t=Gx();return function(){var n=Rt(e),i;if(t){var a=Rt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function Gx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Bx=`uniform float u_blur : 0.05;
uniform float u_opacity : 0.7;
uniform float u_stroke_width : 0.01;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "sdf2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  // if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  // } else if (shape == 1) {
  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  // } else if (shape == 2) {
  //   outer_df = sdBox(v_data.xy, vec2(1.));
  //   inner_df = sdBox(v_data.xy, vec2(r));
  // } else if (shape == 3) {
  //   outer_df = sdPentagon(v_data.xy, 0.8);
  //   inner_df = sdPentagon(v_data.xy, r * 0.8);
  // } else if (shape == 4) {
  //   outer_df = sdHexagon(v_data.xy, 0.8);
  //   inner_df = sdHexagon(v_data.xy, r * 0.8);
  // } else if (shape == 5) {
  //   outer_df = sdOctogon(v_data.xy, 1.0);
  //   inner_df = sdOctogon(v_data.xy, r);
  // } else if (shape == 6) {
  //   outer_df = sdHexagram(v_data.xy, 0.52);
  //   inner_df = sdHexagram(v_data.xy, r * 0.52);
  // } else if (shape == 7) {
  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));
  //   inner_df = sdRhombus(v_data.xy, vec2(r));
  // } else if (shape == 8) {
  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);
  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  // }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;

  gl_FragColor = filterColor(gl_FragColor);
}`,Ux=`attribute vec2 position;
attribute vec4 color;
attribute float shape;
attribute vec2 offset;
attribute float size;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

uniform float u_stroke_width : 0.01;
uniform float u_device_pixel_ratio;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "picking"

void main() {
  v_color = color;
  v_radius = size;

  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);

  // construct point coords
  v_data = vec4(position, antialiasblur, shape);

  gl_Position = projectionMatrix * modelViewMatrix
    * vec4(position * size + offset, 0.0, 1.0);

  setPickingColor(a_PickingColor);
}`,$x=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],Vx=(Op=Ct(),Ip=ze(re.Systems),Pp=Hr(re.MaterialSystem),Lp=ze(re.Systems),Mp=Hr(re.GeometrySystem),kp=ze(re.ShaderModuleService),Op(Dp=(ua=(Up=function(e){fr(r,e);var t=Fx(r);function r(){var n;De(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),Ve(n,"materialSystem",Fp,$t(n)),Ve(n,"geometrySystem",Gp,$t(n)),Ve(n,"shaderModuleService",Bp,$t(n)),n}return We(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="strokeWidth"?s.material.setUniform("u_stroke_width",o):a==="strokeColor"?s.material.setUniform("u_stroke_color",o):a==="strokeOpacity"?s.material.setUniform("u_stroke_opacity",o):a==="opacity"?s.material.setUniform("u_opacity",o):a==="blur"&&s.material.setUniform("u_blur",o))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:Ux,fs:Bx});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:M.SRC_ALPHA,dstRGB:M.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});u.setUniform(Dx({u_device_pixel_ratio:window.devicePixelRatio},s));var c=this.buildAttributes(),f=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:c.instancedOffsets.length/2,vertexCount:6});f.setIndex([0,2,1,0,3,2]),f.setAttribute("position",Float32Array.from(c.positions),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),f.setAttribute("offset",Float32Array.from(c.instancedOffsets),{arrayStride:4*2,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),f.setAttribute("color",Float32Array.from(c.instancedColors),{arrayStride:4*4,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),f.setAttribute("size",Float32Array.from(c.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),f.setAttribute("shape",Float32Array.from(c.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),f.setAttribute("a_PickingColor",Float32Array.from(c.instancedPickingColors),{arrayStride:4*3,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(u),this.setGeometry(f)}},{key:"buildAttribute",value:function(i,a,o){var s,u,c,f;(s=a.instancedPickingColors).push.apply(s,Kt(kx(i.id||o))),a.instancedShapes.push($x.indexOf(i.shape||"circle")),(u=a.instancedColors).push.apply(u,Kt(i.color||[1,0,0,1])),(c=a.instancedOffsets).push.apply(c,Kt(i.position||[0,0])),(f=a.instancedSizes).push.apply(f,Kt(i.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var i=this,a={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach(function(o,s){i.buildAttribute(o,a,s)}):this.buildAttribute(this.config,a,0),a}}]),r}(En),Up),Fp=je(ua.prototype,"materialSystem",[Ip,Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=je(ua.prototype,"geometrySystem",[Lp,Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=je(ua.prototype,"shaderModuleService",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua))||Dp),Vp,jp,zp,Hp,Xp,ca,Wp,Yp,qp,Kp;function Qp(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=jx(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function jx(e,t){if(!!e){if(typeof e=="string")return Zp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zp(e,t)}}function Zp(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var zx=`#ifdef USE_MAP
  uniform sampler2D map;
#endif`,Hx=`#ifdef USE_MAP
  vec4 texelColor = texture2D(map, vUv);
  // texelColor = mapTexelToLinear(texelColor);
  diffuseColor *= texelColor;
#endif`,Xx=`#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))
  varying vec2 vUv;
#endif`,Wx=`#ifdef USE_UV
  attribute vec2 uv;
	#ifdef UVS_VERTEX_ONLY
    vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Yx=`#ifdef USE_UV
  vUv = (uvTransform * vec3(uv, 1)).xy;
#endif`,Jp=(Vp=Ct(),jp=ze(re.RenderEngine),zp=ze(re.ShaderModuleService),Hp=ze(re.ConfigService),Vp(Xp=(ca=(Kp=function(){function e(){De(this,e),this.container=void 0,Ve(this,"engine",Wp,this),Ve(this,"shaderModule",Yp,this),Ve(this,"configService",qp,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}return We(e,[{key:"init",value:function(){var t=Tt(Pe.mark(function n(){var i,a,o,s,u;return Pe.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:Wx}),this.shaderModule.registerModule("uv.vert.main",{vs:Yx}),this.shaderModule.registerModule("uv.frag.declaration",{fs:Xx}),this.shaderModule.registerModule("map.frag.declaration",{fs:zx}),this.shaderModule.registerModule("map.frag.main",{fs:Hx}),i=this.container.getAll(re.Systems),a=this.configService.get(),!a.canvas){f.next=30;break}return f.next=11,this.engine.init({canvas:a.canvas,swapChainFormat:Te.TextureFormat.BGRA8Unorm,antialiasing:!1});case 11:o=Qp(i),f.prev=12,o.s();case 14:if((s=o.n()).done){f.next=21;break}if(u=s.value,!u.initialize){f.next=19;break}return f.next=19,u.initialize();case 19:f.next=14;break;case 21:f.next=26;break;case 23:f.prev=23,f.t0=f.catch(12),o.e(f.t0);case 26:return f.prev=26,o.f(),f.finish(26);case 29:this.inited=!0;case 30:case"end":return f.stop()}},n,this,[[12,23,26,29]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=Tt(Pe.mark(function n(){var i,a,o,s,u,c,f,d=arguments;return Pe.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(!this.inited||this.rendering)){b.next=2;break}return b.abrupt("return");case 2:for(this.pendings.length&&this.pendings.forEach(function(A){A()}),this.rendering=!0,this.engine.beginFrame(),i=this.container.getAll(re.Systems),a=d.length,o=new Array(a),s=0;s<a;s++)o[s]=d[s];u=Qp(i),b.prev=8,u.s();case 10:if((c=u.n()).done){b.next=17;break}if(f=c.value,!f.execute){b.next=15;break}return b.next=15,f.execute(o);case 15:b.next=10;break;case 17:b.next=22;break;case 19:b.prev=19,b.t0=b.catch(8),u.e(b.t0);case 22:return b.prev=22,u.f(),b.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return b.stop()}},n,this,[[8,19,22,25]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"clear",value:function(r){var n=this;return this.inited?this.engine.clear(r):this.pendings.unshift(function(){n.engine.clear(r),n.pendings.shift()}),this}},{key:"setSize",value:function(r){var n=r.width,i=r.height,a=this.engine.getCanvas();return this.size={width:n,height:i},a.width=n,a.height=i,this}},{key:"getSize",value:function(){return this.size}}]),e}(),Kp),Wp=je(ca.prototype,"engine",[jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=je(ca.prototype,"shaderModule",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=je(ca.prototype,"configService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca))||Xp),em,tm,rm,nm=(em=Ct(),em(tm=(rm=function(){function e(){De(this,e),this.entities=[]}return We(e,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(r){return this.addEntity(r.getEntity()),this}},{key:"removeRenderable",value:function(r){return this.removeEntity(r.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(r){return this.entities.indexOf(r)===-1&&this.entities.push(r),this}},{key:"removeEntity",value:function(r){var n=this.entities.indexOf(r);return this.entities.splice(n,1),this}}]),e}(),rm))||tm),im,am,om,Zy=(im=Ct(),im(am=(om=function(){function e(){De(this,e),this.cache={}}return We(e,[{key:"get",value:function(r){return this.cache[r]}},{key:"set",value:function(r,n){this.cache[r]=n}}]),e}(),om))||am),sm,um,cm,fm,go,lm,dm,hm;function vm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function pm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vm(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var mm=(sm=Ct(),um=ze(Zy),cm=ze(re.RenderEngine),sm(fm=(go=(hm=function(){function e(){De(this,e),Ve(this,"textureCache",lm,this),Ve(this,"engine",dm,this),this.config=void 0,this.loaded=!1,this.texture=void 0}return We(e,[{key:"setConfig",value:function(r){this.config=r}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:function(){var t=Tt(Pe.mark(function n(){var i=this;return Pe.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.config.url){o.next=4;break}return o.abrupt("return",new Promise(function(s,u){var c=i.textureCache.get(i.config.url);if(c)s(c);else{var f=new Image;f.crossOrigin="Anonymous",f.src=i.config.url,f.onload=function(){var d=i.engine.createTexture2D(pm(pm({},i.config),{},{data:f,width:f.width,height:f.height,flipY:!0}));i.textureCache.set(i.config.url,d),i.texture=d,i.loaded=!0,s(d)},f.onerror=function(){u()}}}));case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),o.abrupt("return",this.texture);case 7:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),hm),lm=je(go.prototype,"textureCache",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=je(go.prototype,"engine",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),go))||fm),ym,_m,Em,bm,au,gm,Tm,Am=(ym=Ct(),_m=ze(re.Systems),Em=Hr(re.RendererSystem),ym(bm=(au=(Tm=function(){function e(){De(this,e),Ve(this,"rendererSystem",gm,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return We(e,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(r){return this.camera=r,this}},{key:"setScene",value:function(r){return this.scene=r,this}},{key:"setViewport",value:function(r){return this.viewport=r,this}},{key:"setClearColor",value:function(r){return this.clearColor=r,this}},{key:"pick",value:function(r){return this.rendererSystem.pick(r,this)}}]),e}(),Tm),gm=je(au.prototype,"rendererSystem",[_m,Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au))||bm),Sm,wm,Rm,ou,Cm,xm;function Nm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function qx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nm(Object(r),!0).forEach(function(n){q(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}Sm=Ct(),wm=ze(re.ConfigService),Sm(Rm=(ou=(xm=function(){function e(){De(this,e),Ve(this,"configService",Cm,this),this.container=void 0}return We(e,[{key:"getEngine",value:function(){var t=Tt(Pe.mark(function n(){var i,a,o,s;return Pe.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=this.container.get(re.RenderEngine),a=this.configService.get(),o=a.canvas,s=a.engineOptions,c.next=4,i.init(qx({canvas:o||Cy(),swapChainFormat:Te.TextureFormat.BGRA8Unorm,antialiasing:!1},s));case 4:return c.abrupt("return",i);case 5:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getTransformComponent",value:function(r){var n=this.container.get(re.TransformComponentManager);return n.getComponentByEntity(r)}},{key:"getMeshComponent",value:function(r){var n=this.container.get(re.MeshComponentManager);return n.getComponentByEntity(r)}},{key:"setConfig",value:function(r){this.configService.set(r)}},{key:"setContainer",value:function(r){this.container=r}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return jr()}},{key:"createScene",value:function(){return this.container.get(nm)}},{key:"createCamera",value:function(){return this.container.get(Wh)}},{key:"createView",value:function(){return this.container.get(Am)}},{key:"createRenderable",value:function(r,n){var i=r?this.container.getNamed(re.Renderable,r):this.container.get(En),a=jr();return i.setConfig(n||{}),i.setEntity(a),i}},{key:"createGeometry",value:function(r,n){var i=this.container.getNamed(re.Geometry,r),a=jr();return i.setConfig(n||{}),i.setEntity(a),i.getComponent()}},{key:"createMaterial",value:function(r,n){var i=this.container.getNamed(re.Material,r),a=jr();return i.setConfig(n||{}),i.setEntity(a,r),i.getComponent()}},{key:"createTexture2D",value:function(r){var n=this.container.get(mm);return n.setConfig(r),n}},{key:"createBufferGeometry",value:function(r){var n=this.container.getNamed(re.Systems,re.GeometrySystem);return n.createBufferGeometry(r)}},{key:"createInstancedBufferGeometry",value:function(r){var n=this.container.getNamed(re.Systems,re.GeometrySystem);return n.createInstancedBufferGeometry(r)}},{key:"createShaderMaterial",value:function(r){var n=this.container.getNamed(re.Systems,re.MaterialSystem);return n.createShaderMaterial(r)}},{key:"createKernel",value:function(r){var n=this.container.get(uv);return typeof r=="string"?n.setBundle(JSON.parse(r)):n.setBundle(r),n.init(),n}},{key:"createRenderer",value:function(){var r=this.container.get(Jp);return r.container=this.container,r.init(),r}},{key:"destroy",value:function(){var r=this.container.getAll(re.Systems);r.forEach(function(a){a.tearDown&&a.tearDown()});var n=this.container.get(re.RenderEngine);n.destroy();var i=this.container.get(re.InteractorService);i.destroy()}}],[{key:"create",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Q1(),i=navigator.gpu?WR:xR;n.isBound(re.RenderEngine)||n.bind(re.RenderEngine).to(i).inSingletonScope(),n.bind(Jp).toSelf(),n.bind(uv).toSelf(),n.bind(En).toSelf(),n.bind(Am).toSelf(),n.bind(Wh).toSelf(),n.bind(nm).toSelf(),n.bind(e).toSelf(),n.bind(Zy).toSelf(),n.bind(mm).toSelf(),n.bind(re.Geometry).to(KR).whenTargetNamed(bn.BOX),n.bind(re.Geometry).to(oC).whenTargetNamed(bn.SPHERE),n.bind(re.Geometry).to(nC).whenTargetNamed(bn.PLANE),n.bind(re.Geometry).to(eC).whenTargetNamed(bn.MERGED),n.bind(re.Material).to(hC).whenTargetNamed(Ny.BASIC),n.bind(re.Renderable).to(Vx).whenTargetNamed(En.POINT),n.bind(re.Renderable).to(Mx).whenTargetNamed(En.LINE),n.bind(re.Renderable).to(_C).whenTargetNamed(En.GRID);var a=n.get(e);return a.setContainer(n),a.setConfig(r),a}}]),e}(),xm),Cm=je(ou.prototype,"configService",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou));globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;export{Zx as a,Ff as b,Sn as g,Jx as i,e2 as l,bg as n,Eg as t};
